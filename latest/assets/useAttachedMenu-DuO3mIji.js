import{b as de,j as me,c as pe,_ as he,B as xe,i as D,E as ye,R as ge,n as be,A as we}from"./index-CQ0F2wkl.js";import{P as n}from"./index-Dk74W0Oi.js";import{r,R as j}from"./index-BwDkhjyp.js";import{r as Re}from"./index-BONylQH5.js";const Ce={isRoot:!0,mode:"full",hasIcons:!1,size:null,items:[],requestCloseRoot:()=>{}};function ze(u,d){switch(d.type){case"enableIcons":return{...u,hasIcons:!0};case"registerItem":return{...u,items:[...u.items,d.payload].filter(x=>x.ref.current!==null)}}}const ee=r.createContext({state:Ce,dispatch:u=>{}}),Ee=j.createContext({direction:"ltr"});function Ae(){return r.useContext(Ee)}const $=8,Ie=r.forwardRef(function(d,x){let{children:E,className:P,containerRef:y,label:A,menuAlignment:c,mode:B="full",onClose:a,onOpen:I,open:l,size:v="sm",legacyAutoalign:R="true",target:K=xe&&document.body,x:te=0,y:ne=0,...M}=d;const m=de(),S=r.useRef(null),C=r.useContext(ee),f=C.state.isRoot;C.state.mode;const oe=f?v:C.state.size,[U,W]=r.useReducer(ze,{...C.state,isRoot:!1,mode:B,size:v,requestCloseRoot:f?L:C.state.requestCloseRoot}),T=r.useMemo(()=>({state:U,dispatch:W}),[U,W]),o=r.useRef(null),se=me([x,o]),[H,V]=r.useState([-1,-1]),g=T.state.items.filter(e=>!e.disabled&&e.ref.current);let b;if(y!=null&&y.current){const{width:e}=y.current.getBoundingClientRect();b=e}const{direction:re}=Ae();function k(){S.current&&S.current.focus()}function ie(){var e;if(o.current){if(S.current=document.activeElement,R){const t=ae();((document==null?void 0:document.dir)==="rtl"||re==="rtl")&&!((e=M==null?void 0:M.id)!=null&&e.includes("MenuButton"))?(o.current.style.insetInlineStart="initial",o.current.style.insetInlineEnd=`${t[0]}px`):(o.current.style.insetInlineStart=`${t[0]}px`,o.current.style.insetInlineEnd="initial"),o.current.style.insetBlockStart=`${t[1]}px`,V(t)}o.current.focus(),I&&I()}}function L(e){/^key/.test(e.type)?window.addEventListener("keyup",k,{once:!0}):e.type==="click"&&o.current?o.current.addEventListener("focusout",k,{once:!0}):k(),a&&a()}function ce(e){e.stopPropagation(),(D(e,ye)||!f&&D(e,ge))&&a?L(e):G(e)}function G(e){var O,p;const t=g.findIndex(i=>{var z,h;return(h=(z=i.ref)==null?void 0:z.current)==null?void 0:h.contains(document.activeElement)});let s=t;t===-1?s=0:e&&(D(e,be)&&(s=s-1),D(e,we)&&(s=s+1)),s<0&&(s=g.length-1),s>=g.length&&(s=0),s!==t&&((p=(O=g[s].ref)==null?void 0:O.current)==null||p.focus(),e==null||e.preventDefault())}function ue(e){var t;l&&a&&f&&!((t=o.current)!=null&&t.contains(e.relatedTarget))&&L(e)}function J(e,t){if(!o.current)return;const{width:s,height:O}=o.current.getBoundingClientRect(),p=f?"vertical":"horizontal",i={x:{max:window.innerWidth,size:s,anchor:p==="horizontal"?e[1]:e[0],reversedAnchor:p==="horizontal"?e[0]:e[1],offset:0},y:{max:window.innerHeight,size:O,anchor:p==="horizontal"?e[0]:e[1],reversedAnchor:p==="horizontal"?e[1]:e[0],offset:f?0:4}};if(b&&b<i.x.size&&(c==="bottom"||c==="top")&&(i.x.size=b),b&&(c==="bottom-end"||c==="top-end")&&i.x.anchor>=87&&b<i.x.size){const _=i.x.anchor+i.x.reversedAnchor;i.x.anchor=i.x.anchor+_}const{max:z,size:h,anchor:N,reversedAnchor:X,offset:q}=i[t],w=[z-$-h-N>=0?N-q:!1,X-h>=0?X-h+q:!1,z-$-h],Y=c==="top"||c==="top-end"||c==="top-start";typeof w[0]=="number"&&Y&&w[0]>=0&&!w[1]&&t==="y"?o.current.style.transform="translate(0)":Y&&!w[0]&&t==="y"&&(w[0]=N-q);const Z=w.find(_=>_!==!1);return Z>=$?Z:$}function le(e){return e!=null}function Q(e){if(Array.isArray(e)){const t=e.filter(le);return t.length===2?t:void 0}else return[e,e]}function ae(){const e={x:Q(te),y:Q(ne)};return!e.x||!e.y?[-1,-1]:[J(e.x,"x")??-1,J(e.y,"y")??-1]}r.useEffect(()=>{l&&g.length>0&&G()},[l,g]),r.useEffect(()=>{l?ie():V([-1,-1])},[l]);const fe=pe(P,`${m}--menu`,`${m}--menu--${oe}`,{[`${m}--menu--box-shadow-top`]:c&&c.slice(0,3)==="top",[`${m}--menu--open`]:l,[`${m}--menu--shown`]:l&&!R||H[0]>=0&&H[1]>=0,[`${m}--menu--with-icons`]:T.state.hasIcons,[`${m}--autoalign`]:!R}),F=j.createElement(ee.Provider,{value:T},j.createElement("ul",he({},M,{className:fe,role:"menu",ref:se,"aria-label":A,tabIndex:-1,onKeyDown:ce,onBlur:ue}),E));return K&&f?l&&Re.createPortal(F,K)||null:F});Ie.propTypes={children:n.node,className:n.string,label:n.string,menuAlignment:n.string,mode:n.oneOf(["full","basic"]),onClose:n.func,onOpen:n.func,open:n.bool,size:n.oneOf(["xs","sm","md","lg"]),target:n.object,x:n.oneOfType([n.number,n.arrayOf(n.number)]),y:n.oneOfType([n.number,n.arrayOf(n.number)])};function $e(u){const[d,x]=r.useState(!1),[E,P]=r.useState([[-1,-1],[-1,-1]]);function y(){const a=(u==null?void 0:u.current)||u;if(a){const{left:I,top:l,right:v,bottom:R}=a.getBoundingClientRect();P([[I,v],[l,R]])}x(!0)}function A(){x(!1)}function c(){d?A():y()}function B(a){a.preventDefault()}return{open:d,x:E[0],y:E[1],handleClick:c,handleMousedown:B,handleClose:A}}export{ee as M,Ie as a,$e as b,Ae as u};
