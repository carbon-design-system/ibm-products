import{u as _,r as u,e as m,c as f,p as R,aK as P}from"./iframe-Bt_4wi2_.js";import{u as v}from"./useFocusRowExpander-BxptPYQA.js";import{k as w}from"./useDatagrid-CCIMJzFR.js";const c=`${R.prefix}--datagrid`,N=o=>{const l=_(),a=u.useRef(void 0),r=u.useRef(void 0),g=p=>{a.current=p};v({instance:a?.current,lastExpandedRowIndex:r?.current,blockClass:c,activeElement:typeof document<"u"&&document.activeElement});const x=(p,h)=>{const{getAsyncSubRows:t,dispatch:e,state:s}=h.instance||{},d=!!s.dynamicRowSkeleton;return[{id:"expander",Cell:({row:n})=>{const b={...n.getToggleRowExpandedProps(),disabled:t&&d,onClick:async I=>{if(I.stopPropagation(),n.toggleRowExpanded(),r.current=n.id,!n.isExpanded)try{w({dispatch:e,status:"start",rowId:n.id,depth:n.depth,index:n.index}),t&&await t?.(n),w({dispatch:e,status:"finish",rowId:n.id})}catch($){console.log({error:$})}}},{expanderButtonTitleExpanded:C="Collapse row",expanderButtonTitleCollapsed:S="Expand row"}=a?.current||{},y=n.isExpanded?C:S;return n.canExpand||t?m.createElement("button",{type:"button","aria-label":y,className:f(`${c}__row-expander`,`${l}--btn`,`${l}--btn--ghost`),...b},m.createElement(P,{className:f(`${c}__expander-icon`,{[`${c}__expander-icon--not-open`]:!n.isExpanded,[`${c}__expander-icon--open`]:n.isExpanded})})):null},width:48,disableResizing:!0,disableSortBy:!0,Header:""},...p]};o.visibleColumns.push(x),o.useInstance.push(g)},E=`${R.prefix}--datagrid`,D=o=>{N(o);const l=a=>{u.useEffect(()=>{const{rows:t}=a,e=t.filter(s=>s?.original?.defaultExpanded);e?.length&&e.map(s=>{if(!s?.isExpanded&&!s?.hasExpanded){s?.toggleRowExpanded?.(),s.hasExpanded=!0;return}})},[a,a.rows]),u.useEffect(()=>{const{rows:t,initialState:e}=a,{expandedRowIds:s}=e;s&&Object.keys(s).forEach(d=>{const i=t.filter(n=>n.id.toString()===d.toString()||n.original?.id?.toString()===d.toString());(i.length&&d.toString()===i[0].id.toString()||i.length&&d.toString()===i[0].original?.id?.toString())&&i[0].toggleRowExpanded()})},[a]);const r=24,g=(t,{row:e})=>[t,{className:f({[`${E}__carbon-nested-row`]:e.depth>0,[`${E}__carbon-row-expanded`]:e.isExpanded})}],x=(t,{row:e})=>[t,{style:{paddingLeft:`${e.depth>1?r*2+(e.depth-1)*(r+r/3):e.depth===1?r*2:0}px`}}],p=t=>32*t+16,h=(t,{cell:e,instance:s})=>{const d=s.columns.findIndex(i=>i.id===e.column.id)===0;return[t,{style:{marginRight:d&&e.row.depth>0&&parseInt(t.style.width,10)<=p(e.row.depth)+50?`${parseInt(t.style.width,10)-(p(e.row.depth)+50)}px`:"",width:d&&e.row.depth>0?parseInt(t.style.width,10)-p(e.row.depth):t.style.width}}]};Object.assign(a,{withNestedRows:!0}),o.getRowProps.push(g),o.getRowProps.push(x),o.getCellProps.push(h)};o.useInstance.push(l)};export{D as u};
