{"version":3,"file":"index-aiv_WSu0.js","sources":["../../src/components/FeatureFlags/index.tsx"],"sourcesContent":["/**\n * Copyright IBM Corp. 2024, 2025\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport {\n  FeatureFlags as GlobalFeatureFlags,\n  createScope,\n} from '@carbon/feature-flags';\nimport PropTypes from 'prop-types';\nimport React, {\n  createContext,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n  ReactNode,\n  type JSX,\n} from 'react';\nimport { deprecateProp } from '../../global/js/utils/props-helper';\n\nexport interface FeatureFlagsProps {\n  children?: ReactNode;\n  flags?: Record<string, boolean>;\n  defaultPortalTargetBody?: boolean;\n  enableDatagridUseInlineEdit?: boolean;\n  enableDatagridUseEditableCell?: boolean;\n  enableDatagridUseCustomizeColumns?: boolean;\n  // exampleComponentSecondaryIcon?: boolean;\n  // exampleComponentUseExample?: boolean;\n  enableSidepanelResizer?: boolean;\n  enableTestFlagA?: boolean;\n  enableTestFlagB?: boolean;\n}\n//merge c4p feature flags with carbon feature flags\nGlobalFeatureFlags.merge({\n  'default-portal-target-body': true,\n  'enable-datagrid-useInlineEdit': false,\n  'enable-datagrid-useEditableCell': false,\n  'enable-datagrid-useCustomizeColumns': false,\n  'ExampleComponent.secondaryIcon': false,\n  'ExampleComponent.useExample': false,\n  'enable-test-flag-a': false, // used in testing\n  'enable-test-flag-b': true, // used in testing\n  enableSidepanelResizer: false,\n});\n/**\n * Our FeatureFlagContext is used alongside the FeatureFlags component to enable\n * or disable feature flags in a given React tree\n */\nconst FeatureFlagContext = createContext(GlobalFeatureFlags);\n\n/**\n * Supports an object of feature flag values with the `flags` prop, merging them\n * along with the current `FeatureFlagContext` to provide consumers to check if\n * a feature flag is enabled or disabled in a given React tree\n */\nfunction FeatureFlags({\n  children,\n  flags = {},\n  defaultPortalTargetBody = true,\n  enableDatagridUseInlineEdit = false,\n  enableDatagridUseEditableCell = false,\n  enableDatagridUseCustomizeColumns = false,\n  // exampleComponentSecondaryIcon = false,\n  // exampleComponentUseExample = false,\n  enableSidepanelResizer = false,\n  enableTestFlagA = false,\n  enableTestFlagB = false,\n}: FeatureFlagsProps): JSX.Element {\n  const parentScope = useContext(FeatureFlagContext);\n  const [prevParentScope, setPrevParentScope] = useState(parentScope);\n\n  const combinedFlags = {\n    'default-portal-target-body': defaultPortalTargetBody,\n    'enable-datagrid-useInlineEdit': enableDatagridUseInlineEdit,\n    'enable-datagrid-useEditableCell': enableDatagridUseEditableCell,\n    'enable-datagrid-useCustomizeColumns': enableDatagridUseCustomizeColumns,\n    // 'ExampleComponent.secondaryIcon': exampleComponentSecondaryIcon,\n    // 'ExampleComponent.useExample': exampleComponentUseExample,\n    enableSidepanelResizer: enableSidepanelResizer,\n    'enable-test-flag-a': enableTestFlagA,\n    'enable-test-flag-b': enableTestFlagB,\n    ...flags,\n  };\n  const [scope, updateScope] = useState(() => {\n    const scope = createScope(combinedFlags);\n    scope.mergeWithScope(parentScope);\n    return scope;\n  });\n\n  if (parentScope !== prevParentScope) {\n    const scope = createScope(combinedFlags);\n    scope.mergeWithScope(parentScope);\n    updateScope(scope);\n    setPrevParentScope(parentScope);\n  }\n\n  // We use a custom hook to detect if any of the keys or their values change\n  // for flags that are passed in. If they have changed, then we re-create the\n  // FeatureFlagScope using the new flags\n  useChangedValue(combinedFlags, isEqual, (changedFlags) => {\n    const scope = createScope(changedFlags);\n    scope.mergeWithScope(parentScope);\n    updateScope(scope);\n  });\n\n  return (\n    <FeatureFlagContext.Provider value={scope}>\n      {children}\n    </FeatureFlagContext.Provider>\n  );\n}\n\nFeatureFlags.propTypes = {\n  children: PropTypes.node,\n\n  /**\n   * Provide the feature flags to enabled or disabled in the current React tree\n   */\n  defaultPortalTargetBody: PropTypes.bool,\n  enableDatagridUseCustomizeColumns: PropTypes.bool,\n  enableDatagridUseEditableCell: PropTypes.bool,\n  enableDatagridUseInlineEdit: PropTypes.bool,\n  enableSidepanelResizer: PropTypes.bool,\n  enableTestFlagA: PropTypes.bool,\n  enableTestFlagB: PropTypes.bool,\n  // exampleComponentSecondaryIcon: PropTypes.bool,\n  // exampleComponentUseExample: PropTypes.bool,\n  flags: deprecateProp(\n    PropTypes.objectOf(PropTypes.bool),\n    'The `flags` prop for `FeatureFlag` has been deprecated. Please pass the flags directly as props in camelCase'\n  ),\n};\n\n/**\n * This hook will store previous versions of the given `value` and compare the\n * current value to the previous one using the `compare` function. If the\n * compare function returns true, then the given `callback` is invoked in an\n * effect.\n *\n * @param {any} value\n * @param {Function} compare\n * @param {Function} callback\n */\nfunction useChangedValue<T>(\n  value: T,\n  compare: (a: T, b: T) => boolean,\n  callback: (value: T) => void\n) {\n  const initialRender = useRef(false);\n  const savedCallback = useRef(callback);\n  const [prevValue, setPrevValue] = useState(value);\n\n  if (!compare(prevValue, value)) {\n    setPrevValue(value);\n  }\n\n  useEffect(() => {\n    savedCallback.current = callback;\n  });\n\n  useEffect(() => {\n    // We only want the callback triggered after the first render\n    if (initialRender.current) {\n      savedCallback.current(prevValue);\n    }\n  }, [prevValue]);\n\n  useEffect(() => {\n    initialRender.current = true;\n  }, []);\n}\n\n/**\n * Access whether a given flag is enabled or disabled in a given\n * FeatureFlagContext\n *\n * @returns {boolean}\n */\nfunction useFeatureFlag(flag) {\n  const scope = useContext(FeatureFlagContext);\n  return scope.enabled(flag);\n}\n\n/**\n * Access all feature flag information for the given FeatureFlagContext\n *\n * @returns {FeatureFlagScope}\n */\nfunction useFeatureFlags() {\n  return useContext(FeatureFlagContext);\n}\n\n/**\n * Compare two objects and determine if they are equal. This is a shallow\n * comparison since the objects we are comparing are objects with boolean flags\n * from the flags prop in the `FeatureFlags` component\n *\n * @param {object} a\n * @param {object} b\n * @returns {boolean}\n */\nfunction isEqual(\n  a: Record<string, boolean>,\n  b: Record<string, boolean>\n): boolean {\n  if (a === b) {\n    return true;\n  }\n\n  for (const key of Object.keys(a)) {\n    if (a[key] !== b[key]) {\n      return false;\n    }\n  }\n\n  for (const key of Object.keys(b)) {\n    if (b[key] !== a[key]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nexport { FeatureFlags, FeatureFlagContext, useFeatureFlags, useFeatureFlag };\n"],"names":["GlobalFeatureFlags","FeatureFlagContext","createContext","FeatureFlags","children","flags","defaultPortalTargetBody","enableDatagridUseInlineEdit","enableDatagridUseEditableCell","enableDatagridUseCustomizeColumns","enableSidepanelResizer","enableTestFlagA","enableTestFlagB","parentScope","useContext","prevParentScope","setPrevParentScope","useState","combinedFlags","scope","updateScope","createScope","useChangedValue","isEqual","changedFlags","PropTypes","deprecateProp","value","compare","callback","initialRender","useRef","savedCallback","prevValue","setPrevValue","useEffect","useFeatureFlag","flag","useFeatureFlags","a","b","key"],"mappings":"oHAqCAA,EAAmB,MAAM,CACvB,6BAA8B,GAC9B,gCAAiC,GACjC,kCAAmC,GACnC,sCAAuC,GACvC,iCAAkC,GAClC,8BAA+B,GAC/B,qBAAsB,GACtB,qBAAsB,GACtB,uBAAwB,EAC1B,CAAC,EAKD,MAAMC,EAAqBC,EAAAA,cAAcF,CAAkB,EAO3D,SAASG,EAAa,CACpB,SAAAC,EACA,MAAAC,EAAQ,CAAA,EACR,wBAAAC,EAA0B,GAC1B,4BAAAC,EAA8B,GAC9B,8BAAAC,EAAgC,GAChC,kCAAAC,EAAoC,GAGpC,uBAAAC,EAAyB,GACzB,gBAAAC,EAAkB,GAClB,gBAAAC,EAAkB,EACpB,EAAmC,CACjC,MAAMC,EAAcC,EAAAA,WAAWb,CAAkB,EAC3C,CAACc,EAAiBC,CAAkB,EAAIC,EAAAA,SAASJ,CAAW,EAE5DK,EAAgB,CACpB,6BAA8BZ,EAC9B,gCAAiCC,EACjC,kCAAmCC,EACnC,sCAAuCC,EAGvC,uBAAAC,EACA,qBAAsBC,EACtB,qBAAsBC,EACtB,GAAGP,CAAA,EAEC,CAACc,EAAOC,CAAW,EAAIH,EAAAA,SAAS,IAAM,CAC1C,MAAME,EAAQE,EAAYH,CAAa,EACvCC,OAAAA,EAAM,eAAeN,CAAW,EACzBM,CACT,CAAC,EAED,GAAIN,IAAgBE,EAAiB,CACnC,MAAMI,EAAQE,EAAYH,CAAa,EACvCC,EAAM,eAAeN,CAAW,EAChCO,EAAYD,CAAK,EACjBH,EAAmBH,CAAW,CAChC,CAKA,OAAAS,EAAgBJ,EAAeK,EAAUC,GAAiB,CACxD,MAAML,EAAQE,EAAYG,CAAY,EACtCL,EAAM,eAAeN,CAAW,EAChCO,EAAYD,CAAK,CACnB,CAAC,kBAGElB,EAAmB,SAAnB,CAA4B,MAAOkB,GACjCf,CACH,CAEJ,CAEAD,EAAa,UAAY,CACvB,SAAUsB,EAAU,KAKpB,wBAAyBA,EAAU,KACnC,kCAAmCA,EAAU,KAC7C,8BAA+BA,EAAU,KACzC,4BAA6BA,EAAU,KACvC,uBAAwBA,EAAU,KAClC,gBAAiBA,EAAU,KAC3B,gBAAiBA,EAAU,KAG3B,MAAOC,EACLD,EAAU,SAASA,EAAU,IAAI,CAEnC,CACF,EAYA,SAASH,EACPK,EACAC,EACAC,EACA,CACA,MAAMC,EAAgBC,EAAAA,OAAO,EAAK,EAC5BC,EAAgBD,EAAAA,OAAOF,CAAQ,EAC/B,CAACI,EAAWC,CAAY,EAAIjB,EAAAA,SAASU,CAAK,EAE3CC,EAAQK,EAAWN,CAAK,GAC3BO,EAAaP,CAAK,EAGpBQ,EAAAA,UAAU,IAAM,CACdH,EAAc,QAAUH,CAC1B,CAAC,EAEDM,EAAAA,UAAU,IAAM,CAEVL,EAAc,SAChBE,EAAc,QAAQC,CAAS,CAEnC,EAAG,CAACA,CAAS,CAAC,EAEdE,EAAAA,UAAU,IAAM,CACdL,EAAc,QAAU,EAC1B,EAAG,CAAA,CAAE,CACP,CAQA,SAASM,EAAeC,EAAM,CAE5B,OADcvB,EAAAA,WAAWb,CAAkB,EAC9B,QAAQoC,CAAI,CAC3B,CAOA,SAASC,GAAkB,CACzB,OAAOxB,EAAAA,WAAWb,CAAkB,CACtC,CAWA,SAASsB,EACPgB,EACAC,EACS,CACT,GAAID,IAAMC,EACR,MAAO,GAGT,UAAWC,KAAO,OAAO,KAAKF,CAAC,EAC7B,GAAIA,EAAEE,CAAG,IAAMD,EAAEC,CAAG,EAClB,MAAO,GAIX,UAAWA,KAAO,OAAO,KAAKD,CAAC,EAC7B,GAAIA,EAAEC,CAAG,IAAMF,EAAEE,CAAG,EAClB,MAAO,GAIX,MAAO,EACT"}