{"version":3,"file":"useSelectRows-QkCSNAP9.js","sources":["../../src/components/Datagrid/useSelectRows.tsx"],"sourcesContent":["/**\n * Copyright IBM Corp. 2020, 2025\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React, { useCallback, useState } from 'react';\nimport { useIsomorphicEffect } from '../../global/js/hooks';\nimport cx from 'classnames';\nimport { TableSelectRow, usePrefix } from '@carbon/react';\nimport { SelectAll } from './Datagrid/DatagridSelectAll';\nimport { selectionColumnId } from './common-column-ids';\nimport { pkg } from '../../settings';\nimport { handleToggleRowSelected } from './Datagrid/addons/stateReducer';\nimport { ColumnInstance, Hooks, TableInstance } from 'react-table';\nimport { DataGridState } from './types';\n\nconst blockClass = `${pkg.prefix}--datagrid`;\nconst checkboxClass = `${pkg.prefix}--datagrid__checkbox-cell`;\n\nconst renderSelectAll = (gridState: DataGridState) => (\n  <SelectAll {...gridState} />\n);\nconst renderSelectCell = (gridState: DataGridState) => (\n  <SelectRow {...gridState} />\n);\n\nconst useSelectRows = (hooks: Hooks) => {\n  useHighlightSelection(hooks);\n  const useInstance = (instance: TableInstance) => {\n    const { rows } = instance;\n    const rowsWithSelect = rows.map((row) => ({ ...row, isSelectable: true }));\n    Object.assign(instance, { rows: rowsWithSelect });\n  };\n  hooks.useInstance.push(useInstance);\n  hooks.useInstance.push((instance) => {\n    Object.assign(instance, {\n      withSelectRows: true,\n    });\n  });\n  hooks.visibleColumns.push((columns) => {\n    // Ensures that the first column is the row expander in the\n    // case of selected rows and expandable rows being used together\n    const newColOrder = [...columns];\n    const expanderColumnIndex = newColOrder.findIndex(\n      (col) => col.id === 'expander'\n    );\n    const expanderCol =\n      expanderColumnIndex > -1\n        ? newColOrder.splice(expanderColumnIndex, 1)\n        : [];\n    return [\n      ...(expanderColumnIndex > -1 && expanderCol && expanderCol.length\n        ? expanderCol\n        : []),\n      {\n        id: selectionColumnId,\n        Header: renderSelectAll,\n        Cell: renderSelectCell,\n      },\n      ...newColOrder,\n    ] as ColumnInstance[];\n  });\n};\n\nconst useHighlightSelection = (hooks) => {\n  const carbonPrefix = usePrefix();\n  const getRowProps = (props, { row }) => {\n    const { checked } = row.getToggleRowSelectedProps();\n    return [\n      props,\n      {\n        className: cx([\n          `${blockClass}__carbon-row`,\n          {\n            [`${carbonPrefix}--data-table--selected`]: checked,\n            [`${blockClass}__active-row`]: checked,\n          },\n        ]),\n      },\n    ];\n  };\n  hooks.getRowProps.push(getRowProps);\n};\n\nconst SelectRow = (datagridState) => {\n  const {\n    isFetching = false,\n    tableId,\n    row,\n    cell,\n    radio,\n    toggleAllRowsSelected,\n    onRadioSelect,\n    onRowSelect,\n    columns,\n    withStickyColumn,\n    dispatch,\n    getRowId,\n  } = datagridState;\n\n  const [windowSize, setWindowSize] = useState<number>();\n\n  useIsomorphicEffect(() => {\n    setWindowSize(window.innerWidth);\n    function updateSize() {\n      setWindowSize(window.innerWidth);\n    }\n    window.addEventListener('resize', updateSize);\n    return () => window.removeEventListener('resize', updateSize);\n  }, []);\n\n  const selectDisabled = isFetching || row.getRowProps().disabled;\n  const { onChange, title, ...selectProps } = row.getToggleRowSelectedProps();\n  const cellProps = cell.getCellProps();\n  const isFirstColumnStickyLeft =\n    columns[0]?.sticky === 'left' && withStickyColumn;\n  const rowId = `${tableId}-${row.id}-${row.index}`;\n  const { key, _cellProps } = cellProps;\n\n  const onSelectHandler = useCallback(\n    (event) => {\n      event.stopPropagation(); // avoid triggering onRowClick\n      if (radio) {\n        toggleAllRowsSelected(false);\n        if (onRadioSelect) {\n          onRadioSelect(row);\n        }\n      }\n      onChange(event);\n      onRowSelect?.(row, event);\n      handleToggleRowSelected({\n        dispatch,\n        rowData: row,\n        isChecked: event.target.checked,\n        getRowId,\n        selectAll: null,\n      });\n    },\n    [\n      dispatch,\n      getRowId,\n      onChange,\n      onRadioSelect,\n      onRowSelect,\n      radio,\n      row,\n      toggleAllRowsSelected,\n    ]\n  );\n\n  return (\n    <TableSelectRow\n      key={key}\n      {..._cellProps}\n      {...selectProps}\n      radio={radio}\n      onSelect={onSelectHandler}\n      id={rowId}\n      name={`${rowId}-name`}\n      className={cx([\n        checkboxClass,\n        cellProps.className,\n        {\n          [`${checkboxClass}-sticky-left`]:\n            isFirstColumnStickyLeft && Number(windowSize) > 671,\n        },\n      ])}\n      aria-label={title}\n      disabled={selectDisabled}\n    />\n  );\n};\n\nexport default useSelectRows;\n"],"names":["blockClass","pkg","checkboxClass","renderSelectAll","gridState","React","SelectAll","renderSelectCell","SelectRow","useSelectRows","hooks","useHighlightSelection","useInstance","instance","rows","rowsWithSelect","row","columns","newColOrder","expanderColumnIndex","col","expanderCol","selectionColumnId","carbonPrefix","usePrefix","getRowProps","props","checked","cx","datagridState","isFetching","tableId","cell","radio","toggleAllRowsSelected","onRadioSelect","onRowSelect","withStickyColumn","dispatch","getRowId","windowSize","setWindowSize","useState","useIsomorphicEffect","updateSize","selectDisabled","onChange","title","selectProps","cellProps","isFirstColumnStickyLeft","rowId","key","_cellProps","onSelectHandler","useCallback","event","handleToggleRowSelected","TableSelectRow"],"mappings":"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"}