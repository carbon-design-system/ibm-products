{"version":3,"file":"useActionsColumn-BLj8avxF.js","sources":["../../src/components/Datagrid/useActionsColumn.tsx"],"sourcesContent":["/**\n * Copyright IBM Corp. 2021, 2023\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport cx from 'classnames';\nimport {\n  IconSkeleton,\n  OverflowMenu,\n  OverflowMenuItem,\n  IconButton,\n} from '@carbon/react';\nimport { pkg } from '../../settings';\nimport { prepareProps } from '../../global/js/utils/props-helper';\nimport { Hooks, TableInstance } from 'react-table';\nimport { DataGridState, RowAction } from './types';\nconst blockClass = `${pkg.prefix}--datagrid`;\n\nconst useActionsColumn = (hooks: Hooks) => {\n  const useAttachActionsOnInstance = (instance: TableInstance) => {\n    const {\n      rowActions,\n      isFetching,\n      state: { selectedRowIds },\n    } = instance as DataGridState;\n    const getDisabledState = (rowIndex) => {\n      const selectedRowIndexes = Object.keys(selectedRowIds).map((n) =>\n        Number(n)\n      );\n      if (selectedRowIndexes.includes(rowIndex)) {\n        return true;\n      }\n      return false;\n    };\n\n    if (rowActions && Array.isArray(rowActions)) {\n      const addActionsMenu = (props, cellData) => {\n        const { cell } = cellData;\n        const { row, column } = cell;\n        if (column.isAction) {\n          const isColumnSticky = !!column.sticky;\n          return [\n            props,\n            {\n              children: (\n                <div className={`${blockClass}__actions-column-contents`}>\n                  {isFetching && (\n                    <IconSkeleton\n                      className={`${blockClass}__actions-column-loading`}\n                    />\n                  )}\n                  {/* Icon buttons */}\n                  {!isFetching && rowActions.length <= 2 && !isColumnSticky && (\n                    <div className={`${blockClass}_actions-column`}>\n                      {rowActions.map((action, index) => {\n                        const preparedActionProps: RowAction = prepareProps(\n                          action,\n                          ['isDelete']\n                        );\n                        const {\n                          align,\n                          id,\n                          itemText,\n                          onClick,\n                          icon,\n                          shouldHideMenuItem,\n                          shouldDisableMenuItem,\n                          disabled,\n                          ...rest\n                        } = preparedActionProps;\n                        const hidden =\n                          typeof shouldHideMenuItem === 'function' &&\n                          shouldHideMenuItem(row);\n                        const isDisabledByRow =\n                          typeof shouldDisableMenuItem === 'function'\n                            ? shouldDisableMenuItem(row)\n                            : disabled;\n                        if (hidden) {\n                          return null;\n                        }\n                        const Icon = icon;\n                        return (\n                          <div\n                            className={cx(\n                              `${blockClass}__actions-column-button`,\n                              {\n                                [`${blockClass}__disabled-row-action-button`]:\n                                  getDisabledState(row.index),\n                              }\n                            )}\n                            key={`${itemText}__${index}`}\n                          >\n                            <IconButton\n                              {...rest}\n                              align={align || 'top'}\n                              label={itemText}\n                              kind=\"ghost\"\n                              name={itemText} //for test use\n                              className={cx({\n                                [`${blockClass}__disabled-row-action`]:\n                                  getDisabledState(row.index),\n                              })}\n                              onClick={(e) => {\n                                if (getDisabledState(row.index)) {\n                                  // Row actions should be disabled if row is selected and batchActions toolbar is active\n                                  return;\n                                }\n                                e.stopPropagation();\n                                onClick?.(id, row, e);\n                              }}\n                              disabled={isDisabledByRow}\n                            >\n                              {Icon && <Icon />}\n                            </IconButton>\n                          </div>\n                        );\n                      })}\n                    </div>\n                  )}\n                  {/* Overflow menu */}\n                  {!isFetching && (rowActions.length > 2 || isColumnSticky) && (\n                    <div>\n                      <OverflowMenu\n                        align=\"left\"\n                        size=\"sm\"\n                        flipped\n                        onClick={(e) => {\n                          e.stopPropagation();\n                        }}\n                      >\n                        {rowActions.map((action) => {\n                          const {\n                            id,\n                            onClick,\n                            shouldHideMenuItem,\n                            shouldDisableMenuItem,\n                            disabled,\n                            ...rest\n                          } = action;\n                          const hidden =\n                            typeof shouldHideMenuItem === 'function' &&\n                            shouldHideMenuItem(row);\n                          // shouldDisableMenuItem will override disabled because it's more specific\n                          // if shouldDisableMenuItem doesn't exists, fall back to disabled\n                          const isDisabledByRow =\n                            typeof shouldDisableMenuItem === 'function'\n                              ? shouldDisableMenuItem(row)\n                              : disabled;\n                          if (hidden) {\n                            return null;\n                          }\n                          return (\n                            <OverflowMenuItem\n                              {...rest}\n                              disabled={isDisabledByRow}\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                onClick?.(id, row, e);\n                              }}\n                              key={id}\n                            />\n                          );\n                        })}\n                      </OverflowMenu>\n                    </div>\n                  )}\n                </div>\n              ),\n              className: cx({\n                [`${blockClass}__actions-column-cell`]: true,\n                [`${blockClass}__cell`]: true,\n                [`${blockClass}__actions-column-cell-non-sticky`]:\n                  !isColumnSticky,\n              }),\n              style: {\n                width: rowActions.length > 2 || isColumnSticky ? 48 : 96,\n              },\n            },\n          ];\n        }\n        return [props];\n      };\n      hooks.getCellProps.push(addActionsMenu);\n    }\n  };\n  const useStickyHeaderWidth = (instance) => {\n    const { rowActions } = instance;\n    if (rowActions && Array.isArray(rowActions)) {\n      const addHeaderWidth = (props, cellData) => {\n        const { column } = cellData;\n        if (column.isAction) {\n          const isColumnSticky = !!column.sticky;\n          return [\n            props,\n            {\n              style: {\n                ...props.style,\n                width: rowActions.length > 2 || isColumnSticky ? 48 : 96, // set header width based on action length\n              },\n            },\n          ];\n        }\n        return [props];\n      };\n      hooks.getHeaderProps.push(addHeaderWidth);\n    }\n  };\n\n  hooks.useInstance.push(useStickyHeaderWidth);\n  hooks.useInstance.push(useAttachActionsOnInstance);\n};\n\nexport default useActionsColumn;\n"],"names":["blockClass","pkg","useActionsColumn","hooks","useAttachActionsOnInstance","instance","rowActions","isFetching","selectedRowIds","getDisabledState","rowIndex","n","addActionsMenu","props","cellData","cell","row","column","isColumnSticky","React","IconSkeleton","action","index","preparedActionProps","prepareProps","align","id","itemText","onClick","icon","shouldHideMenuItem","shouldDisableMenuItem","disabled","rest","hidden","isDisabledByRow","Icon","cx","IconButton","e","OverflowMenu","OverflowMenuItem","useStickyHeaderWidth","addHeaderWidth"],"mappings":"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"}