import{r as u,e as d}from"./index-DzvNrmz8.js";import{b as se,c as le,F as ie,e as ne,C as oe,f as ue,B as _,g as ce,I as de,R as pe,M as fe,i as me,N as ye,j as he}from"./useDatagrid-BqCGh2fF.js";import{b as be,d as T,P as r}from"./index-5As4T26e.js";import{p as ge,I as Fe}from"./settings-DbzZchXt.js";import{p as q,b as ve}from"./index-Bfrl1yb6.js";import{u as Ce}from"./useWindowResize-pcJgHAcV.js";import{u as Ae}from"./useClickOutside-SlvtHE5q.js";import{A as qe}from"./ActionSet-CYm8Ussl.js";import{F as we}from"./bucket-6-BVxmYIXv.js";const Oe=`${ge.prefix}--datagrid`,n=`${Oe}-filter-flyout`,v={flyoutIconDescription:"Open filters",title:"Filter",primaryActionLabel:"Apply",secondaryActionLabel:"Cancel",align:"bottom"},V=[],L=({updateMethod:o,flyoutIconDescription:p=v.flyoutIconDescription,align:t=v.align,filters:a=V,title:e=v.title,primaryActionLabel:s=v.primaryActionLabel,onFlyoutOpen:f=()=>{},onFlyoutClose:c=()=>{},onApply:b=()=>{},onCancel:y=()=>{},secondaryActionLabel:h=v.secondaryActionLabel,setAllFilters:x,data:j=V,reactTableFiltersState:w=V})=>{const[C,O]=u.useState(!1),[M,I]=u.useState(!1),B=()=>{O(!1),y()},{filtersState:S,prevFiltersObjectArrayRef:W,prevFiltersRef:D,cancel:N,reset:z,renderFilter:J,filtersObjectArray:g,lastAppliedFilters:A}=se({updateMethod:o,filters:a,setAllFilters:x,variation:ue,reactTableFiltersState:w,onCancel:B}),{width:U}=ve.md,H=parseInt(U)*16,P=u.useRef(null),l=u.useRef(null),K=u.useRef(null),[X,Y]=le({initialValue:!0,filtersState:S,prevFiltersRef:D}),G=i=>{const m=l==null?void 0:l.current.getBoundingClientRect(),F=parseInt(window.getComputedStyle(l==null?void 0:l.current).getPropertyValue("width"));if(Math.sign(m.left)===-1){const E=F-Math.abs(m.left);l.current.style.width=q(E)}if(F<642&&Math.sign(m.left)===1||Math.sign(m.left).toString()==="0"){const E=F+Math.abs(m.left);l.current.style.width=q(E)}(i==null?void 0:i.innerWidth)<=H+254?I(!0):I(!1)};Ce(({current:i})=>{G(i)});const{dispatch:Q}=u.useContext(ie),k=o===_,Z=be(),ee=()=>{O(!0),f()},R=()=>{O(!1),c(),l.current.style.width=q(642)};u.useEffect(()=>{l.current.style.width=q(642)},[]);const te=()=>{x(g),R(),b({filtersState:S,filtersObjectArray:g,lastAppliedFilters:A}),Y(!0),D.current=JSON.stringify(S),W.current=JSON.stringify(g),A.current=JSON.stringify(g),Q({type:ce,payload:{savedFilters:g}})},re=()=>a.map(J),ae=()=>k&&d.createElement(qe,{actions:[{key:1,kind:"primary",label:s,onClick:te,isExpressive:!1,disabled:X},{key:3,kind:"secondary",label:h,onClick:N,isExpressive:!1}],size:"md",buttonSize:"md"});return Ae(P,i=>{const m=i.closest(".flatpickr-calendar"),F=i.className===`${Z}--list-box__menu-item__option`;!C||m||F||(R(),N())}),ne(oe,i=>{z(i)}),u.useEffect(function(){A.current=JSON.stringify(w)},[w,A]),d.createElement("div",{className:`${n}__container`,ref:P},d.createElement(Fe,{label:p,kind:"ghost",align:t,onClick:C?R:ee,className:T(`${n}__trigger`,{[`${n}__trigger--open`]:C}),disabled:j.length===0},d.createElement(we,null)),d.createElement("div",{className:T(n,{[`${n}--open`]:C,[`${n}--batch`]:k,[`${n}--instant`]:!k}),ref:l},d.createElement("div",{className:`${n}__inner-container`},d.createElement("span",{className:`${n}__title`},e),d.createElement("div",{className:T(`${n}__filters`,{[`${n}__stacked`]:M}),ref:K},re())),ae()))};L.propTypes={align:r.string,data:r.array.isRequired,filters:r.arrayOf(r.shape({type:r.string.isRequired,column:r.string.isRequired,props:r.object.isRequired})).isRequired,flyoutIconDescription:r.string,onApply:r.func,onCancel:r.func,onFlyoutClose:r.func,onFlyoutOpen:r.func,primaryActionLabel:r.string,reactTableFiltersState:r.arrayOf(r.shape({id:r.string.isRequired,type:r.string.isRequired,value:r.any.isRequired})),secondaryActionLabel:r.string,setAllFilters:r.func.isRequired,title:r.string,updateMethod:r.oneOf([_,de]).isRequired};L.__docgenInfo={description:"",methods:[],displayName:"FilterFlyout",props:{flyoutIconDescription:{defaultValue:{value:"'Open filters'",computed:!1},description:"Icon description for the filter flyout button",type:{name:"string"},required:!1},align:{defaultValue:{value:"'bottom'",computed:!1},description:"Tooltip alignment for the filter button",type:{name:"string"},required:!1},filters:{defaultValue:{value:"[]",computed:!1},description:"Array of filters to render",type:{name:"arrayOf",value:{name:"shape",value:{type:{name:"string",required:!0},column:{name:"string",required:!0},props:{name:"object",required:!0}}}},required:!1},title:{defaultValue:{value:"'Filter'",computed:!1},description:"Title of the filter flyout",type:{name:"string"},required:!1},primaryActionLabel:{defaultValue:{value:"'Apply'",computed:!1},description:"Label text of the primary action in the flyout",type:{name:"string"},required:!1},onFlyoutOpen:{defaultValue:{value:"() => {}",computed:!1},description:"Callback when the flyout opens",type:{name:"func"},required:!1},onFlyoutClose:{defaultValue:{value:"() => {}",computed:!1},description:"Callback when the flyout closes",type:{name:"func"},required:!1},onApply:{defaultValue:{value:"() => {}",computed:!1},description:"Callback when the apply button is clicked",type:{name:"func"},required:!1},onCancel:{defaultValue:{value:"() => {}",computed:!1},description:"Callback when the cancel button is clicked",type:{name:"func"},required:!1},secondaryActionLabel:{defaultValue:{value:"'Cancel'",computed:!1},description:"Label text of the secondary action in the flyout",type:{name:"string"},required:!1},data:{defaultValue:{value:"[]",computed:!1},description:"All data rows in the table",type:{name:"array"},required:!1},reactTableFiltersState:{defaultValue:{value:"[]",computed:!1},description:"Filters from react table's state",type:{name:"arrayOf",value:{name:"shape",value:{id:{name:"string",required:!0},type:{name:"string",required:!0},value:{name:"any",required:!0}}}},required:!1},setAllFilters:{description:"Function that sets all the filters, this comes from the datagridState",type:{name:"func"},required:!0},updateMethod:{description:"The update method used to apply the filters",type:{name:"enum",value:[{value:"'batch'",computed:!1},{value:"'instant'",computed:!1}]},required:!0}}};const Se=(o,p,t)=>o.filter(a=>p.some(e=>{const s=a.values[e];return s!==void 0?String(s).toLowerCase()===String(t).toLowerCase():!0})),$=(o,p,t)=>{const a=t.filter(e=>e.selected).map(e=>e.value);return a.length===0?o:o.filter(e=>{const s=e.values[p];return a.includes(s)})},De=o=>{const p=u.useMemo(()=>({[he]:(t,a,[e,s])=>t.filter(f=>{const c=f.values[a],b=typeof e=="object"?e:new Date(e),y=typeof s=="object"?s:new Date(s),h=typeof c=="object"?c:new Date(c);return h.getTime()<=y.getTime()&&h.getTime()>=b.getTime()}),[ye]:(t,a,e)=>{if(e==="")return t;const s=parseInt(e);return t.filter(f=>f.values[a]===s)},[me]:(t,a,e)=>$(t,a,e),[fe]:(t,a,e)=>$(t,a,e),[pe]:(t,a,e)=>Se(t,a,e)}),[]);o.useInstance.push(t=>{const{filterProps:a,setAllFilters:e,setFilter:s,headers:f,data:c,state:b}=t,y={variation:"flyout",updateMethod:_,panelIconDescription:"Open filter panel",reactTableFiltersState:b.filters},h=()=>({...y,...a,setAllFilters:e,setFilter:s,headers:f,data:c});Object.assign(t,{filterProps:{...y,...t==null?void 0:t.filterProps},filterTypes:p,getFilterFlyoutProps:h,FilterFlyout:L})})};export{De as u};
