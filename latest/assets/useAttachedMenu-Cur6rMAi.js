import{u as de,b as me,c as pe,_ as he,l as ye,a as O,E as xe,v as ge,z as be,y as we}from"./useMergedRefs-DoviDd4t.js";import{P as n}from"./index-Dk74W0Oi.js";import{r,R as _}from"./index-BwDkhjyp.js";import{r as ze}from"./index-BONylQH5.js";const Ce={isRoot:!0,mode:"full",hasIcons:!1,size:null,items:[],requestCloseRoot:()=>{}};function Re(u,d){switch(d.type){case"enableIcons":return{...u,hasIcons:!0};case"registerItem":return{...u,items:[...u.items,d.payload].filter(p=>p.ref.current!==null)}}}const ee=r.createContext({state:Ce,dispatch:u=>{}}),Ee=_.createContext({direction:"ltr"});function Ae(){return r.useContext(Ee)}const D=8,Ie=r.forwardRef(function(d,p){let{children:z,className:P,containerRef:h,label:C,menuAlignment:c,mode:$="full",onClose:a,onOpen:R,open:l,size:E="sm",legacyAutoalign:A="true",target:K=ye&&document.body,x:te=0,y:ne=0,...I}=d;const y=de(),S=r.useRef(null),w=r.useContext(ee),f=w.state.isRoot;w.state.mode;const oe=f?E:w.state.size,[U,W]=r.useReducer(Re,{...w.state,isRoot:!1,mode:$,size:E,requestCloseRoot:f?k:w.state.requestCloseRoot}),B=r.useMemo(()=>({state:U,dispatch:W}),[U,W]),o=r.useRef(null),se=me([p,o]),[j,H]=r.useState([-1,-1]),x=B.state.items.filter(e=>!e.disabled&&e.ref.current);let g;if(h!=null&&h.current){const{width:e}=h.current.getBoundingClientRect();g=e}const{direction:re}=Ae();function T(){S.current&&S.current.focus()}function ie(){var e;if(o.current){if(S.current=document.activeElement,A){const t=ae();((document==null?void 0:document.dir)==="rtl"||re==="rtl")&&!((e=I==null?void 0:I.id)!=null&&e.includes("MenuButton"))?(o.current.style.insetInlineStart="initial",o.current.style.insetInlineEnd=`${t[0]}px`):(o.current.style.insetInlineStart=`${t[0]}px`,o.current.style.insetInlineEnd="initial"),o.current.style.insetBlockStart=`${t[1]}px`,H(t)}o.current.focus(),R&&R()}}function k(e){/^key/.test(e.type)?window.addEventListener("keyup",T,{once:!0}):e.type==="click"&&o.current?o.current.addEventListener("focusout",T,{once:!0}):T(),a&&a()}function ce(e){e.stopPropagation(),(O(e,xe)||!f&&O(e,ge))&&a?k(e):V(e)}function V(e){const t=x.findIndex(v=>{var m,i;return(i=(m=v.ref)==null?void 0:m.current)==null?void 0:i.contains(document.activeElement)});let s=t;t===-1?s=0:e&&(O(e,be)&&(s=s-1),O(e,we)&&(s=s+1)),s<0&&(s=x.length-1),s>=x.length&&(s=0),s!==t&&x[s].ref.current.focus()}function ue(e){var t;l&&a&&f&&!((t=o.current)!=null&&t.contains(e.relatedTarget))&&k(e)}function G(e,t){if(!o.current)return;const{width:s,height:v}=o.current.getBoundingClientRect(),m=f?"vertical":"horizontal",i={x:{max:window.innerWidth,size:s,anchor:m==="horizontal"?e[1]:e[0],reversedAnchor:m==="horizontal"?e[0]:e[1],offset:0},y:{max:window.innerHeight,size:v,anchor:m==="horizontal"?e[0]:e[1],reversedAnchor:m==="horizontal"?e[1]:e[0],offset:f?0:4}};if(g&&g<i.x.size&&(c==="bottom"||c==="top")&&(i.x.size=g),g&&(c==="bottom-end"||c==="top-end")&&i.x.anchor>=87&&g<i.x.size){const q=i.x.anchor+i.x.reversedAnchor;i.x.anchor=i.x.anchor+q}const{max:Q,size:M,anchor:F,reversedAnchor:X,offset:N}=i[t],b=[Q-D-M-F>=0?F-N:!1,X-M>=0?X-M+N:!1,Q-D-M],Y=c==="top"||c==="top-end"||c==="top-start";typeof b[0]=="number"&&Y&&b[0]>=0&&!b[1]&&t==="y"?o.current.style.transform="translate(0)":Y&&!b[0]&&t==="y"&&(b[0]=F-N);const Z=b.find(q=>q!==!1);return Z>=D?Z:D}function le(e){return e!=null}function J(e){if(Array.isArray(e)){const t=e.filter(le);return t.length===2?t:void 0}else return[e,e]}function ae(){const e={x:J(te),y:J(ne)};return!e.x||!e.y?[-1,-1]:[G(e.x,"x")??-1,G(e.y,"y")??-1]}r.useEffect(()=>{l&&x.length>0&&V()},[l,x]),r.useEffect(()=>{l?ie():H([-1,-1])},[l]);const fe=pe(P,`${y}--menu`,`${y}--menu--${oe}`,{[`${y}--menu--box-shadow-top`]:c&&c.slice(0,3)==="top",[`${y}--menu--open`]:l,[`${y}--menu--shown`]:l&&!A||j[0]>=0&&j[1]>=0,[`${y}--menu--with-icons`]:B.state.hasIcons}),L=_.createElement(ee.Provider,{value:B},_.createElement("ul",he({},I,{className:fe,role:"menu",ref:se,"aria-label":C,tabIndex:-1,onKeyDown:ce,onBlur:ue}),z));return K&&f?l&&ze.createPortal(L,K)||null:L});Ie.propTypes={children:n.node,className:n.string,label:n.string,menuAlignment:n.string,mode:n.oneOf(["full","basic"]),onClose:n.func,onOpen:n.func,open:n.bool,size:n.oneOf(["xs","sm","md","lg"]),target:n.object,x:n.oneOfType([n.number,n.arrayOf(n.number)]),y:n.oneOfType([n.number,n.arrayOf(n.number)])};function Pe(u){const[d,p]=r.useState(!1),[z,P]=r.useState([[-1,-1],[-1,-1]]);function h(){const a=(u==null?void 0:u.current)||u;if(a){const{left:R,top:l,right:E,bottom:A}=a.getBoundingClientRect();P([[R,E],[l,A]])}p(!0)}function C(){p(!1)}function c(){d?C():h()}function $(a){a.preventDefault()}return{open:d,x:z[0],y:z[1],handleClick:c,handleMousedown:$,handleClose:C}}export{ee as M,Ie as a,Pe as b,Ae as u};
