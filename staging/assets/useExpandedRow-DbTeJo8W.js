import{R as c,r as g}from"./index-BwDkhjyp.js";import{p as C,c as b}from"./settings-9_3hiHpE.js";import{c as h,L as R,v as $}from"./index-CO-HQMMN.js";import{u as f}from"./useFocusRowExpander-9BajiKyr.js";const l=`${C.prefix}--datagrid`,H=i=>s=>{var e,m;const{row:t}=s,{expandedContentHeight:p}=t,x=(n,E="")=>{var a,o;if((a=n==null?void 0:n.target)!=null&&a.closest("tr").previousElementSibling){const d=(o=n==null?void 0:n.target)==null?void 0:o.closest("tr").previousElementSibling;E==="enter"?d.classList.add(`${l}__expandable-row--hover`):d.classList.remove(`${l}__expandable-row--hover`)}},{key:r,...u}=s;return c.createElement("tr",{className:h(`${l}__expanded-row`,{[`${l}__slug--row`]:g.isValidElement((e=t==null?void 0:t.original)==null?void 0:e.slug),[`${l}__ai-label--row`]:g.isValidElement((m=t==null?void 0:t.original)==null?void 0:m.aiLabel)}),onMouseEnter:n=>x(n,"enter"),onMouseLeave:n=>x(n)},c.createElement("td",{className:`${l}__expanded-row-cell-wrapper`},c.createElement("div",{className:`${l}__expanded-row-content`,ref:n=>{n&&n.style&&p&&(n.style.height=`${p}px`)}},c.createElement(i,{key:r,...u}))))},_=`${C.prefix}--datagrid`,v=i=>{const s=g.useRef(void 0),t=g.useRef(void 0),p=r=>{s.current=r};f({instance:s==null?void 0:s.current,lastExpandedRowIndex:t==null?void 0:t.current,blockClass:_,activeElement:document.activeElement});const x=r=>[{id:"expander",Cell:({row:e})=>{const m={...e.getToggleRowExpandedProps(),onClick:o=>{var d;o.stopPropagation(),e.toggleRowExpanded(),(d=e==null?void 0:e.onClick)==null||d.call(e,e,o),t.current=e.id},title:null},{expanderButtonTitleExpanded:n,expanderButtonTitleCollapsed:E}=(s==null?void 0:s.current)||{},a=e.isExpanded?n:E;return e.canExpand&&c.createElement("button",{type:"button","aria-label":a,className:h(`${_}__row-expander`,`${b.prefix}--btn`,`${b.prefix}--btn--ghost`),...m},e.isExpanded?c.createElement(R,{className:`${_}__row-expander--icon`}):c.createElement($,{className:`${_}__row-expander--icon`}))},width:48,disableResizing:!0,disableSortBy:!0,Header:""},...r];i.visibleColumns.push(x),i.useInstance.push(p)},L=i=>{v(i);const s=t=>{const{rows:p,expandedContentHeight:x,ExpandedRowContentComponent:r,onRowExpand:u}=t,[e,m]=g.useState({}),n=(a,o)=>m({...e,[a]:o}),E=p.map(a=>({...a,canExpand:a.original&&!a.original.notExpandable,expandedContentHeight:e[a.index]||x,RowExpansionRenderer:r&&H(r),onClick:(o,d)=>u==null?void 0:u(o,d)}));Object.assign(t,{rows:E,setExpandedRowHeight:n,withExpandedRows:!0})};i.useInstance.push(s)};export{L as u};
