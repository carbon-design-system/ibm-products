{"version":3,"file":"EditInPlace-DgLd7JPQ.js","sources":["../../src/components/EditInPlace/EditInPlace.tsx"],"sourcesContent":["/**\n * Copyright IBM Corp. 2022, 2025\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { Checkmark, Close, Edit, WarningFilled } from '@carbon/react/icons';\nimport React, {\n  PropsWithChildren,\n  forwardRef,\n  useEffect,\n  useRef,\n  useState,\n} from 'react';\nimport { pkg } from '../../settings';\n\nimport { IconButton, usePrefix } from '@carbon/react';\nimport PropTypes from 'prop-types';\nimport cx from 'classnames';\nimport { getDevtoolsProps } from '../../global/js/utils/devtools';\n\nconst componentName = 'EditInPlace';\nconst blockClass = `${pkg.prefix}--edit-in-place`;\n\nconst defaults = {\n  tooltipAlignment: 'top',\n  size: 'sm',\n};\n\ntype Size = 'sm' | 'md' | 'lg';\ntype AlignPropType =\n  | 'top'\n  | 'top-left'\n  | 'top-right'\n  | 'bottom'\n  | 'bottom-left'\n  | 'bottom-right'\n  | 'left'\n  | 'right';\ntype Shape = {\n  cancel: AlignPropType;\n  edit: AlignPropType;\n  save: AlignPropType;\n};\n\nexport interface EditInplaceProps extends PropsWithChildren {\n  /**\n   * label for cancel button\n   */\n  cancelLabel: string;\n  /**\n   * By default the edit icon is shown on hover only.\n   */\n  editAlwaysVisible?: boolean;\n  /**\n   * label for edit button\n   */\n  editLabel: string;\n  /**\n   * Specify a custom id for the input\n   */\n  id: string;\n  /**\n   * inheritTypography - causes the text entry field to inherit typography settings\n   * assigned to the container. This is useful when editing titles for instance.\n   *\n   * NOTE: The size property limits the vertical size of the input element.\n   * Inherited font's should be selected to fit within the size selected.\n   */\n  inheritTypography?: boolean;\n  /**\n   * determines if the input is invalid\n   */\n  invalid?: boolean;\n  /**\n   * text that is displayed if the input is invalid\n   */\n  invalidText?: string;\n  /**\n   * Provide the text that will be read by a screen reader when visiting this control\n   */\n  labelText: string;\n\n  /**\n   * handler to add custom onBlur event\n   */\n  onBlur?: (value: string) => void;\n  /**\n   * handler that is called when the cancel button is pressed or when the user removes focus from the input and there is no new value\n   */\n  onCancel: (value: string) => void;\n  /**\n   * handler that is called when the input is updated\n   */\n  onChange: (value: string) => void;\n  /**\n   * handler that is called when the save button is pressed or when the user removes focus from the input if it has a new value\n   */\n  onSave: () => void;\n  /**\n   * determines if the input is in readOnly mode\n   */\n  // readOnly: PropTypes.bool,\n  /**\n   * label for the edit button that displays when in read only mode\n   */\n  // readOnlyLabel: PropTypes.string,\n  /**\n   * label for save button\n   */\n  saveLabel: string;\n  /**\n   * vertical size of control\n   */\n  size?: Size;\n  /**\n   * tooltipAlignment from the standard tooltip. Default center.\n   *\n   * Can be passed either as one of tooltip options or as an object specifying cancel, edit and save separately\n   */\n  tooltipAlignment?: AlignPropType | Shape;\n  /**\n   * current value of the input\n   */\n  value: string;\n  /**\n   * placeholder for the input\n   */\n  placeholder?: string;\n}\n\nexport const EditInPlace = forwardRef<HTMLDivElement, EditInplaceProps>(\n  (\n    {\n      cancelLabel,\n      editAlwaysVisible,\n      editLabel,\n      id,\n      inheritTypography,\n      invalid,\n      invalidLabel: deprecated_invalidLabel = ' ',\n      invalidText,\n      labelText,\n      onCancel,\n      onChange,\n      onSave,\n      onBlur,\n      // readOnly,\n      // readOnlyLabel,\n      saveLabel,\n      size = 'sm',\n      tooltipAlignment,\n      value,\n      placeholder,\n      ...rest\n    }: EditInplaceProps & { invalidLabel?: string },\n    ref\n  ) => {\n    const [focused, setFocused] = useState(false);\n    const [initialValue, setInitialValue] = useState<string>('');\n    const [dirtyInput, setDirtyInput] = useState(false);\n    const inputRef = useRef<HTMLInputElement>(null);\n    const canSave = value !== initialValue && !invalid;\n    const escaping = useRef(false);\n    const carbonPrefix = usePrefix();\n\n    const tipAlignIsObject = typeof tooltipAlignment === 'object';\n    const tipAlignments: { [key: string]: AlignPropType } = [\n      'edit',\n      'save',\n      'cancel',\n    ].reduce((acc, tips) => {\n      acc[tips] =\n        (tipAlignIsObject ? tooltipAlignment[tips] : tooltipAlignment) ??\n        defaults.tooltipAlignment;\n\n      return acc;\n    }, {});\n\n    useEffect(() => {\n      if (!initialValue && !dirtyInput) {\n        setInitialValue(value);\n      }\n    }, [initialValue, dirtyInput, value]);\n\n    const isTargetingChild = ({ currentTarget, relatedTarget }) =>\n      currentTarget.contains(relatedTarget);\n\n    const onChangeHandler = ({ target }) => {\n      if (!dirtyInput) {\n        setDirtyInput(true);\n      }\n\n      onChange(target.value);\n    };\n\n    const onFocusHandler = (e) => {\n      // if (readOnly) {\n      //   return;\n      // }\n\n      if (!isTargetingChild(e)) {\n        inputRef.current?.focus();\n        setFocused(true);\n      }\n    };\n\n    const onSaveHandler = () => {\n      setInitialValue(value);\n      setDirtyInput(false);\n      onSave();\n      setFocused(false);\n    };\n\n    const onCancelHandler = () => {\n      setDirtyInput(false);\n      onCancel(initialValue);\n    };\n\n    const onBlurHandler = (e: any) => {\n      // Use custom function provided if passed through\n      if (typeof onBlur === 'function' && !isTargetingChild(e)) {\n        onBlur(initialValue);\n        setFocused(false);\n      } else {\n        // Use Default behavior if no custom function provided\n        if (escaping.current) {\n          return;\n        }\n        if (!isTargetingChild(e)) {\n          if (canSave) {\n            onSaveHandler();\n          } else {\n            onCancelHandler();\n            setFocused(false);\n          }\n        }\n      }\n    };\n\n    const returnHandler = () => {\n      if (canSave) {\n        onSaveHandler();\n      }\n    };\n\n    const escapeHandler = () => {\n      onCancelHandler();\n    };\n\n    const removeFocus = () => {\n      inputRef.current?.blur();\n      setFocused(false);\n    };\n\n    const onKeyHandler = (e) => {\n      // to prevent blur handler from being called twice add additional state to check if escape is being used\n      escaping.current = true;\n      switch (e.key) {\n        case 'Escape':\n          removeFocus();\n          escapeHandler();\n          break;\n        case 'Enter':\n          removeFocus();\n          returnHandler();\n          break;\n        default:\n          break;\n      }\n      escaping.current = false;\n    };\n\n    return (\n      <div {...rest} ref={ref} {...getDevtoolsProps(componentName)}>\n        <div\n          className={cx(blockClass, `${blockClass}--${size}`, {\n            [`${blockClass}--focused`]: focused,\n            [`${blockClass}--invalid`]: invalid,\n            [`${blockClass}--inherit-type`]: inheritTypography,\n            [`${blockClass}--overflows`]:\n              inputRef.current &&\n              inputRef.current.scrollWidth > inputRef.current.offsetWidth,\n            // [`${blockClass}--readonly`]: readOnly,\n          })}\n          onFocus={onFocusHandler}\n          onBlur={onBlurHandler}\n        >\n          <input\n            id={id}\n            className={cx(\n              `${blockClass}__text-input`,\n              `${carbonPrefix}--text-input`,\n              `${carbonPrefix}--text-input--${size}`\n            )}\n            type=\"text\"\n            placeholder={placeholder}\n            value={value}\n            onChange={onChangeHandler}\n            ref={inputRef}\n            // readOnly={readOnly}\n            onKeyDown={onKeyHandler}\n            aria-label={labelText}\n            aria-invalid={invalid}\n          />\n          <div className={`${blockClass}__toolbar`}>\n            {invalid && (\n              <WarningFilled\n                size={16}\n                className={`${blockClass}__warning-icon`}\n              />\n            )}\n            {focused ? (\n              <>\n                <IconButton\n                  align={tipAlignments.cancel}\n                  size={size}\n                  label={cancelLabel}\n                  onClick={onCancelHandler}\n                  kind=\"ghost\"\n                  key=\"cancel\"\n                  className={`${blockClass}__btn ${blockClass}__btn-cancel`}\n                >\n                  <Close size={16} />\n                </IconButton>\n\n                <IconButton\n                  align={tipAlignments.save}\n                  size={size}\n                  label={saveLabel}\n                  onClick={onSaveHandler}\n                  kind=\"ghost\"\n                  key=\"save\"\n                  className={`${blockClass}__btn ${blockClass}__btn-save`}\n                  disabled={!canSave}\n                >\n                  <Checkmark size={16} />\n                </IconButton>\n              </>\n            ) : (\n              <IconButton\n                align={tipAlignments.edit}\n                className={cx(`${blockClass}__btn`, `${blockClass}__btn-edit`, {\n                  [`${blockClass}__btn-edit--always-visible`]:\n                    editAlwaysVisible,\n                })}\n                size={size}\n                label={editLabel}\n                onClick={onFocusHandler}\n                kind=\"ghost\"\n                key=\"edit\"\n              >\n                <Edit size={16} />\n              </IconButton>\n            )}\n          </div>\n        </div>\n        {invalid && (\n          <p className={`${blockClass}__warning-text`}>\n            {invalidText ?? deprecated_invalidLabel}\n          </p>\n        )}\n      </div>\n    );\n  }\n);\n\nEditInPlace.displayName = componentName;\n\nexport const deprecatedProps = {\n  /**\n   * **Deprecated**\n   * invalidLabel was misnamed, using invalidText to match Carbon\n   */\n  invalidText: PropTypes.string,\n};\n\nconst alignPropType = PropTypes.oneOf([\n  'top',\n  'top-left',\n  'top-right',\n  'bottom',\n  'bottom-left',\n  'bottom-right',\n  'left',\n  'right',\n]);\n\nEditInPlace.propTypes = {\n  /**\n   * label for cancel button\n   */\n  cancelLabel: PropTypes.string.isRequired,\n  /**\n   * By default the edit icon is shown on hover only.\n   */\n  editAlwaysVisible: PropTypes.bool,\n  /**\n   * label for edit button\n   */\n  editLabel: PropTypes.string.isRequired,\n  /**\n   * Specify a custom id for the input\n   */\n  id: PropTypes.string.isRequired,\n  /**\n   * inheritTypography - causes the text entry field to inherit typography settings\n   * assigned to the container. This is useful when editing titles for instance.\n   *\n   * NOTE: The size property limits the vertical size of the input element.\n   * Inherited font's should be selected to fit within the size selected.\n   */\n  inheritTypography: PropTypes.bool,\n  /**\n   * determines if the input is invalid\n   */\n  invalid: PropTypes.bool,\n  /**\n   * text that is displayed if the input is invalid\n   */\n  /**@ts-ignore*/\n  invalidText: PropTypes.string,\n  /**\n   * Provide the text that will be read by a screen reader when visiting this control\n   */\n  labelText: PropTypes.string.isRequired,\n  /**\n   * handler to add custom onBlur event\n   */\n  onBlur: PropTypes.func,\n  /**\n   * handler that is called when the cancel button is pressed or when the user removes focus from the input and there is no new value\n   */\n  onCancel: PropTypes.func.isRequired,\n\n  /**\n   * handler that is called when the input is updated\n   */\n  onChange: PropTypes.func.isRequired,\n  /**\n   * handler that is called when the save button is pressed or when the user removes focus from the input if it has a new value\n   */\n  onSave: PropTypes.func.isRequired,\n  /**\n   * Placeholder for text input\n   */\n  placeholder: PropTypes.string,\n  /**\n   * determines if the input is in readOnly mode\n   */\n  // readOnly: PropTypes.bool,\n  /**\n   * label for the edit button that displays when in read only mode\n   */\n  // readOnlyLabel: PropTypes.string,\n  /**\n   * label for save button\n   */\n  saveLabel: PropTypes.string.isRequired,\n  /**\n   * vertical size of control\n   */\n  size: PropTypes.oneOf(['sm', 'md', 'lg']),\n  /**\n   * tooltipAlignment from the standard tooltip. Default center.\n   *\n   * Can be passed either as one of tooltip options or as an object specifying cancel, edit and save separately\n   */\n  /**@ts-ignore*/\n  tooltipAlignment: PropTypes.oneOfType([\n    alignPropType,\n    PropTypes.shape({\n      cancel: alignPropType,\n      edit: alignPropType,\n      save: alignPropType,\n    }),\n  ]),\n  /**\n   * current value of the input\n   */\n  value: PropTypes.string.isRequired,\n\n  ...deprecatedProps,\n};\n"],"names":["componentName","blockClass","pkg","defaults","EditInPlace","forwardRef","cancelLabel","editAlwaysVisible","editLabel","id","inheritTypography","invalid","deprecated_invalidLabel","invalidText","labelText","onCancel","onChange","onSave","onBlur","saveLabel","size","tooltipAlignment","value","placeholder","rest","ref","focused","setFocused","useState","initialValue","setInitialValue","dirtyInput","setDirtyInput","inputRef","useRef","canSave","escaping","carbonPrefix","usePrefix","tipAlignIsObject","tipAlignments","acc","tips","useEffect","isTargetingChild","currentTarget","relatedTarget","onChangeHandler","target","onFocusHandler","e","onSaveHandler","onCancelHandler","onBlurHandler","returnHandler","escapeHandler","removeFocus","onKeyHandler","React","getDevtoolsProps","cx","WarningFilled","IconButton","Close","Checkmark","Edit","deprecatedProps","PropTypes","alignPropType"],"mappings":"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"}