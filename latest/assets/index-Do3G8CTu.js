import{b as Z,c as R,_ as z,i as q,Y as Q,X as ee,u as te,a as ue,f as fe,g as pe,d as de,Z as a,T as me,z as he,a2 as ne,n as X,J as ge,P as be,E as we,e as Y,a3 as ye}from"./index-CO-HQMMN.js";import{P as t}from"./index-Dk74W0Oi.js";import{R as r,r as H}from"./index-BwDkhjyp.js";import{T as ve}from"./Text-DeIkfaUm.js";import{I as oe,n as x}from"./settings-9_3hiHpE.js";import{b as Oe,a as _e}from"./useAttachedMenu-CUrQfPQx.js";import{m as se}from"./mergeRefs-CTUecegF.js";import{d as ie}from"./bucket-12-BR4Aca2V.js";import{R as Ce}from"./index-BONylQH5.js";import{c as S,g as Me}from"./_commonjsHelpers-BosuxZz1.js";import{s as Ee,b as Te,a as Re,w as Ie}from"./wrapFocus-gin0UG4f.js";function xe(c){function e(o){return r.createElement(c,o)}const n=c.displayName||c.name;return e.displayName=`ClassWrapper(${n})`,e}const Pe=r.forwardRef(function(e,n){let{className:o,closeMenu:s,disabled:u=!1,handleOverflowMenuItemFocus:i,hasDivider:l=!1,href:p,isDelete:h=!1,index:O,itemText:w="Provide itemText",onClick:y=()=>{},onKeyDown:d=()=>{},requireTitle:f,title:v,wrapperClassName:C,...M}=e;const m=Z();function g(_){q(_,Q)&&(i==null||i({currentIndex:O,direction:1})),q(_,ee)&&(i==null||i({currentIndex:O,direction:-1}))}function b(_){y(_),s&&s()}const E=R(`${m}--overflow-menu-options__btn`,o),T=R(`${m}--overflow-menu-options__option`,{[`${m}--overflow-menu--divider`]:l,[`${m}--overflow-menu-options__option--danger`]:h,[`${m}--overflow-menu-options__option--disabled`]:u},C),$=p?"a":"button",D=typeof w!="string"?w:r.createElement("div",{className:`${m}--overflow-menu-options__option-content`},w);return r.createElement(ve,{as:"li",className:T,role:"none"},r.createElement($,z({className:E,disabled:u,href:p,onClick:b,onKeyDown:_=>{g(_),d(_)},role:"menuitem",ref:n,tabIndex:-1,title:f?v||w:void 0},M),D))});Pe.propTypes={className:t.string,closeMenu:t.func,disabled:t.bool,handleOverflowMenuItemFocus:t.func,hasDivider:t.bool,href:t.string,index:t.number,isDelete:t.bool,itemText:t.node.isRequired,onBlur:t.func,onClick:t.func,onFocus:t.func,onKeyDown:t.func,onKeyUp:t.func,onMouseDown:t.func,onMouseEnter:t.func,onMouseLeave:t.func,onMouseUp:t.func,requireTitle:t.bool,title:t.string,wrapperClassName:t.string};const G="md",re=r.forwardRef(function(e,n){let{autoAlign:o=!1,children:s,className:u,label:i="Options",renderIcon:l=ie,size:p=G,menuAlignment:h="bottom-start",tooltipAlignment:O,menuTarget:w,...y}=e;const d=te("enable-v12-dynamic-floating-styles")||o,{refs:f,floatingStyles:v,placement:C,middlewareData:M}=ue(d?{placement:h,strategy:"fixed",middleware:[o&&fe({fallbackPlacements:h.includes("bottom")?["bottom-start","bottom-end","top-start","top-end"]:["top-start","top-end","bottom-start","bottom-end"]})],whileElementsMounted:pe}:{}),m=de("overflowmenu"),g=Z(),b=H.useRef(null),{open:E,x:T,y:$,handleClick:D,handleMousedown:_,handleClose:L}=Oe(b);H.useEffect(()=>{d&&Object.keys(v).forEach(k=>{f.floating.current&&(f.floating.current.style[k]=v[k])})},[v,d,f.floating,E,C,M]);function F(){b.current&&D()}const j=R(u,`${g}--overflow-menu__container`,{[`${g}--autoalign`]:d}),K=R(`${g}--overflow-menu__${h}`),U=R(`${g}--overflow-menu`,{[`${g}--overflow-menu--open`]:E},p!==G&&`${g}--overflow-menu--${p}`),N=se(b,f.setReference);return r.createElement("div",z({},y,{className:j,"aria-owns":E?m:void 0,ref:n}),r.createElement(oe,{"aria-controls":E?m:void 0,"aria-haspopup":!0,"aria-expanded":E,className:U,onClick:F,onMouseDown:_,ref:N,label:i,align:O,kind:"ghost"},r.createElement(l,{className:`${g}--overflow-menu__icon`})),r.createElement(_e,{containerRef:b,ref:f.setFloating,menuAlignment:h,className:K,id:m,size:p,legacyAutoalign:!d,open:E,onClose:L,x:T,y:$,label:i,target:w},s))});re.propTypes={autoAlign:t.bool,children:t.node,className:t.string,label:t.string,menuAlignment:t.oneOf(["top-start","top-end","bottom-start","bottom-end"]),renderIcon:t.oneOfType([t.func,t.object]),size:t.oneOf(["sm","md","lg"]),tooltipAlignment:t.oneOf(["top","top-left","top-right","bottom","bottom-left","bottom-right","left","right"]),menuTarget:t.instanceOf(typeof Element<"u"?Element:Object)};class B extends r.Component{static getEventTarget(e){return e.composed&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target}constructor(e){super(e),this.handleRef=this.handleRef.bind(this),this.handleDocumentClick=this.handleDocumentClick.bind(this)}componentDidMount(){document.addEventListener("click",this.handleDocumentClick)}componentWillUnmount(){document.removeEventListener("click",this.handleDocumentClick)}handleDocumentClick(e){this.element&&this.element.contains&&!this.element.contains(B.getEventTarget(e))&&this.props.onClickOutside(e)}handleRef(e){const{children:n}=this.props;this.element=e,n.ref&&typeof n.ref=="function"&&n.ref(e)}render(){return r.cloneElement(this.props.children,{ref:this.handleRef})}}a(B,"propTypes",{children:t.element.isRequired,onClickOutside:t.func.isRequired});var $e=typeof self=="object"&&self.self===self&&self||typeof S=="object"&&S.global===S&&S||S;const P=Me($e),De=function(){const e=[];let n=!1;function o(){e.forEach(i=>{i()}),n=!1}function s(){n||(n=!0,P.requestAnimationFrame(o))}function u(i){i&&e.indexOf(i)<0&&e.push(i)}return{add:i=>(e.length||P.addEventListener("resize",s),u(i),{release(){const l=e.indexOf(i);l>=0&&e.splice(l,1)}})}}();var Fe=De;const le="left",A="top",ae="right",I="bottom",Ne=function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return typeof c!=typeof e?!0:Object(e)===e&&typeof e!="function"?c.top!==e.top||c.left!==e.left:c!==e},ke=c=>{let{menuSize:e,refPosition:n={},offset:o={},direction:s=I,scrollX:u=0,scrollY:i=0,container:l}=c;const{left:p=0,top:h=0,right:O=0,bottom:w=0}=n,y=l.position!=="static"?0:u,d=l.position!=="static"?0:i,f={top:l.position!=="static"?l.rect.top:0,left:l.position!=="static"?l.rect.left:0},{width:v,height:C}=e,{top:M=0,left:m=0}=o,g=(p+O)/2,b=(h+w)/2;return{[le]:()=>({left:p-v+y-m-f.left,top:b-C/2+d+M-9-f.top}),[A]:()=>({left:g-v/2+y+m-f.left,top:h-C+d-M-f.top}),[ae]:()=>({left:O+y+m-f.left,top:b-C/2+d+M+3-f.top}),[I]:()=>({left:g-v/2+y+m-f.left,top:w+d+M-f.top})}[s]()};class V extends r.Component{constructor(){var e;super(...arguments),e=this,a(this,"_placeInProgress",!1),a(this,"state",{floatingPosition:void 0}),a(this,"_menuContainer",null),a(this,"_menuBody",null),a(this,"startSentinel",r.createRef()),a(this,"endSentinel",r.createRef()),a(this,"_updateMenuSize",function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const s=e._menuBody;if(!s)return;const{menuOffset:u={},menuDirection:i}=n,{menuOffset:l={},menuDirection:p=I}=e.props;if(Ne(u,l)||i!==p||o){const{flipped:h,triggerRef:O,updateOrientation:w=null}=e.props,{current:y}=O,d=s.getBoundingClientRect(),f=y&&y.getBoundingClientRect(),v=typeof l!="function"?l:l(s,p,y,h);w&&w({menuSize:d,refPosition:f,direction:p,offset:v,scrollX:P.pageXOffset,scrollY:P.pageYOffset,container:{rect:e.props.target().getBoundingClientRect(),position:getComputedStyle(e.props.target()).position}}),(d.width>0&&d.height>0||!v)&&e.setState({floatingPosition:ke({menuSize:d,refPosition:f,direction:p,offset:v,scrollX:P.pageXOffset,scrollY:P.pageYOffset,container:{rect:e.props.target().getBoundingClientRect(),position:getComputedStyle(e.props.target()).position}})},()=>{o||s.getBoundingClientRect()!==d&&e._updateMenuSize(e.props,!0)})}}),a(this,"_focusMenuContent",n=>{const o=n.querySelector(this.props.selectorPrimaryFocus||null),s=n.querySelector(Ee),u=n.querySelector(Te);(o||s||u||n).focus()}),a(this,"_menuRef",n=>{const{menuRef:o}=this.props;this._placeInProgress=!!n,o&&o(this._menuBody=n),n&&this._updateMenuSize()}),a(this,"_getChildrenWithProps",()=>{const{styles:n,children:o}=this.props,{floatingPosition:s}=this.state,u=s?{left:`${s.left}px`,top:`${s.top}px`,right:"auto"}:{visibility:"hidden",top:"0px"};return r.cloneElement(o,{ref:this._menuRef,style:{...n,...u,position:"absolute",opacity:1}})}),a(this,"handleBlur",n=>{let{target:o,relatedTarget:s}=n;if(s&&o){const{current:u}=this.startSentinel,{current:i}=this.endSentinel;Re({bodyNode:this._menuBody,startSentinelNode:u,endSentinelNode:i,currentActiveNode:s,oldActiveNode:o})}}),a(this,"handleKeyDown",n=>{q(n,me)&&this._menuBody&&Ie({containerNode:this._menuBody,currentActiveNode:n.target,event:n})})}componentWillUnmount(){this.hResize.release()}componentDidMount(){this.hResize=Fe.add(()=>{this._updateMenuSize()})}componentDidUpdate(e){this._updateMenuSize(e);const{onPlace:n}=this.props;this._placeInProgress&&this.state.floatingPosition&&(this._menuBody&&!this._menuBody.contains(document.activeElement)&&this._focusMenuContent(this._menuBody),typeof n=="function"&&(n(this._menuBody),this._placeInProgress=!1))}render(){const{context:e}=this,n=he("enable-experimental-focus-wrap-without-sentinels");if(typeof document<"u"){const{focusTrap:o,target:s}=this.props;return Ce.createPortal(r.createElement("div",{onBlur:o&&!n?this.handleBlur:()=>{},onKeyDown:n?this.handleKeyDown:()=>{}},!n&&r.createElement("span",{ref:this.startSentinel,tabIndex:"0",role:"link",className:`${e}--visually-hidden`},"Focus sentinel"),this._getChildrenWithProps(),!n&&r.createElement("span",{ref:this.endSentinel,tabIndex:"0",role:"link",className:`${e}--visually-hidden`},"Focus sentinel")),s?s():document.body)}return null}}a(V,"contextType",ne);a(V,"propTypes",{children:t.object,flipped:t.bool,focusTrap:t.bool,menuDirection:t.oneOf([le,A,ae,I]),menuOffset:t.oneOfType([t.shape({top:t.number,left:t.number}),t.func]),menuRef:t.func,onPlace:t.func,selectorPrimaryFocus:t.string,styles:t.object,target:t.func,triggerRef:t.oneOfType([t.func,t.shape({current:t.any})]),updateOrientation:t.func});var Se=V;const Be=ye(),ze=function(c){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];return c.addEventListener(...n),{release(){return c.removeEventListener(...n),null}}},Ae={[A]:"bottom",[I]:"top"},J=(c,e,n,o)=>{const s=Ae[e],{offsetWidth:u,offsetHeight:i}=c;switch(s){case"top":case"bottom":{const l=n?n.offsetWidth:0;return{left:(o?-1:1)*(u/2-l/2),top:0}}case"left":case"right":{const l=n?n.offsetHeight:0;return{left:0,top:(o?-1:1)*(i/2-l/2)}}}};let W=class extends r.Component{constructor(){super(...arguments),a(this,"state",{open:!1,hasMountedTrigger:!1,click:!1}),a(this,"instanceId",Be()),a(this,"_hFocusIn",null),a(this,"_hBlurTimeout",void 0),a(this,"_triggerRef",r.createRef()),a(this,"handleClick",e=>{const{onClick:n=x}=this.props;this.setState({click:!0}),(!this._menuBody||!this._menuBody.contains(e.target))&&(this.setState({open:!this.state.open}),n(e))}),a(this,"closeMenuAndFocus",()=>{const e=this.state.click,n=this.state.open;this.closeMenu(()=>{n&&!e&&this.focusMenuEl()})}),a(this,"closeMenuOnEscape",()=>{const e=this.state.open;this.closeMenu(()=>{e&&this.focusMenuEl()})}),a(this,"handleKeyPress",e=>{this.state.open&&X(e,[ee,ge,Q,be])&&e.preventDefault(),X(e,[we])&&(this.closeMenuOnEscape(),e.stopPropagation())}),a(this,"handleClickOutside",e=>{this.state.open&&(!this._menuBody||!this._menuBody.contains(e.target))&&this.closeMenu()}),a(this,"closeMenu",e=>{const{onClose:n=x}=this.props;this.setState({open:!1},()=>{e&&e(),n()})}),a(this,"focusMenuEl",()=>{const{current:e}=this._triggerRef;e&&e.focus()}),a(this,"handleOverflowMenuItemFocus",e=>{let{currentIndex:n,direction:o}=e;const s=r.Children.toArray(this.props.children).reduce((l,p,h)=>(r.isValidElement(p)&&!p.props.disabled&&l.push(h),l),[]),u=(()=>{const l=s.indexOf(n)+o;switch(l){case-1:return s.length-1;case s.length:return 0;default:return l}})(),i=this[`overflowMenuItem${s[u]}`];i==null||i.focus()}),a(this,"_menuBody",null),a(this,"_bindMenuBody",e=>{e||(this._menuBody=e),!e&&this._hFocusIn&&(this._hFocusIn=this._hFocusIn.release())}),a(this,"_handlePlace",e=>{const{onOpen:n=x}=this.props;if(e){this._menuBody=e;const o="onfocusin"in window,s=o?"focusin":"focus";this._hFocusIn=ze(e.ownerDocument,s,u=>{const i=B.getEventTarget(u),{current:l}=this._triggerRef;typeof i.matches=="function"&&!e.contains(i)&&l&&!i.matches(`.${this.context}--overflow-menu:first-child,.${this.context}--overflow-menu-options:first-child`)&&this.closeMenuAndFocus()},!o),n()}}),a(this,"_getTarget",()=>{const{current:e}=this._triggerRef;return e instanceof Element&&e.closest("[data-floating-menu-container]")||document.body})}componentDidUpdate(e,n){const{onClose:o=x}=this.props;!this.state.open&&n.open&&o()}componentDidMount(){this._triggerRef.current&&this.setState({hasMountedTrigger:!0})}static getDerivedStateFromProps(e,n){let{open:o}=e;const{prevOpen:s}=n;return s===o?null:{open:o,prevOpen:o}}componentWillUnmount(){typeof this._hBlurTimeout=="number"&&(clearTimeout(this._hBlurTimeout),this._hBlurTimeout=void 0)}render(){const e=this.context,{id:n,["aria-label"]:o=null,ariaLabel:s,children:u,iconDescription:i="Options",direction:l=I,flipped:p=!1,focusTrap:h=!0,menuOffset:O=J,menuOffsetFlip:w=J,iconClass:y,onClick:d=x,onOpen:f=x,selectorPrimaryFocus:v="[data-floating-menu-primary-focus]",renderIcon:C=ie,innerRef:M,menuOptionsClass:m,light:g,size:b="md",...E}=this.props,{open:T=!1}=this.state,$=R(this.props.className,`${e}--overflow-menu`,{[`${e}--overflow-menu--open`]:T,[`${e}--overflow-menu--light`]:g,[`${e}--overflow-menu--${b}`]:b}),D=R(m,`${e}--overflow-menu-options`,{[`${e}--overflow-menu--flip`]:this.props.flipped,[`${e}--overflow-menu-options--open`]:T,[`${e}--overflow-menu-options--light`]:g,[`${e}--overflow-menu-options--${b}`]:b}),_=R(`${e}--overflow-menu__icon`,y),L=r.Children.toArray(u).map((N,k)=>r.isValidElement(N)?r.cloneElement(N,{closeMenu:N.props.closeMenu||this.closeMenuAndFocus,handleOverflowMenuItemFocus:this.handleOverflowMenuItemFocus,ref:ce=>{this[`overflowMenuItem${k}`]=ce},index:k}):null),F=`overflow-menu-${this.instanceId}__menu-body`,j=r.createElement("ul",{className:D,tabIndex:-1,role:"menu","aria-label":o||s,onKeyDown:this.handleKeyPress,id:F},L),K=r.createElement(Se,{focusTrap:h,triggerRef:this._triggerRef,menuDirection:l,menuOffset:p?w:O,menuRef:this._bindMenuBody,flipped:this.props.flipped,target:this._getTarget,onPlace:this._handlePlace,selectorPrimaryFocus:this.props.selectorPrimaryFocus},r.cloneElement(j,{"data-floating-menu-direction":l})),U={className:_,"aria-label":i};return r.createElement(B,{onClickOutside:this.handleClickOutside},r.createElement("span",{className:`${e}--overflow-menu__wrapper`,"aria-owns":T?F:void 0},r.createElement(oe,z({},E,{type:"button","aria-haspopup":!0,"aria-expanded":T,"aria-controls":T?F:void 0,className:$,onClick:this.handleClick,id:n,ref:se(this._triggerRef,M),size:b,label:i,kind:"ghost"}),r.createElement(C,U)),T&&this.state.hasMountedTrigger&&K))}};a(W,"propTypes",{"aria-label":t.string,ariaLabel:Y(t.string),children:t.node,className:t.string,direction:t.oneOf([A,I]),flipped:t.bool,focusTrap:t.bool,iconClass:t.string,iconDescription:t.string,id:t.string,light:Y(t.bool),menuOffset:t.oneOfType([t.shape({top:t.number,left:t.number}),t.func]),menuOffsetFlip:t.oneOfType([t.shape({top:t.number,left:t.number}),t.func]),menuOptionsClass:t.string,onClick:t.func,onClose:t.func,onFocus:t.func,onKeyDown:t.func,onOpen:t.func,open:t.bool,renderIcon:t.oneOfType([t.func,t.object]),selectorPrimaryFocus:t.string,size:t.oneOf(["sm","md","lg"])});a(W,"contextType",ne);(()=>{const c=(e,n)=>r.createElement(W,z({},e,{innerRef:n}));return c.displayName="OverflowMenu",r.forwardRef(c)})();const We=xe(W);function Le(c){return te("enable-v12-overflowmenu")?r.createElement(re,c):r.createElement(We,c)}Le.displayName="OverflowMenu";export{Le as O,Pe as a};
