import{d as f,X as E}from"./index-CMVdkQrl.js";import{p as P,c as y}from"./settings-C3kz8lqM.js";import{r as C,e as I}from"./index-DtHxqM--.js";import{u as N}from"./useFocusRowExpander-BIwFvcb9.js";import{j as _}from"./useDatagrid-BDEhjUIV.js";const l=`${P.prefix}--datagrid`,B=c=>{const o=C.useRef(void 0),r=C.useRef(void 0),p=d=>{o.current=d};N({instance:o==null?void 0:o.current,lastExpandedRowIndex:r==null?void 0:r.current,blockClass:l,activeElement:typeof document<"u"&&document.activeElement});const $=(d,g)=>{const{getAsyncSubRows:a,dispatch:s,state:e}=g.instance||{},t=!!e.dynamicRowSkeleton;return[{id:"expander",Cell:({row:n})=>{const h={...n.getToggleRowExpandedProps(),disabled:a&&t,onClick:async b=>{if(b.stopPropagation(),n.toggleRowExpanded(),r.current=n.id,!n.isExpanded)try{_({dispatch:s,status:"start",rowId:n.id,depth:n.depth,index:n.index}),a&&await(a==null?void 0:a(n)),_({dispatch:s,status:"finish",rowId:n.id})}catch(v){console.log({error:v})}}},{expanderButtonTitleExpanded:u="Collapse row",expanderButtonTitleCollapsed:m="Expand row"}=(o==null?void 0:o.current)||{},x=n.isExpanded?u:m;return n.canExpand||a?I.createElement("button",{type:"button","aria-label":x,className:f(`${l}__row-expander`,`${y.prefix}--btn`,`${y.prefix}--btn--ghost`),...h},I.createElement(E,{className:f(`${l}__expander-icon`,{[`${l}__expander-icon--not-open`]:!n.isExpanded,[`${l}__expander-icon--open`]:n.isExpanded})})):null},width:48,disableResizing:!0,disableSortBy:!0,Header:""},...d]};c.visibleColumns.push($),c.useInstance.push(p)},S=`${P.prefix}--datagrid`,O=c=>{B(c);const o=r=>{C.useEffect(()=>{const{rows:s}=r,e=s.filter(t=>{var i;return(i=t==null?void 0:t.original)==null?void 0:i.defaultExpanded});e!=null&&e.length&&e.map(t=>{var i;if(!(t!=null&&t.isExpanded)&&!(t!=null&&t.hasExpanded)){(i=t==null?void 0:t.toggleRowExpanded)==null||i.call(t),t.hasExpanded=!0;return}})},[r,r.rows]),C.useEffect(()=>{const{rows:s,initialState:e}=r,{expandedRowIds:t}=e;t&&Object.keys(t).forEach(i=>{var h,u;const n=s.filter(m=>{var x,b;return m.id.toString()===i.toString()||((b=(x=m.original)==null?void 0:x.id)==null?void 0:b.toString())===i.toString()});(n.length&&i.toString()===n[0].id.toString()||n.length&&i.toString()===((u=(h=n[0].original)==null?void 0:h.id)==null?void 0:u.toString()))&&n[0].toggleRowExpanded()})},[r]);const p=24,$=(s,{row:e})=>[s,{className:f({[`${S}__carbon-nested-row`]:e.depth>0,[`${S}__carbon-row-expanded`]:e.isExpanded})}],d=(s,{row:e})=>[s,{style:{paddingLeft:`${e.depth>1?p*2+(e.depth-1)*(p+p/3):e.depth===1?p*2:0}px`}}],g=s=>32*s+16,a=(s,{cell:e,instance:t})=>{const i=t.columns.findIndex(n=>n.id===e.column.id)===0;return[s,{style:{marginRight:i&&e.row.depth>0&&parseInt(s.style.width,10)<=g(e.row.depth)+50?`${parseInt(s.style.width,10)-(g(e.row.depth)+50)}px`:"",width:i&&e.row.depth>0?parseInt(s.style.width,10)-g(e.row.depth):s.style.width}}]};Object.assign(r,{withNestedRows:!0}),c.getRowProps.push($),c.getRowProps.push(d),c.getCellProps.push(a)};c.useInstance.push(o)};export{O as u};
