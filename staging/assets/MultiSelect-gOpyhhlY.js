import{P as s,b as ht,c as It,u as xt,a as yt,k as A,d as H,_ as Q,e as bt,f as St,s as vt,h as wt,bM as _e,l as Ee,S as Ct,H as Ae,E as $e,g as Te}from"./index-CMVdkQrl.js";import{u as Me,L as z,b as _t}from"./index-BCwPvCrC.js";import{g as Et}from"./_commonjsHelpers-Cpj98o6Y.js";import{r as u,e as c}from"./index-DtHxqM--.js";import{m as At}from"./mergeRefs-CTUecegF.js";import{F as $t}from"./FormContext-C4Nuixum.js";import{C as Tt}from"./Checkbox-CVg4b6-b.js";import{n as Ot}from"./settings-C3kz8lqM.js";import{W as Ft,a as Mt}from"./bucket-18-xYgoy0Nr.js";var se,Oe;function Pt(){if(Oe)return se;Oe=1;var i=typeof Element<"u",m=typeof Map=="function",d=typeof Set=="function",x=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function h(t,l){if(t===l)return!0;if(t&&l&&typeof t=="object"&&typeof l=="object"){if(t.constructor!==l.constructor)return!1;var a,n,p;if(Array.isArray(t)){if(a=t.length,a!=l.length)return!1;for(n=a;n--!==0;)if(!h(t[n],l[n]))return!1;return!0}var v;if(m&&t instanceof Map&&l instanceof Map){if(t.size!==l.size)return!1;for(v=t.entries();!(n=v.next()).done;)if(!l.has(n.value[0]))return!1;for(v=t.entries();!(n=v.next()).done;)if(!h(n.value[1],l.get(n.value[0])))return!1;return!0}if(d&&t instanceof Set&&l instanceof Set){if(t.size!==l.size)return!1;for(v=t.entries();!(n=v.next()).done;)if(!l.has(n.value[0]))return!1;return!0}if(x&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(l)){if(a=t.length,a!=l.length)return!1;for(n=a;n--!==0;)if(t[n]!==l[n])return!1;return!0}if(t.constructor===RegExp)return t.source===l.source&&t.flags===l.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof l.valueOf=="function")return t.valueOf()===l.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof l.toString=="function")return t.toString()===l.toString();if(p=Object.keys(t),a=p.length,a!==Object.keys(l).length)return!1;for(n=a;n--!==0;)if(!Object.prototype.hasOwnProperty.call(l,p[n]))return!1;if(i&&t instanceof Element)return!1;for(n=a;n--!==0;)if(!((p[n]==="_owner"||p[n]==="__v"||p[n]==="__o")&&t.$$typeof)&&!h(t[p[n]],l[p[n]]))return!1;return!0}return t!==t&&l!==l}return se=function(l,a){try{return h(l,a)}catch(n){if((n.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw n}},se}var Dt=Pt();const Pe=Et(Dt),Bt={compareItems:s.func,sortItems:s.func},kt=(i,m,d)=>{let{locale:x}=d;return i.localeCompare(m,x,{numeric:!0})},Nt=(i,m)=>{let{selectedItems:d=[],itemToString:x,compareItems:h,locale:t="en"}=m;return i.sort((l,a)=>{if(l.isSelectAll)return-1;if(a.isSelectAll)return 1;const n=d.includes(l),p=d.includes(a);return n&&!p?-1:p&&!n?1:h(x(l),x(a),{locale:t})})},Fe=i=>{let{isControlled:m,isMounted:d,onChangeHandlerControlled:x,onChangeHandlerUncontrolled:h,selectedItems:t}=i;m?d&&x&&x({selectedItems:t}):h(t)},jt=i=>{let{disabled:m,onChange:d,initialSelectedItems:x=[],selectedItems:h,selectAll:t=!1,filteredItems:l=[]}=i;const a=u.useRef(!1),n=u.useRef(d),[p,v]=u.useState(x),b=!!h,w=b?h:p,K=u.useCallback(f=>{if(m)return;const q=l.filter(S=>!(S!=null&&S.disabled)),Y=l.filter(S=>S==null?void 0:S.disabled).length;let C;if(f!=null&&f.isSelectAll&&w.length>0)C=[];else if(f!=null&&f.isSelectAll&&w.length===0)C=q;else{const S=w.findLastIndex($=>Pe($,f));S===-1?(C=w.concat(f),t&&l.length-1===C.length+Y&&(C=q)):(C=Lt(w,S),C=C.filter($=>!($!=null&&$.isSelectAll)))}Fe({isControlled:b,isMounted:a.current,onChangeHandlerControlled:n.current,onChangeHandlerUncontrolled:v,selectedItems:C})},[m,w,l,t,b]),X=u.useCallback(()=>{m||Fe({isControlled:b,isMounted:a.current,onChangeHandlerControlled:n.current,onChangeHandlerUncontrolled:v,selectedItems:[]})},[m,b]);return u.useEffect(()=>{n.current=d},[d]),u.useEffect(()=>{a.current&&n.current&&!b&&n.current({selectedItems:w})},[b,w]),u.useEffect(()=>(a.current=!0,()=>{a.current=!1}),[]),{clearSelection:X,onItemChange:K,selectedItems:w}},Lt=(i,m)=>{const d=i.slice();return d.splice(m,1),d},{ItemClick:Rt,ToggleButtonBlur:Ht,ToggleButtonKeyDownArrowDown:zt,ToggleButtonKeyDownArrowUp:Kt,ToggleButtonKeyDownEnter:qt,ToggleButtonKeyDownEscape:Wt,ToggleButtonKeyDownSpaceButton:Ut,ItemMouseMove:Vt,MenuMouseLeave:Gt,ToggleButtonClick:Jt,ToggleButtonKeyDownPageDown:Qt,ToggleButtonKeyDownPageUp:Xt,FunctionSetHighlightedIndex:Yt}=Me.stateChangeTypes,Zt=i=>typeof i=="string"?i:typeof i=="number"?`${i}`:i!==null&&typeof i=="object"&&"label"in i&&typeof i.label=="string"?i.label:"",De=c.forwardRef((i,m)=>{var Ce;let{autoAlign:d=!1,className:x,decorator:h,id:t,items:l,itemToElement:a,itemToString:n=Zt,titleText:p=!1,hideLabel:v,helperText:b,label:w,type:K="default",size:X,disabled:f=!1,initialSelectedItems:q=[],sortItems:Y=Nt,compareItems:C=kt,clearSelectionText:S="To clear selection, press Delete or Backspace",clearAnnouncement:$="all items have been cleared",clearSelectionDescription:Be="Total items selected: ",light:ke,invalid:E,invalidText:Ne,warn:W,warnText:je,useTitleInItem:Le,translateWithId:re,downshiftProps:Re,open:M=!1,selectionFeedback:oe="top-after-reopen",onChange:He,onMenuChange:ae,direction:ie="bottom",selectedItems:ce,readOnly:B,locale:ze="en",slug:U}=i;const T=u.useMemo(()=>l.filter(e=>{if(typeof e=="object"&&e!==null){for(const g in e)if(Object.hasOwn(e,g)&&e[g]===void 0)return!1}return!0}),[l]);let k=T.some(e=>e.isSelectAll);(ce??[]).length>0&&k&&(console.warn("Warning: `selectAll` should not be used when `selectedItems` is provided. Please pass either `selectAll` or `selectedItems`, not both."),k=!1);const r=ht(),{isFluid:Z}=u.useContext($t),ue=It(),[el,ee]=u.useState(!1),[de,N]=u.useState(!1),[_,Ke]=u.useState(M||!1),[qe,We]=u.useState(M),[Ue,Ve]=u.useState([]),[Ge,fe]=u.useState(!1),O=xt("enable-v12-dynamic-floating-styles")||d,{refs:P,floatingStyles:pe,middlewareData:ge}=yt(O?{placement:ie,strategy:"fixed",middleware:[d&&St({crossAxis:!1}),vt({apply(e){let{rects:g,elements:o}=e;Object.assign(o.floating.style,{width:`${g.reference.width}px`})}}),d&&wt()],whileElementsMounted:bt}:{});u.useLayoutEffect(()=>{var e;if(O){const g={...pe,visibility:(e=ge.hide)!=null&&e.referenceHidden?"hidden":"visible"};Object.keys(g).forEach(o=>{P.floating.current&&(P.floating.current.style[o]=g[o])})}},[O,pe,P.floating,ge,M]);const{selectedItems:V,onItemChange:me,clearSelection:he}=jt({disabled:f,initialSelectedItems:q,onChange:He,selectedItems:ce,selectAll:k,filteredItems:T}),te={selectedItems:V,itemToString:n,compareItems:C,locale:ze},Je={stateReducer:at,isOpen:_,itemToString:e=>Array.isArray(e)&&e.map(function(g){return n(g)}).join(", ")||"",selectedItem:V,items:T,isItemDisabled(e,g){return e==null?void 0:e.disabled},...Re},{getToggleButtonProps:Qe,getLabelProps:Xe,getMenuProps:Ie,getItemProps:Ye,selectedItem:Ze,highlightedIndex:et,setHighlightedIndex:xe}=Me(Je),ye=Qe({onFocus:()=>{N(!0)},onBlur:()=>{N(!1)},onKeyDown:e=>{f||((A(e,_e)||A(e,Ee))&&!_&&(he(),e.stopPropagation()),!_&&A(e,_e)&&I.length>0&&fe(!0),(A(e,Ct)||A(e,Ae)||A(e,$e))&&!_&&(xe(0),fe(!1),G(!0)),A(e,Ae)&&I.length===0&&(N(!1),ee(!1)),A(e,Ee)&&_&&N(!0),A(e,$e)&&_&&N(!0))}}),le=At(ye.ref,m),I=Ze,G=e=>{Ke(e),ae&&ae(e)};qe!==M&&(G(M),We(M));const F=K==="inline",be=!E&&W,tt=H(`${r}--multi-select__wrapper`,`${r}--list-box__wrapper`,x,{[`${r}--multi-select__wrapper--inline`]:F,[`${r}--list-box__wrapper--inline`]:F,[`${r}--multi-select__wrapper--inline--invalid`]:F&&E,[`${r}--list-box__wrapper--inline--invalid`]:F&&E,[`${r}--list-box__wrapper--fluid--invalid`]:Z&&E,[`${r}--list-box__wrapper--slug`]:U,[`${r}--list-box__wrapper--decorator`]:h}),lt=H(`${r}--label`,{[`${r}--label--disabled`]:f,[`${r}--visually-hidden`]:v}),Se=b?`multiselect-helper-text-${ue}`:void 0,nt=`multiselect-field-label-${ue}`,st=H(`${r}--form__helper-text`,{[`${r}--form__helper-text--disabled`]:f}),rt=H(`${r}--multi-select`,{[`${r}--multi-select--invalid`]:E,[`${r}--multi-select--invalid--focused`]:E&&de,[`${r}--multi-select--warning`]:be,[`${r}--multi-select--inline`]:F,[`${r}--multi-select--selected`]:I&&I.length>0,[`${r}--list-box--up`]:ie==="top",[`${r}--multi-select--readonly`]:B,[`${r}--autoalign`]:O,[`${r}--multi-select--selectall`]:k}),ot=a;oe==="fixed"?te.selectedItems=[]:oe==="top-after-reopen"&&(te.selectedItems=Ue);function at(e,g){const{changes:o,props:j,type:L}=g,{highlightedIndex:y}=o;switch(o.isOpen&&!_&&Ve(V),L){case Ut:case qt:if(o.selectedItem===void 0||Array.isArray(o.selectedItem))break;return me(o.selectedItem),{...o,highlightedIndex:e.highlightedIndex};case Ht:case Wt:G(!1);break;case Jt:return G(o.isOpen||!1),{...o,highlightedIndex:V.length>0?0:void 0};case Rt:return xe(o.selectedItem),me(o.selectedItem),{...o,highlightedIndex:e.highlightedIndex};case Gt:return{...o,highlightedIndex:e.highlightedIndex};case Yt:return _?{...o,highlightedIndex:T.indexOf(y)}:{...o,highlightedIndex:0};case zt:case Kt:case Qt:case Xt:if(y>-1){const ne=document.querySelectorAll(`li.${r}--list-box__menu-item[role="option"]`);j.scrollIntoView(ne[y])}return y===-1?{...o,highlightedIndex:0}:o;case Vt:return{...o,highlightedIndex:e.highlightedIndex}}return o}const it=H(`${r}--list-box__field--wrapper`,{[`${r}--list-box__field--wrapper--input-focused`]:de}),ve=e=>{e.target.classList.contains(`${r}--tag__close-icon`)?ee(!1):ee(e.type==="focus")},ct=B?{onClick:e=>{e.preventDefault(),le.current!==void 0&&le.current.focus()},onKeyDown:e=>{["ArrowDown","ArrowUp"," ","Enter"].includes(e.key)&&e.preventDefault()}}:{};let D=c.isValidElement(U??h)?U??h:null;D&&((Ce=D.type)==null?void 0:Ce.displayName)==="AILabel"&&(D=c.cloneElement(D,{size:"mini"}));const ut=I.length>0&&I.map(e=>e==null?void 0:e.text),dt=k?I.filter(e=>!e.isSelectAll).length:I.length,ft=u.useMemo(()=>Ie({ref:O?P.setFloating:null}),[O,Ie,P.setFloating]),we=Xe(),pt=u.isValidElement(p)?{id:we.id}:we,gt=u.useCallback((e,g)=>{const o=e.some(y=>!y.isSelectAll),j=e.filter(y=>!y.isSelectAll).length,L=g.filter(y=>!y.isSelectAll&&!y.disabled).length;return{hasIndividualSelections:o,nonSelectAllSelectedCount:j,totalSelectableCount:L}},[I,T]);return c.createElement("div",{className:tt},c.createElement("label",Q({className:lt},pt),p&&p,I.length>0&&c.createElement("span",{className:`${r}--visually-hidden`},Be," ",I.length," ",ut,",",S)),c.createElement(z,{onFocus:Z?ve:void 0,onBlur:Z?ve:void 0,type:K,size:X,className:rt,disabled:f,light:ke,invalid:E,invalidText:Ne,warn:W,warnText:je,isOpen:_,id:t},E&&c.createElement(Ft,{className:`${r}--list-box__invalid-icon`}),be&&c.createElement(Mt,{className:`${r}--list-box__invalid-icon ${r}--list-box__invalid-icon--warning`}),c.createElement("div",{className:it,ref:O?P.setReference:null},I.length>0&&c.createElement(z.Selection,{readOnly:B,clearSelection:!f&&!B?he:Ot,selectionCount:dt,translateWithId:re,disabled:f}),c.createElement("button",Q({type:"button",className:`${r}--list-box__field`,disabled:f,"aria-disabled":f||B,"aria-describedby":!F&&!E&&!W&&b?Se:void 0},ye,{ref:le},ct),c.createElement("span",{id:nt,className:`${r}--list-box__label`},w),c.createElement(z.MenuIcon,{isOpen:_,translateWithId:re})),U?D:h?c.createElement("div",{className:`${r}--list-box__inner-wrapper--decorator`},D):""),c.createElement(z.Menu,ft,_&&Y(T,te).map((e,g)=>{const o=I.filter(mt=>Pe(mt,e)).length>0,{hasIndividualSelections:j,nonSelectAllSelectedCount:L,totalSelectableCount:y}=gt(I,T),ne=e.isSelectAll&&j&&L<y,R=Ye({item:e,"aria-selected":o}),J=n(e);return c.createElement(z.MenuItem,Q({key:R.id,isActive:o&&!e.isSelectAll,"aria-label":J,isHighlighted:et===g,title:J,disabled:R["aria-disabled"]},R),c.createElement("div",{className:`${r}--checkbox-wrapper`},c.createElement(Tt,{id:`${R.id}__checkbox`,labelText:a?c.createElement(ot,Q({key:R.id},e)):J,checked:o,title:Le?J:void 0,indeterminate:ne,disabled:f})))})),Ge&&c.createElement("span",{"aria-live":"assertive","aria-label":$})),!F&&!E&&!W&&b&&c.createElement("div",{id:Se,className:st},b))});De.displayName="MultiSelect";De.propTypes={...Bt,autoAlign:s.bool,className:s.string,clearSelectionDescription:s.string,clearSelectionText:s.string,compareItems:s.func,decorator:s.node,direction:s.oneOf(["top","bottom"]),disabled:s.bool,downshiftProps:s.object,helperText:s.node,hideLabel:s.bool,id:s.string.isRequired,initialSelectedItems:s.array,invalid:s.bool,invalidText:s.node,itemToElement:s.func,itemToString:s.func,items:s.array.isRequired,label:s.node.isRequired,light:Te(s.bool),locale:s.string,onChange:s.func,onMenuChange:s.func,open:s.bool,readOnly:s.bool,selectedItems:s.array,selectionFeedback:s.oneOf(["top","fixed","top-after-reopen"]),size:_t,slug:Te(s.node),sortItems:s.func,titleText:s.node,translateWithId:s.func,type:s.oneOf(["default","inline"]),useTitleInItem:s.bool,warn:s.bool,warnText:s.node};export{De as M,Nt as a,kt as d,Pe as i,Bt as s,jt as u};
