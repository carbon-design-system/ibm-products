const T=(s,g,r,n)=>{let l=null,d=null,S=0;const $=400;let u=!1,m=null,p=null;const y=o=>{l=o.touches[0].clientX},w=o=>{d=o.touches[0].clientX},v=()=>{if(l!==null&&d!==null){const o=l-d;Math.abs(o)>50&&(o>0?g():r())}l=null,d=null},E=o=>{u=!0,m=o.clientX},L=o=>{u&&(p=o.clientX)},x=()=>{if(u&&m!==null&&p!==null){const o=m-p;Math.abs(o)>50&&(o>0?g():r())}u=!1,m=null,p=null},_=o=>{const H=Date.now();if(Math.abs(o.deltaX)>Math.abs(o.deltaY)&&Math.abs(o.deltaX)>20){if(o.preventDefault(),H-S<$)return;o.deltaX>0?g():r(),S=H}};n&&(s.removeEventListener("touchstart",y),s.removeEventListener("touchmove",w),s.removeEventListener("touchend",v),s.removeEventListener("mousedown",E),s.removeEventListener("mousemove",L),s.removeEventListener("mouseup",x),s.removeEventListener("wheel",_)),s.addEventListener("touchstart",y),s.addEventListener("touchmove",w),s.addEventListener("touchend",v),s.addEventListener("mousedown",E),s.addEventListener("mousemove",L),s.addEventListener("mouseup",x),s.addEventListener("wheel",_)},G=(s,g)=>{const r="carousel";let n=[0],f=[0];const l={},d=4,{onViewChangeStart:S,onViewChangeEnd:$,excludeSwipeSupport:u,useMaxHeight:m}=g||{},p=(t,e)=>{l[t]=e},y=(t,e)=>{if(t.querySelector(`.${e}`))return;const a=document.createElement("div");for(a.classList.add(`${e}`);t.firstChild;)a.appendChild(t.firstChild);t.appendChild(a)},w=()=>n.map(t=>({id:t,elem:l[t]})),v=()=>{const t=Object.keys(l).length,e=l[t-1],a=w();return{currentIndex:n[0],lastIndex:parseInt(e?.dataset.index||n[0].toString(),10),totalViews:t,historyStack:a}},E=()=>{f=[...n];const t=v();S?.(t)},L=t=>{if(!t)return;const e=t.dataset.index;if(e&&n[0]===parseInt(e,10)){const a=v();$?.(a)}},x=t=>{const a=Object.keys(l).length-1;return Math.max(0,Math.min(t,a))},_=t=>{const e=x(t);n[0]!==e&&(E(),n=[e,...n],b(!1))},o=t=>{L(t)},H=(t,e,a,i,c)=>{t.classList.add(`${r}__view`),t.classList.toggle(`${r}__view-in-stack`,e&&!a),t.classList.toggle(`${r}__view-active`,e&&a),c&&!i&&t.classList.add(`${r}__view-recycle-in`),!c&&i&&t.classList.add(`${r}__view-recycle-out`)},R=t=>{t.classList.remove(`${r}__view-recycle-in`,`${r}__view-recycle-out`)},V=t=>t*parseFloat(getComputedStyle(document.documentElement).fontSize),C=t=>{const e=V(d);if(s.clientHeight<e){t<e&&(t=e);const i=s.querySelector(`.${r}__itemsWrapper`);i&&(i.style.blockSize=`${t}px`)}},b=t=>{let e=0,a=0;Array.from(D).forEach((i,c)=>{const F=n.findIndex(h=>h===c),A=f.filter(h=>h===c).length,N=f.length>n.length&&f[0]===c&&A>0,P=f.length<n.length&&n[0]===c&&A>0,U=F>-1,Y=c===n[0];if(H(i,U,Y,N,P),t){p(c,i),setTimeout(()=>{if(m){const X=Array.from(D).map(B=>B.scrollHeight);a=Math.max(...X),i.style.position="absolute",C(a)}else(!e||i.offsetHeight<e&&e>V(d))&&(e=i.offsetHeight),i.style.position="absolute",C(e)});const h=X=>{R(i),X.target===l[n[0]]&&o(i)};i._carouselListener=h,i.addEventListener("animationend",h),i.addEventListener("transitionend",h),i.setAttribute("data-index",c.toString())}}),t&&L(Array.from(D)[0])},k=()=>{const t=n[0]+1;_(t)},M=()=>{n.length-1>=1&&(E(),n=n.slice(1),b(!1))},W=t=>{_(t)},q=()=>({index:n[0],item:l[n[0]]}),z=()=>{n=[0],b(!1)},I=()=>{Object.values(l).forEach(t=>{t&&t._carouselListener&&(t.removeEventListener("animationend",t._carouselListener),t.removeEventListener("transitionend",t._carouselListener))}),u||T(s,k,M,!0)},j=t=>{const e=t.querySelector("slot");return e?e.assignedElements({flatten:!0}):Array.from(t.children)};y(s,`${r}__itemsWrapper`);const O=s.querySelector(`.${r}__itemsWrapper`),D=j(O);return s.classList.add(`${r}__view-stack`),b(!0),u||T(s,k,M,!1),{next:k,prev:M,reset:z,goToIndex:W,getActiveItem:q,destroyEvents:I,allViews:l}};export{G as i};
