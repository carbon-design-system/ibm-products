import{M as de,b as me,i as pe,d as he,_ as xe,k as v,l as ye,U as be,J as ge,H as we,P as n,g as Ce}from"./index-CMVdkQrl.js";import{r as s,e as q}from"./index-DtHxqM--.js";import{r as Ie}from"./index-DgLvjnYm.js";const ze={isRoot:!0,hasIcons:!1,hasSelectableItems:!1,size:null,items:[],requestCloseRoot:()=>{}};function Re(c,d){switch(d.type){case"enableIcons":return{...c,hasIcons:!0};case"enableSelectableItems":return{...c,hasSelectableItems:!0};case"registerItem":return{...c,items:[...c.items,d.payload].filter(x=>x.ref.current!==null)}}}const Z=s.createContext({state:ze,dispatch:c=>{}}),Ae=q.createContext({direction:"ltr"});function Ee(){return s.useContext(Ae)}const D=8,Me=s.forwardRef(function(d,x){let{children:z,className:P,containerRef:y,label:R,menuAlignment:u,mode:U,onClose:a,onOpen:A,open:l,size:E="sm",legacyAutoalign:C="true",target:_=de&&document.body,x:ee=0,y:te=0,...M}=d;const f=me(),B=s.useRef(null),S=s.useContext(Z),m=S.state.isRoot,ne=m?E:S.state.size,[H,K]=s.useReducer(Re,{...S.state,isRoot:!1,size:E,requestCloseRoot:m?T:S.state.requestCloseRoot}),O=s.useMemo(()=>({state:H,dispatch:K}),[H,K]),r=s.useRef(null),oe=pe([x,r]),[W,j]=s.useState([-1,-1]),b=O.state.items.filter(e=>!e.disabled&&e.ref.current);let g;if(y!=null&&y.current){const{width:e}=y.current.getBoundingClientRect();g=e}const{direction:se}=Ee();function re(){B.current&&B.current.focus()}function ie(){var e;if(r.current){if(B.current=document.activeElement,C){const t=ae();((document==null?void 0:document.dir)==="rtl"||se==="rtl")&&!((e=M==null?void 0:M.id)!=null&&e.includes("MenuButton"))?(r.current.style.insetInlineStart="initial",r.current.style.insetInlineEnd=`${t[0]}px`):(r.current.style.insetInlineStart=`${t[0]}px`,r.current.style.insetInlineEnd="initial"),r.current.style.insetBlockStart=`${t[1]}px`,j(t)}r.current.focus(),A&&A()}}function T(){re(),a&&a()}function ce(e){e.stopPropagation(),(v(e,ye)||!m&&v(e,be))&&a?T():J(e)}function J(e){var $,p;const t=b.findIndex(i=>{var I,h;return(h=(I=i.ref)==null?void 0:I.current)==null?void 0:h.contains(document.activeElement)});let o=t;t===-1?o=0:e&&(v(e,ge)&&(o=o-1),v(e,we)&&(o=o+1)),o<0&&(o=b.length-1),o>=b.length&&(o=0),o!==t&&((p=($=b[o].ref)==null?void 0:$.current)==null||p.focus(),e==null||e.preventDefault())}function ue(e){var t;l&&a&&m&&!((t=r.current)!=null&&t.contains(e.relatedTarget))&&T()}function V(e,t){if(!r.current)return;const{width:o,height:$}=r.current.getBoundingClientRect(),p=m?"vertical":"horizontal",i={x:{max:window.innerWidth,size:o,anchor:p==="horizontal"?e[1]:e[0],reversedAnchor:p==="horizontal"?e[0]:e[1],offset:0},y:{max:window.innerHeight,size:$,anchor:p==="horizontal"?e[0]:e[1],reversedAnchor:p==="horizontal"?e[1]:e[0],offset:m?0:4}};if(g&&g<i.x.size&&(u==="bottom"||u==="top")&&(i.x.size=g),g&&(u==="bottom-end"||u==="top-end")&&i.x.anchor>=87&&g<i.x.size){const k=i.x.anchor+i.x.reversedAnchor;i.x.anchor=i.x.anchor+k}const{max:I,size:h,anchor:L,reversedAnchor:Q,offset:N}=i[t],w=[I-D-h-L>=0?L-N:!1,Q-h>=0?Q-h+N:!1,I-D-h],X=u==="top"||u==="top-end"||u==="top-start";typeof w[0]=="number"&&X&&w[0]>=0&&!w[1]&&t==="y"?r.current.style.transform="translate(0)":X&&!w[0]&&t==="y"&&(w[0]=L-N);const Y=w.find(k=>k!==!1);return Y>=D?Y:D}function le(e){return e!=null}function G(e){if(Array.isArray(e)){const t=e.filter(le);return t.length===2?t:void 0}else return[e,e]}function ae(){const e={x:G(ee),y:G(te)};return!e.x||!e.y?[-1,-1]:[V(e.x,"x")??-1,V(e.y,"y")??-1]}s.useEffect(()=>{l&&b.length>0&&J()},[l,b]),s.useEffect(()=>{l?ie():j([-1,-1])},[l]);const fe=he(P,`${f}--menu`,`${f}--menu--${ne}`,{[`${f}--menu--box-shadow-top`]:u&&u.slice(0,3)==="top",[`${f}--menu--open`]:l,[`${f}--menu--shown`]:l&&!C||W[0]>=0&&W[1]>=0,[`${f}--menu--with-icons`]:O.state.hasIcons,[`${f}--menu--with-selectable-items`]:O.state.hasSelectableItems,[`${f}--autoalign`]:!C}),F=q.createElement(Z.Provider,{value:O},q.createElement("ul",xe({},M,{className:fe,role:"menu",ref:oe,"aria-label":R,tabIndex:-1,onKeyDown:ce,onBlur:ue}),z));return _&&m?l&&Ie.createPortal(F,_)||null:F});Me.propTypes={children:n.node,className:n.string,label:n.string,menuAlignment:n.string,mode:Ce(n.oneOf(["full","basic"])),onClose:n.func,onOpen:n.func,open:n.bool,size:n.oneOf(["xs","sm","md","lg"]),target:n.object,x:n.oneOfType([n.number,n.arrayOf(n.number)]),y:n.oneOfType([n.number,n.arrayOf(n.number)])};function ve(c){const[d,x]=s.useState(!1),[z,P]=s.useState([[-1,-1],[-1,-1]]);function y(){const a=(c==null?void 0:c.current)||c;if(a){const{left:A,top:l,right:E,bottom:C}=a.getBoundingClientRect();P([[A,E],[l,C]])}x(!0)}function R(){x(!1)}function u(){d?R():y()}function U(a){a.preventDefault()}return{open:d,x:z[0],y:z[1],handleClick:u,handleMousedown:U,handleClose:R}}export{Ae as L,Z as M,Me as a,ve as b,Ee as u};
