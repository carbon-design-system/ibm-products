{"version":3,"file":"useFocus-DzkM3UDm.js","sources":["../../src/global/js/hooks/useFocus.js"],"sourcesContent":["/**\n * Copyright IBM Corp. 2024, 2024\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { usePrefix } from '@carbon/react';\nimport { pkg } from '../../../settings';\nimport { useCallback, useEffect } from 'react';\n\nexport const getSpecificElement = (parentEl, elementId) => {\n  const element = parentEl?.querySelector(elementId);\n\n  return elementId && !element?.disabled ? element : null;\n};\n\nexport const useFocus = (modalRef, selectorPrimaryFocus) => {\n  const carbonPrefix = usePrefix();\n  const tearsheetBaseClass = `${pkg.prefix}--tearsheet`;\n  const sidePanelBaseClass = `${pkg.prefix}--side-panel`;\n  // Querying focusable element in the modal\n  // Query to exclude hidden elements in the modal from querySelectorAll() method\n  // feel free to include more if needed :)\n  const notQuery = `:not(.${carbonPrefix}--visually-hidden,.${tearsheetBaseClass}__header--no-close-icon,.${carbonPrefix}--btn--disabled,[aria-hidden=\"true\"],[tabindex=\"-1\"],[disabled])`;\n  // Queries to include element types button, input, select, textarea\n  const queryButton = `button${notQuery}`;\n  const queryInput = `input${notQuery}`;\n  const querySelect = `select${notQuery}`;\n  const queryTextarea = `textarea${notQuery}`;\n  const queryLink = `[href]${notQuery}`;\n  const queryAnchor = `a${notQuery}`;\n  const queryTabIndex = `[tabindex=\"0\"]${notQuery}`;\n  const querySidePanelScroll = `.${sidePanelBaseClass}--scrolls`;\n  // Final query\n  const query = `${queryButton},${queryLink},${queryAnchor},${queryInput},${querySelect},${queryTextarea},${queryTabIndex},${querySidePanelScroll}`;\n\n  const getFocusable = useCallback(() => {\n    // Selecting all focusable elements based on the above conditions\n    let focusableElements = modalRef?.current?.querySelectorAll(`${query}`);\n    if (focusableElements?.length) {\n      focusableElements = Array.prototype.filter.call(\n        focusableElements,\n        (el) => window?.getComputedStyle(el)?.display !== 'none'\n      );\n    }\n\n    const first = focusableElements?.[0];\n    const last = focusableElements?.[focusableElements?.length - 1];\n    const all = focusableElements;\n    const specified = getSpecificElement(\n      modalRef?.current,\n      selectorPrimaryFocus\n    );\n\n    return {\n      first,\n      last,\n      all,\n      specified,\n    };\n  }, [modalRef, query, selectorPrimaryFocus]);\n\n  useEffect(() => {\n    getFocusable();\n  }, [getFocusable, modalRef]);\n\n  const handleKeyDown = async (event) => {\n    // Checking whether the key is tab or not\n    if (event.key === 'Tab') {\n      // updating the focusable elements list\n      const { first, last } = getFocusable();\n\n      if (event.shiftKey && document?.activeElement === first) {\n        // Prevents the default \"Tab\" behavior\n        event.preventDefault();\n        // if the user press shift+tab and the current element not in focusable items\n        last?.focus();\n      } else if (!event.shiftKey && document?.activeElement === last) {\n        event.preventDefault();\n        // user pressing tab key only then\n        // focusing the first element if the current element is not in focusable items\n        first?.focus();\n      }\n    }\n  };\n\n  const claimFocus = useCallback(() => {\n    const { first, specified } = getFocusable();\n\n    if (\n      specified &&\n      window?.getComputedStyle(specified)?.display !== 'none' &&\n      specified?.tabIndex !== -1\n    ) {\n      setTimeout(() => specified.focus(), 0);\n    } else {\n      setTimeout(() => first?.focus(), 0);\n    }\n  }, [getFocusable]);\n\n  return {\n    firstElement: getFocusable()?.first,\n    lastElement: getFocusable()?.last,\n    allElements: getFocusable()?.all,\n    specifiedElement: getFocusable()?.specified,\n    keyDownListener: handleKeyDown,\n    getFocusable: getFocusable,\n    claimFocus,\n  };\n};\n"],"names":["getSpecificElement","parentEl","elementId","element","useFocus","modalRef","selectorPrimaryFocus","carbonPrefix","usePrefix","tearsheetBaseClass","pkg","sidePanelBaseClass","notQuery","queryButton","queryInput","querySelect","queryTextarea","queryLink","queryAnchor","queryTabIndex","querySidePanelScroll","query","getFocusable","useCallback","focusableElements","el","first","last","all","specified","useEffect","handleKeyDown","event","claimFocus"],"mappings":"uDAWO,MAAMA,EAAqB,CAACC,EAAUC,IAAc,CACzD,MAAMC,EAAUF,GAAU,cAAcC,CAAS,EAEjD,OAAOA,GAAa,CAACC,GAAS,SAAWA,EAAU,IACrD,EAEaC,EAAW,CAACC,EAAUC,IAAyB,CAC1D,MAAMC,EAAeC,EAAA,EACfC,EAAqB,GAAGC,EAAI,MAAM,cAClCC,EAAqB,GAAGD,EAAI,MAAM,eAIlCE,EAAW,SAASL,CAAY,sBAAsBE,CAAkB,4BAA4BF,CAAY,mEAEhHM,EAAc,SAASD,CAAQ,GAC/BE,EAAa,QAAQF,CAAQ,GAC7BG,EAAc,SAASH,CAAQ,GAC/BI,EAAgB,WAAWJ,CAAQ,GACnCK,EAAY,SAASL,CAAQ,GAC7BM,EAAc,IAAIN,CAAQ,GAC1BO,EAAgB,iBAAiBP,CAAQ,GACzCQ,EAAuB,IAAIT,CAAkB,YAE7CU,EAAQ,GAAGR,CAAW,IAAII,CAAS,IAAIC,CAAW,IAAIJ,CAAU,IAAIC,CAAW,IAAIC,CAAa,IAAIG,CAAa,IAAIC,CAAoB,GAEzIE,EAAeC,EAAAA,YAAY,IAAM,CAErC,IAAIC,EAAoBnB,GAAU,SAAS,iBAAiB,GAAGgB,CAAK,EAAE,EAClEG,GAAmB,SACrBA,EAAoB,MAAM,UAAU,OAAO,KACzCA,EACCC,GAAO,QAAQ,iBAAiBA,CAAE,GAAG,UAAY,MAAA,GAItD,MAAMC,EAAQF,IAAoB,CAAC,EAC7BG,EAAOH,IAAoBA,GAAmB,OAAS,CAAC,EACxDI,EAAMJ,EACNK,EAAY7B,EAChBK,GAAU,QACVC,CAAA,EAGF,MAAO,CACL,MAAAoB,EACA,KAAAC,EACA,IAAAC,EACA,UAAAC,CAAA,CAEJ,EAAG,CAACxB,EAAUgB,EAAOf,CAAoB,CAAC,EAE1CwB,EAAAA,UAAU,IAAM,CACdR,EAAA,CACF,EAAG,CAACA,EAAcjB,CAAQ,CAAC,EAE3B,MAAM0B,EAAgB,MAAOC,GAAU,CAErC,GAAIA,EAAM,MAAQ,MAAO,CAEvB,KAAM,CAAE,MAAAN,EAAO,KAAAC,CAAA,EAASL,EAAA,EAEpBU,EAAM,UAAY,UAAU,gBAAkBN,GAEhDM,EAAM,eAAA,EAENL,GAAM,MAAA,GACG,CAACK,EAAM,UAAY,UAAU,gBAAkBL,IACxDK,EAAM,eAAA,EAGNN,GAAO,MAAA,EAEX,CACF,EAEMO,EAAaV,EAAAA,YAAY,IAAM,CACnC,KAAM,CAAE,MAAAG,EAAO,UAAAG,CAAA,EAAcP,EAAA,EAG3BO,GACA,QAAQ,iBAAiBA,CAAS,GAAG,UAAY,QACjDA,GAAW,WAAa,GAExB,WAAW,IAAMA,EAAU,MAAA,EAAS,CAAC,EAErC,WAAW,IAAMH,GAAO,MAAA,EAAS,CAAC,CAEtC,EAAG,CAACJ,CAAY,CAAC,EAEjB,MAAO,CACL,aAAcA,KAAgB,MAC9B,YAAaA,KAAgB,KAC7B,YAAaA,KAAgB,IAC7B,iBAAkBA,KAAgB,UAClC,gBAAiBS,EACjB,aAAAT,EACA,WAAAW,CAAA,CAEJ"}