import{u as be,a as Ve,e as We,f as He,c as je,b as ze,d as H,_ as J,I as we,P as t,q as ve,r as Ee,b$ as ye,A as Ye,k as Ke,a0 as Xe,c2 as Ge,z as ue,Z as Ue,W as Ze,Y as Je,a4 as Qe,l as et,g as de}from"./index-4poXP75K.js";import{e as g,r as o}from"./index-DtHxqM--.js";import{b as tt,a as ot}from"./useAttachedMenu-DN6VGMKt.js";import{m as ne}from"./mergeRefs-91-mP8KM.js";import{aM as Re}from"./bucket-12-BL1rFmTg.js";import{g as Ce,c as U}from"./_commonjsHelpers-Cpj98o6Y.js";import{h as nt}from"./index-DgLvjnYm.js";import{s as st,b as rt,w as it,a as at}from"./wrapFocus-jEwItT4M.js";import{n as te}from"./events-CdfZZS3f.js";import{u as ct}from"./useOutsideClick-BtJZ_vFp.js";const pe="md",Oe=g.forwardRef(function({autoAlign:s=!1,children:w,className:d,label:p="Options",renderIcon:l=Re,size:r=pe,menuAlignment:v="bottom-start",tooltipAlignment:N,menuTarget:c,...T},h){const E=be("enable-v12-dynamic-floating-styles")||s,{refs:i,floatingStyles:x,placement:m,middlewareData:y}=Ve(E?{placement:v,strategy:"fixed",middleware:[s&&He({fallbackPlacements:v.includes("bottom")?["bottom-start","bottom-end","top-start","top-end"]:["top-start","top-end","bottom-start","bottom-end"]})],whileElementsMounted:We}:{}),R=je("overflowmenu"),f=ze(),O=o.useRef(null),{open:$,x:F,y:B,handleClick:j,handleMousedown:D,handleClose:u}=tt(O);o.useEffect(()=>{E&&Object.keys(x).forEach(S=>{i.floating.current&&(i.floating.current.style[S]=x[S])})},[x,E,i.floating,$,m,y]);function e(){O.current&&j()}const b=H(d,`${f}--overflow-menu__container`,{[`${f}--autoalign`]:E}),C=H(`${f}--overflow-menu__${v}`),M=H(`${f}--overflow-menu`,{[`${f}--overflow-menu--open`]:$},r!==pe&&`${f}--overflow-menu--${r}`),A=ne(O,i.setReference);return g.createElement("div",J({},T,{className:b,"aria-owns":$?R:void 0,ref:h}),g.createElement(we,{"aria-controls":$?R:void 0,"aria-haspopup":!0,"aria-expanded":$,className:M,onClick:e,onMouseDown:D,ref:A,label:p,align:N,kind:"ghost"},g.createElement(l,{className:`${f}--overflow-menu__icon`})),g.createElement(ot,{containerRef:O,ref:i.setFloating,menuAlignment:v,className:C,id:R,size:r,legacyAutoalign:!E,open:$,onClose:u,x:F,y:B,label:p,target:c},w))});Oe.propTypes={autoAlign:t.bool,children:t.node,className:t.string,label:t.string,menuAlignment:t.oneOf(["top-start","top-end","bottom-start","bottom-end"]),renderIcon:t.oneOfType([t.func,t.object]),size:t.oneOf(["sm","md","lg"]),tooltipAlignment:ve(t.oneOf(["top","top-left","top-right","bottom","bottom-left","bottom-right","left","left-bottom","left-top","right","right-bottom","right-top","top-start","top-end","bottom-start","bottom-end","left-end","left-start","right-end","right-start"]),["top","top-start","top-end","bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end"],Ee),menuTarget:t.instanceOf(typeof Element<"u"?Element:Object)};var oe,me;function lt(){if(me)return oe;me=1;var a=function(s,w,d,p,l,r,v,N){if(!s){var c;if(w===void 0)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var T=[d,p,l,r,v,N],h=0;c=new Error(w.replace(/%s/g,function(){return T[h++]})),c.name="Invariant Violation"}throw c.framesToPop=1,c}};return oe=a,oe}var ft=lt();const Ft=Ce(ft);var Z,ge;function ut(){return ge||(ge=1,Z=typeof self=="object"&&self.self===self&&self||typeof U=="object"&&U.global===U&&U||Z),Z}var dt=ut();const W=Ce(dt),pt=(()=>{const a=[];let s=!1;const w=()=>{a.forEach(l=>{l()}),s=!1},d=()=>{s||(s=!0,W.requestAnimationFrame(w))},p=l=>{a.indexOf(l)<0&&a.push(l)};return{add:l=>(a.length||W.addEventListener("resize",d),p(l),{remove:()=>{const r=a.indexOf(l);r>=0&&a.splice(r,1)}})}})(),mt="left",se="top",gt="right",K="bottom",ht=({menuSize:a,refPosition:s,offset:w,direction:d,scrollX:p,scrollY:l,container:r})=>{const{left:v=0,top:N=0,right:c=0,bottom:T=0}=s,h=r.position!=="static"?0:p,E=r.position!=="static"?0:l,i={top:r.position!=="static"?r.rect.top:0,left:r.position!=="static"?r.rect.left:0},{width:x,height:m}=a,{top:y=0,left:R=0}=w,f=(v+c)/2,O=(N+T)/2;return{[mt]:()=>({left:v-x+h-R-i.left,top:O-m/2+E+y-9-i.top}),[se]:()=>({left:f-x/2+h+R-i.left,top:N-m+E-y-i.top}),[gt]:()=>({left:c+h+R-i.left,top:O-m/2+E+y+3-i.top}),[K]:()=>({left:f-x/2+h+R-i.left,top:T+E+y-i.top})}[d]()},bt=({children:a,flipped:s,focusTrap:w,menuDirection:d=K,menuOffset:p={top:0,left:0},menuRef:l,onPlace:r,selectorPrimaryFocus:v,styles:N,target:c=()=>document.body,triggerRef:T,updateOrientation:h})=>{const E=o.useContext(ye),[i,x]=o.useState(void 0),m=o.useRef(null),y=o.useRef(null),R=o.useRef(null),f=o.useRef(!1),O=o.useCallback(e=>{const b=m.current;if(!b)return;const C=T.current,M=b.getBoundingClientRect(),A=C?C.getBoundingClientRect():void 0,S=typeof p=="function"?p(b,d,C,s):p;if(h&&h({menuSize:M,refPosition:A,direction:d,offset:S,scrollX:W.pageXOffset,scrollY:W.pageYOffset,container:{rect:c().getBoundingClientRect(),position:getComputedStyle(c()).position}}),M.width>0&&M.height>0||!S){const P=ht({menuSize:M,refPosition:A??{left:0,top:0,right:0,bottom:0},offset:S,direction:d,scrollX:W.pageXOffset,scrollY:W.pageYOffset,container:{rect:c().getBoundingClientRect(),position:getComputedStyle(c()).position}});if((!i||i.left!==P.left||i.top!==P.top)&&x(P),!e){const X=b.getBoundingClientRect();(X.width!==M.width||X.height!==M.height)&&O(!0)}}},[T,p,d,s,c,h,i]),$=e=>{const b=v?e.querySelector(v):null,C=e.querySelector(st),M=e.querySelector(rt);(b||C||M||e).focus()},F=e=>{m.current=e,f.current=!!e,l&&l(e),e&&O()};o.useEffect(()=>{f.current&&i&&m.current&&(m.current.contains(document.activeElement)||$(m.current),typeof r=="function"&&r(m.current),f.current=!1)},[i,r]),o.useEffect(()=>{const e=pt.add(()=>{O()});return()=>{e.remove()}},[T,p,d,s,c,h]),o.useEffect(()=>{O()},[p,d,s,T,c,h]);const B=()=>{const e=i,b=e?{left:`${e.left}px`,top:`${e.top}px`,right:"auto"}:{visibility:"hidden",top:"0px"},C=a;return o.cloneElement(C,{ref:F,style:{...N,...b,position:"absolute",opacity:1}})},j=e=>{const{target:b,relatedTarget:C}=e;m.current&&y.current&&R.current&&b instanceof HTMLElement&&C instanceof HTMLElement&&at({bodyNode:m.current,startTrapNode:y.current,endTrapNode:R.current,currentActiveNode:C,oldActiveNode:b})},D=e=>{Ke(e,Xe)&&m.current&&e.target instanceof HTMLElement&&it({containerNode:m.current,currentActiveNode:e.target,event:e})},u=Ye("enable-experimental-focus-wrap-without-sentinels");if(typeof document<"u"){const e=c?c():document.body;return nt.createPortal(g.createElement("div",{onBlur:w&&!u?j:void 0,onKeyDown:u?D:void 0},!u&&g.createElement("span",{ref:y,tabIndex:0,role:"link",className:`${E}--visually-hidden`},"Focus sentinel"),B(),!u&&g.createElement("span",{ref:R,tabIndex:0,role:"link",className:`${E}--visually-hidden`},"Focus sentinel")),e)}return null},wt=Ge(),vt=(a,...s)=>(a.addEventListener(...s),{release(){return a.removeEventListener(...s),null}}),Et={[se]:"bottom",[K]:"top"},he=(a,s,w,d)=>{const p=Et[s],{offsetWidth:l,offsetHeight:r}=a;switch(p){case"top":case"bottom":{const v=w?w.offsetWidth:0;return{left:(d?-1:1)*(l/2-v/2),top:0}}default:return{left:0,top:0}}},re=o.forwardRef(({align:a,["aria-label"]:s=null,ariaLabel:w,children:d,className:p,direction:l=K,flipped:r=!1,focusTrap:v=!0,iconClass:N,iconDescription:c="Options",id:T,light:h,menuOffset:E=he,menuOffsetFlip:i=he,menuOptionsClass:x,onClick:m=te,onClose:y=te,onOpen:R=te,open:f,renderIcon:O=Re,selectorPrimaryFocus:$="[data-floating-menu-primary-focus]",size:F="md",innerRef:B,...j},D)=>{const u=o.useContext(ye),[e,b]=o.useState(f??!1),[C,M]=o.useState(!1),[A,S]=o.useState(!1),P=o.useRef(null),X=o.useRef(wt()),V=o.useRef(null),ie=o.useRef({}),ae=o.useRef(f),Q=o.useRef(e),_=o.useRef(null),ce=o.useRef(null);o.useEffect(()=>{ae.current!==f&&(b(!!f),ae.current=f)},[f]),o.useEffect(()=>{_.current&&S(!0)},[]),o.useEffect(()=>{e&&!Q.current?R():!e&&Q.current&&y(),Q.current=e},[e,y,R]),ct(ce,({target:n})=>{e&&(!V.current||n instanceof Node&&!V.current.contains(n))&&z()});const G=o.useCallback(()=>{_.current&&_.current.focus()},[]),z=o.useCallback(n=>{b(!1),n&&n(),y()},[y]),le=o.useCallback(()=>{const n=C,I=e;z(()=>{I&&!n&&G()})},[C,e,z,G]),Me=o.useCallback(()=>{const n=e;z(()=>{n&&G()})},[e,z,G]),xe=n=>{M(!0),(!V.current||!V.current.contains(n.target))&&(b(I=>!I),m(n))},$e=n=>{e&&ue(n,[Ue,Ze,Je,Qe])&&n.preventDefault(),ue(n,[et])&&(Me(),n.stopPropagation())},Ie=({currentIndex:n=0,direction:I})=>{const k=o.Children.toArray(d).reduce((q,fe,De)=>(g.isValidElement(fe)&&!fe.props.disabled&&q.push(De),q),[]),Y=(()=>{const q=k.indexOf(n)+I;switch(q){case-1:return k.length-1;case k.length:return 0;default:return q}})(),L=ie.current[k[Y]];L==null||L.focus()},Ne=n=>{n||(V.current=n),!n&&P.current&&(P.current=P.current.release())},Fe=n=>{if(!n)return;V.current=n;const I="onfocusin"in window,k=I?"focusin":"focus";P.current=vt(n.ownerDocument,k,Y=>{const L=Y.target,q=_.current;typeof L.matches=="function"&&!n.contains(L)&&q&&!L.matches(`.${u}--overflow-menu:first-child, .${u}--overflow-menu-options:first-child`)&&le()},!I)},ke=()=>{const n=_.current;return n instanceof Element&&n.closest("[data-floating-menu-container]")||document.body},ee=`overflow-menu-${X.current}__menu-body`,Se=H(p,`${u}--overflow-menu`,{[`${u}--overflow-menu--open`]:e,[`${u}--overflow-menu--light`]:h,[`${u}--overflow-menu--${F}`]:F}),Pe=H(x,`${u}--overflow-menu-options`,{[`${u}--overflow-menu--flip`]:r,[`${u}--overflow-menu-options--open`]:e,[`${u}--overflow-menu-options--light`]:h,[`${u}--overflow-menu-options--${F}`]:F}),_e=H(`${u}--overflow-menu__icon`,N),Ae=o.Children.toArray(d).map((n,I)=>{if(o.isValidElement(n)){const k=n;return o.cloneElement(k,{closeMenu:k.props.closeMenu||le,handleOverflowMenuItemFocus:Ie,ref:Y=>{ie.current[I]=Y},index:I})}return null}),Le=g.createElement("ul",{className:Pe,tabIndex:-1,role:"menu","aria-label":s||w,onKeyDown:$e,id:ee},Ae),qe=g.createElement(bt,{focusTrap:v,triggerRef:_,menuDirection:l,menuOffset:r?i:E,menuRef:Ne,flipped:r,target:ke,onPlace:Fe,selectorPrimaryFocus:$},o.cloneElement(Le,{"data-floating-menu-direction":l})),Be=B?ne(_,B,D):ne(_,D);return g.createElement(g.Fragment,null,g.createElement("span",{className:`${u}--overflow-menu__wrapper`,"aria-owns":e?ee:void 0,ref:ce},g.createElement(we,J({},j,{align:a,type:"button","aria-haspopup":!0,"aria-expanded":e,"aria-controls":e?ee:void 0,className:Se,onClick:xe,id:T,ref:Be,size:F,label:c,kind:"ghost"}),g.createElement(O,{className:_e,"aria-label":c})),e&&A&&qe))});re.propTypes={align:ve(t.oneOf(["top","top-left","top-right","bottom","bottom-left","bottom-right","left","left-bottom","left-top","right","right-bottom","right-top","top-start","top-end","bottom-start","bottom-end","left-end","left-start","right-end","right-start"]),["top","top-start","top-end","bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end"],Ee),"aria-label":t.string,ariaLabel:de(t.string),children:t.node,className:t.string,direction:t.oneOf([se,K]),flipped:t.bool,focusTrap:t.bool,iconClass:t.string,iconDescription:t.string,id:t.string,light:de(t.bool),menuOffset:t.oneOfType([t.shape({top:t.number.isRequired,left:t.number.isRequired}),t.func]),menuOffsetFlip:t.oneOfType([t.shape({top:t.number.isRequired,left:t.number.isRequired}),t.func]),menuOptionsClass:t.string,onClick:t.func,onClose:t.func,onFocus:t.func,onKeyDown:t.func,onOpen:t.func,open:t.bool,renderIcon:t.oneOfType([t.func,t.object]),selectorPrimaryFocus:t.string,size:t.oneOf(["sm","md","lg"])};const Te=o.forwardRef((a,s)=>be("enable-v12-overflowmenu")?g.createElement(Oe,J({},a,{ref:s})):g.createElement(re,J({},a,{ref:s})));Te.displayName="OverflowMenu";Te.propTypes=re.propTypes;export{Te as O,Ft as i};
