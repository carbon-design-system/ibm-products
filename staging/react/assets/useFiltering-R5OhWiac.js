import{r as c,u as se,en as q,e as u,p as le,I as ne,c as k,ei as ie,P as t}from"./iframe-DaJ7qZFz.js";import{b as oe,c as ue,F as ce,e as de,C as fe,f as pe,B as E,g as me,I as ye,R as he,M as be,i as ge,N as Fe,j as ve}from"./useDatagrid-BB26jHLG.js";import{u as Ce}from"./useWindowResize-FBiPseeK.js";import{u as qe}from"./useClickOutside-Db0NgZOo.js";import{A as Ae}from"./ActionSet-BTJ2RB7T.js";import{F as Re}from"./bucket-6-BJYpAUvA.js";const we=`${le.prefix}--datagrid`,l=`${we}-filter-flyout`,v={flyoutIconDescription:"Open filters",title:"Filter",primaryActionLabel:"Apply",secondaryActionLabel:"Cancel",align:"bottom"},T=[],V=({updateMethod:n,flyoutIconDescription:d=v.flyoutIconDescription,align:r=v.align,filters:a=T,title:e=v.title,primaryActionLabel:s=v.primaryActionLabel,onFlyoutOpen:f=()=>{},onFlyoutClose:i=()=>{},onApply:b=()=>{},onCancel:y=()=>{},secondaryActionLabel:h=v.secondaryActionLabel,setAllFilters:_,data:$=T,reactTableFiltersState:j=T})=>{const[C,A]=c.useState(!1),[M,I]=c.useState(!1),B=()=>{A(!1),y()},{filtersState:R,prevFiltersObjectArrayRef:W,prevFiltersRef:L,cancel:x,reset:z,renderFilter:J,filtersObjectArray:g,lastAppliedFilters:D}=oe({updateMethod:n,filters:a,setAllFilters:_,variation:pe,reactTableFiltersState:j,onCancel:B}),{width:U}=ie.md,H=parseInt(U)*16,N=c.useRef(null),p=c.useRef(null),K=c.useRef(null),[X,Y]=ue({initialValue:!0,filtersState:R,prevFiltersRef:L}),G=o=>{const m=p?.current.getBoundingClientRect(),F=parseInt(window.getComputedStyle(p?.current).getPropertyValue("width"));if(Math.sign(m.left)===-1){const O=F-Math.abs(m.left);p.current.style.width=q(O)}if(F<642&&Math.sign(m.left)===1||Math.sign(m.left).toString()==="0"){const O=F+Math.abs(m.left);p.current.style.width=q(O)}o?.innerWidth<=H+254?I(!0):I(!1)};Ce(({current:o})=>{G(o)});const{dispatch:Q}=c.useContext(ce),w=n===E,Z=se(),ee=()=>{A(!0),f()},S=()=>{A(!1),i(),p.current.style.width=q(642)};c.useEffect(()=>{p.current.style.width=q(642)},[]);const te=()=>{_(g),S(),b({filtersState:R,filtersObjectArray:g,lastAppliedFilters:D}),Y(!0),L.current=JSON.stringify(R),W.current=JSON.stringify(g),D.current=JSON.stringify(g),Q({type:me,payload:{savedFilters:g}})},re=()=>a.map(J),ae=()=>w&&u.createElement(Ae,{actions:[{key:1,kind:"primary",label:s,onClick:te,isExpressive:!1,disabled:X},{key:3,kind:"secondary",label:h,onClick:x,isExpressive:!1}],size:"md",buttonSize:"md"});return qe(N,o=>{const m=o.closest(".flatpickr-calendar"),F=o.className===`${Z}--list-box__menu-item__option`;!C||m||F||(S(),x())}),de(fe,o=>{z(o)}),u.createElement("div",{className:`${l}__container`,ref:N},u.createElement(ne,{label:d,kind:"ghost",align:r,onClick:C?S:ee,className:k(`${l}__trigger`,{[`${l}__trigger--open`]:C}),disabled:$.length===0},u.createElement(Re,null)),u.createElement("div",{className:k(l,{[`${l}--open`]:C,[`${l}--batch`]:w,[`${l}--instant`]:!w}),ref:p},u.createElement("div",{className:`${l}__inner-container`},u.createElement("span",{className:`${l}__title`},e),u.createElement("div",{className:k(`${l}__filters`,{[`${l}__stacked`]:M}),ref:K},re())),ae()))};V.propTypes={align:t.string,data:t.array.isRequired,filters:t.arrayOf(t.shape({type:t.string.isRequired,column:t.string.isRequired,props:t.object.isRequired})).isRequired,flyoutIconDescription:t.string,onApply:t.func,onCancel:t.func,onFlyoutClose:t.func,onFlyoutOpen:t.func,primaryActionLabel:t.string,reactTableFiltersState:t.arrayOf(t.shape({id:t.string.isRequired,type:t.string.isRequired,value:t.any.isRequired})),secondaryActionLabel:t.string,setAllFilters:t.func.isRequired,title:t.string,updateMethod:t.oneOf([E,ye]).isRequired};V.__docgenInfo={description:"",methods:[],displayName:"FilterFlyout",props:{flyoutIconDescription:{defaultValue:{value:"'Open filters'",computed:!1},description:"Icon description for the filter flyout button",type:{name:"string"},required:!1},align:{defaultValue:{value:"'bottom'",computed:!1},description:"Tooltip alignment for the filter button",type:{name:"string"},required:!1},filters:{defaultValue:{value:"[]",computed:!1},description:"Array of filters to render",type:{name:"arrayOf",value:{name:"shape",value:{type:{name:"string",required:!0},column:{name:"string",required:!0},props:{name:"object",required:!0}}}},required:!1},title:{defaultValue:{value:"'Filter'",computed:!1},description:"Title of the filter flyout",type:{name:"string"},required:!1},primaryActionLabel:{defaultValue:{value:"'Apply'",computed:!1},description:"Label text of the primary action in the flyout",type:{name:"string"},required:!1},onFlyoutOpen:{defaultValue:{value:"() => {}",computed:!1},description:"Callback when the flyout opens",type:{name:"func"},required:!1},onFlyoutClose:{defaultValue:{value:"() => {}",computed:!1},description:"Callback when the flyout closes",type:{name:"func"},required:!1},onApply:{defaultValue:{value:"() => {}",computed:!1},description:"Callback when the apply button is clicked",type:{name:"func"},required:!1},onCancel:{defaultValue:{value:"() => {}",computed:!1},description:"Callback when the cancel button is clicked",type:{name:"func"},required:!1},secondaryActionLabel:{defaultValue:{value:"'Cancel'",computed:!1},description:"Label text of the secondary action in the flyout",type:{name:"string"},required:!1},data:{defaultValue:{value:"[]",computed:!1},description:"All data rows in the table",type:{name:"array"},required:!1},reactTableFiltersState:{defaultValue:{value:"[]",computed:!1},description:"Filters from react table's state",type:{name:"arrayOf",value:{name:"shape",value:{id:{name:"string",required:!0},type:{name:"string",required:!0},value:{name:"any",required:!0}}}},required:!1},setAllFilters:{description:"Function that sets all the filters, this comes from the datagridState",type:{name:"func"},required:!0},updateMethod:{description:"The update method used to apply the filters",type:{name:"enum",value:[{value:"'batch'",computed:!1},{value:"'instant'",computed:!1}]},required:!0}}};const Se=(n,d,r)=>n.filter(a=>d.some(e=>{const s=a.values[e];return s!==void 0?String(s).toLowerCase()===String(r).toLowerCase():!0})),P=(n,d,r)=>{const a=r.filter(e=>e.selected).map(e=>e.value);return a.length===0?n:n.filter(e=>{const s=e.values[d];return a.includes(s)})},Ie=n=>{const d=c.useMemo(()=>({[ve]:(r,a,[e,s])=>r.filter(f=>{const i=f.values[a],b=typeof e=="object"?e:new Date(e),y=typeof s=="object"?s:new Date(s),h=typeof i=="object"?i:new Date(i);return h.getTime()<=y.getTime()&&h.getTime()>=b.getTime()}),[Fe]:(r,a,e)=>{if(e==="")return r;const s=parseInt(e);return r.filter(f=>f.values[a]===s)},[ge]:(r,a,e)=>P(r,a,e),[be]:(r,a,e)=>P(r,a,e),[he]:(r,a,e)=>Se(r,a,e)}),[]);n.useInstance.push(r=>{const{filterProps:a,setAllFilters:e,setFilter:s,headers:f,data:i,state:b}=r,y={variation:"flyout",updateMethod:E,panelIconDescription:"Open filter panel",reactTableFiltersState:b.filters},h=()=>({...y,...a,setAllFilters:e,setFilter:s,headers:f,data:i});Object.assign(r,{filterProps:{...y,...r?.filterProps},filterTypes:d,getFilterFlyoutProps:h,FilterFlyout:V})})};export{Ie as u};
