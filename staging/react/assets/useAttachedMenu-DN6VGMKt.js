import{b as fe,i as de,d as me,_ as he,$ as pe,k as g,l as xe,a4 as ye,Z as be,Y as we,P as n,g as Ie}from"./index-4poXP75K.js";import{r,e as _}from"./index-DtHxqM--.js";import{r as ze}from"./index-DgLvjnYm.js";const Ce={isRoot:!0,hasIcons:!1,hasSelectableItems:!1,size:null,items:[],requestCloseRoot:()=>{}};function Ee(u,f){switch(f.type){case"enableIcons":return{...u,hasIcons:!0};case"enableSelectableItems":return{...u,hasSelectableItems:!0};case"registerItem":return{...u,items:[...u.items,f.payload].filter(x=>x.ref.current!==null)}}}const Q=r.createContext({state:Ce,dispatch:u=>{}}),Se=_.createContext({direction:"ltr"});function $e(){return r.useContext(Se)}const O=8,Me=r.forwardRef(function({children:f,className:x,containerRef:d,label:P,menuAlignment:a,mode:B,onClose:y,onOpen:E,open:s,size:S="sm",legacyAutoalign:z="true",target:$=pe&&document.body,x:T=0,y:X=0,...M},ee){const l=fe(),F=r.useRef(null),R=r.useContext(Q),m=R.state.isRoot,te=m?S:R.state.size,[K,U]=r.useReducer(Ee,{...R.state,isRoot:!1,size:S,requestCloseRoot:m?q:R.state.requestCloseRoot}),v=r.useMemo(()=>({state:K,dispatch:U}),[K,U]),i=r.useRef(null),ne=de([ee,i]),[W,j]=r.useState([-1,-1]),b=v.state.items.filter(e=>!e.disabled&&e.ref.current);let w;if(d!=null&&d.current){const{width:e}=d.current.getBoundingClientRect();w=e}const{direction:se}=$e();function oe(){F.current&&F.current.focus()}function re(){var e;if(i.current){if(F.current=document.activeElement,z){const t=ae();((document==null?void 0:document.dir)==="rtl"||se==="rtl")&&!((e=M==null?void 0:M.id)!=null&&e.includes("MenuButton"))?(i.current.style.insetInlineStart="initial",i.current.style.insetInlineEnd=`${t[0]}px`):(i.current.style.insetInlineStart=`${t[0]}px`,i.current.style.insetInlineEnd="initial"),i.current.style.insetBlockStart=`${t[1]}px`,j(t)}i.current.focus(),E&&E()}}function q(){oe(),y&&y()}function ie(e){e.stopPropagation(),(g(e,xe)||!m&&g(e,ye))&&y?q():H(e)}function H(e){var D,h;const t=b.findIndex(c=>{var C,p;return(p=(C=c.ref)==null?void 0:C.current)==null?void 0:p.contains(document.activeElement)});let o=t;t===-1?o=0:e&&(g(e,be)&&(o=o-1),g(e,we)&&(o=o+1)),o<0&&(o=b.length-1),o>=b.length&&(o=0),o!==t&&((h=(D=b[o].ref)==null?void 0:D.current)==null||h.focus(),e==null||e.preventDefault())}function ce(e){var t;s&&y&&m&&!((t=i.current)!=null&&t.contains(e.relatedTarget))&&q()}function V(e,t){if(!i.current)return;const{width:o,height:D}=i.current.getBoundingClientRect(),h=m?"vertical":"horizontal",c={x:{max:window.innerWidth,size:o,anchor:h==="horizontal"?e[1]:e[0],reversedAnchor:h==="horizontal"?e[0]:e[1],offset:0},y:{max:window.innerHeight,size:D,anchor:h==="horizontal"?e[0]:e[1],reversedAnchor:h==="horizontal"?e[1]:e[0],offset:m?0:4}};if(w&&w<c.x.size&&(a==="bottom"||a==="top")&&(c.x.size=w),w&&(a==="bottom-end"||a==="top-end")&&c.x.anchor>=87&&w<c.x.size){const N=c.x.anchor+c.x.reversedAnchor;c.x.anchor=c.x.anchor+N}const{max:C,size:p,anchor:L,reversedAnchor:Z,offset:k}=c[t],I=[C-O-p-L>=0?L-k:!1,Z-p>=0?Z-p+k:!1,C-O-p],G=a==="top"||a==="top-end"||a==="top-start";typeof I[0]=="number"&&G&&I[0]>=0&&!I[1]&&t==="y"?i.current.style.transform="translate(0)":G&&!I[0]&&t==="y"&&(I[0]=L-k);const J=I.find(N=>N!==!1);return J>=O?J:O}function ue(e){return e!=null}function Y(e){if(Array.isArray(e)){const t=e.filter(ue);return t.length===2?t:void 0}else return[e,e]}function ae(){const e={x:Y(T),y:Y(X)};return!e.x||!e.y?[-1,-1]:[V(e.x,"x")??-1,V(e.y,"y")??-1]}r.useEffect(()=>{if(s){const e=requestAnimationFrame(()=>{b.length>0&&H()});return()=>cancelAnimationFrame(e)}},[s,b]),r.useEffect(()=>{s?re():j([-1,-1])},[s]);const le=me(x,`${l}--menu`,`${l}--menu--${te}`,{[`${l}--menu--box-shadow-top`]:a&&a.slice(0,3)==="top",[`${l}--menu--open`]:s,[`${l}--menu--shown`]:s&&!z||W[0]>=0&&W[1]>=0,[`${l}--menu--with-icons`]:v.state.hasIcons,[`${l}--menu--with-selectable-items`]:v.state.hasSelectableItems,[`${l}--autoalign`]:!z}),A=_.createElement(Q.Provider,{value:v},_.createElement("ul",he({},M,{className:le,role:"menu",ref:ne,"aria-label":P,tabIndex:-1,onKeyDown:ie,onBlur:ce}),f));return $&&m?s&&ze.createPortal(A,$)||null:A});Me.propTypes={children:n.node,className:n.string,label:n.string,menuAlignment:n.string,mode:Ie(n.oneOf(["full","basic"])),onClose:n.func,onOpen:n.func,open:n.bool,size:n.oneOf(["xs","sm","md","lg"]),target:n.object,x:n.oneOfType([n.number,n.arrayOf(n.number)]),y:n.oneOfType([n.number,n.arrayOf(n.number)])};function ge(u){const[f,x]=r.useState(!1),[d,P]=r.useState([[-1,-1],[-1,-1]]);function a(){const s=(u==null?void 0:u.current)||u;if(s){const{left:S,top:z,right:$,bottom:T}=s.getBoundingClientRect();P([[S,$],[z,T]])}x(!0)}function B(){x(!1)}function y(){f?B():a()}function E(s){s.preventDefault()}return{open:f,x:d[0],y:d[1],handleClick:y,handleMousedown:E,handleClose:B}}export{Se as L,Q as M,Me as a,ge as b,$e as u};
