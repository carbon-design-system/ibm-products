{"version":3,"file":"CoachmarkFixed-qX_79C8Y.js","sources":["../../src/components/CoachmarkFixed/CoachmarkFixed.tsx"],"sourcesContent":["/**\n * Copyright IBM Corp. 2023, 2024\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n// Import portions of React that are needed.\nimport React, {\n  ReactNode,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from 'react';\n\nimport { COACHMARK_OVERLAY_KIND } from '../Coachmark/utils/enums';\nimport {\n  CoachmarkContext,\n  CoachmarkContextType,\n} from '../Coachmark/utils/context';\nimport { CoachmarkOverlay } from '../Coachmark/CoachmarkOverlay';\nimport { CoachmarkTagline } from '../Coachmark/CoachmarkTagline';\n// Other standard imports.\nimport PropTypes from 'prop-types';\nimport { createPortal } from 'react-dom';\nimport cx from 'classnames';\nimport { getDevtoolsProps } from '../../global/js/utils/devtools';\nimport { pkg } from '../../settings';\nimport {\n  useIsomorphicEffect,\n  usePrefersReducedMotion,\n} from '../../global/js/hooks';\n\n// Carbon and package components we use.\n/* TODO: @import(s) of carbon components and other package components. */\n\n// The block part of our conventional BEM class names (blockClass__E--M).\nconst coachmarkClass = `${pkg.prefix}--coachmark`;\nconst blockClass = `${coachmarkClass}-fixed`;\nconst overlayBlockClass = `${coachmarkClass}-overlay`;\nconst componentName = 'CoachmarkFixed';\n\nexport interface CoachmarkFixedProps {\n  /**\n   * CoachmarkFixed should use a single CoachmarkOverlayElements component as a child.\n   */\n  children: ReactNode;\n  /**\n   * Optional class name for this component.\n   */\n  className?: string;\n  /**\n   * Function to call when the Coachmark closes.\n   */\n  onClose?: () => void;\n  /**\n   * By default, the Coachmark will be appended to the end of `document.body`.\n   * The Coachmark will remain persistent as the user navigates the app until\n   * the user closes the Coachmark.\n   *\n   * Alternatively, the app developer can tightly couple the Coachmark to a DOM\n   * element or other component by specifying a CSS selector. The Coachmark will\n   * remain visible as long as that element remains visible or mounted. When the\n   * element is hidden or component is unmounted, the Coachmark will disappear.\n   */\n  portalTarget?: string;\n  /**\n   * The tagline title which will be fixed to the bottom right of the window and will serve as the display trigger.\n   */\n  tagline: string;\n  /**\n   * Determines the theme of the component.\n   */\n  theme?: 'light' | 'dark';\n  /**\n   * Tooltip text and aria label for the Close button icon.\n   */\n  closeIconDescription?: string;\n}\n\nconst defaults = {\n  onClose: () => {},\n  theme: 'light',\n  tagline: '',\n};\n\n/**\n * Fixed coachmarks are used to call out specific functionality or concepts\n * within the UI that may not be intuitive but are important for the\n * user to gain understanding of the product's main value and discover new use cases.\n * This variant allows the a coachmark overlay to be displayed by interacting with the tagline.\n * @deprecated This component is deprecated.\n */\nexport const CoachmarkFixed = React.forwardRef<\n  HTMLDivElement,\n  CoachmarkFixedProps\n>(\n  (\n    {\n      children,\n      className,\n      onClose = defaults.onClose,\n      portalTarget,\n      tagline = defaults.tagline,\n      theme = defaults.theme,\n      closeIconDescription,\n      // Collect any other property values passed in.\n      ...rest\n    },\n    ref\n  ) => {\n    const overlayRef = useRef<HTMLDivElement>(null);\n    const portalNode = useRef<Element | DocumentFragment | null>(null);\n    const [isOpen, setIsOpen] = useState(false);\n    const [shouldResetPosition, setShouldResetPosition] = useState(false);\n    const [targetRect, setTargetRect] = useState();\n    const [targetOffset, setTargetOffset] = useState({ x: 0, y: 0 });\n    const [fixedIsVisible, setFixedIsVisible] = useState(false);\n    const shouldReduceMotion = usePrefersReducedMotion();\n\n    useIsomorphicEffect(() => {\n      portalNode.current = portalTarget\n        ? (document?.querySelector(portalTarget) ??\n          document?.querySelector('body'))\n        : document?.querySelector('body');\n    }, [portalTarget]);\n\n    const handleClose = useCallback(() => {\n      if (shouldReduceMotion) {\n        setIsOpen(false);\n      } else {\n        setFixedIsVisible(false);\n      }\n    }, [shouldReduceMotion]);\n\n    const handleTransitionEnd = (e: TransitionEvent) => {\n      if (e.propertyName === 'transform' && !fixedIsVisible) {\n        setIsOpen(false);\n        onClose();\n      }\n    };\n\n    const handleTargetClick = (e) => {\n      setTargetRect(e.target.getBoundingClientRect());\n      setTargetOffset({ x: e.target.offsetLeft, y: e.target.offsetTop });\n      // reset position for all other kinds\n      setIsOpen(false);\n      setShouldResetPosition(true);\n    };\n\n    const escFunction = useCallback(\n      (event) => {\n        if (event.key === 'Escape') {\n          handleClose();\n        }\n      },\n      [handleClose]\n    );\n\n    useEffect(() => {\n      document.addEventListener('keydown', escFunction, false);\n\n      return () => {\n        document.removeEventListener('keydown', escFunction, false);\n      };\n    }, [escFunction]);\n\n    const contextValue: CoachmarkContextType = {\n      buttonProps: {\n        'aria-expanded': isOpen,\n        tabIndex: 0,\n        onClick: handleTargetClick,\n        // Compensate for accidental open/close on double-click.\n        // Only open on double-click.\n        onDoubleClick: handleTargetClick,\n      },\n      closeButtonProps: {\n        onClick: handleClose,\n      },\n      targetRect: targetRect,\n      targetOffset: targetOffset,\n      isOpen: isOpen,\n      closeIconDescription,\n    };\n\n    // instead of toggling on/off,\n    // keep open and reset to original position\n    useEffect(() => {\n      if (shouldResetPosition) {\n        setShouldResetPosition(false);\n        setIsOpen(true);\n      }\n    }, [shouldResetPosition]);\n\n    useEffect(() => {\n      setFixedIsVisible(isOpen);\n    }, [isOpen]);\n\n    // On unmount:\n    // - DO NOT \"Close()\" the coachmark.\n    //   - This triggers a \"signal\" to close it forever.\n    //   - \"Closing\" should only ever be a user-triggered event.\n    // - DO \"hide\" the coachmark.\n    //   - The app is doing the action for the user.\n    //   - The user will have the opportunity to open it again.\n    useEffect(() => {\n      return () => setIsOpen(false);\n    }, []);\n\n    return (\n      <CoachmarkContext.Provider value={contextValue}>\n        <div\n          {\n            // Pass through any other property values as HTML attributes.\n            ...rest\n          }\n          className={cx(\n            blockClass, // Apply the block class to the main HTML element\n            `${blockClass}__${theme}`,\n            className // Apply any supplied class names to the main HTML element.\n          )}\n          ref={ref}\n          {...getDevtoolsProps(componentName)}\n        >\n          <CoachmarkTagline title={tagline} onClose={onClose} />\n          {isOpen &&\n            portalNode?.current &&\n            createPortal(\n              <CoachmarkOverlay\n                ref={overlayRef}\n                fixedIsVisible={fixedIsVisible}\n                kind={COACHMARK_OVERLAY_KIND.FIXED}\n                onClose={handleClose}\n                onTransitionEnd={handleTransitionEnd}\n                theme={theme}\n                className={cx(\n                  fixedIsVisible && `${overlayBlockClass}--is-visible`,\n                  overlayBlockClass\n                )}\n              >\n                {children}\n              </CoachmarkOverlay>,\n              // Default to `document.body` when `portalNode` is `null`\n              portalNode?.current\n            )}\n        </div>\n      </CoachmarkContext.Provider>\n    );\n  }\n);\n\n/**@ts-ignore*/\nCoachmarkFixed.deprecated = {\n  level: 'warn',\n  details: `${componentName} is deprecated.`,\n};\n\n// Return a placeholder if not released and not enabled by feature flag\n\n// The display name of the component, used by React. Note that displayName\n// is used in preference to relying on function.name.\nCoachmarkFixed.displayName = componentName;\n\n// The types and DocGen commentary for the component props,\n// in alphabetical order (for consistency).\n// See https://www.npmjs.com/package/prop-types#usage.\nCoachmarkFixed.propTypes = {\n  // TODO: Add this to MDX as will be done with Coachmark\n  /**\n   * CoachmarkFixed should use a single CoachmarkOverlayElements component as a child.\n   */\n  children: PropTypes.node.isRequired,\n  /**\n   * Optional class name for this component.\n   */\n  className: PropTypes.string,\n  /**\n   * Tooltip text and aria label for the Close button icon.\n   */\n  closeIconDescription: PropTypes.string,\n  /**\n   * Function to call when the Coachmark closes.\n   */\n  onClose: PropTypes.func,\n  /**\n   * By default, the Coachmark will be appended to the end of `document.body`.\n   * The Coachmark will remain persistent as the user navigates the app until\n   * the user closes the Coachmark.\n   *\n   * Alternatively, the app developer can tightly couple the Coachmark to a DOM\n   * element or other component by specifying a CSS selector. The Coachmark will\n   * remain visible as long as that element remains visible or mounted. When the\n   * element is hidden or component is unmounted, the Coachmark will disappear.\n   */\n  portalTarget: PropTypes.string,\n\n  /**\n   * The tagline title which will be fixed to the bottom right of the window and will serve as the display trigger.\n   */\n  tagline: PropTypes.string.isRequired,\n  /**\n   * Determines the theme of the component.\n   */\n  theme: PropTypes.oneOf(['light', 'dark']),\n};\n"],"names":["coachmarkClass","pkg","blockClass","overlayBlockClass","componentName","defaults","CoachmarkFixed","React","children","className","onClose","portalTarget","tagline","theme","closeIconDescription","rest","ref","overlayRef","useRef","portalNode","isOpen","setIsOpen","useState","shouldResetPosition","setShouldResetPosition","targetRect","setTargetRect","targetOffset","setTargetOffset","fixedIsVisible","setFixedIsVisible","shouldReduceMotion","usePrefersReducedMotion","useIsomorphicEffect","handleClose","useCallback","handleTransitionEnd","e","handleTargetClick","escFunction","event","useEffect","contextValue","CoachmarkContext","cx","getDevtoolsProps","CoachmarkTagline","createPortal","CoachmarkOverlay","COACHMARK_OVERLAY_KIND","PropTypes"],"mappings":"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"}