import{Z as B,b as it,d as at,u as ct,a as dt,f as ut,s as ft,h as pt,g as mt,i as P,c as j,_ as V,e as ht,U as _e,E as gt,S as It,Y as yt,o as St}from"./index-C8rbkH0g.js";import{u as $e,L as z,a as xt}from"./index-Bo0ibsxA.js";import{g as bt}from"./_commonjsHelpers-BosuxZz1.js";import{P as r}from"./index-Dk74W0Oi.js";import{r as u,R as c}from"./index-BwDkhjyp.js";import{m as vt}from"./mergeRefs-CTUecegF.js";import{F as wt}from"./FormContext-C7kRVu4t.js";import{C as Ct}from"./Checkbox-BYXaHiKq.js";import{n as _t}from"./settings-DI4GKhuL.js";import{W as Et,a as $t}from"./bucket-18--U95jA7N.js";var Tt=typeof Element<"u",At=typeof Map=="function",Ot=typeof Set=="function",Ft=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Y(e,s){if(e===s)return!0;if(e&&s&&typeof e=="object"&&typeof s=="object"){if(e.constructor!==s.constructor)return!1;var l,n,a;if(Array.isArray(e)){if(l=e.length,l!=s.length)return!1;for(n=l;n--!==0;)if(!Y(e[n],s[n]))return!1;return!0}var d;if(At&&e instanceof Map&&s instanceof Map){if(e.size!==s.size)return!1;for(d=e.entries();!(n=d.next()).done;)if(!s.has(n.value[0]))return!1;for(d=e.entries();!(n=d.next()).done;)if(!Y(n.value[1],s.get(n.value[0])))return!1;return!0}if(Ot&&e instanceof Set&&s instanceof Set){if(e.size!==s.size)return!1;for(d=e.entries();!(n=d.next()).done;)if(!s.has(n.value[0]))return!1;return!0}if(Ft&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(s)){if(l=e.length,l!=s.length)return!1;for(n=l;n--!==0;)if(e[n]!==s[n])return!1;return!0}if(e.constructor===RegExp)return e.source===s.source&&e.flags===s.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof s.valueOf=="function")return e.valueOf()===s.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof s.toString=="function")return e.toString()===s.toString();if(a=Object.keys(e),l=a.length,l!==Object.keys(s).length)return!1;for(n=l;n--!==0;)if(!Object.prototype.hasOwnProperty.call(s,a[n]))return!1;if(Tt&&e instanceof Element)return!1;for(n=l;n--!==0;)if(!((a[n]==="_owner"||a[n]==="__v"||a[n]==="__o")&&e.$$typeof)&&!Y(e[a[n]],s[a[n]]))return!1;return!0}return e!==e&&s!==s}var Mt=function(s,l){try{return Y(s,l)}catch(n){if((n.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw n}};const ne=bt(Mt),Pt={compareItems:r.func,sortItems:r.func},Bt=(e,s,l)=>{let{locale:n}=l;return e.localeCompare(s,n,{numeric:!0})},Dt=(e,s)=>{let{selectedItems:l=[],itemToString:n,compareItems:a,locale:d="en"}=s;return e.sort((p,m)=>{if(p.isSelectAll)return-1;if(m.isSelectAll)return 1;const y=l.includes(p),O=l.includes(m);return y&&!O?-1:O&&!y?1:a(n(p),n(m),{locale:d})})};function Ee(e){let{isControlled:s,isMounted:l,onChangeHandlerControlled:n,onChangeHandlerUncontrolled:a,selectedItems:d}=e;s?l&&n&&n({selectedItems:d}):a(d)}function kt(e){let{disabled:s,onChange:l,initialSelectedItems:n=[],selectedItems:a,selectAll:d=!1,filteredItems:p=[]}=e;const m=u.useRef(!1),y=u.useRef(l),[O,E]=u.useState(n),v=!!a,h=v?a:O,Z=u.useCallback(_=>{if(s)return;const H=p.filter(w=>!w.disabled),G=p.filter(w=>w.disabled).length;let S;if(_&&_.isSelectAll&&h.length>0)S=[];else if(_&&_.isSelectAll&&h.length==0)S=H;else{let w;h.forEach((D,J)=>{ne(D,_)&&(w=J)}),w===void 0?(S=h.concat(_),d&&p.length-1===S.length+G&&(S=H)):(S=Te(h,w),S=S.filter(D=>!D.isSelectAll))}Ee({isControlled:v,isMounted:m.current,onChangeHandlerControlled:y.current,onChangeHandlerUncontrolled:E,selectedItems:S})},[s,h,p,d,v]),g=u.useCallback(()=>{s||Ee({isControlled:v,isMounted:m.current,onChangeHandlerControlled:y.current,onChangeHandlerUncontrolled:E,selectedItems:[]})},[s,v]);return u.useEffect(()=>{y.current=l},[l]),u.useEffect(()=>{m.current&&y.current&&!v&&y.current({selectedItems:h})},[v,h]),u.useEffect(()=>(m.current=!0,()=>{m.current=!1}),[]),{selectedItems:h,onItemChange:Z,clearSelection:g}}class Nt extends c.Component{constructor(s){super(s),B(this,"internalSetState",(l,n)=>this.setState(l,()=>{n&&n(),this.props.onChange&&this.props.onChange(this.state)})),B(this,"handleClearSelection",()=>{this.props.disabled||this.internalSetState({selectedItems:[]})}),B(this,"handleSelectItem",l=>{this.internalSetState(n=>({selectedItems:n.selectedItems.concat(l)}))}),B(this,"handleRemoveItem",l=>{this.internalSetState(n=>({selectedItems:Te(n.selectedItems,l)}))}),B(this,"handleOnItemChange",l=>{if(this.props.disabled)return;const{selectedItems:n}=this.state;let a;if(n.forEach((d,p)=>{ne(d,l)&&(a=p)}),a===void 0){this.handleSelectItem(l);return}this.handleRemoveItem(a)}),this.state={selectedItems:s.initialSelectedItems}}render(){const{children:s,render:l}=this.props,{selectedItems:n}=this.state,a={selectedItems:n,onItemChange:this.handleOnItemChange,clearSelection:this.handleClearSelection};return l!==void 0?l(a):s!==void 0?s(a):null}}B(Nt,"propTypes",{children:r.func,disabled:r.bool,initialSelectedItems:r.array.isRequired,onChange:r.func,render:r.func});const Te=(e,s)=>{const l=e.slice();return l.splice(s,1),l},{ItemClick:Rt,ToggleButtonBlur:jt,ToggleButtonKeyDownArrowDown:zt,ToggleButtonKeyDownArrowUp:Ht,ToggleButtonKeyDownEnter:Lt,ToggleButtonKeyDownEscape:Kt,ToggleButtonKeyDownSpaceButton:Ut,ItemMouseMove:Wt,MenuMouseLeave:qt,ToggleButtonClick:Vt,ToggleButtonKeyDownPageDown:Yt,ToggleButtonKeyDownPageUp:Zt,FunctionSetHighlightedIndex:Gt}=$e.stateChangeTypes,Jt=e=>typeof e=="string"?e:typeof e=="number"?`${e}`:e!==null&&typeof e=="object"&&"label"in e&&typeof e.label=="string"?e.label:"",Ae=c.forwardRef((e,s)=>{var Ce;let{autoAlign:l=!1,className:n,id:a,items:d,itemToElement:p,itemToString:m=Jt,titleText:y=!1,hideLabel:O,helperText:E,label:v,type:h="default",size:Z,disabled:g=!1,initialSelectedItems:_=[],sortItems:H=Dt,compareItems:G=Bt,clearSelectionText:S="To clear selection, press Delete or Backspace",clearAnnouncement:w="all items have been cleared",clearSelectionDescription:D="Total items selected: ",light:J,invalid:x,invalidText:Oe,warn:L,warnText:Fe,useTitleInItem:Me,translateWithId:se,downshiftProps:Pe,open:F=!1,selectionFeedback:le="top-after-reopen",onChange:Be,onMenuChange:re,direction:oe="bottom",selectedItems:ie,readOnly:k,locale:De="en",slug:K}=e;const N=u.useMemo(()=>d.filter(t=>{if(typeof t=="object"&&t!==null){for(const f in t)if(Object.hasOwn(t,f)&&t[f]===void 0)return!1}return!0}),[d]);let R=N.some(t=>t.isSelectAll);(ie??[]).length>0&&R&&(console.warn("Warning: `selectAll` should not be used when `selectedItems` is provided. Please pass either `selectAll` or `selectedItems`, not both."),R=!1);const o=it(),{isFluid:U}=u.useContext(wt),ae=at(),[ke,ce]=u.useState(!1),[de,ue]=u.useState(!1),[b,Ne]=u.useState(F||!1),[Re,je]=u.useState(F),[ze,He]=u.useState([]),[Le,fe]=u.useState(!1),$=ct("enable-v12-dynamic-floating-styles")||l,{refs:M,floatingStyles:pe,middlewareData:me}=dt($?{placement:oe,strategy:"fixed",middleware:[l&&ut({crossAxis:!1}),ft({apply(t){let{rects:f,elements:i}=t;Object.assign(i.floating.style,{width:`${f.reference.width}px`})}}),l&&pt()],whileElementsMounted:mt}:{});u.useLayoutEffect(()=>{var t;if($){const f={...pe,visibility:(t=me.hide)!=null&&t.referenceHidden?"hidden":"visible"};Object.keys(f).forEach(i=>{M.floating.current&&(M.floating.current.style[i]=f[i])})}},[$,pe,M.floating,me,F]);const{selectedItems:W,onItemChange:he,clearSelection:ge}=kt({disabled:g,initialSelectedItems:_,onChange:Be,selectedItems:ie,selectAll:R,filteredItems:N}),Q={selectedItems:W,itemToString:m,compareItems:G,locale:De},Ke={stateReducer:tt,isOpen:b,itemToString:t=>Array.isArray(t)&&t.map(function(f){return m(f)}).join(", ")||"",selectedItem:W,items:N,isItemDisabled(t,f){return t.disabled},...Pe},{getToggleButtonProps:Ue,getLabelProps:We,getMenuProps:Ie,getItemProps:qe,selectedItem:Ve,highlightedIndex:Ye,setHighlightedIndex:ye}=$e(Ke),Se=Ue({onFocus:()=>{ue(!0)},onBlur:()=>{ue(!1)},onKeyDown:t=>{g||((P(t,_e)||P(t,gt))&&!b&&(ge(),t.stopPropagation()),!b&&P(t,_e)&&I.length>0&&fe(!0),(P(t,It)||P(t,yt)||P(t,St))&&!b&&(ye(0),fe(!1),q(!0)))}}),X=vt(Se.ref,s),I=Ve,q=t=>{Ne(t),re&&re(t)};Re!==F&&(q(F),je(F));const T=h==="inline",xe=!x&&L,Ze=j(`${o}--multi-select__wrapper`,`${o}--list-box__wrapper`,n,{[`${o}--multi-select__wrapper--inline`]:T,[`${o}--list-box__wrapper--inline`]:T,[`${o}--multi-select__wrapper--inline--invalid`]:T&&x,[`${o}--list-box__wrapper--inline--invalid`]:T&&x,[`${o}--list-box__wrapper--fluid--invalid`]:U&&x,[`${o}--list-box__wrapper--fluid--focus`]:!b&&U&&ke,[`${o}--list-box__wrapper--slug`]:K}),Ge=j(`${o}--label`,{[`${o}--label--disabled`]:g,[`${o}--visually-hidden`]:O}),be=E?`multiselect-helper-text-${ae}`:void 0,Je=`multiselect-field-label-${ae}`,Qe=j(`${o}--form__helper-text`,{[`${o}--form__helper-text--disabled`]:g}),Xe=j(`${o}--multi-select`,{[`${o}--multi-select--invalid`]:x,[`${o}--multi-select--invalid--focused`]:x&&de,[`${o}--multi-select--warning`]:xe,[`${o}--multi-select--inline`]:T,[`${o}--multi-select--selected`]:I&&I.length>0,[`${o}--list-box--up`]:oe==="top",[`${o}--multi-select--readonly`]:k,[`${o}--autoalign`]:$,[`${o}--multi-select--selectall`]:R}),et=p;le==="fixed"?Q.selectedItems=[]:le==="top-after-reopen"&&(Q.selectedItems=ze);function tt(t,f){const{changes:i,props:ee,type:A}=f,{highlightedIndex:C}=i;switch(i.isOpen&&!b&&He(W),A){case Ut:case Lt:if(i.selectedItem===void 0||Array.isArray(i.selectedItem))break;return he(i.selectedItem),{...i,highlightedIndex:t.highlightedIndex};case jt:case Kt:q(!1);break;case Vt:return q(i.isOpen||!1),{...i,highlightedIndex:W.length>0?0:void 0};case Rt:return ye(i.selectedItem),he(i.selectedItem),{...i,highlightedIndex:t.highlightedIndex};case qt:return{...i,highlightedIndex:t.highlightedIndex};case Gt:return b?{...i,highlightedIndex:N.indexOf(C)}:{...i,highlightedIndex:0};case zt:case Ht:case Yt:case Zt:if(C>-1){const te=document.querySelectorAll(`li.${o}--list-box__menu-item[role="option"]`);ee.scrollIntoView(te[C])}return C===-1?{...i,highlightedIndex:0}:i;case Wt:return{...i,highlightedIndex:t.highlightedIndex}}return i}const nt=j(`${o}--list-box__field--wrapper`,{[`${o}--list-box__field--wrapper--input-focused`]:de}),ve=t=>{t.target.classList.contains(`${o}--tag__close-icon`)?ce(!1):ce(t.type==="focus")},st=k?{onClick:t=>{t.preventDefault(),X.current!==void 0&&X.current.focus()},onKeyDown:t=>{["ArrowDown","ArrowUp"," ","Enter"].includes(t.key)&&t.preventDefault()}}:{};let we;K&&((Ce=K.type)==null?void 0:Ce.displayName)==="AILabel"&&(we=c.cloneElement(K,{size:"mini"}));const lt=I.length>0&&I.map(t=>t==null?void 0:t.text),rt=R?I.filter(t=>!t.isSelectAll).length:I.length,ot=u.useMemo(()=>Ie({ref:$?M.setFloating:null}),[$,Ie,M.setFloating]);return c.createElement("div",{className:Ze},c.createElement("label",V({className:Ge},We()),y&&y,I.length>0&&c.createElement("span",{className:`${o}--visually-hidden`},D," ",I.length," ",lt,",",S)),c.createElement(z,{onFocus:U?ve:void 0,onBlur:U?ve:void 0,type:h,size:Z,className:Xe,disabled:g,light:J,invalid:x,invalidText:Oe,warn:L,warnText:Fe,isOpen:b,id:a},x&&c.createElement(Et,{className:`${o}--list-box__invalid-icon`}),xe&&c.createElement($t,{className:`${o}--list-box__invalid-icon ${o}--list-box__invalid-icon--warning`}),c.createElement("div",{className:nt,ref:$?M.setReference:null},I.length>0&&c.createElement(z.Selection,{readOnly:k,clearSelection:!g&&!k?ge:_t,selectionCount:rt,translateWithId:se,disabled:g}),c.createElement("button",V({type:"button",className:`${o}--list-box__field`,disabled:g,"aria-disabled":g||k,"aria-describedby":!T&&!x&&!L&&E?be:void 0},Se,{ref:X},st),c.createElement("span",{id:Je,className:`${o}--list-box__label`},v),c.createElement(z.MenuIcon,{isOpen:b,translateWithId:se})),we),c.createElement(z.Menu,ot,b&&H(N,Q).map((t,f)=>{const i=I.filter(te=>ne(te,t)).length>0,ee=I.length!==0&&t.isSelectAll&&!i,A=qe({item:t,"aria-selected":i}),C=m(t);return c.createElement(z.MenuItem,V({key:A.id,isActive:i&&!t.isSelectAll,"aria-label":C,isHighlighted:Ye===f,title:C,disabled:A["aria-disabled"]},A),c.createElement("div",{className:`${o}--checkbox-wrapper`},c.createElement(Ct,{id:`${A.id}__checkbox`,labelText:p?c.createElement(et,V({key:A.id},t)):C,checked:i,title:Me?C:void 0,indeterminate:ee,disabled:g})))})),Le&&c.createElement("span",{"aria-live":"assertive","aria-label":w})),!T&&!x&&!L&&E&&c.createElement("div",{id:be,className:Qe},E))});Ae.displayName="MultiSelect";Ae.propTypes={...Pt,autoAlign:r.bool,className:r.string,clearSelectionDescription:r.string,clearSelectionText:r.string,compareItems:r.func,direction:r.oneOf(["top","bottom"]),disabled:r.bool,downshiftProps:r.object,helperText:r.node,hideLabel:r.bool,id:r.string.isRequired,initialSelectedItems:r.array,invalid:r.bool,invalidText:r.node,itemToElement:r.func,itemToString:r.func,items:r.array.isRequired,label:r.node.isRequired,light:ht(r.bool),locale:r.string,onChange:r.func,onMenuChange:r.func,open:r.bool,readOnly:r.bool,selectedItems:r.array,selectionFeedback:r.oneOf(["top","fixed","top-after-reopen"]),size:xt,slug:r.node,sortItems:r.func,titleText:r.node,translateWithId:r.func,type:r.oneOf(["default","inline"]),useTitleInItem:r.bool,warn:r.bool,warnText:r.node};export{Ae as M,ne as i};
