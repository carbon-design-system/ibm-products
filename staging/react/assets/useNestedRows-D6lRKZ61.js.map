{"version":3,"file":"useNestedRows-D6lRKZ61.js","sources":["../../src/components/Datagrid/useNestedRowExpander.js","../../src/components/Datagrid/useNestedRows.ts"],"sourcesContent":["/* eslint-disable react/prop-types */\n/**\n * Copyright IBM Corp. 2020, 2025\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React, { useRef } from 'react';\nimport { ChevronRight } from '@carbon/react/icons';\nimport cx from 'classnames';\nimport { pkg } from '../../settings';\nimport { useFocusRowExpander } from './useFocusRowExpander';\nimport { handleDynamicRowCheck } from './Datagrid/addons/stateReducer';\nimport { usePrefix } from '@carbon/react';\n\nconst blockClass = `${pkg.prefix}--datagrid`;\n\nconst useNestedRowExpander = (hooks) => {\n  const carbonPrefix = usePrefix();\n  const tempState = useRef(undefined);\n  const lastExpandedRowIndex = useRef(undefined);\n  const useInstance = (instance) => {\n    tempState.current = instance;\n  };\n\n  useFocusRowExpander({\n    instance: tempState?.current,\n    lastExpandedRowIndex: lastExpandedRowIndex?.current,\n    blockClass,\n    activeElement: typeof document !== 'undefined' && document.activeElement,\n  });\n\n  const visibleColumns = (columns, state) => {\n    const {\n      getAsyncSubRows,\n      dispatch,\n      state: tableState,\n    } = state.instance || {};\n    const fetchingDynamicSubRows = !!tableState.dynamicRowSkeleton;\n    const expanderColumn = {\n      id: 'expander',\n      Cell: ({ row }) => {\n        const expanderButtonProps = {\n          ...row.getToggleRowExpandedProps(),\n          disabled: getAsyncSubRows && fetchingDynamicSubRows,\n          onClick: async (event) => {\n            // Prevents `onRowClick` from being called if `useOnRowClick` is included\n            event.stopPropagation();\n            row.toggleRowExpanded();\n            lastExpandedRowIndex.current = row.id;\n            if (!row.isExpanded) {\n              try {\n                handleDynamicRowCheck({\n                  dispatch,\n                  status: 'start',\n                  rowId: row.id,\n                  depth: row.depth,\n                  index: row.index,\n                });\n                if (getAsyncSubRows) {\n                  await getAsyncSubRows?.(row);\n                }\n                handleDynamicRowCheck({\n                  dispatch,\n                  status: 'finish',\n                  rowId: row.id,\n                });\n              } catch (error) {\n                console.log({ error });\n              }\n            }\n          },\n        };\n        const {\n          expanderButtonTitleExpanded = 'Collapse row',\n          expanderButtonTitleCollapsed = 'Expand row',\n        } = tempState?.current || {};\n        const expanderTitle = row.isExpanded\n          ? expanderButtonTitleExpanded\n          : expanderButtonTitleCollapsed;\n        return row.canExpand || getAsyncSubRows ? (\n          <button\n            type=\"button\"\n            aria-label={expanderTitle}\n            className={cx(\n              `${blockClass}__row-expander`,\n              `${carbonPrefix}--btn`,\n              `${carbonPrefix}--btn--ghost`\n            )}\n            {...expanderButtonProps}\n          >\n            <ChevronRight\n              className={cx(`${blockClass}__expander-icon`, {\n                [`${blockClass}__expander-icon--not-open`]: !row.isExpanded,\n                [`${blockClass}__expander-icon--open`]: row.isExpanded,\n              })}\n            />\n          </button>\n        ) : null;\n      },\n      width: 48,\n      disableResizing: true,\n      disableSortBy: true,\n      Header: '',\n    };\n    return [expanderColumn, ...columns];\n  };\n  hooks.visibleColumns.push(visibleColumns);\n  hooks.useInstance.push(useInstance);\n};\n\nexport default useNestedRowExpander;\n","/**\n * Copyright IBM Corp. 2020, 2024\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport cx from 'classnames';\nimport { pkg } from '../../settings';\nimport useNestedRowExpander from './useNestedRowExpander';\nimport { useEffect } from 'react';\nimport { Hooks, TableInstance } from 'react-table';\nimport { DataGridState, DatagridRow } from './types';\n\nconst blockClass = `${pkg.prefix}--datagrid`;\n\nconst useNestedRows = (hooks: Hooks) => {\n  useNestedRowExpander(hooks);\n  const useInstance = (instance: TableInstance) => {\n    useEffect(() => {\n      const { rows } = instance as DataGridState;\n      const defaultExpandedRows = rows.filter(\n        (row) => row?.original?.defaultExpanded\n      );\n      if (defaultExpandedRows?.length) {\n        defaultExpandedRows.map((defaultExpandedRow) => {\n          if (\n            !defaultExpandedRow?.isExpanded &&\n            !defaultExpandedRow?.hasExpanded\n          ) {\n            defaultExpandedRow?.toggleRowExpanded?.();\n            defaultExpandedRow.hasExpanded = true;\n            return;\n          }\n        });\n      }\n    }, [instance, instance.rows]);\n    // This useEffect will expand rows if they exist in the initialState obj\n    useEffect(() => {\n      const { rows, initialState } = instance;\n      const { expandedRowIds } = initialState as DataGridState;\n\n      if (expandedRowIds) {\n        Object.keys(expandedRowIds).forEach((key) => {\n          const row = rows.filter(\n            (r: any) =>\n              r.id.toString() === key.toString() ||\n              r.original?.id?.toString() === key.toString()\n          ) as DatagridRow[];\n\n          if (\n            (row.length && key.toString() === row[0].id.toString()) ||\n            (row.length && key.toString() === row[0].original?.id?.toString())\n          ) {\n            row[0].toggleRowExpanded();\n          }\n        });\n      }\n    }, [instance]);\n\n    const marginLeft = 24;\n\n    const getRowProps = (props, { row }) => {\n      return [\n        props,\n        {\n          className: cx({\n            [`${blockClass}__carbon-nested-row`]: row.depth > 0,\n            [`${blockClass}__carbon-row-expanded`]: row.isExpanded,\n          }),\n        },\n      ];\n    };\n    const getRowStyles = (props, { row }) => [\n      props,\n      {\n        style: {\n          paddingLeft: `${\n            row.depth > 1\n              ? marginLeft * 2 + (row.depth - 1) * (marginLeft + marginLeft / 3)\n              : row.depth === 1\n                ? marginLeft * 2\n                : 0\n          }px`,\n        },\n      },\n    ];\n    const getIndentation = (depth) => 32 * depth + 16; // row indentation padding\n    const getCellProps = (props, { cell, instance }) => {\n      // we add a dynamic -ve margin right only if the cell is resized below minimum width i.e 50px, else we set the width based on indentation at different levels\n      const isFirstCell =\n        instance.columns.findIndex((c) => c.id === cell.column.id) === 0;\n      return [\n        props,\n        {\n          style: {\n            marginRight:\n              isFirstCell &&\n              cell.row.depth > 0 &&\n              parseInt(props.style.width, 10) <=\n                getIndentation(cell.row.depth) + 50 // indentation padding + expander cell or empty cell width\n                ? `${\n                    parseInt(props.style.width, 10) -\n                    (getIndentation(cell.row.depth) + 50)\n                  }px`\n                : '',\n            width:\n              isFirstCell && cell.row.depth > 0\n                ? parseInt(props.style.width, 10) -\n                  getIndentation(cell.row.depth)\n                : props.style.width,\n          },\n        },\n      ];\n    };\n\n    Object.assign(instance, { withNestedRows: true });\n    hooks.getRowProps.push(getRowProps);\n    hooks.getRowProps.push(getRowStyles);\n    hooks.getCellProps.push(getCellProps);\n  };\n\n  hooks.useInstance.push(useInstance);\n};\n\nexport default useNestedRows;\n"],"names":["blockClass","pkg","useNestedRowExpander","hooks","carbonPrefix","usePrefix","tempState","useRef","lastExpandedRowIndex","useInstance","instance","useFocusRowExpander","visibleColumns","columns","state","getAsyncSubRows","dispatch","tableState","fetchingDynamicSubRows","row","expanderButtonProps","event","handleDynamicRowCheck","error","expanderButtonTitleExpanded","expanderButtonTitleCollapsed","expanderTitle","React","cx","ChevronRight","useNestedRows","useEffect","rows","defaultExpandedRows","defaultExpandedRow","initialState","expandedRowIds","key","r","marginLeft","getRowProps","props","getRowStyles","getIndentation","depth","getCellProps","cell","isFirstCell","c"],"mappings":"iLAgBA,MAAMA,EAAa,GAAGC,EAAI,MAAM,aAE1BC,EAAwBC,GAAU,CACtC,MAAMC,EAAeC,EAAA,EACfC,EAAYC,EAAAA,OAAO,MAAS,EAC5BC,EAAuBD,EAAAA,OAAO,MAAS,EACvCE,EAAeC,GAAa,CAChCJ,EAAU,QAAUI,CACtB,EAEAC,EAAoB,CAClB,SAAUL,GAAW,QACrB,qBAAsBE,GAAsB,QAAA,WAC5CR,EACA,cAAe,OAAO,SAAa,KAAe,SAAS,aAAA,CAC5D,EAED,MAAMY,EAAiB,CAACC,EAASC,IAAU,CACzC,KAAM,CACJ,gBAAAC,EACA,SAAAC,EACA,MAAOC,CAAA,EACLH,EAAM,UAAY,CAAA,EAChBI,EAAyB,CAAC,CAACD,EAAW,mBAmE5C,MAAO,CAlEgB,CACrB,GAAI,WACJ,KAAM,CAAC,CAAE,IAAAE,KAAU,CACjB,MAAMC,EAAsB,CAC1B,GAAGD,EAAI,0BAAA,EACP,SAAUJ,GAAmBG,EAC7B,QAAS,MAAOG,GAAU,CAKxB,GAHAA,EAAM,gBAAA,EACNF,EAAI,kBAAA,EACJX,EAAqB,QAAUW,EAAI,GAC/B,CAACA,EAAI,WACP,GAAI,CACFG,EAAsB,CACpB,SAAAN,EACA,OAAQ,QACR,MAAOG,EAAI,GACX,MAAOA,EAAI,MACX,MAAOA,EAAI,KAAA,CACZ,EACGJ,GACF,MAAMA,IAAkBI,CAAG,EAE7BG,EAAsB,CACpB,SAAAN,EACA,OAAQ,SACR,MAAOG,EAAI,EAAA,CACZ,CACH,OAASI,EAAO,CACd,QAAQ,IAAI,CAAE,MAAAA,EAAO,CACvB,CAEJ,CAAA,EAEI,CACJ,4BAAAC,EAA8B,eAC9B,6BAAAC,EAA+B,YAAA,EAC7BnB,GAAW,SAAW,CAAA,EACpBoB,EAAgBP,EAAI,WACtBK,EACAC,EACJ,OAAON,EAAI,WAAaJ,EACtBY,EAAA,cAAC,SAAA,CACC,KAAK,SACL,aAAYD,EACZ,UAAWE,EACT,GAAG5B,CAAU,iBACb,GAAGI,CAAY,QACf,GAAGA,CAAY,cAAA,EAEhB,GAAGgB,CAAA,EAEJO,EAAA,cAACE,EAAA,CACC,UAAWD,EAAG,GAAG5B,CAAU,kBAAmB,CAC5C,CAAC,GAAGA,CAAU,2BAA2B,EAAG,CAACmB,EAAI,WACjD,CAAC,GAAGnB,CAAU,uBAAuB,EAAGmB,EAAI,UAAA,CAC7C,CAAA,CAAA,CACH,EAEA,IACN,EACA,MAAO,GACP,gBAAiB,GACjB,cAAe,GACf,OAAQ,EAAA,EAEc,GAAGN,CAAO,CACpC,EACAV,EAAM,eAAe,KAAKS,CAAc,EACxCT,EAAM,YAAY,KAAKM,CAAW,CACpC,EChGMT,EAAa,GAAGC,EAAI,MAAM,aAE1B6B,EAAiB3B,GAAiB,CACtCD,EAAqBC,CAAK,EAC1B,MAAMM,EAAeC,GAA4B,CAC/CqB,EAAAA,UAAU,IAAM,CACd,KAAM,CAAE,KAAAC,GAAStB,EACXuB,EAAsBD,EAAK,OAC9Bb,GAAQA,GAAK,UAAU,eAAA,EAEtBc,GAAqB,QACvBA,EAAoB,IAAKC,GAAuB,CAC9C,GACE,CAACA,GAAoB,YACrB,CAACA,GAAoB,YACrB,CACAA,GAAoB,oBAAA,EACpBA,EAAmB,YAAc,GACjC,MACF,CACF,CAAC,CAEL,EAAG,CAACxB,EAAUA,EAAS,IAAI,CAAC,EAE5BqB,EAAAA,UAAU,IAAM,CACd,KAAM,CAAE,KAAAC,EAAM,aAAAG,CAAA,EAAiBzB,EACzB,CAAE,eAAA0B,GAAmBD,EAEvBC,GACF,OAAO,KAAKA,CAAc,EAAE,QAASC,GAAQ,CAC3C,MAAMlB,EAAMa,EAAK,OACdM,GACCA,EAAE,GAAG,aAAeD,EAAI,YACxBC,EAAE,UAAU,IAAI,SAAA,IAAeD,EAAI,SAAA,CAAS,GAI7ClB,EAAI,QAAUkB,EAAI,SAAA,IAAelB,EAAI,CAAC,EAAE,GAAG,SAAA,GAC3CA,EAAI,QAAUkB,EAAI,aAAelB,EAAI,CAAC,EAAE,UAAU,IAAI,aAEvDA,EAAI,CAAC,EAAE,kBAAA,CAEX,CAAC,CAEL,EAAG,CAACT,CAAQ,CAAC,EAEb,MAAM6B,EAAa,GAEbC,EAAc,CAACC,EAAO,CAAE,IAAAtB,KACrB,CACLsB,EACA,CACE,UAAWb,EAAG,CACZ,CAAC,GAAG5B,CAAU,qBAAqB,EAAGmB,EAAI,MAAQ,EAClD,CAAC,GAAGnB,CAAU,uBAAuB,EAAGmB,EAAI,UAAA,CAC7C,CAAA,CACH,EAGEuB,EAAe,CAACD,EAAO,CAAE,IAAAtB,KAAU,CACvCsB,EACA,CACE,MAAO,CACL,YAAa,GACXtB,EAAI,MAAQ,EACRoB,EAAa,GAAKpB,EAAI,MAAQ,IAAMoB,EAAaA,EAAa,GAC9DpB,EAAI,QAAU,EACZoB,EAAa,EACb,CACR,IAAA,CACF,CACF,EAEII,EAAkBC,GAAU,GAAKA,EAAQ,GACzCC,EAAe,CAACJ,EAAO,CAAE,KAAAK,EAAM,SAAApC,KAAe,CAElD,MAAMqC,EACJrC,EAAS,QAAQ,UAAWsC,GAAMA,EAAE,KAAOF,EAAK,OAAO,EAAE,IAAM,EACjE,MAAO,CACLL,EACA,CACE,MAAO,CACL,YACEM,GACAD,EAAK,IAAI,MAAQ,GACjB,SAASL,EAAM,MAAM,MAAO,EAAE,GAC5BE,EAAeG,EAAK,IAAI,KAAK,EAAI,GAC/B,GACE,SAASL,EAAM,MAAM,MAAO,EAAE,GAC7BE,EAAeG,EAAK,IAAI,KAAK,EAAI,GACpC,KACA,GACN,MACEC,GAAeD,EAAK,IAAI,MAAQ,EAC5B,SAASL,EAAM,MAAM,MAAO,EAAE,EAC9BE,EAAeG,EAAK,IAAI,KAAK,EAC7BL,EAAM,MAAM,KAAA,CACpB,CACF,CAEJ,EAEA,OAAO,OAAO/B,EAAU,CAAE,eAAgB,GAAM,EAChDP,EAAM,YAAY,KAAKqC,CAAW,EAClCrC,EAAM,YAAY,KAAKuC,CAAY,EACnCvC,EAAM,aAAa,KAAK0C,CAAY,CACtC,EAEA1C,EAAM,YAAY,KAAKM,CAAW,CACpC"}