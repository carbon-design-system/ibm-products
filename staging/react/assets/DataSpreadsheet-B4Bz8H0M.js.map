{"version":3,"file":"DataSpreadsheet-B4Bz8H0M.js","sources":["../../src/global/js/hooks/useActiveElement.js","../../src/components/DataSpreadsheet/hooks/useMoveActiveCell.js","../../src/components/DataSpreadsheet/hooks/useResetSpreadsheetFocus.js","../../src/components/DataSpreadsheet/hooks/useSpreadsheetOutsideClick.js","../../src/components/DataSpreadsheet/hooks/useSpreadsheetEdit.js","../../src/components/DataSpreadsheet/hooks/useSpreadsheetMouseUp.js","../../src/components/DataSpreadsheet/utils/moveColumnIndicatorLine.js","../../src/components/DataSpreadsheet/hooks/useSpreadsheetMouseMove.js","../../src/components/DataSpreadsheet/utils/getSelectionAreaPoints.js","../../src/components/DataSpreadsheet/utils/createCellSelectionArea.js","../../src/components/DataSpreadsheet/utils/checkActiveHeaderCell.js","../../src/components/DataSpreadsheet/utils/checkSelectedHeaderCell.js","../../src/components/DataSpreadsheet/utils/getSpreadsheetWidth.js","../../src/components/DataSpreadsheet/utils/checkForHoldingKey.js","../../src/components/DataSpreadsheet/utils/handleHeaderCellSelection.js","../../src/components/DataSpreadsheet/utils/handleActiveCellInSelectionEnter.js","../../src/components/DataSpreadsheet/utils/handleActiveCellInSelectionTab.js","../../src/global/js/utils/rangeWithCallback.js","../../src/components/DataSpreadsheet/utils/handleCellDeletion.js","../../src/components/DataSpreadsheet/utils/commonEventHandlers.js","../../src/components/DataSpreadsheet/DataSpreadsheetBody.tsx","../../src/components/DataSpreadsheet/DataSpreadsheetHeader.tsx","../../src/components/DataSpreadsheet/utils/createActiveCellFn.js","../../src/components/DataSpreadsheet/utils/getCellSize.js","../../src/global/js/utils/getScrollbarWidth.js","../../src/components/DataSpreadsheet/utils/handleEditSubmit.js","../../src/components/DataSpreadsheet/DataSpreadsheet.tsx"],"sourcesContent":["/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { useState, useEffect } from 'react';\n\nexport const useActiveElement = () => {\n  const [active, setActive] = useState(document.activeElement);\n  const handleFocusIn = () => {\n    setActive(document.activeElement);\n  };\n\n  useEffect(() => {\n    document.addEventListener('focusin', handleFocusIn);\n    return () => {\n      document.removeEventListener('focusin', handleFocusIn);\n    };\n  }, []);\n\n  return active;\n};\n","/**\n * Copyright IBM Corp. 2022, 2024\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { useCallback, useEffect } from 'react';\n\n// Moves the placement of the active cell\nexport const useMoveActiveCell = ({\n  spreadsheetRef,\n  activeCellCoordinates,\n  containerHasFocus,\n  createActiveCell,\n  activeCellContent,\n  isActiveHeaderCellChanged,\n}) => {\n  let performCreateActiveCell;\n  //new active cell is created when the activeCellContent changes or navigate through headers\n  // Otherwise new active cell will display the old value in a glance\n  useEffect(() => {\n    performCreateActiveCell();\n  }, [activeCellContent, performCreateActiveCell, isActiveHeaderCellChanged]);\n\n  performCreateActiveCell = useCallback(() => {\n    const activeCellPlacementElement = spreadsheetRef?.current.querySelector(\n      `[data-row-index=\"${activeCellCoordinates?.row}\"][data-column-index=\"${activeCellCoordinates?.column}\"]`\n    );\n    const shouldPlaceActiveCellInHeader =\n      activeCellCoordinates?.row === 'header' && true;\n    const selectAllElement = spreadsheetRef?.current.querySelector(\n      `[data-row-index=\"header\"][data-column-index=\"header\"]`\n    );\n    if (containerHasFocus) {\n      createActiveCell({\n        placementElement: activeCellCoordinates\n          ? activeCellPlacementElement\n          : selectAllElement,\n        coords: activeCellCoordinates,\n        addToHeader: shouldPlaceActiveCellInHeader,\n      });\n    }\n  }, [\n    spreadsheetRef,\n    activeCellCoordinates,\n    containerHasFocus,\n    createActiveCell,\n  ]);\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { useEffect } from 'react';\nimport { pkg } from '../../../settings';\n\nexport const useResetSpreadsheetFocus = ({\n  blockClass = `${pkg.prefix}--data-spreadsheet`,\n  focusedElement,\n  removeActiveCell,\n  setContainerHasFocus,\n}) => {\n  // Reset everything when spreadsheet loses focus\n  useEffect(() => {\n    if (\n      !focusedElement.classList.contains(\n        `${blockClass}--interactive-cell-element`\n      )\n    ) {\n      setContainerHasFocus(false);\n      removeActiveCell();\n    }\n    if (\n      focusedElement.classList.contains(blockClass) ||\n      focusedElement.classList.contains(\n        `${blockClass}--interactive-cell-element`\n      )\n    ) {\n      setContainerHasFocus(true);\n    }\n  }, [focusedElement, removeActiveCell, blockClass, setContainerHasFocus]);\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { useEffect } from 'react';\nimport { pkg } from '../../../settings';\nimport { removeCellSelections } from '../utils/removeCellSelections';\n\n// Click outside useEffect for spreadsheet\nexport const useSpreadsheetOutsideClick = ({\n  isBlurSpreadsheet,\n  spreadsheetRef,\n  blockClass = `${pkg.prefix}--data-spreadsheet`,\n  setActiveCellCoordinates,\n  setSelectionAreas,\n  removeActiveCell,\n  setContainerHasFocus,\n  removeCellEditor,\n}) => {\n  useEffect(() => {\n    const handleOutsideClick = (event) => {\n      if (\n        !spreadsheetRef.current ||\n        spreadsheetRef.current.contains(event.target) ||\n        event.target.classList.contains(\n          `${blockClass}__active-cell--highlight`\n        ) ||\n        event.target.classList.contains(\n          `${blockClass}--interactive-cell-element`\n        )\n      ) {\n        return;\n      }\n      isBlurSpreadsheet.current = true;\n      setActiveCellCoordinates(null);\n      setSelectionAreas([]);\n      removeActiveCell();\n      removeCellSelections({ spreadsheetRef });\n      setContainerHasFocus(false);\n    };\n    document.addEventListener('click', handleOutsideClick);\n    return () => {\n      document.removeEventListener('click', handleOutsideClick);\n    };\n  }, [\n    isBlurSpreadsheet,\n    spreadsheetRef,\n    removeActiveCell,\n    blockClass,\n    setActiveCellCoordinates,\n    setContainerHasFocus,\n    setSelectionAreas,\n    removeCellEditor,\n  ]);\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { useEffect, useState } from 'react';\nimport { px } from '@carbon/layout';\nimport { pkg } from '../../../settings';\nimport { usePreviousValue } from '../../../global/js/hooks';\n\nexport const useSpreadsheetEdit = ({\n  isEditing,\n  rows,\n  activeCellCoordinates,\n  activeCellRef,\n  cellEditorRef,\n  cellEditorRulerRef,\n  visibleColumns,\n  defaultColumn,\n  cellEditorValue,\n  blockClass = `${pkg.prefix}--data-spreadsheet`,\n}) => {\n  const [nextIndex, setNextIndex] = useState(null);\n  const previousState = usePreviousValue({\n    nextIndex,\n  });\n  useEffect(() => {\n    if (!previousState?.nextIndex) {\n      setNextIndex(activeCellCoordinates?.column);\n    }\n  }, [previousState?.nextIndex, activeCellCoordinates]);\n  useEffect(() => {\n    const rulerWidth = cellEditorRulerRef.current.offsetWidth;\n    const cellEditorCurrentWidth = parseInt(cellEditorRef.current.style.width);\n    if (isEditing) {\n      const cellProps =\n        rows[activeCellCoordinates?.row]?.cells[activeCellCoordinates?.column];\n      const activeCellLeftPosition = activeCellRef?.current.style.left;\n      const activeCellTopPosition = activeCellRef?.current.style.top;\n      cellEditorRef.current.style.left = activeCellLeftPosition;\n      cellEditorRef.current.style.top = activeCellTopPosition;\n      cellEditorRef.current.style.display = 'block';\n      cellEditorRef.current.style.height = activeCellRef?.current.style.height;\n      cellEditorRef.current.style.paddingTop = `${\n        (parseInt(activeCellRef?.current.style.height) - 16) / 2 - 1\n      }px`; // calculate paddingTop based on cellHeight which could be variable depending on the cellSize prop\n      cellEditorRef.current.style.textAlign =\n        cellProps?.column?.placement === 'right' ? 'right' : 'left';\n      cellEditorRef.current?.focus();\n\n      if (rulerWidth < cellEditorCurrentWidth) {\n        const currentColumnWidth =\n          visibleColumns[nextIndex]?.width || defaultColumn?.width;\n        // If the contents of the cell editor is deleted past the point of the next column\n        if (rulerWidth < cellEditorCurrentWidth - currentColumnWidth) {\n          cellEditorRef.current.style.width = px(\n            parseInt(cellEditorRef.current.style.width) - currentColumnWidth\n          );\n          setNextIndex((prev) => {\n            if (prev === 0) {\n              return prev;\n            }\n            return prev - 1;\n          });\n        }\n        // Decrease cell editor width by increment of current column width\n      }\n      if (rulerWidth >= cellEditorCurrentWidth) {\n        setNextIndex((prev) => {\n          if (prev === visibleColumns.length - 1) {\n            return prev;\n          }\n          return prev + 1;\n        });\n        const onLastColumnIndex = nextIndex + 1 === visibleColumns.length;\n        const nextColumnWidth = onLastColumnIndex\n          ? 0\n          : visibleColumns[nextIndex + 1]?.width || defaultColumn?.width;\n        const startingRowPosition = activeCellCoordinates?.row;\n        const totalRows = rows.length;\n        const totalCellEditorMaxHeight =\n          (totalRows - startingRowPosition) * defaultColumn.rowHeight;\n        cellEditorRef.current.style.maxHeight = px(totalCellEditorMaxHeight);\n        cellEditorRef.current.style.width = px(\n          nextColumnWidth + cellEditorCurrentWidth\n        );\n        cellEditorRef.current.style.height = px(\n          cellEditorRef.current.scrollHeight\n        ); // adds dynamic height to cell editor\n        // Cell editor has reached max height, we need to add the scrolling back.\n        // We also need to subtract 1 to account for the fact that the cell editor\n        // is placed one pixel below the cell being edited to account for the border\n        if (\n          cellEditorRef.current.clientHeight ===\n          totalCellEditorMaxHeight - 1\n        ) {\n          cellEditorRef.current.style.overflow = 'auto';\n        } else {\n          cellEditorRef.current.style.overflow = 'hidden';\n        }\n      }\n    }\n    if (!isEditing) {\n      cellEditorRef.current.style.overflow = 'hidden';\n      cellEditorRef.current.style.display = 'none';\n      cellEditorRef.current.blur();\n      activeCellRef.current.focus();\n      setNextIndex(activeCellCoordinates?.column);\n    }\n  }, [\n    isEditing,\n    activeCellCoordinates,\n    rows,\n    cellEditorValue,\n    defaultColumn,\n    activeCellRef,\n    cellEditorRef,\n    cellEditorRulerRef,\n    visibleColumns,\n    blockClass,\n    previousState?.cellEditorValue,\n    nextIndex,\n  ]);\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { useEffect } from 'react';\nimport { px } from '@carbon/layout';\n\nimport { pkg } from '../../../settings';\nimport { deepCloneObject } from '../../../global/js/utils/deepCloneObject';\n\nexport const useSpreadsheetMouseUp = ({\n  currentMatcher,\n  setSelectionAreas,\n  selectedHeaderReorderActive,\n  setSelectedHeaderReorderActive,\n  setClickAndHoldActive,\n  setValidStartingPoint,\n  validStartingPoint,\n  blockClass = `${pkg.prefix}--data-spreadsheet`,\n  ref,\n  setHeaderCellHoldActive,\n  setColumnOrder,\n  visibleColumns,\n  setActiveCellCoordinates,\n  activeCellCoordinates,\n  rows,\n  defaultColumn,\n  selectionAreas,\n}) => {\n  useEffect(() => {\n    const handleMouseUp = (event) => {\n      // Only handle mouseup if it occurred within this instance\n      if (!ref.current?.contains(event.target)) {\n        return;\n      }\n      let isHoldingColumn = false;\n      if (\n        selectionAreas?.[0]?.header &&\n        selectionAreas[0].header.type === 'column'\n      ) {\n        isHoldingColumn = true;\n      }\n      // Remove the cloned selection area on mouse up\n      if (!validStartingPoint && isHoldingColumn) {\n        setHeaderCellHoldActive(false);\n        const selectionAreaElement = ref.current.querySelector(\n          `.${blockClass}__selection-area--element`\n        );\n        const selectionAreaCloneElement = ref.current.querySelector(\n          `.${blockClass}__selection-area--element-cloned`\n        );\n        if (!selectionAreaCloneElement) {\n          return;\n        }\n        // Mouse up while a cloned selection area exists/a column is being reordered\n        if (selectionAreaCloneElement) {\n          const closestCell = event.target.closest(\n            `.${blockClass}--interactive-cell-element`\n          );\n          const newColumnIndex = parseInt?.(\n            closestCell?.getAttribute('data-column-index')\n          );\n          const originalColumnIndex = parseInt?.(\n            selectionAreaCloneElement?.getAttribute(\n              'data-column-index-original'\n            )\n          );\n          const selectionAreaToClone = selectionAreas.filter(\n            (item) => item?.matcher === currentMatcher\n          );\n          const selectionAreaIndexArray =\n            selectionAreaToClone[0].header.selectedIndexList;\n          const columnToMoveToElement = ref.current.querySelector(\n            `[data-row-index=\"header\"][data-column-index=\"${newColumnIndex}\"]`\n          );\n          // Mouse up element was not part of the spreadsheet component\n          if (!columnToMoveToElement) {\n            return;\n          }\n          const selectionAreaToMove = ref.current.querySelector(\n            `[data-matcher-id=\"${currentMatcher}\"]`\n          );\n          const spreadsheetPosition = ref.current.getBoundingClientRect();\n          const listContainer = ref.current.querySelector(\n            `.${blockClass}__list--container`\n          );\n          const leftScrollAmount = listContainer.scrollLeft;\n          const newIndexLessThanStarting = newColumnIndex < originalColumnIndex;\n          const newIndexGreater = newColumnIndex > originalColumnIndex;\n          const differenceBetweenOldNewIndex = newIndexGreater\n            ? newColumnIndex - originalColumnIndex\n            : originalColumnIndex - newColumnIndex;\n          setSelectionAreas((prev) => {\n            const selectionAreaClone = deepCloneObject(prev);\n            if (originalColumnIndex === newColumnIndex) {\n              return prev;\n            }\n            const indexOfItemToUpdate = selectionAreaClone.findIndex(\n              (item) => item.matcher === currentMatcher\n            );\n            if (indexOfItemToUpdate === -1) {\n              return prev;\n            }\n            if (!selectionAreaIndexArray.includes(newColumnIndex)) {\n              // We need to not add just the newColumnIndex, but an array of indexes\n              // if there are multiple columns\n              const newIndexArray = newIndexGreater\n                ? selectionAreaIndexArray.map(\n                    (num) => num + differenceBetweenOldNewIndex\n                  )\n                : selectionAreaIndexArray.map(\n                    (num) => num - differenceBetweenOldNewIndex\n                  );\n              selectionAreaClone[indexOfItemToUpdate].header.selectedIndexList =\n                newIndexArray;\n              selectionAreaClone[indexOfItemToUpdate].point1.column = Math.min(\n                ...newIndexArray\n              );\n              selectionAreaClone[indexOfItemToUpdate].point2.column = Math.max(\n                ...newIndexArray\n              );\n            }\n            selectionAreaClone[indexOfItemToUpdate].areaCreated = false;\n            return selectionAreaClone;\n          });\n          // Only reorder columns if the new index is _not_ part of the\n          // selectionAreaIndexArray, meaning the new placement is outside\n          // of the current selection area. Similarly, the active cell position\n          // should only be changed under the same condition.\n          if (!selectionAreaIndexArray.includes(newColumnIndex)) {\n            const deleteCount = selectionAreaIndexArray.length;\n            const startIndex = Math.min(...selectionAreaIndexArray);\n            const columnIdArray = visibleColumns.map((column) => column.id);\n            const columnIdArrayClone = [...columnIdArray];\n            const getNewColumnOrder = () => {\n              const newColumnList = [];\n              selectionAreaIndexArray.map((index) => {\n                return newColumnList.push(columnIdArray[index]);\n              });\n              return newColumnList;\n            };\n            // Remove one element at the original index\n            columnIdArrayClone.splice(startIndex, deleteCount);\n            const originalPointIndex = selectionAreaIndexArray.findIndex(\n              (item) => item === originalColumnIndex\n            );\n            const updatedNewIndexWithNewOrder =\n              newColumnIndex - originalPointIndex;\n            // Add one element at the new index\n            columnIdArrayClone.splice(\n              updatedNewIndexWithNewOrder,\n              0,\n              ...getNewColumnOrder()\n            );\n            setColumnOrder(columnIdArrayClone); // Function provided by useTable (react-table) hook to reorder columns\n            const newCellCoords = {\n              ...activeCellCoordinates,\n              column: newIndexGreater\n                ? activeCellCoordinates.column + differenceBetweenOldNewIndex\n                : activeCellCoordinates.column - differenceBetweenOldNewIndex,\n            };\n            setActiveCellCoordinates(newCellCoords);\n            const firstSelectedHeader = Array.from(\n              ref.current.querySelectorAll(\n                `.${blockClass}__th--selected-header`\n              )\n            )[0];\n            const firstSelectedHeaderCoords =\n              firstSelectedHeader.getBoundingClientRect();\n            const newRelativePosition =\n              firstSelectedHeaderCoords.left -\n              spreadsheetPosition.left +\n              leftScrollAmount;\n            // console.log(firstSelectedHeaderCoords.left - spreadsheetPosition.left + leftScrollAmount);\n            const updatedSelectionAreaPlacement = newIndexLessThanStarting\n              ? newRelativePosition\n              : newColumnIndex === originalColumnIndex\n                ? selectionAreaToMove.style.left\n                : newRelativePosition;\n            selectionAreaToMove.style.left = px(updatedSelectionAreaPlacement);\n          }\n          // Remove the cloned column and indicator elements\n          const indicatorLineElement = ref.current.querySelector(\n            `.${blockClass}__reorder-indicator-line`\n          );\n          indicatorLineElement?.remove();\n          selectionAreaCloneElement?.remove();\n          selectionAreaElement?.classList?.remove(\n            `${blockClass}__selection-area--element`\n          );\n          setSelectedHeaderReorderActive(false);\n        }\n      }\n      // Mouse up was on a spreadsheet body cell which is a valid\n      // start/end point for creating a selection area\n      if (validStartingPoint || event.type === 'mouseup') {\n        setClickAndHoldActive(false);\n        setValidStartingPoint(false);\n        const cellButton = event.target.closest(`.${blockClass}__body--td`);\n        if (cellButton) {\n          const endCellCoordinates = {\n            row: Number(cellButton.getAttribute('data-row-index')),\n            column: Number(cellButton.getAttribute('data-column-index')),\n          };\n          setSelectionAreas((prev) => {\n            const selectionAreaClone = deepCloneObject(prev);\n            const indexOfItemToUpdate = selectionAreaClone.findIndex(\n              (item) => item.matcher === currentMatcher\n            );\n            // No items in the array have an object that matches the value of currentMatcher\n            if (indexOfItemToUpdate === -1) {\n              return prev;\n            }\n            selectionAreaClone[indexOfItemToUpdate].point2 = endCellCoordinates;\n            selectionAreaClone[indexOfItemToUpdate].areaCreated = false;\n            return selectionAreaClone;\n          });\n        }\n      }\n    };\n    document.addEventListener('mouseup', handleMouseUp);\n    return () => {\n      document.removeEventListener('mouseup', handleMouseUp);\n    };\n  }, [\n    blockClass,\n    currentMatcher,\n    setSelectionAreas,\n    setClickAndHoldActive,\n    setValidStartingPoint,\n    validStartingPoint,\n    selectedHeaderReorderActive,\n    setSelectedHeaderReorderActive,\n    ref,\n    setHeaderCellHoldActive,\n    setColumnOrder,\n    visibleColumns,\n    setActiveCellCoordinates,\n    activeCellCoordinates,\n    rows,\n    defaultColumn,\n    selectionAreas,\n  ]);\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { px } from '@carbon/layout';\nimport { pkg } from '../../../settings';\n\nexport const moveColumnIndicatorLine = ({\n  blockClass = `${pkg.prefix}--data-spreadsheet`,\n  clonedSelectionElement,\n  ref,\n  spreadsheetCoords,\n  leftScrollAmount,\n}) => {\n  const closestCell = event.target.closest(\n    `.${blockClass}--interactive-cell-element`\n  );\n  const newColumnIndex = closestCell?.getAttribute('data-column-index');\n  const originalColumnIndex = clonedSelectionElement?.getAttribute(\n    'data-column-index-original'\n  );\n  const closestCellCoords = closestCell.getBoundingClientRect();\n  const indicatorLineElement = ref.current.querySelector(\n    `.${blockClass}__reorder-indicator-line`\n  );\n  const matcherId = clonedSelectionElement?.getAttribute('data-matcher-id');\n  const selectionAreaOrigin = ref.current.querySelector(\n    `[data-matcher-id=\"${matcherId}\"]`\n  );\n\n  const listContainer = ref.current.querySelector(\n    `.${blockClass}__list--container`\n  );\n\n  const scrollSpeed = 10; // Scrolling speed\n  const leftEdgeThreshold = 120; // Distance from the left edge to start scrolling\n  const rightEdgeThreshold = 100; // Distance from the right edge to start scrolling\n\n  const { clientX } = event;\n  const { left, right } = listContainer.getBoundingClientRect();\n\n  // Is near left side of viewport\n  if (clientX < leftEdgeThreshold) {\n    window.scrollBy(-scrollSpeed, 0);\n  }\n\n  // Is near right side of viewport\n  if (clientX > window.innerWidth - rightEdgeThreshold) {\n    window.scrollBy(scrollSpeed, 0);\n  }\n\n  // Is near left edge of table\n  if (clientX > left && clientX < left + leftEdgeThreshold) {\n    listContainer.scrollBy(-scrollSpeed, 0);\n  }\n\n  // Is near right edge of table\n  if (clientX < right && clientX > right - rightEdgeThreshold) {\n    listContainer.scrollBy(scrollSpeed, 0);\n  }\n\n  if (Number(newColumnIndex) > Number(originalColumnIndex)) {\n    const leftPosition =\n      closestCellCoords.left -\n      spreadsheetCoords.left +\n      closestCell.offsetWidth -\n      2 +\n      leftScrollAmount;\n    indicatorLineElement.style.left = px(leftPosition);\n  }\n  if (Number(newColumnIndex) < Number(originalColumnIndex)) {\n    const leftPosition =\n      closestCellCoords.left - spreadsheetCoords.left + leftScrollAmount;\n    indicatorLineElement.style.left = px(leftPosition);\n  }\n\n  if (Number(newColumnIndex) === Number(originalColumnIndex)) {\n    indicatorLineElement.style.left = selectionAreaOrigin.style.left;\n  }\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { useEffect } from 'react';\nimport { px } from '@carbon/layout';\nimport { pkg } from '../../../settings';\nimport { moveColumnIndicatorLine } from '../utils/moveColumnIndicatorLine';\n\n// Used specifically for reordering columns, will move the position of the\n// cloned selection area to follow the position of the cursor\nexport const useSpreadsheetMouseMove = ({\n  ref,\n  blockClass = `${pkg.prefix}--data-spreadsheet`,\n  headerCellHoldActive,\n  defaultColumn,\n}) => {\n  useEffect(() => {\n    const handleMouseMove = (event) => {\n      const clonedSelectionElement = ref.current.querySelector(\n        `.${blockClass}__selection-area--element-cloned`\n      );\n      if (clonedSelectionElement) {\n        ref.current.addEventListener('mousemove', handleMouseMove);\n      }\n      const spreadsheetCoords = ref.current.getBoundingClientRect();\n      const listContainer = ref.current.querySelector(\n        `.${blockClass}__list--container`\n      );\n      const scrollAmount = listContainer.scrollLeft;\n      moveColumnIndicatorLine({\n        clonedSelectionElement,\n        ref,\n        spreadsheetCoords,\n        leftScrollAmount: scrollAmount,\n      });\n      const spreadsheetWrapperElement = ref.current;\n      spreadsheetWrapperElement.getBoundingClientRect();\n      const xPositionRelativeToSpreadsheet =\n        event.clientX - spreadsheetCoords.left;\n      const offsetXValue = clonedSelectionElement?.getAttribute(\n        'data-clone-offset-x'\n      );\n\n      const totalSpreadsheetScrollingWidth = listContainer.scrollWidth;\n      const clonedSelectionWidth = clonedSelectionElement.offsetWidth;\n      const clonePlacement = Math.max(\n        xPositionRelativeToSpreadsheet - offsetXValue,\n        defaultColumn?.rowHeaderWidth\n      );\n      const leftPosition =\n        totalSpreadsheetScrollingWidth - clonedSelectionWidth >= clonePlacement\n          ? clonePlacement + scrollAmount\n          : totalSpreadsheetScrollingWidth - clonedSelectionWidth;\n      // Moves the position of the cloned selection area to follow mouse, and\n      // add the amount horizontally scrolled\n      if (leftPosition < spreadsheetCoords.right - 40) {\n        clonedSelectionElement.style.left = px(leftPosition);\n      }\n    };\n    if (headerCellHoldActive) {\n      ref.current.addEventListener('mousemove', handleMouseMove);\n    }\n\n    const spreadsheetRef = ref.current;\n    if (!headerCellHoldActive) {\n      spreadsheetRef?.removeEventListener('mousemove', handleMouseMove);\n    }\n    return () => {\n      spreadsheetRef?.removeEventListener('mousemove', handleMouseMove);\n    };\n  });\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nexport const getSelectionAreaPoints = (area) => {\n  const greatestRowIndex = Math.max(area.point1.row, area.point2.row);\n  const greatestColumnIndex = Math.max(area.point1.column, area.point2.column);\n  const lowestRowIndex = Math.min(area.point1.row, area.point2.row);\n  const lowestColumnIndex = Math.min(area.point1.column, area.point2.column);\n  return {\n    greatestRowIndex,\n    greatestColumnIndex,\n    lowestColumnIndex,\n    lowestRowIndex,\n  };\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { px } from '@carbon/layout';\nimport { deepCloneObject } from '../../../global/js/utils/deepCloneObject';\nimport { getSelectionAreaPoints } from './getSelectionAreaPoints';\n\nexport const createCellSelectionArea = ({\n  ref,\n  area,\n  blockClass,\n  defaultColumn,\n  selectionAreas,\n  setSelectionAreas,\n  setActiveCellInsideSelectionArea,\n  visibleColumns,\n}) => {\n  const {\n    lowestColumnIndex,\n    lowestRowIndex,\n    greatestColumnIndex,\n    greatestRowIndex,\n  } = getSelectionAreaPoints(area);\n  if (\n    greatestRowIndex - lowestRowIndex > 0 ||\n    greatestColumnIndex - lowestColumnIndex > 0\n  ) {\n    setActiveCellInsideSelectionArea(true);\n    const activeCellElement = ref.current.querySelector(\n      `.${blockClass}__active-cell--highlight`\n    );\n    activeCellElement.setAttribute('data-selection-id', area.matcher);\n  }\n  let selectionAreaVariableWidth = 0;\n  visibleColumns.forEach((item, index) => {\n    if (index >= lowestColumnIndex && index <= greatestColumnIndex) {\n      selectionAreaVariableWidth += item?.width || defaultColumn?.width;\n    }\n  });\n\n  const spreadsheetSelector = ref.current ?? document;\n  const point1Element =\n    spreadsheetSelector.querySelector(\n      `[data-row-index=\"${area.point1.row}\"][data-column-index=\"${area.point1.column}\"]`\n    ) || spreadsheetSelector.querySelector(`.${blockClass}__body--td`);\n  // if we can't find the point1 element (this can happen in the case where a virtualized row is not present anymore in the DOM), we get the default height of the first body cell we find\n\n  const selectionAreaCellHeight = point1Element.offsetHeight;\n  const selectionAreaTotalHeight =\n    selectionAreaCellHeight * (greatestRowIndex - lowestRowIndex + 1);\n\n  const bodyContainer = spreadsheetSelector.querySelector(\n    `.${blockClass}__list--container`\n  ).firstElementChild;\n  const placementElement = bodyContainer.querySelector(\n    `[data-row-index=\"${lowestRowIndex}\"][data-column-index=\"${lowestColumnIndex}\"]`\n  );\n  const relativePosition = {\n    top: placementElement\n      ? placementElement.getBoundingClientRect().top -\n        bodyContainer.getBoundingClientRect().top\n      : lowestRowIndex === 0\n        ? 0\n        : selectionAreaCellHeight * lowestRowIndex, // calculate top value here if virtualized row is not in DOM\n    left: placementElement\n      ? placementElement.getBoundingClientRect().left -\n        bodyContainer.getBoundingClientRect().left\n      : lowestColumnIndex === 0\n        ? 0 + (defaultColumn.rowHeaderWidth - 4)\n        : defaultColumn.width * lowestColumnIndex +\n          (defaultColumn.rowHeaderWidth - 4), // calculate left value here if virtualized row is not in DOM, accounting for row header cell width (including borders)\n  };\n  const selectionAreaElement =\n    (ref\n      ? ref.current.querySelector(`[data-matcher-id=\"${area.matcher}\"]`)\n      : document.querySelector(`[data-matcher-id=\"${area.matcher}\"]`)) ||\n    document.createElement('div');\n  selectionAreaElement.classList.add(`${blockClass}__selection-area--element`);\n  selectionAreaElement.setAttribute('data-matcher-id', area.matcher);\n  selectionAreaElement.style.width = px(selectionAreaVariableWidth);\n  selectionAreaElement.style.height = px(selectionAreaTotalHeight);\n  selectionAreaElement.style.left = px(relativePosition.left);\n  selectionAreaElement.style.top = px(relativePosition.top);\n  bodyContainer.appendChild(selectionAreaElement);\n  const selectionAreasClone = deepCloneObject(selectionAreas);\n  const indexOfCurrentArea = selectionAreasClone.findIndex(\n    (item) => item.matcher === area.matcher\n  );\n  // We need to add another property to the selectionAreas object array to\n  // let us know if an area has been created for each item already, ie createdArea: true\n  selectionAreasClone[indexOfCurrentArea].areaCreated = true;\n  setSelectionAreas(selectionAreasClone);\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { deepCloneObject } from '../../../global/js/utils/deepCloneObject';\n\n// Determines if a row or column header cell should receive a highlight/active background color\n// Check each object in selectionAreas and see if the headerIndex is between\n// point1.row and point2.row, inclusive\nexport const checkActiveHeaderCell = (\n  headerIndex,\n  selectionAreas,\n  headerType\n) => {\n  const areasCloned = deepCloneObject(selectionAreas);\n  const activeRowIndexes = [];\n  areasCloned.forEach((area) => {\n    const greatestRowIndex = Math.max(\n      area.point1?.[headerType],\n      area.point2?.[headerType]\n    );\n    const lowestRowIndex = Math.min(\n      area.point1?.[headerType],\n      area.point2?.[headerType]\n    );\n    for (let i = lowestRowIndex; i <= greatestRowIndex; i++) {\n      activeRowIndexes.push(i);\n    }\n  });\n  const activeRowIndexesNoDuplicates = [...new Set(activeRowIndexes)];\n  if (\n    areasCloned?.length &&\n    activeRowIndexesNoDuplicates.includes(headerIndex)\n  ) {\n    return true;\n  }\n  return false;\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { deepCloneObject } from '../../../global/js/utils/deepCloneObject';\n\nexport const checkSelectedHeaderCell = (\n  headerIndex,\n  selectionAreas,\n  headerType,\n  items\n) => {\n  const areasCloned = deepCloneObject(selectionAreas);\n  const isSelectedHeader = areasCloned.some((area) => {\n    const oppositeType = headerType === 'column' ? 'row' : 'column';\n    const minOppositeSelection = Math.min(\n      area?.point1?.[oppositeType],\n      area?.point2?.[oppositeType]\n    );\n    const maxOppositeSelection = Math.max(\n      area?.point1?.[oppositeType],\n      area?.point2?.[oppositeType]\n    );\n\n    const minSelection = Math.min(\n      area?.point1?.[headerType],\n      area?.point2?.[headerType]\n    );\n    const maxSelection = Math.max(\n      area?.point1?.[headerType],\n      area?.point2?.[headerType]\n    );\n    const isTrueSelectedState =\n      items?.length - 1 === maxOppositeSelection && minOppositeSelection === 0;\n    // console.log({minSelection, maxSelection});\n    // Iterate over all columns included in the selection area\n    for (let i = minSelection; i <= maxSelection; i++) {\n      if (headerIndex === i && isTrueSelectedState) {\n        return true;\n      }\n    }\n    return false;\n  });\n  return isSelectedHeader;\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { px } from '@carbon/layout';\n\nexport const getSpreadsheetWidth = ({\n  type,\n  headerGroup,\n  scrollBarSizeValue,\n  totalVisibleColumns,\n  defaultColumn,\n  totalColumnsWidth,\n  visibleColumns,\n}) => {\n  const additionalWidth = scrollBarSizeValue + defaultColumn.rowHeaderWidth;\n  if (!totalVisibleColumns) {\n    if (type === 'header') {\n      return px(\n        parseInt(headerGroup.getHeaderGroupProps().style.width) +\n          additionalWidth\n      );\n    }\n    if (type !== 'header') {\n      return totalColumnsWidth + additionalWidth;\n    }\n  }\n  if (totalVisibleColumns) {\n    const totalVisibleColumnWidth = visibleColumns\n      .map(\n        (item, index) =>\n          index <= totalVisibleColumns - 1 &&\n          (item?.width || defaultColumn?.width)\n      )\n      .reduce((prev, curr) => prev + curr, 0);\n    return totalVisibleColumnWidth + additionalWidth;\n  }\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nexport const checkForHoldingKey = (event, key) => {\n  // possible key inputs: altKey,ctrlKey,metaKey,shiftKey\n  if (key == 'cmd') {\n    return event.metaKey || event.ctrlKey;\n  } else {\n    return event[key];\n  }\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { deepCloneObject } from '../../../global/js/utils/deepCloneObject';\nimport uuidv4 from '../../../global/js/utils/uuidv4';\nimport { removeCellSelections } from './removeCellSelections';\nimport { checkActiveHeaderCell } from './checkActiveHeaderCell';\n\nconst getSelectedItemIndexList = ({ indexList, newIndex, activeCellIndex }) => {\n  const lowestIndex =\n    newIndex > activeCellIndex\n      ? activeCellIndex\n      : Math.min(...indexList, newIndex);\n  const highestIndex =\n    newIndex < activeCellIndex\n      ? activeCellIndex\n      : Math.max(...indexList, newIndex);\n  const newIndexList = [];\n  for (let i = lowestIndex; i <= highestIndex; i++) {\n    newIndexList.push(i);\n  }\n  return [...newIndexList];\n};\n\nexport const handleHeaderCellSelection = ({\n  type,\n  activeCellCoordinates,\n  rows,\n  columns,\n  currentMatcher,\n  setActiveCellCoordinates,\n  setCurrentMatcher,\n  setSelectionAreas,\n  spreadsheetRef,\n  index,\n  isKeyboard,\n  setSelectionAreaData,\n  isHoldingCommandKey,\n  isHoldingShiftKey,\n}) => {\n  if (!isHoldingCommandKey) {\n    setSelectionAreaData([]);\n    removeCellSelections({ spreadsheetRef });\n  }\n  const rowValue = isKeyboard ? activeCellCoordinates?.row : index;\n  const columnValue = isKeyboard ? activeCellCoordinates?.column : index;\n  const point1 = {\n    row: type === 'column' ? 0 : rowValue,\n    column: type === 'column' ? columnValue : 0,\n  };\n  const point2 = {\n    row: type === 'column' ? rows.length - 1 : rowValue, // going to always be the last row\n    column: type === 'column' ? columnValue : columns.length - 1,\n  };\n  const tempMatcher = uuidv4();\n  if (!isHoldingShiftKey) {\n    setActiveCellCoordinates({\n      row: type === 'column' ? 0 : rowValue,\n      column: type === 'column' ? columnValue : 0,\n    });\n    setCurrentMatcher(tempMatcher);\n  }\n  const newSelectionArea = {\n    point1,\n    point2,\n    areaCreated: false,\n    matcher: tempMatcher,\n    header: {\n      type,\n      selectedIndexList: [type === 'column' ? columnValue : rowValue],\n    },\n  };\n  setSelectionAreas((prev) => {\n    const selectionsClone = deepCloneObject(prev);\n    if (isHoldingCommandKey) {\n      const selectionsFromHeaderCell = selectionsClone.filter(\n        (item) => item.header?.type\n      );\n      const previouslyCreatedHeaderSelection = selectionsFromHeaderCell.filter(\n        (item) => item.header?.type === type\n      );\n      const isHeaderPartOfPreviousSelection = checkActiveHeaderCell(\n        index,\n        previouslyCreatedHeaderSelection,\n        type\n      );\n      // Prevents row/column header selections from being created multiple times\n      if (\n        previouslyCreatedHeaderSelection.length &&\n        isHeaderPartOfPreviousSelection\n      ) {\n        return prev;\n      }\n      return [...prev, newSelectionArea];\n    }\n    if (isHoldingShiftKey) {\n      const selectionsFromHeaderCell = selectionsClone.filter(\n        (item) => item.header?.type\n      );\n      // Shift/click behavior should not occur unless there are activeCellCoordinates set\n      const currentSelectionArea = selectionsFromHeaderCell.filter(\n        (item) => item.matcher === currentMatcher\n      )[0];\n      const originalAreaIndex = Math.max(\n        currentSelectionArea?.point1[type],\n        currentSelectionArea?.point2[type],\n        activeCellCoordinates?.[type]\n      );\n      const newIndexValue = type === 'column' ? columnValue : rowValue;\n      const newPoint = {\n        row: originalAreaIndex < newIndexValue ? rows.length - 1 : 0,\n        column: columnValue,\n      };\n      const selectionAreasClone = deepCloneObject(prev);\n      const indexOfCurrentArea = selectionAreasClone.findIndex(\n        (item) => item.matcher === currentMatcher\n      );\n      const newIndexList = getSelectedItemIndexList({\n        indexList: selectionAreasClone[indexOfCurrentArea]?.header\n          ?.selectedIndexList || [type === 'column' ? columnValue : rowValue],\n        newIndex: newIndexValue,\n        activeCellIndex: activeCellCoordinates?.[type],\n      });\n      const setPoint1 = (value) => {\n        return value < newIndexValue\n          ? {\n              row: type === 'column' ? 0 : Math.min(...newIndexList),\n              column: type === 'column' ? Math.min(...newIndexList) : 0,\n            }\n          : newPoint;\n      };\n      const setPoint2 = (value) => {\n        return value < newIndexValue\n          ? newPoint\n          : {\n              row:\n                type === 'column' ? rows.length - 1 : Math.max(...newIndexList),\n              column:\n                type === 'column'\n                  ? Math.max(...newIndexList)\n                  : columns.length - 1,\n            };\n      };\n      // If there is no active cell set and shift is clicked on a header cell\n      if (\n        !activeCellCoordinates ||\n        typeof activeCellCoordinates === 'undefined'\n      ) {\n        // Need to set positioning of active cell because it doesn't exist yet\n        setCurrentMatcher(tempMatcher);\n        const firstSelectionArea = {\n          point1: setPoint1(type === 'column' ? columnValue : rowValue),\n          point2: setPoint2(type === 'column' ? columnValue : rowValue),\n          areaCreated: false,\n          matcher: tempMatcher,\n          header: {\n            type,\n            selectedIndexList: [type === 'column' ? columnValue : rowValue],\n          },\n        };\n        setActiveCellCoordinates({\n          row: type === 'column' ? 0 : rowValue,\n          column: type === 'column' ? columnValue : 0,\n        });\n        return [firstSelectionArea];\n      }\n      selectionAreasClone[indexOfCurrentArea].point1 = setPoint1(\n        activeCellCoordinates?.[type]\n      );\n      selectionAreasClone[indexOfCurrentArea].point2 = setPoint2(\n        activeCellCoordinates?.[type]\n      );\n      selectionAreasClone[indexOfCurrentArea].areaCreated = false;\n      selectionAreasClone[indexOfCurrentArea].header.selectedIndexList =\n        newIndexList;\n      return selectionAreasClone;\n    }\n    return [newSelectionArea];\n  });\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { getSelectionAreaPoints } from './getSelectionAreaPoints';\n\nexport const handleActiveCellInSelectionEnter = ({\n  activeCellInsideSelectionArea,\n  activeCellCoordinates,\n  activeCellRef,\n  selectionAreas,\n  updateActiveCellCoordinates,\n}) => {\n  if (!activeCellInsideSelectionArea) {\n    return;\n  }\n  const activeCellSelectionId =\n    activeCellRef.current.getAttribute('data-selection-id');\n  const activeCellIndexInSelectionAreas = selectionAreas.findIndex(\n    (item) => item.matcher === activeCellSelectionId\n  );\n  const selectionAreaToNavigate =\n    selectionAreas[activeCellIndexInSelectionAreas];\n  const {\n    lowestColumnIndex,\n    lowestRowIndex,\n    greatestColumnIndex,\n    greatestRowIndex,\n  } = getSelectionAreaPoints(selectionAreaToNavigate);\n  // Move active cell down one row if possible\n  const coordinatesClone = { ...activeCellCoordinates };\n  if (activeCellCoordinates?.row < greatestRowIndex) {\n    updateActiveCellCoordinates({\n      coords: coordinatesClone,\n      updatedValue: { row: coordinatesClone?.row + 1 },\n      optOutOfSelectionAreaUpdate: true,\n    });\n  }\n  // Move active cell to next column of selection area if it exists\n  // If not, find the next selection area and update active cell to\n  // be the first cell in that selection\n  if (activeCellCoordinates?.row === greatestRowIndex) {\n    if (activeCellCoordinates?.column < greatestColumnIndex) {\n      updateActiveCellCoordinates({\n        coords: coordinatesClone,\n        updatedValue: {\n          column: coordinatesClone?.column + 1,\n          row: lowestRowIndex,\n        },\n        optOutOfSelectionAreaUpdate: true,\n      });\n    }\n    // Move to next selection area if there is one, or back to\n    // the beginning of the current selection\n    if (activeCellCoordinates?.column === greatestColumnIndex) {\n      if (selectionAreas.length > 1) {\n        if (selectionAreas[activeCellIndexInSelectionAreas + 1]) {\n          // Update activeCellRef data-selection-id attribute to the matcher of the next selection area\n          activeCellRef.current.setAttribute(\n            'data-selection-id',\n            selectionAreas[activeCellIndexInSelectionAreas + 1].matcher\n          );\n          const nextSelectionArea =\n            selectionAreas[activeCellIndexInSelectionAreas + 1];\n          const { lowestColumnIndex, lowestRowIndex } =\n            getSelectionAreaPoints(nextSelectionArea);\n          updateActiveCellCoordinates({\n            coords: coordinatesClone,\n            updatedValue: {\n              column: lowestColumnIndex,\n              row: lowestRowIndex,\n            },\n            optOutOfSelectionAreaUpdate: true,\n          });\n          return;\n        } else {\n          // There are multiple selection areas and the active cell is in the last one\n          // So we need to move the active cell to the first cell in the first selection area\n          activeCellRef.current.setAttribute(\n            'data-selection-id',\n            selectionAreas[0].matcher\n          );\n          const firstSelectionArea = selectionAreas[0];\n          const { lowestColumnIndex, lowestRowIndex } =\n            getSelectionAreaPoints(firstSelectionArea);\n          updateActiveCellCoordinates({\n            coords: coordinatesClone,\n            updatedValue: {\n              column: lowestColumnIndex,\n              row: lowestRowIndex,\n            },\n            optOutOfSelectionAreaUpdate: true,\n          });\n        }\n      }\n      // Only one selection area, go back to first cell in the selection\n      if (selectionAreas.length === 1) {\n        return updateActiveCellCoordinates({\n          coords: coordinatesClone,\n          updatedValue: {\n            column: lowestColumnIndex,\n            row: lowestRowIndex,\n          },\n          optOutOfSelectionAreaUpdate: true,\n        });\n      }\n    }\n  }\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { getSelectionAreaPoints } from './getSelectionAreaPoints';\n\nexport const handleActiveCellInSelectionTab = ({\n  activeCellInsideSelectionArea,\n  activeCellCoordinates,\n  activeCellRef,\n  selectionAreas,\n  updateActiveCellCoordinates,\n}) => {\n  if (!activeCellInsideSelectionArea) {\n    return;\n  }\n  const activeCellSelectionId =\n    activeCellRef.current.getAttribute('data-selection-id');\n  const activeCellIndexInSelectionAreas = selectionAreas.findIndex(\n    (item) => item.matcher === activeCellSelectionId\n  );\n  const selectionAreaToNavigate =\n    selectionAreas[activeCellIndexInSelectionAreas];\n  const {\n    lowestColumnIndex,\n    lowestRowIndex,\n    greatestColumnIndex,\n    greatestRowIndex,\n  } = getSelectionAreaPoints(selectionAreaToNavigate);\n  // Move active cell to next column in selection area\n  if (activeCellCoordinates?.column < greatestColumnIndex) {\n    updateActiveCellCoordinates({\n      updatedValue: { column: activeCellCoordinates?.column + 1 },\n      optOutOfSelectionAreaUpdate: true,\n    });\n  }\n  // Move active cell to next row of selection area if it exists\n  // If not, find the next selection area and update active cell to\n  // be the first cell in that selection\n  if (activeCellCoordinates?.column === greatestColumnIndex) {\n    if (activeCellCoordinates?.row < greatestRowIndex) {\n      updateActiveCellCoordinates({\n        updatedValue: {\n          column: lowestColumnIndex,\n          row: activeCellCoordinates?.row + 1,\n        },\n        optOutOfSelectionAreaUpdate: true,\n      });\n    }\n    // Move to next selection area if there is on, or back to\n    // the beginning of the current selection\n    if (activeCellCoordinates?.row === greatestRowIndex) {\n      if (selectionAreas.length > 1) {\n        if (selectionAreas[activeCellIndexInSelectionAreas + 1]) {\n          // Update activeCellRef data-selection-id attribute to the matcher of the next selection area\n          activeCellRef.current.setAttribute(\n            'data-selection-id',\n            selectionAreas[activeCellIndexInSelectionAreas + 1].matcher\n          );\n          const nextSelectionArea =\n            selectionAreas[activeCellIndexInSelectionAreas + 1];\n          const { lowestColumnIndex, lowestRowIndex } =\n            getSelectionAreaPoints(nextSelectionArea);\n          updateActiveCellCoordinates({\n            updatedValue: {\n              column: lowestColumnIndex,\n              row: lowestRowIndex,\n            },\n            optOutOfSelectionAreaUpdate: true,\n          });\n          return;\n        } else {\n          // There are multiple selection areas and the active cell is in the last one\n          // So we need to move the active cell to the first cell in the first selection area\n          activeCellRef.current.setAttribute(\n            'data-selection-id',\n            selectionAreas[0].matcher\n          );\n          const firstSelectionArea = selectionAreas[0];\n          const { lowestColumnIndex, lowestRowIndex } =\n            getSelectionAreaPoints(firstSelectionArea);\n          updateActiveCellCoordinates({\n            updatedValue: {\n              column: lowestColumnIndex,\n              row: lowestRowIndex,\n            },\n            optOutOfSelectionAreaUpdate: true,\n          });\n        }\n      }\n      // Only one selection area, go back to first cell in the selection\n      if (selectionAreas.length === 1) {\n        return updateActiveCellCoordinates({\n          updatedValue: {\n            column: lowestColumnIndex,\n            row: lowestRowIndex,\n          },\n          optOutOfSelectionAreaUpdate: true,\n        });\n      }\n    }\n  }\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n// Iterates through a numeric range and calls callback\n// function for each iteration\nexport const rangeWithCallback = (start, end, fn) => {\n  for (let i = start; i <= end; i++) {\n    fn(i);\n  }\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { deepCloneObject } from '../../../global/js/utils/deepCloneObject';\nimport { rangeWithCallback } from '../../../global/js/utils/rangeWithCallback';\n\nexport const handleCellDeletion = ({\n  activeCellCoordinates,\n  selectionAreas,\n  currentMatcher,\n  rows,\n  setActiveCellContent,\n  updateData,\n}) => {\n  // This means that the delete key has been pressed when the active cell is in a header,\n  // not within the spreadsheet body. To delete an entire row/column, it must first be\n  // selected, and then can be deleted.\n  if (\n    activeCellCoordinates?.column === 'header' ||\n    activeCellCoordinates?.row === 'header'\n  ) {\n    return;\n  }\n  const selectionAreaClone = deepCloneObject(selectionAreas);\n  const indexOfCurrentSelectionArea = selectionAreaClone.findIndex(\n    (item) => item.matcher === currentMatcher\n  );\n  const selectionAreaToEmptyContents =\n    selectionAreaClone[indexOfCurrentSelectionArea];\n  const lowestColumnIndex = Math.min(\n    selectionAreaToEmptyContents?.point1?.column,\n    selectionAreaToEmptyContents?.point2?.column\n  );\n  const greatestColumnIndex = Math.max(\n    selectionAreaToEmptyContents?.point1?.column,\n    selectionAreaToEmptyContents?.point2?.column\n  );\n  const lowestRowIndex = Math.min(\n    selectionAreaToEmptyContents?.point1?.row,\n    selectionAreaToEmptyContents?.point2?.row\n  );\n  const greatestRowIndex = Math.max(\n    selectionAreaToEmptyContents?.point1?.row,\n    selectionAreaToEmptyContents?.point2?.row\n  );\n  rangeWithCallback(lowestColumnIndex, greatestColumnIndex, (columnIndex) => {\n    rangeWithCallback(lowestRowIndex, greatestRowIndex, (rowIndex) => {\n      const cellProps = rows[rowIndex].cells[columnIndex];\n      updateData(rowIndex, cellProps?.column.id, '');\n    });\n  });\n  setActiveCellContent(null);\n};\n","/**\n * Copyright IBM Corp. 2024\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { pkg } from '../../../settings';\nimport { checkForHoldingKey } from './checkForHoldingKey';\nimport { deepCloneObject } from '../../../global/js/utils/deepCloneObject';\nimport uuidv4 from '../../../global/js/utils/uuidv4';\nimport { removeCellSelections } from './removeCellSelections';\nimport { handleHeaderCellSelection } from './handleHeaderCellSelection';\nimport {\n  handleMultipleKeys,\n  includesResourceKey,\n  includesShift,\n} from './handleMultipleKeys';\nimport { handleActiveCellInSelectionEnter } from './handleActiveCellInSelectionEnter';\nimport { handleActiveCellInSelectionTab } from './handleActiveCellInSelectionTab';\nimport { handleCellDeletion } from './handleCellDeletion';\n\nconst blockClass = `${pkg.prefix}--data-spreadsheet`;\n\n// onClick fn for each cell in the data spreadsheet body,\n// adds the active cell highlight\n\nexport const handleBodyCellClick = (cell, columnIndex, event, ...rest) => {\n  const [\n    currentMatcher,\n    activeCellCoordinates,\n    selectionAreas,\n    setActiveCellCoordinates,\n    setSelectionAreas,\n    setContainerHasFocus,\n    setClickAndHoldActive,\n    setCurrentMatcher,\n    ref,\n    setSelectionAreaData,\n    setActiveCellInsideSelectionArea,\n    activeCellRef,\n    setValidStartingPoint,\n  ] = rest;\n\n  event.preventDefault();\n  const closestBodyCell = event.target.closest(`.${blockClass}__body--td`);\n  const isValidSelectionAreaStart = closestBodyCell.classList.contains(\n    `${blockClass}__body--td`\n  );\n  setValidStartingPoint(isValidSelectionAreaStart);\n  const isHoldingCommandKey = checkForHoldingKey(event, 'cmd');\n  const isHoldingShiftKey = checkForHoldingKey(event, 'shiftKey');\n  setContainerHasFocus(true);\n  const activeCoordinates = {\n    row: cell.row.index,\n    column: columnIndex,\n  };\n  const tempMatcher = uuidv4();\n  setClickAndHoldActive(true);\n\n  // prevent multiple selections unless cmd key is held\n  // meaning that selectionAreas should only have one item by default\n  if (isHoldingCommandKey) {\n    const activeCellElement = ref.current.querySelector(\n      `.${blockClass}__active-cell--highlight`\n    );\n    activeCellElement.setAttribute('data-selection-id', tempMatcher);\n    setActiveCellInsideSelectionArea(true);\n    setActiveCellCoordinates(activeCoordinates);\n    setCurrentMatcher(tempMatcher);\n    setSelectionAreas((prev) => [\n      ...prev,\n      { point1: activeCoordinates, matcher: tempMatcher },\n    ]);\n  } else if (isHoldingShiftKey) {\n    setContainerHasFocus(true);\n    const selectionAreaClone = deepCloneObject(selectionAreas);\n    const indexOfItemToUpdate = selectionAreaClone.findIndex(\n      (item) => item.matcher === currentMatcher\n    );\n\n    if (indexOfItemToUpdate === -1) {\n      // There is always a selectionArea with a point1 object that updates\n      // whenever the activeCellCoordinates update, we should always be able\n      // to find an index, but if we do not for some reason we should return\n      // at this point.\n      return;\n    } else {\n      // Update the selectionArea that was found, do not update currentMatcher\n      selectionAreaClone[indexOfItemToUpdate].point1 = activeCellCoordinates;\n      selectionAreaClone[indexOfItemToUpdate].point2 = activeCoordinates;\n      selectionAreaClone[indexOfItemToUpdate].areaCreated = false;\n      selectionAreaClone[indexOfItemToUpdate].matcher = currentMatcher;\n      setSelectionAreas(selectionAreaClone);\n    }\n  } else {\n    activeCellRef.current.style.display = 'none';\n    setActiveCellInsideSelectionArea(false);\n    setActiveCellCoordinates(activeCoordinates);\n    // remove all previous cell selections\n    removeCellSelections({ spreadsheetRef: ref });\n    setSelectionAreas([{ point1: activeCoordinates, matcher: tempMatcher }]);\n    setCurrentMatcher(tempMatcher);\n    setSelectionAreaData([]);\n  }\n};\n\nexport const handleBodyCellHover = (cell, columnIndex, ...rest) => {\n  const [clickAndHoldActive, currentMatcher, setSelectionAreas] = rest;\n  if (clickAndHoldActive) {\n    const cellCoordinates = {\n      row: cell.row.index,\n      column: columnIndex,\n    };\n\n    setSelectionAreas((prev) => {\n      const selectionAreaClone = deepCloneObject(prev);\n      const indexOfItemToUpdate = selectionAreaClone.findIndex(\n        (item) => item.matcher === currentMatcher\n      );\n      // No items in the array match up with the currentMatcher value\n      if (indexOfItemToUpdate === -1) {\n        return prev;\n      }\n      // Do not update state if you're still hovering on the same cell\n      if (\n        selectionAreaClone[indexOfItemToUpdate].point2?.row ===\n          cellCoordinates.row &&\n        selectionAreaClone[indexOfItemToUpdate].point2?.column ===\n          cellCoordinates.column\n      ) {\n        return prev;\n      }\n      selectionAreaClone[indexOfItemToUpdate].point2 = cellCoordinates;\n      selectionAreaClone[indexOfItemToUpdate].areaCreated = false;\n      return selectionAreaClone;\n    });\n  }\n};\n\nexport const handleRowHeaderClick = (index, event, ...rest) => {\n  const [\n    columns,\n    ref,\n    setSelectionAreas,\n    setCurrentMatcher,\n    setActiveCellCoordinates,\n    activeCellCoordinates,\n    rows,\n    setSelectionAreaData,\n  ] = rest;\n  const isHoldingCommandKey = checkForHoldingKey(event, 'cmd');\n  handleHeaderCellSelection({\n    type: 'row',\n    activeCellCoordinates,\n    rows,\n    columns,\n    setActiveCellCoordinates,\n    setCurrentMatcher,\n    setSelectionAreas,\n    spreadsheetRef: ref,\n    index,\n    setSelectionAreaData,\n    isHoldingCommandKey,\n  });\n};\n\nexport const handleKeyPress = (event, ...rest) => {\n  const [\n    activeCellInsideSelectionArea,\n    updateActiveCellCoordinates,\n    activeCellCoordinates,\n    removeActiveCell,\n    columns,\n    rows,\n    spreadsheetRef,\n    currentMatcher,\n    removeCellEditor,\n    selectionAreas,\n    handleHomeEndKey,\n    keysPressedList,\n    usingMac,\n    updateData,\n    checkForReturnCondition,\n    handleArrowKeyPress,\n    setSelectionAreas,\n    setSelectionAreaData,\n    setCurrentMatcher,\n    activeCellRef,\n    setActiveCellCoordinates,\n    setContainerHasFocus,\n    setActiveCellContent,\n  ] = rest;\n\n  const { key } = event;\n  // Command keys need to be returned as there is default browser behavior with these keys\n  // Needs to be returned in editing mode\n  if (checkForReturnCondition(key)) {\n    return;\n  }\n\n  // Clear out all cell selection areas if user uses any arrow key, except if the shift key is being held\n  if (['ArrowLeft', 'ArrowUp', 'ArrowRight', 'ArrowDown'].indexOf(key) > -1) {\n    if (\n      selectionAreas?.length &&\n      keysPressedList.length < 2 &&\n      !includesShift(keysPressedList)\n    ) {\n      setSelectionAreas([]);\n      setSelectionAreaData([]);\n      removeCellSelections({ spreadsheetRef });\n    }\n  }\n  if (keysPressedList?.length > 1) {\n    handleMultipleKeys({\n      activeCellCoordinates,\n      event,\n      keysPressedList,\n      selectionAreas,\n      currentMatcher,\n      rows,\n      setSelectionAreas,\n      columns,\n      updateActiveCellCoordinates,\n      spreadsheetRef,\n      removeCellSelections,\n      blockClass,\n      setCurrentMatcher,\n      usingMac,\n    });\n  }\n\n  // Allow arrow key navigation if there are less than two activeKeys OR\n  // if one of the activeCellCoordinates is in a header position\n  // Prevent arrow keys, home key, and end key from scrolling the page when the data spreadsheet container has focus\n\n  if (\n    (keysPressedList.length < 2 && !includesShift(keysPressedList)) ||\n    activeCellCoordinates.row === 'header' ||\n    activeCellCoordinates.column === 'header'\n  ) {\n    switch (key) {\n      case 'Backspace':\n      case 'Delete': {\n        const deleteParams = {\n          selectionAreas,\n          currentMatcher,\n          rows,\n          setActiveCellContent,\n          updateData,\n          activeCellCoordinates,\n        };\n        handleCellDeletion(deleteParams);\n        break;\n      }\n      // Enter\n      case 'Enter': {\n        handleActiveCellInSelectionEnter({\n          activeCellInsideSelectionArea,\n          activeCellCoordinates,\n          activeCellRef,\n          selectionAreas,\n          updateActiveCellCoordinates,\n        });\n        break;\n      }\n      // HOME\n      case 'Home':\n      case 'End': {\n        event.preventDefault();\n        if (includesResourceKey(keysPressedList, usingMac)) {\n          return;\n        }\n        handleHomeEndKey({ type: key });\n        break;\n      }\n      // Tab\n      case 'Tab': {\n        if (activeCellInsideSelectionArea) {\n          event.preventDefault();\n          return handleActiveCellInSelectionTab({\n            activeCellInsideSelectionArea,\n            activeCellCoordinates,\n            activeCellRef,\n            selectionAreas,\n            updateActiveCellCoordinates,\n          });\n        }\n        setSelectionAreas([]);\n        removeActiveCell();\n        removeCellEditor();\n        setContainerHasFocus(false);\n        setActiveCellCoordinates(null);\n        break;\n      }\n      case 'ArrowLeft':\n      case 'ArrowUp':\n      case 'ArrowRight':\n      case 'ArrowDown': {\n        handleArrowKeyPress(key);\n      }\n    }\n  }\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React, {\n  useRef,\n  useCallback,\n  useEffect,\n  forwardRef,\n  useState,\n  ForwardedRef,\n  Dispatch,\n  SetStateAction,\n  MutableRefObject,\n} from 'react';\nimport PropTypes from 'prop-types';\nimport { FixedSizeList } from 'react-window';\nimport cx from 'classnames';\nimport { px } from '@carbon/layout';\n\nimport { pkg } from '../../settings';\nimport { deepCloneObject } from '../../global/js/utils/deepCloneObject';\nimport { usePreviousValue } from '../../global/js/hooks';\n\nimport { removeCellSelections } from './utils/removeCellSelections';\nimport { createCellSelectionArea } from './utils/createCellSelectionArea';\nimport { checkActiveHeaderCell } from './utils/checkActiveHeaderCell';\nimport { checkSelectedHeaderCell } from './utils/checkSelectedHeaderCell';\nimport { getSpreadsheetWidth } from './utils/getSpreadsheetWidth';\n\nimport { useSpreadsheetMouseUp } from './hooks';\nimport {\n  handleBodyCellClick,\n  handleBodyCellHover,\n  handleRowHeaderClick,\n} from './utils/commonEventHandlers';\nimport { prepareProps } from '../../global/js/utils/props-helper';\nimport { ActiveCellCoordinates, PrevState, SpreadsheetColumn } from './types';\nimport {\n  Column,\n  IdType,\n  TableBodyPropGetter,\n  TableBodyProps,\n} from 'react-table';\n\nconst blockClass = `${pkg.prefix}--data-spreadsheet`;\n\ninterface DataSpreadsheetBodyProps {\n  /**\n   * Object containing the active cell coordinates\n   */\n  activeCellCoordinates?: ActiveCellCoordinates | null;\n\n  /**\n   *This is the ref of the button input, which is the active cell element\n   */\n  activeCellRef?: MutableRefObject<HTMLElement | undefined>;\n  /**\n   * Is the user clicking and holding in the data spreadsheet body\n   */\n  clickAndHoldActive?: boolean;\n\n  /**\n   * All of the spreadsheet columns\n   */\n  columns?: readonly Column<object>[];\n\n  /**\n   * This represents the id of the current cell selection area\n   */\n  currentMatcher?: string;\n\n  /**\n   * Default spreadsheet sizing values\n   */\n  defaultColumn?: SpreadsheetColumn;\n\n  /**\n   * Sets the number of empty rows to be created when there is no data provided\n   */\n  defaultEmptyRowCount?: number;\n\n  /**\n   * Function to set table body prop values\n   */\n  getTableBodyProps: (propGetter?: TableBodyPropGetter<any>) => TableBodyProps;\n\n  /**\n   * Headers provided from useTable hook\n   */\n  headerGroups?: any[];\n\n  /**\n   * The spreadsheet id\n   */\n  id?: number | string;\n\n  /**\n   * Set current columns after drag drop\n   */\n  setCurrentColumns?: Dispatch<SetStateAction<object[]>>;\n\n  /**\n   * The event handler that is called when the active cell changes\n   */\n  onActiveCellChange?: () => void;\n\n  /**\n   * Check if user is using custom component\n   */\n  hasCustomRowHeader?: boolean;\n\n  /**\n   * Component next to numbering rows\n   */\n  renderRowHeader?: (index: number) => any[];\n\n  /**\n   * Component next to numbering rows\n   */\n  renderRowHeaderDirection?: string;\n\n  /**\n   * The event handler that is called to set the rows for the empty spreadsheet\n   */\n  onDataUpdate?: ({ ...args }) => void;\n\n  /**\n   * The event handler that is called when the selection areas change\n   */\n  onSelectionAreaChange?: ({ ...args }) => void;\n\n  /**\n   * Prepare row function from react-table\n   */\n  prepareRow?: (...args) => void;\n\n  /**\n   * All of the spreadsheet row data\n   */\n  rows?: any[];\n\n  /**\n   * The scrollbar width\n   */\n  scrollBarSize?: number;\n\n  /**\n   * Array of selection area data\n   */\n  selectionAreaData?: any[];\n\n  /**\n   * Header reordering is active\n   */\n  selectedHeaderReorderActive?: boolean;\n\n  /**\n   * Set header reordering active or not\n   */\n  setSelectedHeaderReorderActive?: Dispatch<SetStateAction<boolean>>;\n\n  /**\n   * Array of selection areas\n   */\n  selectionAreas?: any[];\n\n  /**\n   * Setter fn for activeCellCoordinates state value\n   */\n  setActiveCellCoordinates?: Dispatch<\n    SetStateAction<ActiveCellCoordinates | null>\n  >;\n\n  /**\n   * Setter fn for active cell inside of selection area\n   */\n  setActiveCellInsideSelectionArea?: Dispatch<SetStateAction<boolean>>;\n\n  /**\n   * Setter fn for clickAndHold state value\n   */\n  setClickAndHoldActive?: Dispatch<SetStateAction<boolean>>;\n\n  /**\n   * Setter fn for column ordering, provided from react-table\n   */\n  setColumnOrder?: (\n    updater:\n      | ((columnOrder: Array<IdType<any>>) => Array<IdType<any>>)\n      | Array<IdType<any>>\n  ) => void;\n\n  /**\n   * Setter fn for containerHasFocus state value\n   */\n  setContainerHasFocus?: Dispatch<SetStateAction<boolean>>;\n\n  /**\n   * Setter fn for currentMatcher state value\n   */\n  setCurrentMatcher?: Dispatch<SetStateAction<string>>;\n\n  /**\n   * Setter fn for header cell hold active value\n   */\n  setHeaderCellHoldActive?: Dispatch<SetStateAction<boolean>>;\n\n  /**\n   * Setter fn for selectionAreaData state value\n   */\n  setSelectionAreaData?: Dispatch<SetStateAction<object[]>>;\n\n  /**\n   * Setter fn for selectionAreas state value\n   */\n  setSelectionAreas?: Dispatch<SetStateAction<object[]>>;\n\n  /**\n   * The total columns width\n   */\n  totalColumnsWidth?: number;\n\n  /**\n   * The total number of columns to be initially visible, additional columns will be rendered and\n   * visible via horizontal scrollbar\n   */\n  totalVisibleColumns?: number;\n\n  /**\n   * Prop from react-table used to reorder columns\n   */\n  visibleColumns?: Column<object>[];\n}\n\nexport const DataSpreadsheetBody = forwardRef(\n  (\n    {\n      activeCellRef,\n      columns,\n      activeCellCoordinates,\n      defaultColumn,\n      defaultEmptyRowCount,\n      getTableBodyProps,\n      headerGroups,\n      setCurrentColumns,\n      id,\n      onDataUpdate,\n      renderRowHeader,\n      renderRowHeaderDirection,\n      hasCustomRowHeader,\n      prepareRow,\n      rows,\n      selectionAreaData,\n      setSelectionAreaData,\n      setActiveCellCoordinates,\n      selectedHeaderReorderActive,\n      setSelectedHeaderReorderActive,\n      selectionAreas,\n      setContainerHasFocus,\n      setSelectionAreas,\n      scrollBarSize,\n      totalColumnsWidth,\n      clickAndHoldActive,\n      setClickAndHoldActive,\n      currentMatcher,\n      setCurrentMatcher,\n      onSelectionAreaChange,\n      setActiveCellInsideSelectionArea,\n      totalVisibleColumns,\n      setHeaderCellHoldActive,\n      setColumnOrder,\n      visibleColumns,\n    }: DataSpreadsheetBodyProps,\n    ref: ForwardedRef<HTMLDivElement>\n  ) => {\n    const [validStartingPoint, setValidStartingPoint] = useState(false);\n    const contentScrollRef = useRef<HTMLDivElement | undefined>(undefined);\n\n    const previousState: PrevState =\n      usePreviousValue({\n        selectionAreaData,\n        clickAndHoldActive,\n        rowHeight: defaultColumn?.rowHeight,\n      }) || {};\n\n    // Set custom css property containing the spreadsheet total width\n    useEffect(() => {\n      (ref as MutableRefObject<HTMLDivElement>)?.current.style.setProperty(\n        `--${blockClass}--total-width`,\n        px((totalColumnsWidth || 0) + (scrollBarSize || 0))\n      );\n    }, [ref, scrollBarSize, totalColumnsWidth]);\n\n    // Call the `onSelectionAreaChange` handler to send selection area data\n    // back to the consumer\n    useEffect(() => {\n      if (selectionAreaData?.length) {\n        let selectionChanged = false;\n        if (\n          previousState?.selectionAreaData?.length !==\n            selectionAreaData?.length ||\n          selectionAreaData?.[0]?.cells.length !==\n            previousState?.selectionAreaData?.[0]?.cells.length\n        ) {\n          selectionChanged = true;\n        }\n\n        if (\n          (!clickAndHoldActive && previousState?.clickAndHoldActive) ||\n          selectionChanged\n        ) {\n          onSelectionAreaChange?.(selectionAreaData);\n        }\n      }\n    }, [\n      previousState?.selectionAreaData,\n      selectionAreaData,\n      onSelectionAreaChange,\n      clickAndHoldActive,\n      previousState?.clickAndHoldActive,\n    ]);\n\n    // Create cell selection areas based on selectionAreas array\n    useEffect(() => {\n      if (selectionAreas && selectionAreas.length) {\n        selectionAreas.map((area) => {\n          // Setup selection area data that will be sent back to consumer via onSelectionAreaChange prop\n          if (area.areaCreated) {\n            const rowStart = Math.min(area.point1.row, area.point2.row);\n            const rowEnd = Math.max(area.point1.row, area.point2.row);\n            const columnStart = Math.min(\n              area.point1.column,\n              area.point2.column\n            );\n            const columnEnd = Math.max(area.point1.column, area.point2.column);\n            const selectionData = {\n              rows: {\n                start: rowStart,\n                end: rowEnd,\n              },\n              columns: {\n                start: columnStart,\n                end: columnEnd,\n              },\n              cells: populateSelectionAreaCellData({\n                rowStart,\n                rowEnd,\n                columnStart,\n                columnEnd,\n              }),\n              selectionId: area.matcher,\n            };\n            setSelectionAreaData?.((prev) => {\n              const prevValues = deepCloneObject(prev);\n              const newAreaData = prevValues.filter(\n                (item) => item.selectionId !== area.matcher\n              );\n              return [...newAreaData, selectionData];\n            });\n          }\n          if (!area.areaCreated && area.point1 && area.point2 && area.matcher) {\n            createCellSelectionArea({\n              ref,\n              area,\n              blockClass,\n              defaultColumn,\n              selectionAreas,\n              setSelectionAreas,\n              setActiveCellInsideSelectionArea,\n              visibleColumns,\n            });\n          }\n          return;\n        });\n      }\n    }, [\n      selectionAreas,\n      setSelectionAreas,\n      defaultColumn,\n      onSelectionAreaChange,\n      setSelectionAreaData,\n      ref,\n      activeCellCoordinates,\n      setActiveCellInsideSelectionArea,\n      visibleColumns,\n      hasCustomRowHeader,\n    ]);\n\n    const populateSelectionAreaCellData = ({\n      rowStart,\n      rowEnd,\n      columnStart,\n      columnEnd,\n    }) => {\n      const cellContainer: (number | string)[][] = [];\n      for (let rowIndex = rowStart; rowIndex <= rowEnd; rowIndex++) {\n        for (\n          let columnIndex = columnStart;\n          columnIndex <= columnEnd;\n          columnIndex++\n        ) {\n          cellContainer.push([\n            rowIndex,\n            columnIndex,\n            `${blockClass}__cell--${rowIndex}--${columnIndex}`,\n          ]);\n        }\n      }\n      return cellContainer;\n    };\n\n    useSpreadsheetMouseUp({\n      currentMatcher,\n      setClickAndHoldActive,\n      setSelectionAreas,\n      setValidStartingPoint,\n      selectedHeaderReorderActive,\n      setSelectedHeaderReorderActive,\n      validStartingPoint,\n      ref,\n      setHeaderCellHoldActive,\n      setColumnOrder,\n      visibleColumns,\n      setActiveCellCoordinates,\n      rows,\n      activeCellCoordinates,\n      defaultColumn,\n      selectionAreas,\n    });\n\n    // Make sure that if the cellSize prop changes, the active\n    // cell also gets updated with the new size and new top placement\n    // value. All of the cell selections will be updated as well\n    useEffect(() => {\n      let listContainer;\n      let activeCellButton;\n      if (spreadsheetBodyRef?.current) {\n        listContainer = spreadsheetBodyRef?.current;\n        activeCellButton = listContainer?.querySelector(\n          `.${blockClass}__active-cell--highlight`\n        );\n      }\n      if (\n        activeCellButton &&\n        defaultColumn?.rowHeight !== previousState.rowHeight\n      ) {\n        activeCellButton.style.height = `${defaultColumn?.rowHeight}px`;\n        if (activeCellCoordinates) {\n          const activeTargetElement = (\n            ref as MutableRefObject<HTMLDivElement>\n          )?.current.querySelector(\n            `[data-row-index=\"${activeCellCoordinates.row}\"][data-column-index=\"${activeCellCoordinates.column}\"]`\n          );\n          const listContainer = (\n            ref as MutableRefObject<HTMLDivElement>\n          )?.current.querySelector(`.${blockClass}__list--container`);\n          let newActiveCellTopPosition;\n          if (activeTargetElement && listContainer) {\n            newActiveCellTopPosition =\n              activeTargetElement?.getBoundingClientRect().top -\n              listContainer.getBoundingClientRect().top;\n          }\n          activeCellButton.style.top = px(newActiveCellTopPosition);\n          removeCellSelections({ matcher: undefined, spreadsheetRef: ref });\n          selectionAreas?.map((area) => {\n            if (\n              !area.areaCreated &&\n              area.point1 &&\n              area.point2 &&\n              area.matcher\n            ) {\n              return createCellSelectionArea({\n                ref,\n                area,\n                blockClass,\n                defaultColumn,\n                selectionAreas,\n                setSelectionAreas,\n                setActiveCellInsideSelectionArea,\n                visibleColumns,\n              });\n            }\n          });\n        }\n      }\n    }, [\n      defaultColumn,\n      ref,\n      activeCellCoordinates,\n      previousState?.rowHeight,\n      selectionAreas,\n      setActiveCellInsideSelectionArea,\n      setSelectionAreas,\n      visibleColumns,\n      hasCustomRowHeader,\n    ]);\n\n    //this method will check for any duplicate selection area and remove.\n    //same selections are those have the same height, width, top, left styles. These inline styles are being set in createCellSelection util.\n    const removeDuplicateSelections = useCallback(() => {\n      const uniqueAttrArray: string[] = [],\n        removedSelectionAreaMatcherArr: (string | null)[] = [];\n      (ref as MutableRefObject<HTMLDivElement>)?.current\n        .querySelectorAll(`.${blockClass}__selection-area--element`)\n        .forEach((selectorEl) => {\n          const { top, left, height, width } = (selectorEl as HTMLElement)\n            .style;\n          const uniqueAttrStr = `${top}${left}${height}${width}`; // eg: 20px30px70px90px\n          if (uniqueAttrArray.indexOf(uniqueAttrStr) == -1) {\n            uniqueAttrArray.push(uniqueAttrStr);\n          } else {\n            selectorEl.remove(); // this is identified as duplicate selection and hence removing.\n            removedSelectionAreaMatcherArr.push(\n              selectorEl.getAttribute('data-matcher-id')\n            );\n          }\n        });\n\n      //clean the duplicate selectionAreaData and selectionArea\n      if (removedSelectionAreaMatcherArr.length) {\n        setSelectionAreas?.((prev) => {\n          const prevValues = deepCloneObject(prev);\n          return prevValues.filter(\n            (item) => !removedSelectionAreaMatcherArr.includes(item.matcher)\n          );\n        });\n        setSelectionAreaData?.((prev) => {\n          const prevValues = deepCloneObject(prev);\n          return prevValues.filter(\n            (item) => !removedSelectionAreaMatcherArr.includes(item.selectionId)\n          );\n        });\n      }\n    }, [ref, setSelectionAreas, setSelectionAreaData]);\n\n    //selectionAreas will be set when ever a selection area is made.\n    useEffect(() => {\n      removeDuplicateSelections();\n    }, [selectionAreas, removeDuplicateSelections]);\n\n    // onClick fn for each cell in the data spreadsheet body,\n    // adds the active cell highlight\n\n    const handleBodyCellClickEvent = useCallback(\n      (cell, columnIndex) => {\n        return (event) => {\n          handleBodyCellClick(\n            cell,\n            columnIndex,\n            event,\n            currentMatcher,\n            activeCellCoordinates,\n            selectionAreas,\n            setActiveCellCoordinates,\n            setSelectionAreas,\n            setContainerHasFocus,\n            setClickAndHoldActive,\n            setCurrentMatcher,\n            ref,\n            setSelectionAreaData,\n            setActiveCellInsideSelectionArea,\n            activeCellRef,\n            setValidStartingPoint\n          );\n        };\n      },\n      [\n        currentMatcher,\n        activeCellCoordinates,\n        selectionAreas,\n        setActiveCellCoordinates,\n        setSelectionAreas,\n        setContainerHasFocus,\n        setClickAndHoldActive,\n        setCurrentMatcher,\n        ref,\n        setSelectionAreaData,\n        setActiveCellInsideSelectionArea,\n        activeCellRef,\n      ]\n    );\n\n    const handleBodyScroll = () => {\n      const headerRowElement =\n        (ref as MutableRefObject<HTMLDivElement>).current.querySelector(`\n        .${blockClass}__header--container .${blockClass}__tr`) ||\n        new HTMLDivElement();\n      headerRowElement.scrollLeft = (\n        contentScrollRef as MutableRefObject<HTMLDivElement>\n      )?.current.scrollLeft;\n    };\n\n    useEffect(() => {\n      (\n        contentScrollRef as MutableRefObject<HTMLDivElement>\n      ).current.addEventListener('scroll', () => handleBodyScroll());\n      const contentScrollElementRef =\n        contentScrollRef.current || new HTMLElement();\n      return () => {\n        contentScrollElementRef.removeEventListener('scroll', handleBodyScroll);\n      };\n    });\n\n    const handleBodyCellHoverEvent = useCallback(\n      (cell, columnIndex) => {\n        return () => {\n          handleBodyCellHover(\n            cell,\n            columnIndex,\n            clickAndHoldActive,\n            currentMatcher,\n            setSelectionAreas\n          );\n        };\n      },\n      [clickAndHoldActive, currentMatcher, setSelectionAreas]\n    );\n\n    const handleRowHeaderClickEvent = useCallback(\n      (index) => {\n        return (event) => {\n          handleRowHeaderClick(\n            index,\n            event,\n            columns,\n            ref,\n            setSelectionAreas,\n            setCurrentMatcher,\n            setActiveCellCoordinates,\n            activeCellCoordinates,\n            rows,\n            setSelectionAreaData\n          );\n        };\n      },\n      [\n        columns,\n        ref,\n        setSelectionAreas,\n        setCurrentMatcher,\n        setActiveCellCoordinates,\n        activeCellCoordinates,\n        rows,\n        setSelectionAreaData,\n      ]\n    );\n\n    // Builds the empty rows and calls `onDataUpdate` to set the new empty rows\n    // using defaultEmptyRowCount to determine how many empty rows are created.\n    useEffect(() => {\n      if (!rows?.length) {\n        const buildEmptyRows = () => {\n          const emptyRowData: object[] = [];\n          [...Array(defaultEmptyRowCount)].map(() => {\n            const emptyCell = {};\n            headerGroups?.[0]?.headers.map((header) => {\n              emptyCell[header.id] = null;\n            });\n            emptyRowData.push(emptyCell);\n          });\n          onDataUpdate?.(emptyRowData);\n        };\n        buildEmptyRows();\n      }\n      if (headerGroups?.[0] && typeof setCurrentColumns === 'function') {\n        const headers = headerGroups[0].headers;\n        setCurrentColumns(headers);\n      }\n    }, [\n      rows,\n      headerGroups,\n      defaultEmptyRowCount,\n      onDataUpdate,\n      setCurrentColumns,\n    ]);\n\n    const RenderEmptyRows = () => {\n      return <div />;\n    };\n\n    // Renders each row/cell in the spreadsheet body\n    const RenderRow = useCallback(\n      ({ index, style }) => {\n        const row = rows?.[index];\n        if (rows && rows.length) {\n          prepareRow?.(row);\n          const rowProps = prepareProps(row.getRowProps({ style }), 'key');\n          return (\n            <div\n              key={{ ...row.getRowProps().key }}\n              {...rowProps}\n              className={cx(`${blockClass}__tr`)}\n              data-row-index={index}\n              aria-rowindex={index + 1}\n              aria-owns={`${blockClass}__cell-editor-text-area`}\n            >\n              {/* ROW HEADER BUTTON */}\n              <div\n                role=\"rowheader\"\n                className={`${blockClass}__td-th--cell-container`}\n              >\n                <button\n                  id={`${blockClass}__cell--${index}--header`}\n                  tabIndex={-1}\n                  data-row-index={index}\n                  data-column-index=\"header\"\n                  type=\"button\"\n                  onClick={handleRowHeaderClickEvent(index)}\n                  className={cx(\n                    `${blockClass}__td`,\n                    `${blockClass}__td-th`,\n                    `${blockClass}--interactive-cell-element`,\n                    {\n                      [`${blockClass}__td_custom`]: hasCustomRowHeader\n                        ? true\n                        : false,\n                      [`${blockClass}__td-th--active-header`]:\n                        !hasCustomRowHeader &&\n                        (activeCellCoordinates?.row === index ||\n                          checkActiveHeaderCell(index, selectionAreas, 'row')),\n                      [`${blockClass}__td-th--selected-header`]:\n                        !hasCustomRowHeader &&\n                        checkSelectedHeaderCell(\n                          index,\n                          selectionAreas,\n                          'row',\n                          columns\n                        ),\n                    }\n                  )}\n                  style={{\n                    width: defaultColumn?.rowHeaderWidth,\n                    flexDirection: hasCustomRowHeader\n                      ? renderRowHeaderDirection === 'Left'\n                        ? 'row-reverse'\n                        : row\n                      : undefined,\n                  }}\n                >\n                  {index + 1}\n                  {hasCustomRowHeader &&\n                    typeof renderRowHeader === 'function' &&\n                    renderRowHeader(index)}\n                </button>\n              </div>\n              {/* CELL BUTTONS */}\n              {row.cells.map((cell, index) => {\n                const cellProps = prepareProps(cell.getCellProps(), 'key');\n                return (\n                  <div\n                    key={`cell_${index}`}\n                    aria-colindex={index + 1}\n                    {...cellProps}\n                    role=\"gridcell\"\n                    style={{\n                      ...cell.getCellProps().style,\n                      display: 'grid',\n                      minWidth: cell?.column?.width || defaultColumn?.width,\n                    }}\n                  >\n                    <button\n                      id={`${blockClass}__cell--${cell.row.index}--${index}`}\n                      tabIndex={-1}\n                      data-row-index={cell.row.index}\n                      data-column-index={index}\n                      className={cx(\n                        `${blockClass}__td`,\n                        `${blockClass}__body--td`,\n                        `${blockClass}--interactive-cell-element`\n                      )}\n                      onMouseDown={handleBodyCellClickEvent(cell, index)}\n                      onMouseOver={handleBodyCellHoverEvent(cell, index)}\n                      onFocus={() => {}}\n                      type=\"button\"\n                    >\n                      {cell.render('Cell')}\n                    </button>\n                  </div>\n                );\n              })}\n            </div>\n          );\n        }\n      },\n      [\n        prepareRow,\n        renderRowHeader,\n        rows,\n        hasCustomRowHeader,\n        activeCellCoordinates?.row,\n        selectionAreas,\n        handleRowHeaderClickEvent,\n        handleBodyCellClickEvent,\n        handleBodyCellHoverEvent,\n        columns,\n        defaultColumn,\n        renderRowHeaderDirection,\n      ]\n    );\n\n    const spreadsheetBodyRef = useRef(undefined);\n    return (\n      <div\n        ref={spreadsheetBodyRef as MutableRefObject<any>}\n        className={cx(`${blockClass}__body--container`)}\n        {...getTableBodyProps?.()}\n      >\n        <FixedSizeList\n          className={cx(\n            `${blockClass}__list--container`,\n            `${blockClass}__list--container--${id}`\n          )}\n          height={400}\n          itemCount={rows?.length || defaultEmptyRowCount}\n          itemSize={defaultColumn?.rowHeight}\n          width={getSpreadsheetWidth({\n            headerGroup: undefined,\n            type: undefined,\n            scrollBarSizeValue: scrollBarSize,\n            totalVisibleColumns,\n            defaultColumn,\n            totalColumnsWidth,\n            visibleColumns,\n          })}\n          outerRef={contentScrollRef}\n        >\n          {rows?.length ? RenderRow : RenderEmptyRows}\n        </FixedSizeList>\n      </div>\n    );\n  }\n);\n\nDataSpreadsheetBody.propTypes = {\n  /**\n   * Object containing the active cell coordinates\n   */\n  /**@ts-ignore */\n  activeCellCoordinates: PropTypes.shape({\n    row: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n    column: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  }),\n\n  /**\n   *This is the ref of the button input, which is the active cell element\n   */\n  /**@ts-ignore */\n  activeCellRef: PropTypes.object,\n  /**\n   * Is the user clicking and holding in the data spreadsheet body\n   */\n  clickAndHoldActive: PropTypes.bool,\n\n  /**\n   * All of the spreadsheet columns\n   */\n  columns: PropTypes.array,\n\n  /**\n   * This represents the id of the current cell selection area\n   */\n  currentMatcher: PropTypes.string,\n\n  /**\n   * Default spreadsheet sizing values\n   */\n  /**@ts-ignore */\n  defaultColumn: PropTypes.shape({\n    rowHeight: PropTypes.number,\n    rowHeaderWidth: PropTypes.number,\n    width: PropTypes.number,\n  }),\n\n  /**\n   * Sets the number of empty rows to be created when there is no data provided\n   */\n  defaultEmptyRowCount: PropTypes.number,\n\n  /**\n   * Function to set table body prop values\n   */\n  /**@ts-ignore */\n  getTableBodyProps: PropTypes.func,\n\n  /**\n   * Check if spreadsheet is using custom row header component attached\n   */\n  hasCustomRowHeader: PropTypes.bool,\n\n  /**\n   * Headers provided from useTable hook\n   */\n  headerGroups: PropTypes.arrayOf(PropTypes.object),\n\n  /**\n   * The spreadsheet id\n   */\n  id: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n\n  /**\n   * The event handler that is called when the active cell changes\n   */\n  onActiveCellChange: PropTypes.func,\n\n  /**\n   * The event handler that is called to set the rows for the empty spreadsheet\n   */\n  onDataUpdate: PropTypes.func,\n\n  /**\n   * The event handler that is called when the selection areas change\n   */\n  onSelectionAreaChange: PropTypes.func,\n\n  /**\n   * Prepare row function from react-table\n   */\n  prepareRow: PropTypes.func,\n\n  /**\n   * Component next to numbering rows\n   */\n  renderRowHeader: PropTypes.func,\n\n  /**\n   * Component next to numbering rows\n   */\n  renderRowHeaderDirection: PropTypes.string,\n\n  /**\n   * All of the spreadsheet row data\n   */\n  rows: PropTypes.arrayOf(PropTypes.object),\n\n  /**\n   * The scrollbar width\n   */\n  scrollBarSize: PropTypes.number,\n\n  /**\n   * Header reordering is active\n   */\n  selectedHeaderReorderActive: PropTypes.bool,\n\n  /**\n   * Array of selection area data\n   */\n  selectionAreaData: PropTypes.array,\n\n  /**\n   * Array of selection areas\n   */\n  selectionAreas: PropTypes.array,\n\n  /**\n   * Setter fn for activeCellCoordinates state value\n   */\n  setActiveCellCoordinates: PropTypes.func,\n\n  /**\n   * Setter fn for active cell inside of selection area\n   */\n  setActiveCellInsideSelectionArea: PropTypes.func,\n\n  /**\n   * Setter fn for clickAndHold state value\n   */\n  setClickAndHoldActive: PropTypes.func,\n\n  /**\n   * Setter fn for column ordering, provided from react-table\n   */\n  setColumnOrder: PropTypes.func,\n\n  /**\n   * Setter fn for containerHasFocus state value\n   */\n  setContainerHasFocus: PropTypes.func,\n\n  /**\n   * Set current columns after drag drop\n   */\n  setCurrentColumns: PropTypes.func,\n\n  /**\n   * Setter fn for currentMatcher state value\n   */\n  setCurrentMatcher: PropTypes.func,\n\n  /**\n   * Setter fn for header cell hold active value\n   */\n  setHeaderCellHoldActive: PropTypes.func,\n\n  /**\n   * Set header reordering active or not\n   */\n  setSelectedHeaderReorderActive: PropTypes.func,\n\n  /**\n   * Setter fn for selectionAreaData state value\n   */\n  setSelectionAreaData: PropTypes.func,\n\n  /**\n   * Setter fn for selectionAreas state value\n   */\n  setSelectionAreas: PropTypes.func,\n\n  /**\n   * The total columns width\n   */\n  totalColumnsWidth: PropTypes.number,\n\n  /**\n   * The total number of columns to be initially visible, additional columns will be rendered and\n   * visible via horizontal scrollbar\n   */\n  totalVisibleColumns: PropTypes.number,\n\n  /**\n   * Prop from react-table used to reorder columns\n   */\n  /**@ts-ignore */\n  visibleColumns: PropTypes.array,\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React, {\n  Dispatch,\n  ForwardedRef,\n  MutableRefObject,\n  SetStateAction,\n  forwardRef,\n  useEffect,\n  useState,\n} from 'react';\nimport PropTypes from 'prop-types';\nimport cx from 'classnames';\nimport { px } from '@carbon/layout';\nimport { pkg } from '../../settings';\nimport { usePreviousValue } from '../../global/js/hooks';\nimport { checkActiveHeaderCell } from './utils/checkActiveHeaderCell';\nimport { checkSelectedHeaderCell } from './utils/checkSelectedHeaderCell';\nimport { handleHeaderCellSelection } from './utils/handleHeaderCellSelection';\nimport { selectAllCells } from './utils/selectAllCells';\nimport { getSpreadsheetWidth } from './utils/getSpreadsheetWidth';\nimport { useSpreadsheetMouseMove } from './hooks';\nimport { checkForHoldingKey } from './utils/checkForHoldingKey';\nimport { prepareProps } from '../../global/js/utils/props-helper';\nimport {\n  ActiveCellCoordinates,\n  ItemType,\n  PrevState,\n  Size,\n  SpreadsheetColumn,\n} from './types';\nimport { Column } from 'react-table';\n\nconst blockClass = `${pkg.prefix}--data-spreadsheet`;\n\ninterface DataSpreadsheetHeaderProps {\n  /**\n   * Object containing the active cell coordinates\n   */\n  activeCellCoordinates?: ActiveCellCoordinates | null;\n\n  /**\n   * Specifies the cell height\n   */\n  cellSize?: Size;\n\n  /**\n   * Disable column swapping, default false\n   */\n  disableColumnSwapping?: boolean;\n\n  /**\n   * All of the spreadsheet columns\n   */\n  columns?: readonly Column[];\n\n  /**\n   * uuid that corresponds to the current selection area\n   */\n  currentMatcher?: string;\n\n  /**\n   * Default spreadsheet sizing values\n   */\n  defaultColumn?: SpreadsheetColumn;\n\n  /**\n   * Whether or not a click/hold is active on a header cell\n   */\n  headerCellHoldActive?: boolean;\n\n  /**\n   * Headers provided from useTable hook\n   */\n  headerGroups?: any[];\n\n  /**\n   * Read-only table\n   */\n  readOnlyTable?: boolean;\n\n  /**\n   * All of the spreadsheet row data\n   */\n  rows?: object[];\n\n  /**\n   * The scrollbar width\n   */\n  scrollBarSize?: number;\n\n  /**\n   * The aria label applied to the Select all button\n   */\n  selectAllAriaLabel: string;\n\n  /**\n   * All of the cell selection area items\n   */\n  selectionAreas?: ItemType[];\n\n  /**\n   * Setter fn for activeCellCoordinates value\n   */\n  setActiveCellCoordinates?: Dispatch<\n    SetStateAction<ActiveCellCoordinates | null>\n  >;\n\n  /**\n   * Header reordering is active\n   */\n  selectedHeaderReorderActive?: boolean;\n\n  /**\n   * Set header reordering active or not\n   */\n  setSelectedHeaderReorderActive?: Dispatch<SetStateAction<boolean>>;\n\n  /**\n   * Setter fn for currentMatcher value\n   */\n  setCurrentMatcher?: Dispatch<SetStateAction<string>>;\n\n  /**\n   * Setter fn for header cell hold active value\n   */\n  setHeaderCellHoldActive?: (arg: boolean) => void;\n\n  /**\n   * Setter fn for selectionAreaData state value\n   */\n  setSelectionAreaData?: Dispatch<SetStateAction<object[]>>;\n\n  /**\n   * Setter fn for selectionAreas value\n   */\n  setSelectionAreas?: Dispatch<SetStateAction<object[]>>;\n\n  /**\n   * The total number of columns to be initially visible, additional columns will be rendered and\n   * visible via horizontal scrollbar\n   */\n  totalVisibleColumns?: number;\n\n  /**\n   * Function used to update the active cell coordinates\n   */\n  updateActiveCellCoordinates?: (arg) => void;\n\n  /**\n   * Array of visible columns provided by react-table useTable hook\n   */\n  visibleColumns?: Column<object>[];\n}\n\nexport const DataSpreadsheetHeader = forwardRef(\n  (\n    {\n      activeCellCoordinates,\n      cellSize,\n      columns,\n      currentMatcher,\n      defaultColumn,\n      headerGroups,\n      scrollBarSize,\n      selectionAreas,\n      selectedHeaderReorderActive,\n      setSelectedHeaderReorderActive,\n      setActiveCellCoordinates,\n      setCurrentMatcher,\n      setSelectionAreas,\n      readOnlyTable,\n      disableColumnSwapping,\n      setSelectionAreaData,\n      rows,\n      totalVisibleColumns,\n      updateActiveCellCoordinates,\n      setHeaderCellHoldActive,\n      headerCellHoldActive,\n      selectAllAriaLabel,\n      visibleColumns,\n    }: DataSpreadsheetHeaderProps,\n    ref: ForwardedRef<HTMLDivElement>\n  ) => {\n    const [scrollBarSizeValue, setScrollBarSizeValue] = useState<\n      number | undefined\n    >(0);\n    const previousState: PrevState = usePreviousValue({ cellSize }) || {};\n    useEffect(() => {\n      if (previousState?.cellSize !== cellSize) {\n        const scrollContainer = (\n          ref as MutableRefObject<HTMLElement>\n        )?.current?.querySelector(`.${blockClass}__list--container`);\n        const hasScrollBar =\n          scrollContainer?.scrollHeight &&\n          scrollContainer?.clientHeight &&\n          scrollContainer?.scrollHeight > scrollContainer?.clientHeight;\n        const scrollBarValue = hasScrollBar ? 0 : scrollBarSize;\n\n        // fix for a11y violation element_scrollable_tabbable\n        if (!scrollContainer?.getAttribute('tabIndex')) {\n          scrollContainer?.setAttribute('tabIndex', '0');\n        }\n\n        setScrollBarSizeValue(scrollBarValue);\n      }\n    }, [cellSize, ref, scrollBarSize, previousState?.cellSize]);\n\n    const handleColumnHeaderClick = (index) => {\n      return (event) => {\n        const isHoldingCommandKey = checkForHoldingKey(event, 'cmd');\n        const isHoldingShiftKey = checkForHoldingKey(event, 'shiftKey');\n        handleHeaderCellSelection({\n          type: 'column',\n          activeCellCoordinates,\n          rows,\n          columns,\n          currentMatcher,\n          setActiveCellCoordinates,\n          setCurrentMatcher,\n          setSelectionAreas,\n          spreadsheetRef: ref,\n          index,\n          isKeyboard: undefined,\n          setSelectionAreaData,\n          isHoldingCommandKey,\n          isHoldingShiftKey,\n        });\n      };\n    };\n\n    const handleSelectAllClick = () => {\n      selectAllCells({\n        ref,\n        setCurrentMatcher,\n        setSelectionAreas,\n        rows,\n        columns,\n        activeCellCoordinates,\n        updateActiveCellCoordinates,\n      });\n    };\n\n    const handleHeaderMouseDown = (index) => {\n      return (event) => {\n        if (event.shiftKey) {\n          // Remove columns, need to call handleHeaderCellSelection\n          return;\n        }\n        const selectionAreaToClone = selectionAreas?.filter(\n          (item) => item?.matcher === currentMatcher\n        );\n        const selectionAreaElement = (\n          ref as MutableRefObject<HTMLDivElement>\n        ).current.querySelector(\n          `[data-matcher-id=\"${selectionAreaToClone?.[0]?.matcher}\"]`\n        );\n        if (selectionAreaElement) {\n          selectionAreaElement.classList.add(\n            `${blockClass}__selection-area--element`\n          );\n        }\n        if (typeof setSelectedHeaderReorderActive === 'function') {\n          setSelectedHeaderReorderActive(true);\n        }\n\n        const clickXPosition = event.clientX;\n        const headerButtonCoords = event.target.getBoundingClientRect();\n        const headerIndex = event.target.getAttribute('data-column-index');\n        const offsetXValue = clickXPosition - headerButtonCoords.left;\n        const lowestColumnIndexFromSelectionArea = Math.min(\n          selectionAreaToClone?.[0]?.point1?.column || 0,\n          selectionAreaToClone?.[0]?.point2?.column || 0\n        );\n        const selectionAreaCoords =\n          selectionAreaElement?.getBoundingClientRect() || new DOMRect();\n        const updatedOffsetDifference =\n          lowestColumnIndexFromSelectionArea < parseInt(headerIndex)\n            ? offsetXValue +\n              (headerButtonCoords.left - selectionAreaCoords?.left)\n            : offsetXValue;\n\n        const spreadsheetSelector =\n          (ref as MutableRefObject<HTMLElement>)?.current ?? document;\n        const bodyContainer = spreadsheetSelector.querySelector(\n          `.${blockClass}__list--container`\n        )?.firstElementChild;\n\n        const selectionAreaClonedElement =\n          selectionAreaElement?.cloneNode() as HTMLElement;\n        const reorderIndicatorLine =\n          selectionAreaElement?.cloneNode() as HTMLElement;\n        if (reorderIndicatorLine) {\n          reorderIndicatorLine.className = `${blockClass}__reorder-indicator-line`;\n          reorderIndicatorLine.style.width = px(2);\n        }\n        selectionAreaClonedElement.classList.add(\n          `${blockClass}__selection-area--element-cloned`\n        );\n        selectionAreaClonedElement.setAttribute(\n          'data-clone-offset-x',\n          `${updatedOffsetDifference}`\n        );\n        selectionAreaClonedElement.setAttribute(\n          'data-column-index-original',\n          index\n        );\n        bodyContainer?.appendChild(selectionAreaClonedElement);\n        bodyContainer?.appendChild(reorderIndicatorLine);\n        setHeaderCellHoldActive?.(true);\n      };\n    };\n\n    useSpreadsheetMouseMove({ ref, headerCellHoldActive, defaultColumn });\n\n    return (\n      <div className={cx(`${blockClass}__header--container`)} role=\"rowgroup\">\n        {headerGroups?.map((headerGroup, index) => {\n          const headerProps = prepareProps(\n            headerGroup.getHeaderGroupProps(),\n            'key'\n          );\n          return (\n            <div\n              key={`header_${index}`}\n              {...headerProps}\n              style={{\n                ...headerGroup.getHeaderGroupProps().style,\n                width: getSpreadsheetWidth({\n                  type: 'header',\n                  headerGroup,\n                  scrollBarSizeValue,\n                  totalVisibleColumns,\n                  defaultColumn,\n                  totalColumnsWidth: undefined,\n                  visibleColumns,\n                }),\n                overflow: 'hidden',\n              }}\n              className={`${blockClass}__tr`}\n            >\n              {/* SELECT ALL BUTTON */}\n              <div\n                role=\"columnheader\"\n                className={`${blockClass}__select-all-cell-container`}\n                style={{\n                  width: defaultColumn?.rowHeaderWidth,\n                  height: defaultColumn?.rowHeight,\n                }}\n              >\n                <button\n                  id={`${blockClass}__cell--header--header`}\n                  data-row-index=\"header\"\n                  data-column-index=\"header\"\n                  type=\"button\"\n                  style={{\n                    width: defaultColumn?.rowHeaderWidth,\n                  }}\n                  tabIndex={-1}\n                  aria-label={selectAllAriaLabel}\n                  onClick={handleSelectAllClick}\n                  className={cx(\n                    `${blockClass}__th`,\n                    `${blockClass}--interactive-cell-element`,\n                    `${blockClass}__th--select-all`,\n                    {\n                      [`${blockClass}__th--active-header`]:\n                        activeCellCoordinates?.column === 'header' &&\n                        activeCellCoordinates?.row === 'header',\n                    }\n                  )}\n                >\n                  &nbsp;\n                </button>\n              </div>\n              {/* COLUMN HEADER BUTTONS */}\n              {headerGroup.headers.map((column, index) => {\n                const colProps = prepareProps(column.getHeaderProps(), 'key');\n                const selectedHeader = checkSelectedHeaderCell(\n                  index,\n                  selectionAreas,\n                  'column',\n                  rows\n                );\n                return (\n                  <div\n                    key={`column_${index}`}\n                    role=\"columnheader\"\n                    className={`${blockClass}__columnheader`}\n                    {...colProps}\n                  >\n                    <button\n                      id={`${blockClass}__cell--header--${index}`}\n                      data-row-index=\"header\"\n                      data-column-index={index}\n                      tabIndex={-1}\n                      onMouseDown={\n                        selectedHeader &&\n                        !readOnlyTable &&\n                        !disableColumnSwapping\n                          ? handleHeaderMouseDown(index)\n                          : undefined\n                      }\n                      onMouseUp={\n                        selectedHeader &&\n                        !readOnlyTable &&\n                        !disableColumnSwapping &&\n                        typeof setSelectedHeaderReorderActive === 'function'\n                          ? () => setSelectedHeaderReorderActive(false)\n                          : undefined\n                      }\n                      onClick={\n                        !selectedHeader\n                          ? handleColumnHeaderClick(index)\n                          : undefined\n                      }\n                      style={{\n                        height: defaultColumn?.rowHeight,\n                        width: column?.width || defaultColumn?.width,\n                      }}\n                      className={cx(\n                        `${blockClass}__th`,\n                        `${blockClass}--interactive-cell-element`,\n                        {\n                          [`${blockClass}__th--active-header`]:\n                            activeCellCoordinates?.column === index ||\n                            checkActiveHeaderCell(\n                              index,\n                              selectionAreas,\n                              'column'\n                            ),\n                          [`${blockClass}__th--active-header-disabledSwapping`]:\n                            disableColumnSwapping || readOnlyTable,\n                          [`${blockClass}__th--selected-header`]:\n                            selectedHeader,\n                          [`${blockClass}__th--selected-header-reorder-active`]:\n                            selectedHeaderReorderActive,\n                        }\n                      )}\n                      type=\"button\"\n                    >\n                      {column.render('Header')}\n                    </button>\n                  </div>\n                );\n              })}\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n);\n\nDataSpreadsheetHeader.propTypes = {\n  /**\n   * Object containing the active cell coordinates\n   */\n  /**@ts-ignore */\n  activeCellCoordinates: PropTypes.shape({\n    row: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n    column: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  }),\n\n  /**\n   * Specifies the cell height\n   */\n  cellSize: PropTypes.oneOf(['xs', 'sm', 'md', 'lg']),\n\n  /**\n   * All of the spreadsheet columns\n   */\n  columns: PropTypes.array,\n\n  /**\n   * uuid that corresponds to the current selection area\n   */\n  currentMatcher: PropTypes.string,\n\n  /**\n   * Default spreadsheet sizing values\n   */\n  /**@ts-ignore */\n  defaultColumn: PropTypes.shape({\n    rowHeight: PropTypes.number,\n    rowHeaderWidth: PropTypes.number,\n    width: PropTypes.number,\n  }),\n\n  /**\n   * Disable column swapping, default false\n   */\n  disableColumnSwapping: PropTypes.bool,\n\n  /**\n   * Whether or not a click/hold is active on a header cell\n   */\n  headerCellHoldActive: PropTypes.bool,\n\n  /**\n   * Headers provided from useTable hook\n   */\n  headerGroups: PropTypes.arrayOf(PropTypes.object),\n\n  /**\n   * Read-only table\n   */\n  readOnlyTable: PropTypes.bool,\n\n  /**\n   * All of the spreadsheet row data\n   */\n  /**@ts-ignore */\n  rows: PropTypes.arrayOf(PropTypes.object),\n\n  /**\n   * The scrollbar width\n   */\n  scrollBarSize: PropTypes.number,\n\n  /**\n   * The aria label applied to the Select all button\n   */\n  selectAllAriaLabel: PropTypes.string.isRequired,\n\n  /**\n   * Header reordering is active\n   */\n  selectedHeaderReorderActive: PropTypes.bool,\n\n  /**\n   * All of the cell selection area items\n   */\n  /**@ts-ignore */\n  selectionAreas: PropTypes.arrayOf(PropTypes.object),\n\n  /**\n   * Setter fn for activeCellCoordinates value\n   */\n  setActiveCellCoordinates: PropTypes.func,\n\n  /**\n   * Setter fn for currentMatcher value\n   */\n  setCurrentMatcher: PropTypes.func,\n\n  /**\n   * Setter fn for header cell hold active value\n   */\n  setHeaderCellHoldActive: PropTypes.func,\n\n  /**\n   * Set header reordering active or not\n   */\n  setSelectedHeaderReorderActive: PropTypes.func,\n\n  /**\n   * Setter fn for selectionAreaData state value\n   */\n  setSelectionAreaData: PropTypes.func,\n\n  /**\n   * Setter fn for selectionAreas value\n   */\n  setSelectionAreas: PropTypes.func,\n\n  /**\n   * The total number of columns to be initially visible, additional columns will be rendered and\n   * visible via horizontal scrollbar\n   */\n  totalVisibleColumns: PropTypes.number,\n\n  /**\n   * Function used to update the active cell coordinates\n   */\n  updateActiveCellCoordinates: PropTypes.func,\n\n  /**\n   * Array of visible columns provided by react-table useTable hook\n   */\n  /**@ts-ignore */\n  visibleColumns: PropTypes.array,\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { px } from '@carbon/layout';\nimport { pkg } from '../../../settings';\n\nexport const createActiveCellFn = ({\n  placementElement,\n  coords,\n  addToHeader = false,\n  contextRef,\n  blockClass = `${pkg.prefix}--data-spreadsheet`,\n  onActiveCellChange,\n  activeCellValue,\n  activeCellRef,\n  cellEditorRef,\n  defaultColumn,\n}) => {\n  if (!coords) {\n    return;\n  }\n  // If the active cell is in the column header row (very first), we need to append this element\n  // to `.${blockClass}__header--container`, otherwise it should be appended to `.${blockClass}__listContainer` firstElementChild\n  const spreadsheetSelector = contextRef?.current ?? document;\n  const point1Element =\n    spreadsheetSelector.querySelector(\n      `[data-row-index=\"${coords.row}\"][data-column-index=\"${coords.column}\"]`\n    ) || spreadsheetSelector.querySelector(`.${blockClass}__body--td`);\n  // if we can't find the point1 element (this can happen in the case where a virtualized row is not present anymore in the DOM), we get the default height/width of the first body cell we find\n\n  const selectionAreaCellWidth = point1Element.offsetWidth;\n  const selectionAreaCellHeight = point1Element.offsetHeight;\n  const activeElementContainer = addToHeader\n    ? contextRef?.current.querySelector(`.${blockClass}__header--container`)\n    : contextRef?.current.querySelector(`.${blockClass}__list--container`)\n        .firstElementChild;\n  const relativePosition = {\n    top: placementElement\n      ? placementElement.getBoundingClientRect().top -\n        activeElementContainer.getBoundingClientRect().top\n      : coords.row === 0\n        ? 0\n        : selectionAreaCellHeight * coords.row, // calculate top value here if virtualized row is not in DOM\n    left: placementElement\n      ? placementElement.getBoundingClientRect().left -\n        activeElementContainer.getBoundingClientRect().left\n      : coords.column === 0\n        ? 0 + (defaultColumn.rowHeaderWidth - 4)\n        : selectionAreaCellWidth * coords.column +\n          (defaultColumn.rowHeaderWidth - 4), // calculate left value here if virtualized row is not in DOM, accounting for row header cell width (including borders)\n  };\n  const activeCellButton = activeCellRef?.current;\n  activeCellButton.style.width = px(\n    placementElement ? placementElement?.offsetWidth : selectionAreaCellWidth\n  );\n  activeCellButton.style.height = px(\n    placementElement ? placementElement?.offsetHeight : selectionAreaCellHeight\n  );\n  activeCellButton.style.left = px(relativePosition.left);\n  activeCellButton.style.top = px(relativePosition.top);\n  activeCellButton.style.display = 'block';\n  activeCellButton.setAttribute(\n    'data-active-row-index',\n    typeof coords?.row === 'number' ? coords.row : 'header'\n  );\n  activeCellButton.setAttribute(\n    'data-active-column-index',\n    typeof coords?.column === 'number' ? coords.column : 'header'\n  );\n  activeElementContainer.appendChild(activeCellButton);\n  activeCellButton.focus();\n  if (!addToHeader) {\n    activeElementContainer.appendChild(cellEditorRef.current);\n  }\n  if (typeof coords?.column === 'number' && typeof coords?.row === 'number') {\n    onActiveCellChange?.(activeCellValue);\n  }\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport {\n  baseFontSize,\n  sizeXSmall as xs,\n  sizeSmall as sm,\n  sizeMedium as md,\n  sizeLarge as lg,\n} from '@carbon/layout';\n\nconst getSizeInPixels = (carbonSize) =>\n  Number(carbonSize.replace('rem', '') * baseFontSize);\n\nexport const getCellSize = (cellSize) => {\n  switch (cellSize) {\n    case 'xs':\n      return getSizeInPixels(xs);\n    case 'sm':\n      return getSizeInPixels(sm);\n    case 'md':\n      return getSizeInPixels(md);\n    case 'lg':\n      return getSizeInPixels(lg);\n    default:\n      return getSizeInPixels(sm);\n  }\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nexport const getScrollbarWidth = () => {\n  const scrollDiv = document.createElement('div');\n  scrollDiv.setAttribute(\n    'style',\n    'width: 100px; height: 100px; overflow: scroll; position:absolute; top:-9999px;'\n  );\n  document.body.appendChild(scrollDiv);\n  const scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;\n  document.body.removeChild(scrollDiv);\n  return scrollbarWidth;\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { removeCellSelections } from './removeCellSelections';\nimport uuidv4 from '../../../global/js/utils/uuidv4';\n\n// Update the data\nexport const handleEditSubmit = ({\n  activeCellCoordinates,\n  cellEditorRulerRef,\n  columns,\n  previousState,\n  removeCellEditor,\n  rows,\n  setActiveCellCoordinates,\n  setCurrentMatcher,\n  setSelectionAreas,\n  spreadsheetRef,\n  updateData,\n}) => {\n  return (event) => {\n    const { key } = event;\n    const updateSelectionAreaOnCellEditSubmit = ({ type }) => {\n      const submitEditChanges = () => {\n        const prevCoords = previousState?.activeCellCoordinates;\n        const cellProps = rows[prevCoords?.row].cells[prevCoords?.column];\n        removeCellEditor();\n        updateData(prevCoords?.row, cellProps.column.id);\n      };\n      removeCellSelections({ spreadsheetRef });\n      submitEditChanges();\n      const tempMatcher = uuidv4();\n      const newSelectionArea = {\n        row:\n          type === 'Enter'\n            ? activeCellCoordinates.row === rows.length - 1\n              ? activeCellCoordinates.row\n              : activeCellCoordinates.row + 1\n            : activeCellCoordinates.row,\n        column:\n          type === 'Tab'\n            ? activeCellCoordinates.column === columns.length - 1\n              ? activeCellCoordinates.column\n              : activeCellCoordinates.column + 1\n            : activeCellCoordinates.column,\n      };\n      setSelectionAreas([\n        {\n          point1: newSelectionArea,\n          point2: newSelectionArea,\n          matcher: tempMatcher,\n          areaCreated: false,\n        },\n      ]);\n      setCurrentMatcher(tempMatcher);\n      cellEditorRulerRef.current.textContent = '';\n    };\n    if (key === 'Enter') {\n      updateSelectionAreaOnCellEditSubmit({ type: 'Enter' });\n      setActiveCellCoordinates((prev) => ({\n        ...prev,\n        row: prev.row === rows.length - 1 ? prev.row : prev.row + 1, // do not move to next cell below if we're already in the last row\n      }));\n    }\n    if (key === 'Tab') {\n      event.preventDefault();\n      updateSelectionAreaOnCellEditSubmit({ type: 'Tab' });\n      setActiveCellCoordinates((prev) => ({\n        ...prev,\n        column:\n          prev.column === columns.length - 1 ? prev.column : prev.column + 1, // do not move to next cell below if we're already in the last column\n      }));\n    }\n    return;\n  };\n};\n","/**\n * Copyright IBM Corp. 2022, 2022\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { ActiveCellCoordinates, PrevState, Size, Theme } from './types';\nimport {\n  Column,\n  TableInstance,\n  UseColumnOrderInstanceProps,\n  useBlockLayout,\n  useColumnOrder,\n  useTable,\n} from 'react-table';\n// Import portions of React that are needed.\nimport React, {\n  ForwardedRef,\n  LegacyRef,\n  MutableRefObject,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { useActiveElement, usePreviousValue } from '../../global/js/hooks';\nimport {\n  useMoveActiveCell,\n  useMultipleKeyTracking,\n  useResetSpreadsheetFocus,\n  useSpreadsheetEdit,\n  useSpreadsheetOutsideClick,\n} from './hooks';\n\nimport { DataSpreadsheetBody } from './DataSpreadsheetBody';\nimport { DataSpreadsheetHeader } from './DataSpreadsheetHeader';\n// Other standard imports.\nimport PropTypes from 'prop-types';\nimport { createActiveCellFn } from './utils/createActiveCellFn';\nimport cx from 'classnames';\nimport { deepCloneObject } from '../../global/js/utils/deepCloneObject';\nimport { getCellSize } from './utils/getCellSize';\nimport { getDevtoolsProps } from '../../global/js/utils/devtools';\nimport { getScrollbarWidth } from '../../global/js/utils/getScrollbarWidth';\nimport { handleEditSubmit } from './utils/handleEditSubmit';\nimport { handleHeaderCellSelection } from './utils/handleHeaderCellSelection';\nimport { getNodeTextContent } from '../../global/js/utils/getNodeTextContent';\nimport { handleKeyPress } from './utils/commonEventHandlers';\nimport { pkg } from '../../settings';\nimport { removeCellSelections } from './utils/removeCellSelections';\nimport { selectAllCells } from './utils/selectAllCells';\nimport uuidv4 from '../../global/js/utils/uuidv4';\n\n// The block part of our conventional BEM class names (blockClass__E--M).\nconst blockClass = `${pkg.prefix}--data-spreadsheet`;\nconst componentName = 'DataSpreadsheet';\n\n// Default values for props\nconst defaults = {\n  columns: Object.freeze([]),\n  data: Object.freeze([]),\n  defaultEmptyRowCount: 16,\n  onDataUpdate: Object.freeze(() => {}),\n  onColDrag: Object.freeze(() => {}),\n  onActiveCellChange: Object.freeze(() => {}),\n  onSelectionAreaChange: Object.freeze(() => {}),\n  theme: 'light',\n};\n\nexport interface DataSpreadsheetProps {\n  /**\n   * Specifies the cell height\n   */\n  cellSize?: Size;\n\n  /**\n   * Provide an optional class to be applied to the containing node.\n   */\n  className?: string;\n\n  /**\n   * The data that will build the column headers\n   */\n  columns?: readonly Column<object>[];\n\n  /**\n   * Disable column swapping, default false\n   */\n  disableColumnSwapping?: boolean;\n\n  /**\n   * The spreadsheet data that will be rendered in the body of the spreadsheet component\n   */\n  data?: readonly object[];\n\n  /**\n   * Sets the number of empty rows to be created when there is no data provided\n   */\n  defaultEmptyRowCount?: number;\n\n  /**\n   * Check if has custom row header component attached\n   */\n  hasCustomRowHeader?: boolean;\n\n  /**\n   * The spreadsheet id\n   */\n  id?: number | string;\n\n  /**\n   * The event handler that is called when the active cell changes\n   */\n  onActiveCellChange?: () => void;\n\n  /**\n   * Callback for columns after being dragged\n   */\n  onColDrag?: ({ ...args }) => void;\n\n  /**\n   * The setter fn for the data prop\n   */\n  onDataUpdate?: ({ ...args }) => void;\n\n  /**\n   * The event handler that is called when the selection area values change\n   */\n  onSelectionAreaChange?: () => void;\n\n  /**\n   * Read-only table\n   */\n  readOnlyTable?: boolean;\n\n  /**\n   * Position of the custom row numbering component\n   */\n  renderRowHeaderDirection?: 'left' | 'right';\n\n  /**\n   * Component next to numbering rows\n   */\n  renderRowHeader?: (index: number) => any[];\n\n  /**\n   * The aria label applied to the Select all button\n   */\n  selectAllAriaLabel: string;\n\n  /**\n   * The aria label applied to the Data spreadsheet component\n   */\n  spreadsheetAriaLabel: string;\n\n  /**\n   * The theme the DataSpreadsheet should use (only used to render active cell/selection area colors on dark theme)\n   */\n  theme?: Theme;\n\n  /**\n   * The total number of columns to be initially visible, additional columns will be rendered and\n   * visible via horizontal scrollbar\n   */\n  totalVisibleColumns?: number;\n\n  /* TODO: add types and DocGen for all props. */\n}\n\n/**\n * DataSpreadsheet: used to organize and display large amounts of structured data, separated by columns and rows in a grid-like format.\n */\nexport const DataSpreadsheet = React.forwardRef(\n  (\n    {\n      // The component props, in alphabetical order (for consistency).\n      cellSize = 'sm',\n      className,\n      columns = defaults.columns,\n      data = defaults.data,\n      defaultEmptyRowCount = defaults.defaultEmptyRowCount,\n      onDataUpdate = defaults.onDataUpdate,\n      onColDrag = defaults.onColDrag,\n      id,\n      onActiveCellChange = defaults.onActiveCellChange,\n      onSelectionAreaChange = defaults.onSelectionAreaChange,\n      renderRowHeader,\n      renderRowHeaderDirection,\n      disableColumnSwapping = false,\n      readOnlyTable = false,\n      selectAllAriaLabel,\n      spreadsheetAriaLabel,\n      theme,\n      totalVisibleColumns,\n\n      // Collect any other property values passed in.\n      ...rest\n    }: DataSpreadsheetProps,\n    ref: ForwardedRef<HTMLDivElement>\n  ) => {\n    const multiKeyTrackingRef: LegacyRef<HTMLDivElement> = useRef(null);\n    const localRef = useRef(undefined);\n    const spreadsheetRef = ref || localRef;\n    const focusedElement = useActiveElement();\n    const [currentColumns, setCurrentColumns] = useState<object>(columns);\n    const [pastColumns, setPastColumns] = useState<object[]>([]);\n    const [containerHasFocus, setContainerHasFocus] = useState(false);\n    const [activeCellCoordinates, setActiveCellCoordinates] =\n      useState<ActiveCellCoordinates | null>(null);\n    const [selectionAreas, setSelectionAreas] = useState<object[]>([]);\n    const [selectionAreaData, setSelectionAreaData] = useState<object[]>([]);\n    const [clickAndHoldActive, setClickAndHoldActive] = useState(false);\n    const [currentMatcher, setCurrentMatcher] = useState('');\n    const [isEditing, setIsEditing] = useState(false);\n    const [cellEditorValue, setCellEditorValue] = useState('');\n    const [headerCellHoldActive, setHeaderCellHoldActive] = useState(false);\n    const [selectedHeaderReorderActive, setSelectedHeaderReorderActive] =\n      useState(false);\n    const isBlurSpreadsheet = useRef(false);\n    const [isActiveHeaderCellChanged, setIsActiveHeaderCellChanged] =\n      useState<boolean>(false);\n    const [activeCellInsideSelectionArea, setActiveCellInsideSelectionArea] =\n      useState(false);\n    const previousState: PrevState =\n      usePreviousValue({\n        activeCellCoordinates,\n        isEditing,\n        cellEditorValue,\n        selectedHeaderReorderActive,\n      }) || {};\n    const cellSizeValue = getCellSize(cellSize);\n    const cellEditorRef = useRef<HTMLTextAreaElement | undefined>(undefined);\n    const [activeCellContent, setActiveCellContent] = useState<any>();\n    const activeCellRef = useRef<\n      HTMLDivElement | HTMLButtonElement | undefined\n    >(undefined);\n    const cellEditorRulerRef = useRef<HTMLPreElement | undefined>(undefined);\n\n    const hasCustomRowHeader = typeof renderRowHeader === 'function';\n    const maxNumRowsCount = data.length.toString().length;\n\n    const defaultColumn = useMemo(\n      () => ({\n        width: 150,\n        rowHeaderWidth: hasCustomRowHeader ? 40 + maxNumRowsCount * 8.56 : 64,\n        rowHeight: cellSizeValue,\n      }),\n      [cellSizeValue, hasCustomRowHeader, maxNumRowsCount]\n    );\n    const { keysPressedList, usingMac } = useMultipleKeyTracking({\n      ref: multiKeyTrackingRef,\n      containerHasFocus,\n      isEditing,\n    });\n    const scrollBarSize = useMemo(() => getScrollbarWidth(), []);\n\n    const {\n      getTableProps,\n      getTableBodyProps,\n      headerGroups,\n      rows,\n      totalColumnsWidth,\n      prepareRow,\n      setColumnOrder,\n      visibleColumns,\n    } = useTable(\n      {\n        columns,\n        data,\n        defaultColumn,\n      },\n      useBlockLayout,\n      useColumnOrder\n    ) as UseColumnOrderInstanceProps<any> & TableInstance;\n\n    // Update the spreadsheet data after editing a cell\n    const updateData = useCallback(\n      (rowIndex, columnId, newValue) => {\n        onDataUpdate((prev) =>\n          prev.map((row, index) => {\n            if (index === rowIndex) {\n              return {\n                ...prev[rowIndex],\n                [columnId]: cellEditorValue || newValue,\n              };\n            }\n            return row;\n          })\n        );\n      },\n      [cellEditorValue, onDataUpdate]\n    );\n\n    useEffect(() => {\n      const currentHeaders: Array<any> = [];\n      if (Object.keys(currentColumns).length > 0) {\n        Object.keys(currentColumns).forEach((itemIndex) => {\n          if (typeof currentColumns[itemIndex].Header === 'object') {\n            if (currentColumns[itemIndex].column_name) {\n              currentHeaders.push(currentColumns[itemIndex].column_name);\n            } else {\n              currentHeaders.push(\n                getNodeTextContent(currentColumns[itemIndex].Header)\n              );\n            }\n          } else if (currentColumns[itemIndex].Header) {\n            currentHeaders.push(currentColumns[itemIndex].Header);\n          }\n        });\n      }\n\n      if (previousState.selectedHeaderReorderActive) {\n        setPastColumns(currentHeaders);\n      }\n\n      if (\n        !previousState.selectedHeaderReorderActive &&\n        pastColumns.length > 0 &&\n        !headerCellHoldActive &&\n        JSON.stringify(currentHeaders) !== JSON.stringify(pastColumns)\n      ) {\n        onColDrag({\n          headers: currentHeaders,\n          data: activeCellContent.props.data,\n        });\n        if (currentHeaders.length === 0) {\n          setPastColumns([]);\n        }\n      }\n    }, [\n      previousState?.selectedHeaderReorderActive,\n      currentColumns,\n      headerCellHoldActive,\n      columns,\n      activeCellContent,\n      onColDrag,\n      pastColumns,\n    ]);\n\n    // Removes the active cell element\n    const removeActiveCell = useCallback(() => {\n      const activeCellHighlight: HTMLDivElement | null = (\n        spreadsheetRef as MutableRefObject<HTMLDivElement>\n      )?.current?.querySelector(`.${blockClass}__active-cell--highlight`);\n      if (activeCellHighlight) {\n        activeCellHighlight.style.display = 'none';\n      }\n    }, [spreadsheetRef]);\n\n    const removeCellEditor = useCallback(() => {\n      setCellEditorValue('');\n      setIsEditing(false);\n      if (cellEditorRef?.current) {\n        cellEditorRef.current.style.display = 'none';\n      }\n    }, []);\n\n    // Remove cell editor if the active cell coordinates change and save with new cell data, this will\n    // happen if you click on another cell while isEditing is true\n    useEffect(() => {\n      const prevCoords = previousState?.activeCellCoordinates;\n      if (\n        (prevCoords?.row !== activeCellCoordinates?.row ||\n          prevCoords?.column !== activeCellCoordinates?.column) &&\n        isEditing\n      ) {\n        const cellProps =\n          rows[Number(prevCoords?.row)].cells[Number(prevCoords?.column)];\n        removeCellEditor();\n        updateData(prevCoords?.row, cellProps.column.id, undefined);\n        if (cellEditorRulerRef?.current) {\n          cellEditorRulerRef.current.textContent = '';\n        }\n      }\n      if (\n        prevCoords?.row !== activeCellCoordinates?.row ||\n        prevCoords?.column !== activeCellCoordinates?.column\n      ) {\n        if (\n          activeCellCoordinates &&\n          activeCellCoordinates?.row !== 'header' &&\n          activeCellCoordinates?.column !== 'header'\n        ) {\n          const activeCellFullData =\n            typeof activeCellCoordinates?.column === 'number' &&\n            typeof activeCellCoordinates?.row === 'number'\n              ? rows[activeCellCoordinates?.row].cells[\n                  activeCellCoordinates?.column\n                ]\n              : null;\n          if (activeCellFullData) {\n            setActiveCellContent(activeCellFullData.render('Cell'));\n          } else {\n            setActiveCellContent(null);\n          }\n        }\n        if (\n          (activeCellCoordinates && activeCellCoordinates?.row === 'header') ||\n          activeCellCoordinates?.column === 'header'\n        ) {\n          setActiveCellContent(null);\n          setIsActiveHeaderCellChanged((prev) => !prev);\n        }\n      }\n      // For when we edit and focus out of data spreadsheet\n      if (\n        isEditing &&\n        previousState.activeCellCoordinates &&\n        isBlurSpreadsheet.current\n      ) {\n        setActiveCellContent(previousState.cellEditorValue);\n        isBlurSpreadsheet.current = false;\n        removeCellEditor();\n      }\n    }, [\n      isBlurSpreadsheet,\n      activeCellCoordinates,\n      previousState?.activeCellCoordinates,\n      previousState?.cellEditorValue,\n      updateData,\n      rows,\n      isEditing,\n      removeCellEditor,\n      activeCellContent,\n    ]);\n\n    const createActiveCell = useCallback(\n      ({ placementElement, coords, addToHeader = false }) => {\n        const activeCellFullData =\n          typeof coords?.column === 'number' && typeof coords?.row === 'number'\n            ? rows[coords?.row].cells[coords?.column]\n            : null;\n        const activeCellValue = activeCellFullData\n          ? Object.values(activeCellFullData.row.values)[coords?.column]\n          : null;\n\n        createActiveCellFn({\n          placementElement,\n          coords,\n          addToHeader,\n          contextRef: spreadsheetRef,\n          blockClass,\n          onActiveCellChange,\n          activeCellValue,\n          activeCellRef,\n          cellEditorRef,\n          defaultColumn,\n        });\n      },\n      [spreadsheetRef, rows, onActiveCellChange, defaultColumn]\n    );\n\n    useResetSpreadsheetFocus({\n      focusedElement,\n      removeActiveCell,\n      setContainerHasFocus,\n    });\n\n    useSpreadsheetOutsideClick({\n      isBlurSpreadsheet,\n      spreadsheetRef,\n      setActiveCellCoordinates,\n      setSelectionAreas,\n      removeActiveCell,\n      setContainerHasFocus,\n      removeCellEditor,\n    });\n\n    useMoveActiveCell({\n      spreadsheetRef,\n      activeCellCoordinates,\n      containerHasFocus,\n      createActiveCell,\n      activeCellContent,\n      isActiveHeaderCellChanged,\n    });\n\n    const handleInitialArrowPress = useCallback(() => {\n      // If activeCellCoordinates is null then we need to set an initial value\n      // which will place the activeCell on the select all cell/button\n      setActiveCellInsideSelectionArea(false);\n      if (!activeCellCoordinates) {\n        setActiveCellCoordinates({\n          column: 'header',\n          row: 'header',\n        });\n      }\n      return;\n    }, [activeCellCoordinates]);\n\n    const updateActiveCellCoordinates = useCallback(\n      ({\n        coords = { ...activeCellCoordinates },\n        updatedValue,\n        optOutOfSelectionAreaUpdate = false,\n      }) => {\n        const newActiveCell = {\n          ...coords,\n          ...updatedValue,\n        };\n        setActiveCellCoordinates(newActiveCell);\n        // Only run if the active cell is _not_ a header cell. This will add a point1 object\n        // to selectionAreas every time the active cell changes, allowing us to create cell\n        // selections using keyboard. Opting out of the selection area updates here means\n        // that the active cell is being moved within a selection area\n        if (\n          newActiveCell.row !== 'header' &&\n          newActiveCell.column !== 'header' &&\n          !optOutOfSelectionAreaUpdate\n        ) {\n          const tempMatcher = uuidv4();\n          setSelectionAreas([{ point1: newActiveCell, matcher: tempMatcher }]);\n          setCurrentMatcher(tempMatcher);\n        }\n      },\n      [activeCellCoordinates]\n    );\n\n    const handleHomeEndKey = useCallback(\n      ({ type }) => {\n        const coordinatesClone = { ...activeCellCoordinates };\n        updateActiveCellCoordinates({\n          coords: coordinatesClone,\n          updatedValue: {\n            column: type === 'Home' ? 0 : columns.length - 1,\n          },\n        });\n        removeCellSelections({ matcher: undefined, spreadsheetRef });\n      },\n      [\n        activeCellCoordinates,\n        updateActiveCellCoordinates,\n        spreadsheetRef,\n        columns.length,\n      ]\n    );\n\n    const checkForReturnCondition = useCallback(\n      (key) => {\n        return isEditing || key === 'Meta' || key === 'Control';\n      },\n      [isEditing]\n    );\n\n    const handleArrowKeyPress = useCallback(\n      (arrowKey) => {\n        event?.preventDefault();\n        handleInitialArrowPress();\n        const coordinatesClone = { ...activeCellCoordinates };\n\n        let updatedValue;\n\n        switch (arrowKey) {\n          // Left\n          case 'ArrowLeft': {\n            if (coordinatesClone.column === 'header') {\n              return;\n            }\n            if (typeof coordinatesClone.column === 'number') {\n              if (coordinatesClone.column === 0) {\n                updatedValue = { column: 'header' };\n              } else {\n                updatedValue = { column: coordinatesClone.column - 1 };\n              }\n            }\n            break;\n          }\n          // Up\n          case 'ArrowUp': {\n            if (coordinatesClone.row === 'header') {\n              return;\n            }\n            if (typeof coordinatesClone.row === 'number') {\n              // set row back to header if we are at index 0\n              if (coordinatesClone.row === 0) {\n                updatedValue = { row: 'header' };\n              } else {\n                // if we are at any other index than 0, subtract 1 from current row index\n                updatedValue = { row: coordinatesClone.row - 1 };\n              }\n            }\n            break;\n          }\n          // Right\n          case 'ArrowRight': {\n            if (coordinatesClone.column === 'header') {\n              updatedValue = { column: 0 };\n            }\n            if (typeof coordinatesClone.column === 'number') {\n              // Prevent active cell coordinates from updating if the active\n              // cell is in the last column, ie we can't go any further to the right\n              if (columns.length - 1 === coordinatesClone.column) {\n                return;\n              } else {\n                updatedValue = { column: coordinatesClone.column + 1 };\n              }\n            }\n            break;\n          }\n          // Down\n          case 'ArrowDown': {\n            if (coordinatesClone.row === 'header') {\n              updatedValue = { row: 0 };\n            }\n            if (typeof coordinatesClone.row === 'number') {\n              // Prevent active cell coordinates from updating if the active\n              // cell is in the last row, ie we can't go any further down since\n              // we are in the last row\n              if (rows.length - 1 === coordinatesClone.row) {\n                return;\n              } else {\n                updatedValue = { row: coordinatesClone.row + 1 };\n              }\n            }\n            break;\n          }\n        }\n        if (updatedValue) {\n          updateActiveCellCoordinates({\n            coords: coordinatesClone,\n            updatedValue,\n          });\n        }\n      },\n      [\n        handleInitialArrowPress,\n        updateActiveCellCoordinates,\n        activeCellCoordinates,\n        columns,\n        rows,\n      ]\n    );\n\n    const handleKeyPressEvent = useCallback(\n      (event) => {\n        handleKeyPress(\n          event,\n          activeCellInsideSelectionArea,\n          updateActiveCellCoordinates,\n          activeCellCoordinates,\n          removeActiveCell,\n          columns,\n          rows,\n          spreadsheetRef,\n          currentMatcher,\n          removeCellEditor,\n          selectionAreas,\n          handleHomeEndKey,\n          keysPressedList,\n          usingMac,\n          updateData,\n          checkForReturnCondition,\n          handleArrowKeyPress,\n          setSelectionAreas,\n          setSelectionAreaData,\n          setCurrentMatcher,\n          activeCellRef,\n          setActiveCellCoordinates,\n          setContainerHasFocus,\n          setActiveCellContent,\n          readOnlyTable\n        );\n      },\n      [\n        activeCellInsideSelectionArea,\n        updateActiveCellCoordinates,\n        activeCellCoordinates,\n        removeActiveCell,\n        columns,\n        rows,\n        spreadsheetRef,\n        currentMatcher,\n        removeCellEditor,\n        selectionAreas,\n        handleHomeEndKey,\n        keysPressedList,\n        usingMac,\n        updateData,\n        checkForReturnCondition,\n        handleArrowKeyPress,\n        readOnlyTable,\n      ]\n    );\n\n    const startEditMode = () => {\n      setIsEditing(true);\n      setClickAndHoldActive(false);\n      const activeCellFullData =\n        typeof activeCellCoordinates?.column === 'number' &&\n        typeof activeCellCoordinates?.row === 'number'\n          ? rows[activeCellCoordinates?.row].cells[\n              activeCellCoordinates?.column\n            ]\n          : null;\n\n      const activeCellValue =\n        activeCellFullData?.row?.cells?.[Number(activeCellCoordinates?.column)]\n          ?.value;\n\n      setCellEditorValue(activeCellValue || '');\n      if (cellEditorRulerRef?.current) {\n        cellEditorRulerRef.current.textContent = activeCellValue;\n      }\n      if (cellEditorRef?.current && activeCellRef?.current) {\n        cellEditorRef.current.style.width =\n          activeCellRef?.current?.style?.width;\n      }\n    };\n\n    // Sets the initial placement of the cell editor cursor at the end of the text area\n    // this is not done for us by default in Safari\n    useEffect(() => {\n      if (isEditing && !previousState?.isEditing) {\n        cellEditorRef?.current?.setSelectionRange(\n          Number(cellEditorRulerRef?.current?.textContent?.length),\n          Number(cellEditorRulerRef?.current?.textContent?.length)\n        );\n        cellEditorRef?.current?.focus();\n      }\n    }, [isEditing, previousState?.isEditing]);\n\n    const handleActiveCellClick = () => {\n      if (\n        activeCellCoordinates?.row === 'header' ||\n        activeCellCoordinates?.column === 'header'\n      ) {\n        const indexValue =\n          activeCellCoordinates?.row === 'header'\n            ? activeCellCoordinates?.column\n            : activeCellCoordinates?.row;\n        if (\n          activeCellCoordinates?.row === 'header' &&\n          activeCellCoordinates?.column === 'header'\n        ) {\n          return;\n        }\n        handleRowColumnHeaderClick({\n          isKeyboard: false,\n          index: Number(indexValue),\n        });\n      }\n      return;\n    };\n\n    // Mouse up on active cell\n    const handleActiveCellMouseUp = () => {\n      setClickAndHoldActive(false);\n    };\n\n    // Mouse down on active cell\n    const handleActiveCellMouseDown = () => {\n      if (\n        activeCellCoordinates?.row !== 'header' ||\n        activeCellCoordinates?.column !== 'header'\n      ) {\n        const tempMatcher = uuidv4();\n        setClickAndHoldActive(true);\n        removeCellSelections({ matcher: null, spreadsheetRef });\n        setSelectionAreas([\n          { point1: activeCellCoordinates, matcher: tempMatcher },\n        ]);\n        setCurrentMatcher(tempMatcher);\n        setSelectionAreaData([]);\n        setActiveCellInsideSelectionArea(false);\n      }\n      return;\n    };\n\n    // Go into edit mode if 'Enter' key is pressed on activeCellRef\n    const handleActiveCellKeyDown = (event) => {\n      const { key } = event;\n      if (key === 'Enter' && !activeCellInsideSelectionArea && !readOnlyTable) {\n        if (\n          activeCellCoordinates?.column !== 'header' &&\n          activeCellCoordinates?.row !== 'header'\n        ) {\n          startEditMode();\n        }\n        if (\n          activeCellCoordinates?.row === 'header' ||\n          activeCellCoordinates?.column === 'header'\n        ) {\n          handleRowColumnHeaderClick({ isKeyboard: true });\n        }\n      }\n    };\n\n    const handleRowColumnHeaderClick = ({ isKeyboard, index = -1 }) => {\n      const handleHeaderCellProps = {\n        activeCellCoordinates,\n        rows,\n        columns,\n        currentMatcher,\n        setActiveCellCoordinates,\n        setCurrentMatcher,\n        setSelectionAreas,\n        spreadsheetRef,\n        index,\n        isKeyboard,\n        setSelectionAreaData,\n        isHoldingCommandKey: null,\n        isHoldingShiftKey: null,\n      };\n      // Select an entire column\n      if (\n        activeCellCoordinates?.row === 'header' &&\n        activeCellCoordinates?.column !== 'header'\n      ) {\n        handleHeaderCellSelection({\n          type: 'column',\n          ...handleHeaderCellProps,\n        });\n      }\n      // Select an entire row\n      if (\n        activeCellCoordinates?.column === 'header' &&\n        activeCellCoordinates?.row !== 'header'\n      ) {\n        handleHeaderCellSelection({\n          type: 'row',\n          ...handleHeaderCellProps,\n        });\n      }\n      if (\n        activeCellCoordinates?.column === 'header' &&\n        activeCellCoordinates?.row === 'header'\n      ) {\n        selectAllCells({\n          ref: spreadsheetRef,\n          setCurrentMatcher,\n          setSelectionAreas,\n          rows,\n          columns,\n          activeCellCoordinates,\n          updateActiveCellCoordinates,\n        });\n      }\n    };\n\n    // Go into edit mode if double click is detected on activeCellRef\n    const handleActiveCellDoubleClick = (readOnlyTable: boolean) => {\n      if (!readOnlyTable) {\n        startEditMode();\n      }\n    };\n\n    useSpreadsheetEdit({\n      isEditing,\n      rows,\n      activeCellCoordinates,\n      activeCellRef,\n      cellEditorRef,\n      cellEditorRulerRef,\n      visibleColumns,\n      defaultColumn,\n      cellEditorValue,\n    });\n\n    // Only update if there are cell selection areas\n    // Find point object that matches currentMatcher and remove the second point\n    // because hovering over the active cell while clicking and holding should\n    // remove the previously existing selection area\n    const handleActiveCellMouseEnterCallback = useCallback(\n      (areas, clickHold) => {\n        if (!currentMatcher) {\n          return;\n        }\n        if (areas && areas.length && clickHold && currentMatcher) {\n          setSelectionAreas((prev) => {\n            const selectionAreaClone = deepCloneObject(prev);\n            const indexOfItemToUpdate = selectionAreaClone.findIndex(\n              (item) => item.matcher === currentMatcher\n            );\n            if (indexOfItemToUpdate === -1) {\n              return prev;\n            }\n            if (\n              typeof selectionAreaClone[indexOfItemToUpdate].point2 ===\n                'object' &&\n              selectionAreaClone[indexOfItemToUpdate].areaCreated\n            ) {\n              selectionAreaClone[indexOfItemToUpdate].point2 =\n                selectionAreaClone[indexOfItemToUpdate].point1;\n              selectionAreaClone[indexOfItemToUpdate].areaCreated = false;\n              setActiveCellInsideSelectionArea(false);\n              removeCellSelections({\n                matcher: currentMatcher,\n                spreadsheetRef,\n              });\n              return selectionAreaClone;\n            }\n            return prev;\n          });\n        }\n      },\n      [spreadsheetRef, currentMatcher]\n    );\n\n    const handleActiveCellMouseEnter = useCallback(() => {\n      handleActiveCellMouseEnterCallback(selectionAreas, clickAndHoldActive);\n    }, [\n      clickAndHoldActive,\n      selectionAreas,\n      handleActiveCellMouseEnterCallback,\n    ]);\n    // cspell:words rowcount colcount\n    return (\n      <div\n        {...rest}\n        {...getTableProps()}\n        {...getDevtoolsProps(componentName)}\n        className={cx(\n          blockClass,\n          className,\n          `${blockClass}--interactive-cell-element`,\n          {\n            [`${blockClass}__container-has-focus`]: containerHasFocus,\n            [`${blockClass}__${theme}`]: theme === 'dark',\n          }\n        )}\n        ref={spreadsheetRef as MutableRefObject<HTMLDivElement>}\n        role=\"grid\"\n        tabIndex={0}\n        aria-rowcount={rows?.length || 0}\n        aria-colcount={columns?.length || 0}\n        aria-label={spreadsheetAriaLabel}\n        onKeyDown={handleKeyPressEvent}\n        onFocus={() => setContainerHasFocus(true)}\n      >\n        <div ref={multiKeyTrackingRef}>\n          {/* HEADER */}\n          <DataSpreadsheetHeader\n            ref={spreadsheetRef as LegacyRef<HTMLDivElement>}\n            activeCellCoordinates={activeCellCoordinates}\n            cellSize={cellSize}\n            columns={columns}\n            currentMatcher={currentMatcher}\n            defaultColumn={defaultColumn}\n            selectedHeaderReorderActive={selectedHeaderReorderActive}\n            setSelectedHeaderReorderActive={setSelectedHeaderReorderActive}\n            headerGroups={headerGroups}\n            rows={rows}\n            scrollBarSize={scrollBarSize}\n            selectionAreas={selectionAreas}\n            setActiveCellCoordinates={setActiveCellCoordinates}\n            setSelectionAreas={setSelectionAreas}\n            setCurrentMatcher={setCurrentMatcher}\n            setSelectionAreaData={setSelectionAreaData}\n            disableColumnSwapping={disableColumnSwapping}\n            readOnlyTable={readOnlyTable}\n            totalVisibleColumns={totalVisibleColumns}\n            updateActiveCellCoordinates={updateActiveCellCoordinates}\n            setHeaderCellHoldActive={setHeaderCellHoldActive}\n            headerCellHoldActive={headerCellHoldActive}\n            visibleColumns={visibleColumns}\n            selectAllAriaLabel={selectAllAriaLabel}\n          />\n\n          {/* BODY */}\n          <DataSpreadsheetBody\n            activeCellRef={activeCellRef}\n            activeCellCoordinates={activeCellCoordinates}\n            setCurrentColumns={setCurrentColumns}\n            ref={spreadsheetRef as LegacyRef<HTMLDivElement>}\n            clickAndHoldActive={clickAndHoldActive}\n            setClickAndHoldActive={setClickAndHoldActive}\n            currentMatcher={currentMatcher}\n            setCurrentMatcher={setCurrentMatcher}\n            setContainerHasFocus={setContainerHasFocus}\n            selectedHeaderReorderActive={selectedHeaderReorderActive}\n            setSelectedHeaderReorderActive={setSelectedHeaderReorderActive}\n            selectionAreas={selectionAreas}\n            setSelectionAreas={setSelectionAreas}\n            headerGroups={headerGroups}\n            defaultColumn={defaultColumn}\n            getTableBodyProps={getTableBodyProps}\n            hasCustomRowHeader={hasCustomRowHeader}\n            onDataUpdate={onDataUpdate}\n            renderRowHeaderDirection={renderRowHeaderDirection}\n            renderRowHeader={renderRowHeader}\n            onActiveCellChange={onActiveCellChange}\n            onSelectionAreaChange={onSelectionAreaChange}\n            prepareRow={prepareRow}\n            rows={rows}\n            selectionAreaData={selectionAreaData}\n            setSelectionAreaData={setSelectionAreaData}\n            setActiveCellCoordinates={setActiveCellCoordinates}\n            scrollBarSize={scrollBarSize}\n            totalColumnsWidth={totalColumnsWidth}\n            id={id}\n            columns={columns}\n            defaultEmptyRowCount={defaultEmptyRowCount}\n            setActiveCellInsideSelectionArea={setActiveCellInsideSelectionArea}\n            totalVisibleColumns={totalVisibleColumns}\n            setHeaderCellHoldActive={setHeaderCellHoldActive}\n            setColumnOrder={setColumnOrder}\n            visibleColumns={visibleColumns}\n          />\n          <button\n            onMouseDown={handleActiveCellMouseDown}\n            onMouseUp={handleActiveCellMouseUp}\n            onClick={handleActiveCellClick}\n            onKeyDown={handleActiveCellKeyDown}\n            onDoubleClick={() => handleActiveCellDoubleClick(readOnlyTable)}\n            onMouseEnter={handleActiveCellMouseEnter}\n            ref={activeCellRef as LegacyRef<HTMLButtonElement>}\n            className={cx(\n              `${blockClass}--interactive-cell-element`,\n              `${blockClass}__active-cell--highlight`,\n              {\n                [`${blockClass}__active-cell--with-selection`]:\n                  activeCellInsideSelectionArea,\n              }\n            )}\n            type=\"button\"\n          >\n            {activeCellContent}\n          </button>\n          <textarea\n            id={`${blockClass}__cell-editor-text-area`}\n            value={cellEditorValue}\n            onKeyDown={handleEditSubmit({\n              activeCellCoordinates,\n              cellEditorRulerRef,\n              columns,\n              previousState,\n              removeCellEditor,\n              rows,\n              setActiveCellCoordinates,\n              setCurrentMatcher,\n              setSelectionAreas,\n              spreadsheetRef,\n              updateData,\n            })}\n            onChange={(event) => {\n              if (previousState.isEditing) {\n                setCellEditorValue(event.target.value);\n                if (cellEditorRulerRef?.current) {\n                  cellEditorRulerRef.current.textContent = event.target.value;\n                }\n              }\n            }}\n            ref={cellEditorRef as LegacyRef<HTMLTextAreaElement>}\n            aria-labelledby={\n              activeCellCoordinates\n                ? `${blockClass}__cell--${activeCellCoordinates?.row}--${activeCellCoordinates?.column}`\n                : ''\n            }\n            className={cx(\n              `${blockClass}__cell-editor`,\n              `${blockClass}--interactive-cell-element`,\n              `${blockClass}__cell-editor--${cellSize}`,\n              {\n                [`${blockClass}__cell-editor--active`]: isEditing,\n              }\n            )}\n          />\n          <pre\n            aria-hidden\n            ref={cellEditorRulerRef as LegacyRef<HTMLPreElement>}\n            className={`${blockClass}__cell-editor-ruler`}\n          />\n        </div>\n      </div>\n    );\n  }\n);\n\n// Return a placeholder if not released and not enabled by feature flag\n\n// The display name of the component, used by React. Note that displayName\n// is used in preference to relying on function.name.\nDataSpreadsheet.displayName = componentName;\n\n// The types and DocGen commentary for the component props,\n// in alphabetical order (for consistency).\n// See https://www.npmjs.com/package/prop-types#usage.\nDataSpreadsheet.propTypes = {\n  /**\n   * Specifies the cell height\n   */\n  cellSize: PropTypes.oneOf(['xs', 'sm', 'md', 'lg']),\n\n  /**\n   * Provide an optional class to be applied to the containing node.\n   */\n  className: PropTypes.string,\n\n  /**\n   * The data that will build the column headers\n   */\n  /**@ts-ignore */\n  columns: PropTypes.arrayOf(\n    PropTypes.shape({\n      Header: PropTypes.string,\n      accessor: PropTypes.oneOfType([PropTypes.string, PropTypes.func]),\n      Cell: PropTypes.func, // optional cell formatter\n    })\n  ),\n\n  /**\n   * The spreadsheet data that will be rendered in the body of the spreadsheet component\n   */\n  /**@ts-ignore */\n  data: PropTypes.arrayOf(PropTypes.shape),\n\n  /**\n   * Sets the number of empty rows to be created when there is no data provided\n   */\n  defaultEmptyRowCount: PropTypes.number,\n\n  /**\n   * Disable column swapping, default false\n   */\n  disableColumnSwapping: PropTypes.bool,\n\n  /**\n   * Check if spreadsheet is using custom row header component attached\n   */\n  hasCustomRowHeader: PropTypes.bool,\n\n  /**\n   * The spreadsheet id\n   */\n  id: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n\n  /**\n   * The event handler that is called when the active cell changes\n   */\n  onActiveCellChange: PropTypes.func,\n\n  /**\n   * Callback for when columns are dropped after dragged\n   */\n  onColDrag: PropTypes.func,\n\n  /**\n   * The setter fn for the data prop\n   */\n  onDataUpdate: PropTypes.func,\n\n  /**\n   * The event handler that is called when the selection area values change\n   */\n  onSelectionAreaChange: PropTypes.func,\n\n  /**\n   * Read-only table\n   */\n  readOnlyTable: PropTypes.bool,\n\n  /**\n   * Component next to numbering rows\n   */\n  renderRowHeader: PropTypes.func,\n\n  /**\n   * Component next to numbering rows\n   */\n  renderRowHeaderDirection: PropTypes.oneOf(['left', 'right']),\n  /**\n   * The aria label applied to the Select all button\n   */\n  selectAllAriaLabel: PropTypes.string.isRequired,\n\n  /**\n   * The aria label applied to the Data spreadsheet component\n   */\n  spreadsheetAriaLabel: PropTypes.string.isRequired,\n\n  /**\n   * The theme the DataSpreadsheet should use (only used to render active cell/selection area colors on dark theme)\n   */\n  theme: PropTypes.oneOf(['light', 'dark']),\n\n  /**\n   * The total number of columns to be initially visible, additional columns will be rendered and\n   * visible via horizontal scrollbar\n   */\n  totalVisibleColumns: PropTypes.number,\n\n  /* TODO: add types and DocGen for all props. */\n};\n"],"names":["useActiveElement","active","setActive","useState","handleFocusIn","useEffect","useMoveActiveCell","spreadsheetRef","activeCellCoordinates","containerHasFocus","createActiveCell","activeCellContent","isActiveHeaderCellChanged","performCreateActiveCell","useCallback","activeCellPlacementElement","shouldPlaceActiveCellInHeader","selectAllElement","useResetSpreadsheetFocus","blockClass","pkg","focusedElement","removeActiveCell","setContainerHasFocus","useSpreadsheetOutsideClick","isBlurSpreadsheet","setActiveCellCoordinates","setSelectionAreas","removeCellEditor","handleOutsideClick","event","removeCellSelections","useSpreadsheetEdit","isEditing","rows","activeCellRef","cellEditorRef","cellEditorRulerRef","visibleColumns","defaultColumn","cellEditorValue","nextIndex","setNextIndex","previousState","usePreviousValue","rulerWidth","cellEditorCurrentWidth","cellProps","activeCellLeftPosition","activeCellTopPosition","currentColumnWidth","px","prev","nextColumnWidth","startingRowPosition","totalCellEditorMaxHeight","useSpreadsheetMouseUp","currentMatcher","selectedHeaderReorderActive","setSelectedHeaderReorderActive","setClickAndHoldActive","setValidStartingPoint","validStartingPoint","ref","setHeaderCellHoldActive","setColumnOrder","selectionAreas","handleMouseUp","isHoldingColumn","selectionAreaElement","selectionAreaCloneElement","closestCell","newColumnIndex","originalColumnIndex","selectionAreaIndexArray","item","selectionAreaToMove","spreadsheetPosition","leftScrollAmount","newIndexLessThanStarting","newIndexGreater","differenceBetweenOldNewIndex","selectionAreaClone","deepCloneObject","indexOfItemToUpdate","newIndexArray","num","deleteCount","startIndex","columnIdArray","column","columnIdArrayClone","getNewColumnOrder","newColumnList","index","originalPointIndex","updatedNewIndexWithNewOrder","newCellCoords","newRelativePosition","updatedSelectionAreaPlacement","cellButton","endCellCoordinates","moveColumnIndicatorLine","clonedSelectionElement","spreadsheetCoords","closestCellCoords","indicatorLineElement","matcherId","selectionAreaOrigin","listContainer","scrollSpeed","leftEdgeThreshold","rightEdgeThreshold","clientX","left","right","leftPosition","useSpreadsheetMouseMove","headerCellHoldActive","handleMouseMove","scrollAmount","xPositionRelativeToSpreadsheet","offsetXValue","totalSpreadsheetScrollingWidth","clonedSelectionWidth","clonePlacement","getSelectionAreaPoints","area","greatestRowIndex","greatestColumnIndex","lowestRowIndex","lowestColumnIndex","createCellSelectionArea","setActiveCellInsideSelectionArea","selectionAreaVariableWidth","spreadsheetSelector","selectionAreaCellHeight","selectionAreaTotalHeight","bodyContainer","placementElement","relativePosition","selectionAreasClone","indexOfCurrentArea","checkActiveHeaderCell","headerIndex","headerType","areasCloned","activeRowIndexes","i","activeRowIndexesNoDuplicates","checkSelectedHeaderCell","items","oppositeType","minOppositeSelection","maxOppositeSelection","minSelection","maxSelection","isTrueSelectedState","getSpreadsheetWidth","type","headerGroup","scrollBarSizeValue","totalVisibleColumns","totalColumnsWidth","additionalWidth","curr","checkForHoldingKey","key","getSelectedItemIndexList","indexList","newIndex","activeCellIndex","lowestIndex","highestIndex","newIndexList","handleHeaderCellSelection","columns","setCurrentMatcher","isKeyboard","setSelectionAreaData","isHoldingCommandKey","isHoldingShiftKey","rowValue","columnValue","point1","point2","tempMatcher","uuidv4","newSelectionArea","selectionsClone","previouslyCreatedHeaderSelection","isHeaderPartOfPreviousSelection","currentSelectionArea","originalAreaIndex","newIndexValue","newPoint","setPoint1","value","setPoint2","firstSelectionArea","handleActiveCellInSelectionEnter","activeCellInsideSelectionArea","updateActiveCellCoordinates","activeCellSelectionId","activeCellIndexInSelectionAreas","selectionAreaToNavigate","coordinatesClone","nextSelectionArea","handleActiveCellInSelectionTab","rangeWithCallback","start","end","fn","handleCellDeletion","setActiveCellContent","updateData","indexOfCurrentSelectionArea","selectionAreaToEmptyContents","columnIndex","rowIndex","handleBodyCellClick","cell","rest","isValidSelectionAreaStart","activeCoordinates","handleBodyCellHover","clickAndHoldActive","cellCoordinates","handleRowHeaderClick","handleKeyPress","handleHomeEndKey","keysPressedList","usingMac","checkForReturnCondition","handleArrowKeyPress","includesShift","handleMultipleKeys","includesResourceKey","DataSpreadsheetBody","forwardRef","defaultEmptyRowCount","getTableBodyProps","headerGroups","setCurrentColumns","id","onDataUpdate","renderRowHeader","renderRowHeaderDirection","hasCustomRowHeader","prepareRow","selectionAreaData","scrollBarSize","onSelectionAreaChange","contentScrollRef","useRef","selectionChanged","rowStart","rowEnd","columnStart","columnEnd","selectionData","populateSelectionAreaCellData","cellContainer","activeCellButton","spreadsheetBodyRef","activeTargetElement","newActiveCellTopPosition","removeDuplicateSelections","uniqueAttrArray","removedSelectionAreaMatcherArr","selectorEl","top","height","width","uniqueAttrStr","handleBodyCellClickEvent","handleBodyScroll","headerRowElement","contentScrollElementRef","handleBodyCellHoverEvent","handleRowHeaderClickEvent","emptyRowData","emptyCell","header","headers","RenderEmptyRows","RenderRow","style","row","rowProps","prepareProps","React","cx","FixedSizeList","PropTypes","DataSpreadsheetHeader","cellSize","readOnlyTable","disableColumnSwapping","selectAllAriaLabel","setScrollBarSizeValue","scrollContainer","scrollBarValue","handleColumnHeaderClick","handleSelectAllClick","selectAllCells","handleHeaderMouseDown","selectionAreaToClone","clickXPosition","headerButtonCoords","lowestColumnIndexFromSelectionArea","selectionAreaCoords","updatedOffsetDifference","selectionAreaClonedElement","reorderIndicatorLine","headerProps","colProps","selectedHeader","createActiveCellFn","coords","addToHeader","contextRef","onActiveCellChange","activeCellValue","point1Element","selectionAreaCellWidth","activeElementContainer","getSizeInPixels","carbonSize","baseFontSize","getCellSize","xs","sm","md","lg","getScrollbarWidth","scrollDiv","scrollbarWidth","handleEditSubmit","updateSelectionAreaOnCellEditSubmit","submitEditChanges","prevCoords","componentName","defaults","DataSpreadsheet","className","data","onColDrag","spreadsheetAriaLabel","theme","multiKeyTrackingRef","localRef","currentColumns","pastColumns","setPastColumns","setIsEditing","setCellEditorValue","setIsActiveHeaderCellChanged","cellSizeValue","maxNumRowsCount","useMemo","useMultipleKeyTracking","getTableProps","useTable","useBlockLayout","useColumnOrder","columnId","newValue","currentHeaders","itemIndex","getNodeTextContent","activeCellHighlight","activeCellFullData","handleInitialArrowPress","updatedValue","optOutOfSelectionAreaUpdate","newActiveCell","arrowKey","handleKeyPressEvent","startEditMode","handleActiveCellClick","indexValue","handleRowColumnHeaderClick","handleActiveCellMouseUp","handleActiveCellMouseDown","handleActiveCellKeyDown","handleHeaderCellProps","handleActiveCellDoubleClick","handleActiveCellMouseEnterCallback","areas","clickHold","handleActiveCellMouseEnter","getDevtoolsProps"],"mappings":"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"}