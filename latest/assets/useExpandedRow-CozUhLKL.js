import{e as c,r as g}from"./index-BOZkNhcz.js";import{p as C,c as b}from"./settings-DqneCnpo.js";import{c as h,R as f,J as R}from"./index-Cd8snwnz.js";import{u as $}from"./useFocusRowExpander-UbaPBXPx.js";const l=`${C.prefix}--datagrid`,H=d=>s=>{var e,m;const{row:t}=s,{expandedContentHeight:p}=t,u=(n,E="")=>{var a,o;if((a=n==null?void 0:n.target)!=null&&a.closest("tr").previousElementSibling){const i=(o=n==null?void 0:n.target)==null?void 0:o.closest("tr").previousElementSibling;E==="enter"?i.classList.add(`${l}__expandable-row--hover`):i.classList.remove(`${l}__expandable-row--hover`)}},{key:r,...x}=s;return c.createElement("tr",{className:h(`${l}__expanded-row`,{[`${l}__slug--row`]:g.isValidElement((e=t==null?void 0:t.original)==null?void 0:e.slug),[`${l}__ai-label--row`]:g.isValidElement((m=t==null?void 0:t.original)==null?void 0:m.aiLabel)}),onMouseEnter:n=>u(n,"enter"),onMouseLeave:n=>u(n)},c.createElement("td",{className:`${l}__expanded-row-cell-wrapper`},c.createElement("div",{className:`${l}__expanded-row-content`,ref:n=>{n&&n.style&&p&&(n.style.height=`${p}px`)}},c.createElement(d,{key:r,...x}))))},_=`${C.prefix}--datagrid`,w=d=>{const s=g.useRef(void 0),t=g.useRef(void 0),p=r=>{s.current=r};$({instance:s==null?void 0:s.current,lastExpandedRowIndex:t==null?void 0:t.current,blockClass:_,activeElement:document.activeElement});const u=r=>[{id:"expander",Cell:({row:e})=>{const m={...e.getToggleRowExpandedProps(),onClick:o=>{var i;o.stopPropagation(),e.toggleRowExpanded(),(i=e==null?void 0:e.onClick)==null||i.call(e,e,o),t.current=e.id},title:null},{expanderButtonTitleExpanded:n,expanderButtonTitleCollapsed:E}=(s==null?void 0:s.current)||{},a=e.isExpanded?n:E;return e.canExpand&&c.createElement("button",{type:"button","aria-label":a,className:h(`${_}__row-expander`,`${b.prefix}--btn`,`${b.prefix}--btn--ghost`),...m},e.isExpanded?c.createElement(f,{className:`${_}__row-expander--icon`}):c.createElement(R,{className:`${_}__row-expander--icon`}))},width:48,disableResizing:!0,disableSortBy:!0,Header:""},...r];d.visibleColumns.push(u),d.useInstance.push(p)},B=d=>{w(d);const s=t=>{const{rows:p,expandedContentHeight:u,ExpandedRowContentComponent:r,onRowExpand:x}=t,[e,m]=g.useState({}),n=(a,o)=>m({...e,[a]:o}),E=p.map(a=>({...a,canExpand:a.original&&!a.original.notExpandable,expandedContentHeight:e[a.index]||u,RowExpansionRenderer:r&&H(r),onClick:(o,i)=>x==null?void 0:x(o,i)}));Object.assign(t,{rows:E,setExpandedRowHeight:n,withExpandedRows:!0})};d.useInstance.push(s)};export{B as u};
