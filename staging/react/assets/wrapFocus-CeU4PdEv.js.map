{"version":3,"file":"wrapFocus-CeU4PdEv.js","sources":["../../../../node_modules/@carbon/react/es/internal/keyboard/navigation.js","../../../../node_modules/@carbon/react/es/internal/wrapFocus.js"],"sourcesContent":["/**\n * Copyright IBM Corp. 2016, 2023\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { ArrowRight, ArrowLeft } from './keys.js';\nimport { match } from './match.js';\n\n/**\n * A \"ring buffer\" function that takes an array and, depending on an ArrowRight\n * or ArrowLeft key input, loops from last index to first or first index to last.\n *\n * @param key - the left or right arrow key (KeyboardEvent, number, or string)\n * @param index - the current index in the array\n * @param arrayLength - the total length of the array\n *\n * @example\n *  getNextIndex(keyCodes.RIGHT, 0, 4)\n */\nconst getNextIndex = (key, index, arrayLength) => {\n  if (match(key, ArrowRight)) {\n    return (index + 1) % arrayLength;\n  }\n  if (match(key, ArrowLeft)) {\n    return (index + arrayLength - 1) % arrayLength;\n  }\n  return;\n};\n\n/**\n * CSS selector that selects major nodes that are sequentially focusable.\n */\nconst selectorTabbable = `\n  a[href], area[href], input:not([disabled]):not([tabindex='-1']),\n  button:not([disabled]):not([tabindex='-1']),select:not([disabled]):not([tabindex='-1']),\n  textarea:not([disabled]):not([tabindex='-1']),\n  iframe, object, embed, *[tabindex]:not([tabindex='-1']):not([disabled]), *[contenteditable=true]\n`;\n\n/**\n * CSS selector that selects major nodes that are click focusable.\n */\nconst selectorFocusable = `\n  a[href], area[href], input:not([disabled]),\n  button:not([disabled]),select:not([disabled]),\n  textarea:not([disabled]),\n  iframe, object, embed, *[tabindex]:not([disabled]), *[contenteditable=true]\n`;\n\nexport { getNextIndex, selectorFocusable, selectorTabbable };\n","/**\n * Copyright IBM Corp. 2016, 2023\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { tabbable } from 'tabbable';\nimport { selectorTabbable } from './keyboard/navigation.js';\n\n/**\n * A flag `node.compareDocumentPosition(target)` returns that indicates\n * `target` is located earlier than `node` in the document or `target` contains `node`.\n */\nconst DOCUMENT_POSITION_BROAD_PRECEDING = typeof Node !== 'undefined' ? Node.DOCUMENT_POSITION_PRECEDING | Node.DOCUMENT_POSITION_CONTAINS : 0;\n\n/**\n * A flag `node.compareDocumentPosition(target)` returns that indicates\n * `target` is located later than `node` in the document or `node` contains `target`.\n */\nconst DOCUMENT_POSITION_BROAD_FOLLOWING = typeof Node !== 'undefined' ? Node.DOCUMENT_POSITION_FOLLOWING | Node.DOCUMENT_POSITION_CONTAINED_BY : 0;\n\n/**\n * Checks whether the given node or one of its ancestors matches any of the\n * specified floating menu selectors.\n *\n * @param {Node} node - A DOM node.\n * @param {string[]} selectorsFloatingMenus - Additional CSS selectors that\n * match floating menus.\n * @returns {boolean} Whether the node or one of its ancestors is in a floating\n * menu.\n */\nconst elementOrParentIsFloatingMenu = (node, selectorsFloatingMenus = [], prefix = 'cds') => {\n  if (node instanceof Element && typeof node.closest === 'function') {\n    const allSelectorsFloatingMenus = [`.${prefix}--overflow-menu-options`, `.${prefix}--tooltip`, '.flatpickr-calendar', ...selectorsFloatingMenus];\n    return allSelectorsFloatingMenus.some(selector => !!node.closest(selector));\n  }\n  return false;\n};\n\n/**\n * Ensures the focus is kept within the given container by implementing\n * \"focus-wrap\" behavior.\n */\nconst wrapFocus = ({\n  bodyNode,\n  startTrapNode,\n  endTrapNode,\n  currentActiveNode,\n  oldActiveNode,\n  selectorsFloatingMenus,\n  prefix = 'cds'\n}) => {\n  if (bodyNode && currentActiveNode && oldActiveNode && !bodyNode.contains(currentActiveNode) && !elementOrParentIsFloatingMenu(currentActiveNode, selectorsFloatingMenus, prefix)) {\n    const comparisonResult = oldActiveNode.compareDocumentPosition(currentActiveNode);\n    if (currentActiveNode === startTrapNode || comparisonResult & DOCUMENT_POSITION_BROAD_PRECEDING) {\n      const tabbableElement = Array.from(bodyNode.querySelectorAll(selectorTabbable)).reverse().find(({\n        offsetParent\n      }) => Boolean(offsetParent));\n      if (tabbableElement) {\n        tabbableElement.focus();\n      } else if (bodyNode !== oldActiveNode) {\n        bodyNode.focus();\n      }\n    } else if (currentActiveNode === endTrapNode || comparisonResult & DOCUMENT_POSITION_BROAD_FOLLOWING) {\n      const tabbableElement = Array.from(bodyNode.querySelectorAll(selectorTabbable)).find(({\n        offsetParent\n      }) => Boolean(offsetParent));\n      if (tabbableElement) {\n        tabbableElement.focus();\n      } else if (bodyNode !== oldActiveNode) {\n        bodyNode.focus();\n      }\n    }\n  }\n};\n\n/**\n * Ensures the focus is kept in the given container, implementing \"focus-wrap\"\n * behavior.\n *\n * Note: This must be called *before* focus moves using `onKeyDown` or similar.\n */\nconst wrapFocusWithoutSentinels = ({\n  containerNode,\n  currentActiveNode,\n  event\n}) => {\n  if (!containerNode) return;\n  if (['blur', 'focusout', 'focusin', 'focus'].includes(event.type) && process.env.NODE_ENV !== 'production') {\n    throw new Error(`Error: wrapFocusWithoutSentinels(...) called in unsupported ${event.type} event.\\n\\nCall wrapFocusWithoutSentinels(...) from onKeyDown instead.`);\n  }\n\n  // Use `tabbable` to get the focusable elements in tab order.\n  // `selectorTabbable` returns elements in DOM order which is why it's not\n  // used.\n  const tabbables = tabbable(containerNode);\n  const firstTabbable = tabbables[0];\n  const lastTabbable = tabbables[tabbables.length - 1];\n\n  // The shift key indicates if focus is moving forwards or backwards.\n  if (currentActiveNode === lastTabbable && !event.shiftKey) {\n    // Cancel the current movement of focus because we're going to place it ourselves\n    event.preventDefault();\n    firstTabbable.focus();\n  }\n  if (currentActiveNode === firstTabbable && event.shiftKey) {\n    // Cancel the current movement of focus because we're going to place it ourselves\n    event.preventDefault();\n    lastTabbable.focus();\n  }\n};\n\nexport { elementOrParentIsFloatingMenu, wrapFocus, wrapFocusWithoutSentinels };\n"],"names":["getNextIndex","key","index","arrayLength","match","ArrowRight","ArrowLeft","selectorTabbable","selectorFocusable","DOCUMENT_POSITION_BROAD_PRECEDING","DOCUMENT_POSITION_BROAD_FOLLOWING","elementOrParentIsFloatingMenu","node","selectorsFloatingMenus","prefix","selector","wrapFocus","bodyNode","startTrapNode","endTrapNode","currentActiveNode","oldActiveNode","comparisonResult","tabbableElement","offsetParent","wrapFocusWithoutSentinels","containerNode","event","tabbables","tabbable","firstTabbable","lastTabbable"],"mappings":"gEAqBA,MAAMA,EAAe,CAACC,EAAKC,EAAOC,IAAgB,CAChD,GAAIC,EAAMH,EAAKI,CAAU,EACvB,OAAQH,EAAQ,GAAKC,EAEvB,GAAIC,EAAMH,EAAKK,CAAS,EACtB,OAAQJ,EAAQC,EAAc,GAAKA,CAGvC,EAKMI,EAAmB;AAAA;AAAA;AAAA;AAAA;AAAA,EAUnBC,EAAoB;AAAA;AAAA;AAAA;AAAA;AAAA,EC9BpBC,EAAoC,OAAO,KAAS,IAAc,KAAK,4BAA8B,KAAK,2BAA6B,EAMvIC,EAAoC,OAAO,KAAS,IAAc,KAAK,4BAA8B,KAAK,+BAAiC,EAY3IC,EAAgC,CAACC,EAAMC,EAAyB,CAAA,EAAIC,EAAS,QAC7EF,aAAgB,SAAW,OAAOA,EAAK,SAAY,WACnB,CAAC,IAAIE,CAAM,0BAA2B,IAAIA,CAAM,YAAa,sBAAuB,GAAGD,CAAsB,EAC9G,KAAKE,GAAY,CAAC,CAACH,EAAK,QAAQG,CAAQ,CAAC,EAErE,GAOHC,EAAY,CAAC,CACjB,SAAAC,EACA,cAAAC,EACA,YAAAC,EACA,kBAAAC,EACA,cAAAC,EACA,uBAAAR,EACA,OAAAC,EAAS,KACX,IAAM,CACJ,GAAIG,GAAYG,GAAqBC,GAAiB,CAACJ,EAAS,SAASG,CAAiB,GAAK,CAACT,EAA8BS,EAAmBP,EAAwBC,CAAM,EAAG,CAChL,MAAMQ,EAAmBD,EAAc,wBAAwBD,CAAiB,EAChF,GAAIA,IAAsBF,GAAiBI,EAAmBb,EAAmC,CAC/F,MAAMc,EAAkB,MAAM,KAAKN,EAAS,iBAAiBV,CAAgB,CAAC,EAAE,UAAU,KAAK,CAAC,CAC9F,aAAAiB,CAAA,IACI,EAAQA,CAAa,EACvBD,EACFA,EAAgB,MAAA,EACPN,IAAaI,GACtBJ,EAAS,MAAA,CAEb,SAAWG,IAAsBD,GAAeG,EAAmBZ,EAAmC,CACpG,MAAMa,EAAkB,MAAM,KAAKN,EAAS,iBAAiBV,CAAgB,CAAC,EAAE,KAAK,CAAC,CACpF,aAAAiB,CAAA,IACI,EAAQA,CAAa,EACvBD,EACFA,EAAgB,MAAA,EACPN,IAAaI,GACtBJ,EAAS,MAAA,CAEb,CACF,CACF,EAQMQ,EAA4B,CAAC,CACjC,cAAAC,EACA,kBAAAN,EACA,MAAAO,CACF,IAAM,CACJ,GAAI,CAACD,EAAe,OAChB,CAAC,OAAQ,WAAY,UAAW,OAAO,EAAE,SAASC,EAAM,IAAI,EAOhE,MAAMC,EAAYC,EAASH,CAAa,EAClCI,EAAgBF,EAAU,CAAC,EAC3BG,EAAeH,EAAUA,EAAU,OAAS,CAAC,EAG/CR,IAAsBW,GAAgB,CAACJ,EAAM,WAE/CA,EAAM,eAAA,EACNG,EAAc,MAAA,GAEZV,IAAsBU,GAAiBH,EAAM,WAE/CA,EAAM,eAAA,EACNI,EAAa,MAAA,EAEjB","x_google_ignoreList":[0,1]}