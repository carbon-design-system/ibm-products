import{e as p,r as g}from"./index-DtHxqM--.js";import{p as C}from"./settings-Bzj6EGPa.js";import{d as h,b as $,ap as R,w as f}from"./index-4poXP75K.js";import{u as w}from"./useFocusRowExpander-BIwFvcb9.js";const c=`${C.prefix}--datagrid`,H=d=>s=>{var m,n;const{row:t}=s,{expandedContentHeight:u}=t,i=(e,E="")=>{var a,r;if((a=e==null?void 0:e.target)!=null&&a.closest("tr").previousElementSibling){const l=(r=e==null?void 0:e.target)==null?void 0:r.closest("tr").previousElementSibling;E==="enter"?l.classList.add(`${c}__expandable-row--hover`):l.classList.remove(`${c}__expandable-row--hover`)}},{key:x,...o}=s;return p.createElement("tr",{className:h(`${c}__expanded-row`,{[`${c}__slug--row`]:g.isValidElement((m=t==null?void 0:t.original)==null?void 0:m.slug),[`${c}__ai-label--row`]:g.isValidElement((n=t==null?void 0:t.original)==null?void 0:n.aiLabel)}),onMouseEnter:e=>i(e,"enter"),onMouseLeave:e=>i(e)},p.createElement("td",{className:`${c}__expanded-row-cell-wrapper`},p.createElement("div",{className:`${c}__expanded-row-content`,ref:e=>{e&&e.style&&u&&(e.style.height=`${u}px`)}},p.createElement(d,{key:x,...o}))))},b=`${C.prefix}--datagrid`,N=d=>{const s=g.useRef(void 0),t=g.useRef(void 0),u=o=>{s.current=o},i=$();w({instance:s==null?void 0:s.current,lastExpandedRowIndex:t==null?void 0:t.current,blockClass:b,activeElement:document.activeElement});const x=o=>[{id:"expander",Cell:({row:n})=>{const e={...n.getToggleRowExpandedProps(),onClick:l=>{var _;l.stopPropagation(),n.toggleRowExpanded(),(_=n==null?void 0:n.onClick)==null||_.call(n,n,l),t.current=n.id},title:null},{expanderButtonTitleExpanded:E,expanderButtonTitleCollapsed:a}=(s==null?void 0:s.current)||{},r=n.isExpanded?E:a;return n.canExpand&&p.createElement("button",{type:"button","aria-label":r,className:h(`${b}__row-expander`,`${i}--btn`,`${i}--btn--ghost`),...e},n.isExpanded?p.createElement(R,{className:`${b}__row-expander--icon`}):p.createElement(f,{className:`${b}__row-expander--icon`}))},width:48,disableResizing:!0,disableSortBy:!0,Header:""},...o];d.visibleColumns.push(x),d.useInstance.push(u)},B=d=>{N(d);const s=t=>{const{rows:u,expandedContentHeight:i,ExpandedRowContentComponent:x,onRowExpand:o}=t,[m,n]=g.useState({}),e=(a,r)=>n({...m,[a]:r}),E=u.map(a=>({...a,canExpand:a.original&&!a.original.notExpandable,expandedContentHeight:m[a.index]||i,RowExpansionRenderer:x&&H(x),onClick:(r,l)=>o==null?void 0:o(r,l)}));Object.assign(t,{rows:E,setExpandedRowHeight:e,withExpandedRows:!0})};d.useInstance.push(s)};export{B as u};
