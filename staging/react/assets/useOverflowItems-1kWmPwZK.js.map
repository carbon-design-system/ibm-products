{"version":3,"file":"useOverflowItems-1kWmPwZK.js","sources":["../../src/global/js/hooks/useOverflowItems/useOverflowItems.ts"],"sourcesContent":["/**\n * Copyright IBM Corp. 2025, 2025\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { RefObject, useRef, useState } from 'react';\nimport { useResizeObserver } from '../useResizeObserver';\n\ntype Item = {\n  id: string;\n};\n\nexport function useOverflowItems<T extends Item>(\n  items: T[] = [],\n  containerRef: RefObject<HTMLElement | null>,\n  offsetRef?: RefObject<HTMLElement | null>,\n  maxItems?: number,\n  onChange?: (value: {\n    hiddenItems?: T[];\n    minWidth?: number;\n    maxWidth?: number;\n  }) => void\n): {\n  visibleItems: T[];\n  itemRefHandler: (id: string, node: HTMLElement | null) => void;\n  hiddenItems: T[];\n  offsetRefHandler: (node: HTMLElement | null) => HTMLElement;\n} {\n  const [remainingWidth, setRemainingWidth] = useState(0);\n  const offsetWidthRef = useRef<number>(0);\n  const itemsRef = useRef<Map<string, number> | null>(null);\n  const visibleItemCount = useRef<number>(0);\n  const minWidthRef = useRef<number>(0);\n  const requiredWidthRef = useRef<number>(0);\n\n  const handleResize = () => {\n    if (containerRef?.current) {\n      offsetWidthRef.current = offsetRef?.current?.offsetWidth || 0;\n      const usableWidth =\n        containerRef.current.offsetWidth - offsetWidthRef.current;\n      setRemainingWidth(usableWidth);\n    }\n  };\n\n  const offsetRefHandler = (node) => {\n    if (node && containerRef?.current) {\n      offsetWidthRef.current = node.offsetWidth;\n      const usableWidth =\n        containerRef.current.offsetWidth - offsetWidthRef.current;\n      setRemainingWidth(usableWidth);\n    }\n\n    return node;\n  };\n\n  useResizeObserver(containerRef as RefObject<HTMLElement>, handleResize);\n\n  const getMap = () => {\n    if (!itemsRef.current) {\n      itemsRef.current = new Map();\n    }\n    return itemsRef.current;\n  };\n\n  const requiredWidth = items\n    ?.slice(0, maxItems)\n    ?.reduce((acc, item) => acc + (getMap().get(item.id) || 0), 0);\n\n  const itemRefHandler = (id: string, node: HTMLElement | null) => {\n    const map = getMap();\n    if (node) {\n      const style = getComputedStyle?.(node);\n      const totalWidth =\n        node.offsetWidth +\n        parseInt(style.marginLeft) +\n        parseInt(style.marginRight);\n      map.set(id, totalWidth);\n    }\n\n    return () => {\n      map.delete(id);\n    };\n  };\n\n  const getVisibleItems = () => {\n    if (!containerRef) {\n      return items;\n    }\n\n    const map = getMap();\n    let maxReached = false;\n    let accumulatedWidth = 0;\n    let includeOffset = false;\n\n    if (maxItems) {\n      includeOffset = requiredWidth + offsetWidthRef?.current > requiredWidth;\n    } else {\n      includeOffset = requiredWidth > remainingWidth + offsetWidthRef?.current;\n    }\n\n    return items.slice(0, maxItems).reduce((prev, cur) => {\n      if (maxReached) {\n        return prev;\n      }\n\n      const itemWidth = map.get(cur.id) || 0;\n      let willFit = accumulatedWidth + itemWidth <= remainingWidth;\n\n      if (!includeOffset) {\n        willFit =\n          accumulatedWidth + itemWidth <=\n          remainingWidth + offsetWidthRef?.current;\n      }\n\n      if (willFit) {\n        accumulatedWidth += itemWidth;\n        prev.push(cur);\n      } else {\n        maxReached = true;\n      }\n      return prev;\n    }, [] as T[]);\n  };\n\n  const visibleItems = getVisibleItems();\n  const hiddenItems = items.slice(visibleItems?.length);\n  // only call the change handler when the number of visible items has changed\n  if (\n    visibleItems?.length !== visibleItemCount.current ||\n    remainingWidth !== minWidthRef.current ||\n    requiredWidth !== requiredWidthRef.current\n  ) {\n    visibleItemCount.current = visibleItems?.length;\n    minWidthRef.current = remainingWidth;\n    requiredWidthRef.current = requiredWidth;\n    const firstItemKey: string = getMap()?.keys()?.next()?.value || '';\n    const firstItemWidth = getMap()?.get(firstItemKey) || 0;\n\n    onChange?.({\n      hiddenItems,\n      minWidth: remainingWidth,\n      maxWidth: requiredWidth + firstItemWidth,\n    });\n  }\n\n  return {\n    visibleItems,\n    itemRefHandler,\n    hiddenItems,\n    offsetRefHandler,\n  };\n}\n"],"names":["useOverflowItems","items","containerRef","offsetRef","maxItems","onChange","remainingWidth","setRemainingWidth","useState","offsetWidthRef","useRef","itemsRef","visibleItemCount","minWidthRef","requiredWidthRef","handleResize","usableWidth","offsetRefHandler","node","useResizeObserver","getMap","requiredWidth","acc","item","itemRefHandler","id","map","style","totalWidth","visibleItems","maxReached","accumulatedWidth","includeOffset","prev","cur","itemWidth","willFit","hiddenItems","firstItemKey","firstItemWidth"],"mappings":"6FAcO,SAASA,EACdC,EAAa,CAAA,EACbC,EACAC,EACAC,EACAC,EAUA,CACA,KAAM,CAACC,EAAgBC,CAAiB,EAAIC,EAAAA,SAAS,CAAC,EAChDC,EAAiBC,EAAAA,OAAe,CAAC,EACjCC,EAAWD,EAAAA,OAAmC,IAAI,EAClDE,EAAmBF,EAAAA,OAAe,CAAC,EACnCG,EAAcH,EAAAA,OAAe,CAAC,EAC9BI,EAAmBJ,EAAAA,OAAe,CAAC,EAEnCK,EAAe,IAAM,CACzB,GAAIb,GAAc,QAAS,CACzBO,EAAe,QAAUN,GAAW,SAAS,aAAe,EAC5D,MAAMa,EACJd,EAAa,QAAQ,YAAcO,EAAe,QACpDF,EAAkBS,CAAW,CAC/B,CACF,EAEMC,EAAoBC,GAAS,CACjC,GAAIA,GAAQhB,GAAc,QAAS,CACjCO,EAAe,QAAUS,EAAK,YAC9B,MAAMF,EACJd,EAAa,QAAQ,YAAcO,EAAe,QACpDF,EAAkBS,CAAW,CAC/B,CAEA,OAAOE,CACT,EAEAC,EAAkBjB,EAAwCa,CAAY,EAEtE,MAAMK,EAAS,KACRT,EAAS,UACZA,EAAS,YAAc,KAElBA,EAAS,SAGZU,EAAgBpB,GAClB,MAAM,EAAGG,CAAQ,GACjB,OAAO,CAACkB,EAAKC,IAASD,GAAOF,IAAS,IAAIG,EAAK,EAAE,GAAK,GAAI,CAAC,EAEzDC,EAAiB,CAACC,EAAYP,IAA6B,CAC/D,MAAMQ,EAAMN,EAAA,EACZ,GAAIF,EAAM,CACR,MAAMS,EAAQ,mBAAmBT,CAAI,EAC/BU,EACJV,EAAK,YACL,SAASS,EAAM,UAAU,EACzB,SAASA,EAAM,WAAW,EAC5BD,EAAI,IAAID,EAAIG,CAAU,CACxB,CAEA,MAAO,IAAM,CACXF,EAAI,OAAOD,CAAE,CACf,CACF,EA0CMI,GAxCkB,IAAM,CAC5B,GAAI,CAAC3B,EACH,OAAOD,EAGT,MAAMyB,EAAMN,EAAA,EACZ,IAAIU,EAAa,GACbC,EAAmB,EACnBC,EAAgB,GAEpB,OAAI5B,EACF4B,EAAgBX,EAAgBZ,GAAgB,QAAUY,EAE1DW,EAAgBX,EAAgBf,EAAiBG,GAAgB,QAG5DR,EAAM,MAAM,EAAGG,CAAQ,EAAE,OAAO,CAAC6B,EAAMC,IAAQ,CACpD,GAAIJ,EACF,OAAOG,EAGT,MAAME,EAAYT,EAAI,IAAIQ,EAAI,EAAE,GAAK,EACrC,IAAIE,EAAUL,EAAmBI,GAAa7B,EAE9C,OAAK0B,IACHI,EACEL,EAAmBI,GACnB7B,EAAiBG,GAAgB,SAGjC2B,GACFL,GAAoBI,EACpBF,EAAK,KAAKC,CAAG,GAEbJ,EAAa,GAERG,CACT,EAAG,CAAA,CAAS,CACd,GAEqB,EACfI,EAAcpC,EAAM,MAAM4B,GAAc,MAAM,EAEpD,GACEA,GAAc,SAAWjB,EAAiB,SAC1CN,IAAmBO,EAAY,SAC/BQ,IAAkBP,EAAiB,QACnC,CACAF,EAAiB,QAAUiB,GAAc,OACzChB,EAAY,QAAUP,EACtBQ,EAAiB,QAAUO,EAC3B,MAAMiB,EAAuBlB,KAAU,QAAQ,KAAA,GAAQ,OAAS,GAC1DmB,EAAiBnB,EAAA,GAAU,IAAIkB,CAAY,GAAK,EAEtDjC,IAAW,CACT,YAAAgC,EACA,SAAU/B,EACV,SAAUe,EAAgBkB,CAAA,CAC3B,CACH,CAEA,MAAO,CACL,aAAAV,EACA,eAAAL,EACA,YAAAa,EACA,iBAAApB,CAAA,CAEJ"}