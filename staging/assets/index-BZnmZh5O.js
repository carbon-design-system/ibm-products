import{e as r,r as X}from"./index-CPiZ6Cnx.js";import{u as Q,a as ae,f as ce,g as ue,d as fe,b as pe,c as P,_ as K,P as t,a6 as i,j as de,T as he,R as me,a5 as ee,a8 as ge,y as Y,D as be,A as ye,B as Oe,Z as we,E as ve,i as G}from"./index-BPCFiO9b.js";import{I as te,n as T}from"./settings-41bnSjHp.js";import{b as _e,a as Ce}from"./useAttachedMenu-CqlpaYyp.js";import{m as ne}from"./mergeRefs-CTUecegF.js";import{d as Me}from"./index-H2wBg9na.js";import{c as oe}from"./bucket-12-6vZmyEHs.js";import{G as Ee}from"./index-B83en7q5.js";import{c as S,g as Re}from"./_commonjsHelpers-BosuxZz1.js";import{s as Te,a as Ie,w as Pe,b as xe}from"./wrapFocus-Dfrp1CCV.js";import{c as Fe}from"./createClassWrapper-CfmfodUV.js";const H="md",$e=c=>({"top-left":"top-start","top-right":"top-end","bottom-left":"bottom-start","bottom-right":"bottom-end","left-bottom":"left-end","left-top":"left-start","right-bottom":"right-end","right-top":"right-start"})[c],se=r.forwardRef(function(e,n){let{autoAlign:o=!1,children:s,className:u,label:a="Options",renderIcon:l=oe,size:d=H,menuAlignment:h="bottom-start",tooltipAlignment:v,menuTarget:w,...b}=e;const p=Q("enable-v12-dynamic-floating-styles")||o,{refs:f,floatingStyles:y,placement:_,middlewareData:C}=ae(p?{placement:h,strategy:"fixed",middleware:[o&&ue({fallbackPlacements:h.includes("bottom")?["bottom-start","bottom-end","top-start","top-end"]:["top-start","top-end","bottom-start","bottom-end"]})],whileElementsMounted:ce}:{}),O=fe("overflowmenu"),m=pe(),g=X.useRef(null),{open:M,x:E,y:z,handleClick:A,handleMousedown:L,handleClose:W}=_e(g);X.useEffect(()=>{p&&Object.keys(y).forEach($=>{f.floating.current&&(f.floating.current.style[$]=y[$])})},[y,p,f.floating,M,_,C]);function x(){g.current&&A()}const j=P(u,`${m}--overflow-menu__container`,{[`${m}--autoalign`]:p}),V=P(`${m}--overflow-menu__${h}`),q=P(`${m}--overflow-menu`,{[`${m}--overflow-menu--open`]:M},d!==H&&`${m}--overflow-menu--${d}`),F=ne(g,f.setReference);return r.createElement("div",K({},b,{className:j,"aria-owns":M?O:void 0,ref:n}),r.createElement(te,{"aria-controls":M?O:void 0,"aria-haspopup":!0,"aria-expanded":M,className:q,onClick:x,onMouseDown:L,ref:F,label:a,align:v,kind:"ghost"},r.createElement(l,{className:`${m}--overflow-menu__icon`})),r.createElement(Ce,{containerRef:g,ref:f.setFloating,menuAlignment:h,className:V,id:O,size:d,legacyAutoalign:!p,open:M,onClose:W,x:E,y:z,label:a,target:w},s))});se.propTypes={autoAlign:t.bool,children:t.node,className:t.string,label:t.string,menuAlignment:t.oneOf(["top-start","top-end","bottom-start","bottom-end"]),renderIcon:t.oneOfType([t.func,t.object]),size:t.oneOf(["sm","md","lg"]),tooltipAlignment:Me(t.oneOf(["top","top-left","top-right","bottom","bottom-left","bottom-right","left","left-bottom","left-top","right","right-bottom","right-top","top-start","top-end","bottom-start","bottom-end","left-end","left-start","right-end","right-start"]),["top","top-start","top-end","bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end"],$e),menuTarget:t.instanceOf(typeof Element<"u"?Element:Object)};var k,Z;function De(){return Z||(Z=1,k=typeof self=="object"&&self.self===self&&self||typeof S=="object"&&S.global===S&&S||k),k}var Se=De();const I=Re(Se),ke=function(){const e=[];let n=!1;function o(){e.forEach(a=>{a()}),n=!1}function s(){n||(n=!0,I.requestAnimationFrame(o))}function u(a){a&&e.indexOf(a)<0&&e.push(a)}return{add:a=>(e.length||I.addEventListener("resize",s),u(a),{release(){const l=e.indexOf(a);l>=0&&e.splice(l,1)}})}}();var Be=ke;const ie="left",B="top",re="right",R="bottom",Ne=function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return typeof c!=typeof e?!0:Object(e)===e&&typeof e!="function"?c.top!==e.top||c.left!==e.left:c!==e},ze=c=>{let{menuSize:e,refPosition:n={},offset:o={},direction:s=R,scrollX:u=0,scrollY:a=0,container:l}=c;const{left:d=0,top:h=0,right:v=0,bottom:w=0}=n,b=l.position!=="static"?0:u,p=l.position!=="static"?0:a,f={top:l.position!=="static"?l.rect.top:0,left:l.position!=="static"?l.rect.left:0},{width:y,height:_}=e,{top:C=0,left:O=0}=o,m=(d+v)/2,g=(h+w)/2;return{[ie]:()=>({left:d-y+b-O-f.left,top:g-_/2+p+C-9-f.top}),[B]:()=>({left:m-y/2+b+O-f.left,top:h-_+p-C-f.top}),[re]:()=>({left:v+b+O-f.left,top:g-_/2+p+C+3-f.top}),[R]:()=>({left:m-y/2+b+O-f.left,top:w+p+C-f.top})}[s]()};class U extends r.Component{constructor(){var e;super(...arguments),e=this,i(this,"_placeInProgress",!1),i(this,"state",{floatingPosition:void 0}),i(this,"_menuContainer",null),i(this,"_menuBody",null),i(this,"startSentinel",r.createRef()),i(this,"endSentinel",r.createRef()),i(this,"_updateMenuSize",function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const s=e._menuBody;if(!s)return;const{menuOffset:u={},menuDirection:a}=n,{menuOffset:l={},menuDirection:d=R}=e.props;if(Ne(u,l)||a!==d||o){const{flipped:h,triggerRef:v,updateOrientation:w=null}=e.props,{current:b}=v,p=s.getBoundingClientRect(),f=b&&b.getBoundingClientRect(),y=typeof l!="function"?l:l(s,d,b,h);w&&w({menuSize:p,refPosition:f,direction:d,offset:y,scrollX:I.pageXOffset,scrollY:I.pageYOffset,container:{rect:e.props.target().getBoundingClientRect(),position:getComputedStyle(e.props.target()).position}}),(p.width>0&&p.height>0||!y)&&e.setState({floatingPosition:ze({menuSize:p,refPosition:f,direction:d,offset:y,scrollX:I.pageXOffset,scrollY:I.pageYOffset,container:{rect:e.props.target().getBoundingClientRect(),position:getComputedStyle(e.props.target()).position}})},()=>{o||s.getBoundingClientRect()!==p&&e._updateMenuSize(e.props,!0)})}}),i(this,"_focusMenuContent",n=>{const o=n.querySelector(this.props.selectorPrimaryFocus||null),s=n.querySelector(Te),u=n.querySelector(Ie);(o||s||u||n).focus()}),i(this,"_menuRef",n=>{const{menuRef:o}=this.props;this._placeInProgress=!!n,o&&o(this._menuBody=n),n&&this._updateMenuSize()}),i(this,"_getChildrenWithProps",()=>{const{styles:n,children:o}=this.props,{floatingPosition:s}=this.state,u=s?{left:`${s.left}px`,top:`${s.top}px`,right:"auto"}:{visibility:"hidden",top:"0px"};return r.cloneElement(o,{ref:this._menuRef,style:{...n,...u,position:"absolute",opacity:1}})}),i(this,"handleBlur",n=>{let{target:o,relatedTarget:s}=n;if(s&&o){const{current:u}=this.startSentinel,{current:a}=this.endSentinel;Pe({bodyNode:this._menuBody,currentActiveNode:s,oldActiveNode:o})}}),i(this,"handleKeyDown",n=>{de(n,he)&&this._menuBody&&xe({containerNode:this._menuBody,currentActiveNode:n.target,event:n})})}componentWillUnmount(){this.hResize.release()}componentDidMount(){this.hResize=Be.add(()=>{this._updateMenuSize()})}componentDidUpdate(e){this._updateMenuSize(e);const{onPlace:n}=this.props;this._placeInProgress&&this.state.floatingPosition&&(this._menuBody&&!this._menuBody.contains(document.activeElement)&&this._focusMenuContent(this._menuBody),typeof n=="function"&&(n(this._menuBody),this._placeInProgress=!1))}render(){const{context:e}=this,n=me("enable-experimental-focus-wrap-without-sentinels");if(typeof document<"u"){const{focusTrap:o,target:s}=this.props;return Ee.createPortal(r.createElement("div",{onBlur:o&&!n?this.handleBlur:()=>{},onKeyDown:n?this.handleKeyDown:()=>{}},!n&&r.createElement("span",{ref:this.startSentinel,tabIndex:"0",role:"link",className:`${e}--visually-hidden`},"Focus sentinel"),this._getChildrenWithProps(),!n&&r.createElement("span",{ref:this.endSentinel,tabIndex:"0",role:"link",className:`${e}--visually-hidden`},"Focus sentinel")),s?s():document.body)}return null}}i(U,"contextType",ee);i(U,"propTypes",{children:t.object,flipped:t.bool,focusTrap:t.bool,menuDirection:t.oneOf([ie,B,re,R]),menuOffset:t.oneOfType([t.shape({top:t.number,left:t.number}),t.func]),menuRef:t.func,onPlace:t.func,selectorPrimaryFocus:t.string,styles:t.object,target:t.func,triggerRef:t.oneOfType([t.func,t.shape({current:t.any})]),updateOrientation:t.func});var Ae=U;class D extends r.Component{static getEventTarget(e){return e.composed&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target}constructor(e){super(e),this.handleRef=this.handleRef.bind(this),this.handleDocumentClick=this.handleDocumentClick.bind(this)}componentDidMount(){document.addEventListener("click",this.handleDocumentClick)}componentWillUnmount(){document.removeEventListener("click",this.handleDocumentClick)}handleDocumentClick(e){this.element&&this.element.contains&&!this.element.contains(D.getEventTarget(e))&&this.props.onClickOutside(e)}handleRef(e){const{children:n}=this.props;this.element=e,n.ref&&typeof n.ref=="function"&&n.ref(e)}render(){return r.cloneElement(this.props.children,{ref:this.handleRef})}}i(D,"propTypes",{children:t.element.isRequired,onClickOutside:t.func.isRequired});const Le=ge(),We=function(c){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];return c.addEventListener(...n),{release(){return c.removeEventListener(...n),null}}},je={[B]:"bottom",[R]:"top"},J=(c,e,n,o)=>{const s=je[e],{offsetWidth:u,offsetHeight:a}=c;switch(s){case"top":case"bottom":{const l=n?n.offsetWidth:0;return{left:(o?-1:1)*(u/2-l/2),top:0}}}};let N=class extends r.Component{constructor(){super(...arguments),i(this,"state",{open:!1,hasMountedTrigger:!1,click:!1}),i(this,"instanceId",Le()),i(this,"_hFocusIn",null),i(this,"_hBlurTimeout",void 0),i(this,"_triggerRef",r.createRef()),i(this,"handleClick",e=>{const{onClick:n=T}=this.props;this.setState({click:!0}),(!this._menuBody||!this._menuBody.contains(e.target))&&(this.setState({open:!this.state.open}),n(e))}),i(this,"closeMenuAndFocus",()=>{const e=this.state.click,n=this.state.open;this.closeMenu(()=>{n&&!e&&this.focusMenuEl()})}),i(this,"closeMenuOnEscape",()=>{const e=this.state.open;this.closeMenu(()=>{e&&this.focusMenuEl()})}),i(this,"handleKeyPress",e=>{this.state.open&&Y(e,[be,ye,Oe,we])&&e.preventDefault(),Y(e,[ve])&&(this.closeMenuOnEscape(),e.stopPropagation())}),i(this,"handleClickOutside",e=>{this.state.open&&(!this._menuBody||!this._menuBody.contains(e.target))&&this.closeMenu()}),i(this,"closeMenu",e=>{const{onClose:n=T}=this.props;this.setState({open:!1},()=>{e&&e(),n()})}),i(this,"focusMenuEl",()=>{const{current:e}=this._triggerRef;e&&e.focus()}),i(this,"handleOverflowMenuItemFocus",e=>{let{currentIndex:n,direction:o}=e;const s=r.Children.toArray(this.props.children).reduce((l,d,h)=>(r.isValidElement(d)&&!d.props.disabled&&l.push(h),l),[]),u=(()=>{const l=s.indexOf(n)+o;switch(l){case-1:return s.length-1;case s.length:return 0;default:return l}})(),a=this[`overflowMenuItem${s[u]}`];a==null||a.focus()}),i(this,"_menuBody",null),i(this,"_bindMenuBody",e=>{e||(this._menuBody=e),!e&&this._hFocusIn&&(this._hFocusIn=this._hFocusIn.release())}),i(this,"_handlePlace",e=>{const{onOpen:n=T}=this.props;if(e){this._menuBody=e;const o="onfocusin"in window,s=o?"focusin":"focus";this._hFocusIn=We(e.ownerDocument,s,u=>{const a=D.getEventTarget(u),{current:l}=this._triggerRef;typeof a.matches=="function"&&!e.contains(a)&&l&&!a.matches(`.${this.context}--overflow-menu:first-child,.${this.context}--overflow-menu-options:first-child`)&&this.closeMenuAndFocus()},!o),n()}}),i(this,"_getTarget",()=>{const{current:e}=this._triggerRef;return e instanceof Element&&e.closest("[data-floating-menu-container]")||document.body})}componentDidUpdate(e,n){const{onClose:o=T}=this.props;!this.state.open&&n.open&&o()}componentDidMount(){this._triggerRef.current&&this.setState({hasMountedTrigger:!0})}static getDerivedStateFromProps(e,n){let{open:o}=e;const{prevOpen:s}=n;return s===o?null:{open:o,prevOpen:o}}componentWillUnmount(){typeof this._hBlurTimeout=="number"&&(clearTimeout(this._hBlurTimeout),this._hBlurTimeout=void 0)}render(){const e=this.context,{id:n,["aria-label"]:o=null,ariaLabel:s,children:u,iconDescription:a="Options",direction:l=R,flipped:d=!1,focusTrap:h=!0,menuOffset:v=J,menuOffsetFlip:w=J,iconClass:b,onClick:p=T,onOpen:f=T,selectorPrimaryFocus:y="[data-floating-menu-primary-focus]",renderIcon:_=oe,innerRef:C,menuOptionsClass:O,light:m,size:g="md",...M}=this.props,{open:E=!1}=this.state,z=P(this.props.className,`${e}--overflow-menu`,{[`${e}--overflow-menu--open`]:E,[`${e}--overflow-menu--light`]:m,[`${e}--overflow-menu--${g}`]:g}),A=P(O,`${e}--overflow-menu-options`,{[`${e}--overflow-menu--flip`]:this.props.flipped,[`${e}--overflow-menu-options--open`]:E,[`${e}--overflow-menu-options--light`]:m,[`${e}--overflow-menu-options--${g}`]:g}),L=P(`${e}--overflow-menu__icon`,b),W=r.Children.toArray(u).map((F,$)=>r.isValidElement(F)?r.cloneElement(F,{closeMenu:F.props.closeMenu||this.closeMenuAndFocus,handleOverflowMenuItemFocus:this.handleOverflowMenuItemFocus,ref:le=>{this[`overflowMenuItem${$}`]=le},index:$}):null),x=`overflow-menu-${this.instanceId}__menu-body`,j=r.createElement("ul",{className:A,tabIndex:-1,role:"menu","aria-label":o||s,onKeyDown:this.handleKeyPress,id:x},W),V=r.createElement(Ae,{focusTrap:h,triggerRef:this._triggerRef,menuDirection:l,menuOffset:d?w:v,menuRef:this._bindMenuBody,flipped:this.props.flipped,target:this._getTarget,onPlace:this._handlePlace,selectorPrimaryFocus:this.props.selectorPrimaryFocus},r.cloneElement(j,{"data-floating-menu-direction":l})),q={className:L,"aria-label":a};return r.createElement(D,{onClickOutside:this.handleClickOutside},r.createElement("span",{className:`${e}--overflow-menu__wrapper`,"aria-owns":E?x:void 0},r.createElement(te,K({},M,{type:"button","aria-haspopup":!0,"aria-expanded":E,"aria-controls":E?x:void 0,className:z,onClick:this.handleClick,id:n,ref:ne(this._triggerRef,C),size:g,label:a,kind:"ghost"}),r.createElement(_,q)),E&&this.state.hasMountedTrigger&&V))}};i(N,"propTypes",{"aria-label":t.string,ariaLabel:G(t.string),children:t.node,className:t.string,direction:t.oneOf([B,R]),flipped:t.bool,focusTrap:t.bool,iconClass:t.string,iconDescription:t.string,id:t.string,light:G(t.bool),menuOffset:t.oneOfType([t.shape({top:t.number,left:t.number}),t.func]),menuOffsetFlip:t.oneOfType([t.shape({top:t.number,left:t.number}),t.func]),menuOptionsClass:t.string,onClick:t.func,onClose:t.func,onFocus:t.func,onKeyDown:t.func,onOpen:t.func,open:t.bool,renderIcon:t.oneOfType([t.func,t.object]),selectorPrimaryFocus:t.string,size:t.oneOf(["sm","md","lg"])});i(N,"contextType",ee);(()=>{const c=(e,n)=>r.createElement(N,K({},e,{innerRef:n}));return c.displayName="OverflowMenu",r.forwardRef(c)})();const Ve=Fe(N);function qe(c){return Q("enable-v12-overflowmenu")?r.createElement(se,c):r.createElement(Ve,c)}qe.displayName="OverflowMenu";export{qe as O};
