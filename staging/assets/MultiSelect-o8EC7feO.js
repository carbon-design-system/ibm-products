import{P as s,a2 as D,b as dt,d as ut,u as ft,a as pt,f as mt,s as ht,h as gt,g as It,i as P,c as j,_ as Z,e as _e,Z as Ee,E as xt,S as yt,x as St,t as bt}from"./index-CXyjPnaX.js";import{u as Ae,L as z,a as vt}from"./index-DoQB7l6P.js";import{g as wt}from"./_commonjsHelpers-BosuxZz1.js";import{r as m,e as f}from"./index-CPiZ6Cnx.js";import{m as Ct}from"./mergeRefs-CTUecegF.js";import{F as _t}from"./FormContext-CgeSXHS1.js";import{C as Et}from"./Checkbox-UQpZ5X10.js";import{n as $t}from"./settings-iwZeeh4T.js";import{W as Tt,a as At}from"./bucket-18-By6NmkK1.js";var ne,$e;function Ot(){if($e)return ne;$e=1;var c=typeof Element<"u",p=typeof Map=="function",o=typeof Set=="function",d=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function u(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var a,l,g;if(Array.isArray(t)){if(a=t.length,a!=n.length)return!1;for(l=a;l--!==0;)if(!u(t[l],n[l]))return!1;return!0}var S;if(p&&t instanceof Map&&n instanceof Map){if(t.size!==n.size)return!1;for(S=t.entries();!(l=S.next()).done;)if(!n.has(l.value[0]))return!1;for(S=t.entries();!(l=S.next()).done;)if(!u(l.value[1],n.get(l.value[0])))return!1;return!0}if(o&&t instanceof Set&&n instanceof Set){if(t.size!==n.size)return!1;for(S=t.entries();!(l=S.next()).done;)if(!n.has(l.value[0]))return!1;return!0}if(d&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(n)){if(a=t.length,a!=n.length)return!1;for(l=a;l--!==0;)if(t[l]!==n[l])return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof n.valueOf=="function")return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof n.toString=="function")return t.toString()===n.toString();if(g=Object.keys(t),a=g.length,a!==Object.keys(n).length)return!1;for(l=a;l--!==0;)if(!Object.prototype.hasOwnProperty.call(n,g[l]))return!1;if(c&&t instanceof Element)return!1;for(l=a;l--!==0;)if(!((g[l]==="_owner"||g[l]==="__v"||g[l]==="__o")&&t.$$typeof)&&!u(t[g[l]],n[g[l]]))return!1;return!0}return t!==t&&n!==n}return ne=function(n,a){try{return u(n,a)}catch(l){if((l.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw l}},ne}var Ft=Ot();const se=wt(Ft),Mt={compareItems:s.func,sortItems:s.func},Pt=(c,p,o)=>{let{locale:d}=o;return c.localeCompare(p,d,{numeric:!0})},Dt=(c,p)=>{let{selectedItems:o=[],itemToString:d,compareItems:u,locale:t="en"}=p;return c.sort((n,a)=>{if(n.isSelectAll)return-1;if(a.isSelectAll)return 1;const l=o.includes(n),g=o.includes(a);return l&&!g?-1:g&&!l?1:u(d(n),d(a),{locale:t})})};function Te(c){let{isControlled:p,isMounted:o,onChangeHandlerControlled:d,onChangeHandlerUncontrolled:u,selectedItems:t}=c;p?o&&d&&d({selectedItems:t}):u(t)}function Bt(c){let{disabled:p,onChange:o,initialSelectedItems:d=[],selectedItems:u,selectAll:t=!1,filteredItems:n=[]}=c;const a=m.useRef(!1),l=m.useRef(o),[g,S]=m.useState(d),x=!!u,b=x?u:g,H=m.useCallback(h=>{if(p)return;const L=n.filter(_=>!_.disabled),J=n.filter(_=>_.disabled).length;let v;if(h&&h.isSelectAll&&b.length>0)v=[];else if(h&&h.isSelectAll&&b.length==0)v=L;else{let _;b.forEach((B,Q)=>{se(B,h)&&(_=Q)}),_===void 0?(v=b.concat(h),t&&n.length-1===v.length+J&&(v=L)):(v=Oe(b,_),v=v.filter(B=>!B.isSelectAll))}Te({isControlled:x,isMounted:a.current,onChangeHandlerControlled:l.current,onChangeHandlerUncontrolled:S,selectedItems:v})},[p,b,n,t,x]),G=m.useCallback(()=>{p||Te({isControlled:x,isMounted:a.current,onChangeHandlerControlled:l.current,onChangeHandlerUncontrolled:S,selectedItems:[]})},[p,x]);return m.useEffect(()=>{l.current=o},[o]),m.useEffect(()=>{a.current&&l.current&&!x&&l.current({selectedItems:b})},[x,b]),m.useEffect(()=>(a.current=!0,()=>{a.current=!1}),[]),{selectedItems:b,onItemChange:H,clearSelection:G}}class Nt extends f.Component{constructor(p){super(p),D(this,"internalSetState",(o,d)=>this.setState(o,()=>{d&&d(),this.props.onChange&&this.props.onChange(this.state)})),D(this,"handleClearSelection",()=>{this.props.disabled||this.internalSetState({selectedItems:[]})}),D(this,"handleSelectItem",o=>{this.internalSetState(d=>({selectedItems:d.selectedItems.concat(o)}))}),D(this,"handleRemoveItem",o=>{this.internalSetState(d=>({selectedItems:Oe(d.selectedItems,o)}))}),D(this,"handleOnItemChange",o=>{if(this.props.disabled)return;const{selectedItems:d}=this.state;let u;if(d.forEach((t,n)=>{se(t,o)&&(u=n)}),u===void 0){this.handleSelectItem(o);return}this.handleRemoveItem(u)}),this.state={selectedItems:p.initialSelectedItems}}render(){const{children:p,render:o}=this.props,{selectedItems:d}=this.state,u={selectedItems:d,onItemChange:this.handleOnItemChange,clearSelection:this.handleClearSelection};return o!==void 0?o(u):p!==void 0?p(u):null}}D(Nt,"propTypes",{children:s.func,disabled:s.bool,initialSelectedItems:s.array.isRequired,onChange:s.func,render:s.func});const Oe=(c,p)=>{const o=c.slice();return o.splice(p,1),o},{ItemClick:Rt,ToggleButtonBlur:kt,ToggleButtonKeyDownArrowDown:jt,ToggleButtonKeyDownArrowUp:zt,ToggleButtonKeyDownEnter:Ht,ToggleButtonKeyDownEscape:Lt,ToggleButtonKeyDownSpaceButton:Kt,ItemMouseMove:qt,MenuMouseLeave:Wt,ToggleButtonClick:Ut,ToggleButtonKeyDownPageDown:Vt,ToggleButtonKeyDownPageUp:Zt,FunctionSetHighlightedIndex:Gt}=Ae.stateChangeTypes,Jt=c=>typeof c=="string"?c:typeof c=="number"?`${c}`:c!==null&&typeof c=="object"&&"label"in c&&typeof c.label=="string"?c.label:"",Fe=f.forwardRef((c,p)=>{var Ce;let{autoAlign:o=!1,className:d,decorator:u,id:t,items:n,itemToElement:a,itemToString:l=Jt,titleText:g=!1,hideLabel:S,helperText:x,label:b,type:H="default",size:G,disabled:h=!1,initialSelectedItems:L=[],sortItems:J=Dt,compareItems:v=Pt,clearSelectionText:_="To clear selection, press Delete or Backspace",clearAnnouncement:B="all items have been cleared",clearSelectionDescription:Q="Total items selected: ",light:Me,invalid:w,invalidText:Pe,warn:K,warnText:De,useTitleInItem:Be,translateWithId:le,downshiftProps:Ne,open:O=!1,selectionFeedback:re="top-after-reopen",onChange:Re,onMenuChange:oe,direction:ie="bottom",selectedItems:ae,readOnly:N,locale:ke="en",slug:q}=c;const R=m.useMemo(()=>n.filter(e=>{if(typeof e=="object"&&e!==null){for(const I in e)if(Object.hasOwn(e,I)&&e[I]===void 0)return!1}return!0}),[n]);let k=R.some(e=>e.isSelectAll);(ae??[]).length>0&&k&&(console.warn("Warning: `selectAll` should not be used when `selectedItems` is provided. Please pass either `selectAll` or `selectedItems`, not both."),k=!1);const r=dt(),{isFluid:W}=m.useContext(_t),ce=ut(),[je,de]=m.useState(!1),[ue,fe]=m.useState(!1),[C,ze]=m.useState(O||!1),[He,Le]=m.useState(O),[Ke,qe]=m.useState([]),[We,pe]=m.useState(!1),$=ft("enable-v12-dynamic-floating-styles")||o,{refs:F,floatingStyles:me,middlewareData:he}=pt($?{placement:ie,strategy:"fixed",middleware:[o&&mt({crossAxis:!1}),ht({apply(e){let{rects:I,elements:i}=e;Object.assign(i.floating.style,{width:`${I.reference.width}px`})}}),o&&gt()],whileElementsMounted:It}:{});m.useLayoutEffect(()=>{var e;if($){const I={...me,visibility:(e=he.hide)!=null&&e.referenceHidden?"hidden":"visible"};Object.keys(I).forEach(i=>{F.floating.current&&(F.floating.current.style[i]=I[i])})}},[$,me,F.floating,he,O]);const{selectedItems:U,onItemChange:ge,clearSelection:Ie}=Bt({disabled:h,initialSelectedItems:L,onChange:Re,selectedItems:ae,selectAll:k,filteredItems:R}),X={selectedItems:U,itemToString:l,compareItems:v,locale:ke},Ue={stateReducer:lt,isOpen:C,itemToString:e=>Array.isArray(e)&&e.map(function(I){return l(I)}).join(", ")||"",selectedItem:U,items:R,isItemDisabled(e,I){return e==null?void 0:e.disabled},...Ne},{getToggleButtonProps:Ve,getLabelProps:Ze,getMenuProps:xe,getItemProps:Ge,selectedItem:Je,highlightedIndex:Qe,setHighlightedIndex:ye}=Ae(Ue),Se=Ve({onFocus:()=>{fe(!0)},onBlur:()=>{fe(!1)},onKeyDown:e=>{h||((P(e,Ee)||P(e,xt))&&!C&&(Ie(),e.stopPropagation()),!C&&P(e,Ee)&&y.length>0&&pe(!0),(P(e,yt)||P(e,St)||P(e,bt))&&!C&&(ye(0),pe(!1),V(!0)))}}),Y=Ct(Se.ref,p),y=Je,V=e=>{ze(e),oe&&oe(e)};He!==O&&(V(O),Le(O));const T=H==="inline",be=!w&&K,Xe=j(`${r}--multi-select__wrapper`,`${r}--list-box__wrapper`,d,{[`${r}--multi-select__wrapper--inline`]:T,[`${r}--list-box__wrapper--inline`]:T,[`${r}--multi-select__wrapper--inline--invalid`]:T&&w,[`${r}--list-box__wrapper--inline--invalid`]:T&&w,[`${r}--list-box__wrapper--fluid--invalid`]:W&&w,[`${r}--list-box__wrapper--fluid--focus`]:!C&&W&&je,[`${r}--list-box__wrapper--slug`]:q,[`${r}--list-box__wrapper--decorator`]:u}),Ye=j(`${r}--label`,{[`${r}--label--disabled`]:h,[`${r}--visually-hidden`]:S}),ve=x?`multiselect-helper-text-${ce}`:void 0,et=`multiselect-field-label-${ce}`,tt=j(`${r}--form__helper-text`,{[`${r}--form__helper-text--disabled`]:h}),nt=j(`${r}--multi-select`,{[`${r}--multi-select--invalid`]:w,[`${r}--multi-select--invalid--focused`]:w&&ue,[`${r}--multi-select--warning`]:be,[`${r}--multi-select--inline`]:T,[`${r}--multi-select--selected`]:y&&y.length>0,[`${r}--list-box--up`]:ie==="top",[`${r}--multi-select--readonly`]:N,[`${r}--autoalign`]:$,[`${r}--multi-select--selectall`]:k}),st=a;re==="fixed"?X.selectedItems=[]:re==="top-after-reopen"&&(X.selectedItems=Ke);function lt(e,I){const{changes:i,props:ee,type:A}=I,{highlightedIndex:E}=i;switch(i.isOpen&&!C&&qe(U),A){case Kt:case Ht:if(i.selectedItem===void 0||Array.isArray(i.selectedItem))break;return ge(i.selectedItem),{...i,highlightedIndex:e.highlightedIndex};case kt:case Lt:V(!1);break;case Ut:return V(i.isOpen||!1),{...i,highlightedIndex:U.length>0?0:void 0};case Rt:return ye(i.selectedItem),ge(i.selectedItem),{...i,highlightedIndex:e.highlightedIndex};case Wt:return{...i,highlightedIndex:e.highlightedIndex};case Gt:return C?{...i,highlightedIndex:R.indexOf(E)}:{...i,highlightedIndex:0};case jt:case zt:case Vt:case Zt:if(E>-1){const te=document.querySelectorAll(`li.${r}--list-box__menu-item[role="option"]`);ee.scrollIntoView(te[E])}return E===-1?{...i,highlightedIndex:0}:i;case qt:return{...i,highlightedIndex:e.highlightedIndex}}return i}const rt=j(`${r}--list-box__field--wrapper`,{[`${r}--list-box__field--wrapper--input-focused`]:ue}),we=e=>{e.target.classList.contains(`${r}--tag__close-icon`)?de(!1):de(e.type==="focus")},ot=N?{onClick:e=>{e.preventDefault(),Y.current!==void 0&&Y.current.focus()},onKeyDown:e=>{["ArrowDown","ArrowUp"," ","Enter"].includes(e.key)&&e.preventDefault()}}:{};let M=f.isValidElement(q??u)?q??u:null;M&&((Ce=M.type)==null?void 0:Ce.displayName)==="AILabel"&&(M=f.cloneElement(M,{size:"mini"}));const it=y.length>0&&y.map(e=>e==null?void 0:e.text),at=k?y.filter(e=>!e.isSelectAll).length:y.length,ct=m.useMemo(()=>xe({ref:$?F.setFloating:null}),[$,xe,F.setFloating]);return f.createElement("div",{className:Xe},f.createElement("label",Z({className:Ye},Ze()),g&&g,y.length>0&&f.createElement("span",{className:`${r}--visually-hidden`},Q," ",y.length," ",it,",",_)),f.createElement(z,{onFocus:W?we:void 0,onBlur:W?we:void 0,type:H,size:G,className:nt,disabled:h,light:Me,invalid:w,invalidText:Pe,warn:K,warnText:De,isOpen:C,id:t},w&&f.createElement(Tt,{className:`${r}--list-box__invalid-icon`}),be&&f.createElement(At,{className:`${r}--list-box__invalid-icon ${r}--list-box__invalid-icon--warning`}),f.createElement("div",{className:rt,ref:$?F.setReference:null},y.length>0&&f.createElement(z.Selection,{readOnly:N,clearSelection:!h&&!N?Ie:$t,selectionCount:at,translateWithId:le,disabled:h}),f.createElement("button",Z({type:"button",className:`${r}--list-box__field`,disabled:h,"aria-disabled":h||N,"aria-describedby":!T&&!w&&!K&&x?ve:void 0},Se,{ref:Y},ot),f.createElement("span",{id:et,className:`${r}--list-box__label`},b),f.createElement(z.MenuIcon,{isOpen:C,translateWithId:le})),q?M:u?f.createElement("div",{className:`${r}--list-box__inner-wrapper--decorator`},M):""),f.createElement(z.Menu,ct,C&&J(R,X).map((e,I)=>{const i=y.filter(te=>se(te,e)).length>0,ee=y.length!==0&&e.isSelectAll&&!i,A=Ge({item:e,"aria-selected":i}),E=l(e);return f.createElement(z.MenuItem,Z({key:A.id,isActive:i&&!e.isSelectAll,"aria-label":E,isHighlighted:Qe===I,title:E,disabled:A["aria-disabled"]},A),f.createElement("div",{className:`${r}--checkbox-wrapper`},f.createElement(Et,{id:`${A.id}__checkbox`,labelText:a?f.createElement(st,Z({key:A.id},e)):E,checked:i,title:Be?E:void 0,indeterminate:ee,disabled:h})))})),We&&f.createElement("span",{"aria-live":"assertive","aria-label":B})),!T&&!w&&!K&&x&&f.createElement("div",{id:ve,className:tt},x))});Fe.displayName="MultiSelect";Fe.propTypes={...Mt,autoAlign:s.bool,className:s.string,clearSelectionDescription:s.string,clearSelectionText:s.string,compareItems:s.func,decorator:s.node,direction:s.oneOf(["top","bottom"]),disabled:s.bool,downshiftProps:s.object,helperText:s.node,hideLabel:s.bool,id:s.string.isRequired,initialSelectedItems:s.array,invalid:s.bool,invalidText:s.node,itemToElement:s.func,itemToString:s.func,items:s.array.isRequired,label:s.node.isRequired,light:_e(s.bool),locale:s.string,onChange:s.func,onMenuChange:s.func,open:s.bool,readOnly:s.bool,selectedItems:s.array,selectionFeedback:s.oneOf(["top","fixed","top-after-reopen"]),size:vt,slug:_e(s.node),sortItems:s.func,titleText:s.node,translateWithId:s.func,type:s.oneOf(["default","inline"]),useTitleInItem:s.bool,warn:s.bool,warnText:s.node};export{Fe as M,se as i};
