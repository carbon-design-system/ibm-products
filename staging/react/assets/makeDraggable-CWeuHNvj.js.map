{"version":3,"file":"makeDraggable-CWeuHNvj.js","sources":["../../src/global/js/utils/makeDraggable/makeDraggable.ts"],"sourcesContent":["/**\n * Copyright IBM Corp. 2025, 2025\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n/* eslint-disable jsdoc/check-param-names */\ninterface DraggableProps {\n  /**\n   * HTML element to move.\n   */\n  el: HTMLElement;\n  /**\n   * HTML element to initiate the drag (e.g., header).\n   */\n  dragHandle?: HTMLElement;\n  /**\n   * HTML element to focus on drag for keyboard interaction (e.g., Drag Icon).\n   */\n  focusableDragHandle?: HTMLElement;\n  /**\n   * Pixel value that defines the distance to move when dragging with arrow\n   * keys.\n   */\n  dragStep?: number;\n  /**\n   * Pixel value that defines the distance to move when dragging with\n   * shift+arrow keys.\n   */\n  shiftDragStep?: number;\n}\n\ninterface EventDetail {\n  dragstart: { keyboard?: boolean; mouse?: boolean };\n  dragend: { keyboard?: boolean; mouse?: boolean };\n}\n\n/**\n * Makes a given element draggable using a handle element.\n *@param draggable - object which accepts el and optional attributes handle,focusableInHandle,dragStep and shiftDragStep\n */\nexport const makeDraggable = ({\n  el,\n  dragHandle,\n  focusableDragHandle,\n  dragStep,\n  shiftDragStep,\n}: DraggableProps) => {\n  if (dragHandle) {\n    dragHandle.style.cursor = 'move';\n    el.style.cursor = 'default';\n  } else {\n    el.style.cursor = 'move';\n  }\n\n  let isDragging = false;\n  let currentX = 0;\n  let currentY = 0;\n  let initialMouseX = 0;\n  let initialMouseY = 0;\n\n  const dispatch = <T extends keyof EventDetail>(\n    type: T,\n    detail: EventDetail[T]\n  ) => {\n    const eventInit: CustomEventInit<EventDetail[T]> = {\n      detail,\n      bubbles: true,\n    };\n    el.dispatchEvent(new CustomEvent(type, eventInit));\n  };\n\n  const onKeyDown = (e: KeyboardEvent) => {\n    if (e.key === 'Enter') {\n      isDragging = !isDragging;\n    }\n    if (isDragging) {\n      dispatch('dragstart', { keyboard: true });\n    } else {\n      dispatch('dragend', { keyboard: true });\n    }\n\n    if (!isDragging) {\n      return;\n    }\n    const distance = e.shiftKey ? (shiftDragStep ?? 32) : (dragStep ?? 8);\n    switch (e.key) {\n      case 'Enter':\n      case ' ':\n        e.preventDefault();\n        break;\n      case 'ArrowLeft':\n        el.style.left = `${el.offsetLeft - distance}px`;\n        break;\n      case 'ArrowRight':\n        el.style.left = `${el.offsetLeft + distance}px`;\n        break;\n      case 'ArrowUp':\n        el.style.top = `${el.offsetTop - distance}px`;\n        break;\n      case 'ArrowDown':\n        el.style.top = `${el.offsetTop + distance}px`;\n        break;\n    }\n  };\n\n  const onMouseDown = (e: MouseEvent) => {\n    const target = e.target;\n    if (!(target instanceof Node)) {\n      return;\n    }\n\n    const isTargetInHandle = dragHandle\n      ? dragHandle.contains(target)\n      : el.contains(target);\n\n    if (!isTargetInHandle) {\n      return;\n    }\n    const style = window.getComputedStyle(el);\n    const matrix = new DOMMatrix(style.transform);\n    currentX = matrix.m41;\n    currentY = matrix.m42;\n\n    // Store the mouse position at the start of the drag\n    initialMouseX = e.clientX;\n    initialMouseY = e.clientY;\n    isDragging = true;\n    dispatch('dragstart', { mouse: true });\n\n    document.addEventListener('mousemove', onMouseMove);\n    document.addEventListener('mouseup', onMouseUp, { once: true });\n  };\n\n  const onMouseMove = (e: MouseEvent) => {\n    if (!isDragging) {\n      return;\n    }\n\n    // Calculate the change in mouse position from the start\n    const dx = e.clientX - initialMouseX;\n    const dy = e.clientY - initialMouseY;\n\n    // Add that change to the element's original translation\n    el.style.transform = `translate(${currentX + dx}px, ${currentY + dy}px)`;\n  };\n\n  const onMouseUp = () => {\n    if (!isDragging) {\n      return;\n    }\n    isDragging = false;\n    dispatch('dragend', { mouse: true });\n\n    document.removeEventListener('mousemove', onMouseMove);\n  };\n  if (dragHandle) {\n    dragHandle.addEventListener('mousedown', onMouseDown);\n  } else {\n    el.addEventListener('mousedown', onMouseDown);\n  }\n  focusableDragHandle?.addEventListener('keydown', onKeyDown);\n\n  const draggableCleanup = () => {\n    if (dragHandle) {\n      dragHandle.removeEventListener('mousedown', onMouseDown);\n    } else {\n      el.removeEventListener('mousedown', onMouseDown);\n    }\n    focusableDragHandle?.removeEventListener('keydown', onKeyDown);\n    document.removeEventListener('mousemove', onMouseMove);\n    document.removeEventListener('mouseup', onMouseUp);\n  };\n  return {\n    cleanup: draggableCleanup,\n  };\n};\n"],"names":["makeDraggable","el","dragHandle","focusableDragHandle","dragStep","shiftDragStep","isDragging","currentX","currentY","initialMouseX","initialMouseY","dispatch","type","detail","eventInit","onKeyDown","e","distance","onMouseDown","target","style","matrix","onMouseMove","onMouseUp","dx","dy"],"mappings":"AA0CO,MAAMA,EAAgB,CAAC,CAC5B,GAAAC,EACA,WAAAC,EACA,oBAAAC,EACA,SAAAC,EACA,cAAAC,CACF,IAAsB,CAChBH,GACFA,EAAW,MAAM,OAAS,OAC1BD,EAAG,MAAM,OAAS,WAElBA,EAAG,MAAM,OAAS,OAGpB,IAAIK,EAAa,GACbC,EAAW,EACXC,EAAW,EACXC,EAAgB,EAChBC,EAAgB,EAEpB,MAAMC,EAAW,CACfC,EACAC,IACG,CACH,MAAMC,EAA6C,CACjD,OAAAD,EACA,QAAS,EAAA,EAEXZ,EAAG,cAAc,IAAI,YAAYW,EAAME,CAAS,CAAC,CACnD,EAEMC,EAAaC,GAAqB,CAUtC,GATIA,EAAE,MAAQ,UACZV,EAAa,CAACA,GAEZA,EACFK,EAAS,YAAa,CAAE,SAAU,EAAA,CAAM,EAExCA,EAAS,UAAW,CAAE,SAAU,EAAA,CAAM,EAGpC,CAACL,EACH,OAEF,MAAMW,EAAWD,EAAE,SAAYX,GAAiB,GAAOD,GAAY,EACnE,OAAQY,EAAE,IAAA,CACR,IAAK,QACL,IAAK,IACHA,EAAE,eAAA,EACF,MACF,IAAK,YACHf,EAAG,MAAM,KAAO,GAAGA,EAAG,WAAagB,CAAQ,KAC3C,MACF,IAAK,aACHhB,EAAG,MAAM,KAAO,GAAGA,EAAG,WAAagB,CAAQ,KAC3C,MACF,IAAK,UACHhB,EAAG,MAAM,IAAM,GAAGA,EAAG,UAAYgB,CAAQ,KACzC,MACF,IAAK,YACHhB,EAAG,MAAM,IAAM,GAAGA,EAAG,UAAYgB,CAAQ,KACzC,KAAA,CAEN,EAEMC,EAAeF,GAAkB,CACrC,MAAMG,EAASH,EAAE,OASjB,GARI,EAAEG,aAAkB,OAQpB,EAJqBjB,EACrBA,EAAW,SAASiB,CAAM,EAC1BlB,EAAG,SAASkB,CAAM,GAGpB,OAEF,MAAMC,EAAQ,OAAO,iBAAiBnB,CAAE,EAClCoB,EAAS,IAAI,UAAUD,EAAM,SAAS,EAC5Cb,EAAWc,EAAO,IAClBb,EAAWa,EAAO,IAGlBZ,EAAgBO,EAAE,QAClBN,EAAgBM,EAAE,QAClBV,EAAa,GACbK,EAAS,YAAa,CAAE,MAAO,EAAA,CAAM,EAErC,SAAS,iBAAiB,YAAaW,CAAW,EAClD,SAAS,iBAAiB,UAAWC,EAAW,CAAE,KAAM,GAAM,CAChE,EAEMD,EAAeN,GAAkB,CACrC,GAAI,CAACV,EACH,OAIF,MAAMkB,EAAKR,EAAE,QAAUP,EACjBgB,EAAKT,EAAE,QAAUN,EAGvBT,EAAG,MAAM,UAAY,aAAaM,EAAWiB,CAAE,OAAOhB,EAAWiB,CAAE,KACrE,EAEMF,EAAY,IAAM,CACjBjB,IAGLA,EAAa,GACbK,EAAS,UAAW,CAAE,MAAO,EAAA,CAAM,EAEnC,SAAS,oBAAoB,YAAaW,CAAW,EACvD,EACA,OAAIpB,EACFA,EAAW,iBAAiB,YAAagB,CAAW,EAEpDjB,EAAG,iBAAiB,YAAaiB,CAAW,EAE9Cf,GAAqB,iBAAiB,UAAWY,CAAS,EAYnD,CACL,QAXuB,IAAM,CACzBb,EACFA,EAAW,oBAAoB,YAAagB,CAAW,EAEvDjB,EAAG,oBAAoB,YAAaiB,CAAW,EAEjDf,GAAqB,oBAAoB,UAAWY,CAAS,EAC7D,SAAS,oBAAoB,YAAaO,CAAW,EACrD,SAAS,oBAAoB,UAAWC,CAAS,CACnD,CAEW,CAEb"}