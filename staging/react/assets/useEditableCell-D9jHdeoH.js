import{e as s,c as D,p as X,P as n,r as m,w as fe}from"./iframe-arkle79Y.js";import{C as be}from"./Checkbox-BmutBX2u.js";import{D as Ie,a as Ee}from"./DatePicker-B8x9tntQ.js";import{D as _e}from"./Dropdown-C6rbHrvJ.js";import{N as xe}from"./NumberInput-C5o0CAOn.js";import{T as he}from"./TextInput-CfvZmzil.js";import{p as ve}from"./props-helper-B3uqW2Cc.js";import{l as Ce}from"./useDatagrid-DUPmJdvZ.js";import{u as ge}from"./usePreviousValue-BqGIc7VE.js";import{u as ye}from"./useIsomorphicEffect-CVBbaLXF.js";import{c as we,d as $e}from"./bucket-2-BjUncjOH.js";import{E as Te}from"./bucket-6-DcCyHKAe.js";const E=`${X.prefix}--datagrid`,B=({label:o,renderIcon:u,labelIcon:f,placeholder:d,disabledCell:_,nonEditCell:y,isActiveCell:l,columnConfig:b,type:i})=>s.createElement("div",{className:D(`${E}__inline-edit-button`,{[`${E}__inline-edit-button--disabled`]:_,[`${E}__inline-edit-button--with-label-icon`]:f,[`${E}__inline-edit-button--non-edit`]:y,[`${E}__inline-edit-button--active`]:l,[`${E}__inline-edit-button--${i}`]:i==="date"||i==="selection"}),tabIndex:l?0:-1,"data-disabled":_,"aria-disabled":_,role:"button"},f&&s.createElement("div",{className:`${E}__label-icon`},s.createElement(f,null)),o!==""?s.createElement("span",{className:D(`${E}__inline-edit-button-label`,{[`${E}__inline-edit-button-label-with-icon`]:!y,[`${E}__defaultStringRenderer--multiline`]:b?.multiLineWrap})},o):s.createElement("span",{className:`${E}__placeholder`},d),!y&&u&&s.createElement("div",{className:`${E}__inline-edit-button-icon`},s.createElement(u,null)));B.propTypes={columnConfig:n.object,disabledCell:n.bool,isActiveCell:n.bool,label:n.oneOfType([n.string,n.number]),labelIcon:n.oneOfType([n.func,n.object]),nonEditCell:n.bool,placeholder:n.string,renderIcon:n.oneOfType([n.func,n.object]),type:n.oneOf(["text","number","selection","date","checkbox"]),value:n.oneOfType([n.string,n.node])};B.__docgenInfo={description:"",methods:[],displayName:"InlineEditButton",props:{columnConfig:{description:"",type:{name:"object"},required:!1},disabledCell:{description:"",type:{name:"bool"},required:!1},isActiveCell:{description:"",type:{name:"bool"},required:!1},label:{description:"",type:{name:"union",value:[{name:"string"},{name:"number"}]},required:!1},labelIcon:{description:"",type:{name:"union",value:[{name:"func"},{name:"object"}]},required:!1},nonEditCell:{description:"",type:{name:"bool"},required:!1},placeholder:{description:"",type:{name:"string"},required:!1},renderIcon:{description:"",type:{name:"union",value:[{name:"func"},{name:"object"}]},required:!1},type:{description:"",type:{name:"enum",value:[{value:"'text'",computed:!1},{value:"'number'",computed:!1},{value:"'selection'",computed:!1},{value:"'date'",computed:!1},{value:"'checkbox'",computed:!1}]},required:!1},value:{description:"",type:{name:"union",value:[{name:"string"},{name:"node"}]},required:!1}}};const p=`${X.prefix}--datagrid`,M=({cell:o,config:u,disabledCell:f=!1,instance:d,placeholder:_="",tabIndex:y,value:l,nonEditCell:b=!1,type:i})=>{const q=o.column.id,w=d.columns.findIndex(e=>e.id===q),U=o.row.index,r=`column-${w}-row-${U}`,{state:J,dispatch:$}=m.useContext(Ce),[v,C]=m.useState(!1),[c,k]=m.useState(l),[A,V]=m.useState(),[N,Q]=m.useState(),{activeCellId:T,editId:P}=J,R=ge({editId:P,activeCellId:T}),{inputProps:x}=u||{},W=m.useRef(void 0),Z=m.useRef(void 0),Y=m.useRef(void 0),j=m.useRef(void 0),z=m.useRef(void 0),{rowSize:S,onDataUpdate:H}=d;let g;v&&(d.cellEditing={cellId:r,columnIndex:w,rowIndex:U,curCellValue:c}),m.useEffect(()=>{V(l);const e=o.column.id,t=d.columns.find(a=>a.id===e);Q(typeof t.Header=="string"?t.Header:"Inline edit cell label")},[]),m.useEffect(()=>{if(R?.editId===r&&!P||R?.editId===r&&r!==P){const{validator:e}=u||{};if(e?.(c)){k(A),g(A);return}}},[R?.editId,P,r,c,u,A,g]),m.useEffect(()=>{(T!==r||!P)&&C(!1),T===r&&P===r&&!b&&(C(!0),g(c))},[T,r,b,P,c,g]);const ee=e=>{const t=document.querySelector(`#${p}__inline-edit--date-picker--${o.row.index}`),a=e==="selection"?j?.current:t;a.click(),e==="date"&&a?.focus()};m.useEffect(()=>{if(R?.editId===r&&R?.activeCellId===r&&T!==r){const{validator:e}=u||{};e?.(c)||V(c)}},[R,r,c,T,u]);const te=()=>{v||($({type:"ENTER_EDIT_MODE",payload:{activeCellId:r,editId:r}}),C(!0),setTimeout(()=>{(i==="selection"||i==="date")&&ee(i)},1))};m.useEffect(()=>{v&&(i==="text"&&W.current.focus(),i==="number"&&Y.current.focus(),i==="selection"&&j?.current?.focus())},[v,i]),g=m.useCallback(e=>{const t=o.column.id,a=o.row.index;H(I=>I.map((h,pe)=>pe===a?{...I[a],[t]:e}:h))},[o,H]),m.useEffect(()=>{k(l)},[l]);const O=()=>{document.querySelector(`#${d.tableId} .${p}__table-with-inline-edit`).focus()},L=e=>{const t=d.rows.length;return e==="Enter"?`column-${w}-row-${o.row.index<t-1&&i==="checkbox"?o.row.index+1:o.row.index}`:`column-${w<d.columns.length-1?w+1:w}-row-${o.row.index}`},ne=e=>{const{key:t}=e;switch(t){case"ArrowRight":case"ArrowLeft":case"ArrowUp":case"ArrowDown":if(v&&e.target.type==="checkbox"){const a=L(t);g(c),V(c),$({type:"EXIT_EDIT_MODE",payload:a}),C(!1),O()}break;case"Tab":case"Enter":{if(i==="checkbox"){const a=L(t);$({type:"EXIT_EDIT_MODE",payload:a}),C(!1),O()}if(v){if(i==="selection"||i==="date")return;const{validator:a}=u||{};if(a?.(c))return;const h=L(t);g(c),V(c),$({type:"EXIT_EDIT_MODE",payload:h}),C(!1),O()}break}case"Escape":{v&&($({type:"EXIT_EDIT_MODE",payload:r}),k(A),g(A),C(!1),O());break}default:return}},ie=()=>{$({type:"UPDATE_ACTIVE_CELL_ID",payload:r})},ae=e=>!!e?.icon?s.createElement(s.Fragment,null,s.createElement(e.icon),s.createElement("span",{className:D(`${p}__inline-edit--select-item`)},e?.text)):e?.text,K=e=>e?.length&&typeof e[0]=="object"?t=>ae(t):null;ye(()=>{if(j.current&&j.current.style){const e=j.current.closest(`.${p}__inline-edit--select`);e.style.width=`${o.column.totalWidth}px`}},[j.current,o.column.totalWidth]);const oe=()=>{const{inputProps:e}=u||{};return s.createElement(_e,{id:r,label:N||"Dropdown menu options",ariaLabel:N||"Dropdown menu options",...e,hideLabel:!0,className:D(`${p}__inline-edit--select`,{[`${p}__inline-edit--select-${S}`]:S}),items:e?.items||[],initialSelectedItem:o.value,itemToElement:K(e?.items),renderSelectedItem:K(e?.items),onChange:t=>{const a=L("Enter");g(t.selectedItem),k(t.selectedItem),$({type:"EXIT_EDIT_MODE",payload:a}),C(!1),O(),e?.onChange?.(t.selectedItem)},downshiftProps:{onStateChange:t=>{const{isOpen:a}=t||{};a===!1&&($({type:"EXIT_EDIT_MODE",payload:r}),C(!1),O())}},ref:j,autoAlign:!0})},le=()=>{if(i==="text")return Te;if(i==="number")return we;if(i==="selection")return fe;if(i==="date")return $e},re=()=>{const e=ve(u.inputProps,["datePickerInputProps"]),t=u?.inputProps?.datePickerInputProps;return s.createElement(Ie,{...e,appendTo:z?.current?.parentElement,ref:a=>{if(a&&a.style){a.style.width=`${o.column.totalWidth}px`;const I=`${p}__inline-edit--date-picker--${o.row.index}`,h=a.querySelector(`input#${I}`);h&&(h.style.position="static")}},datePickerType:"single",className:D(`${p}__inline-edit--date`,{[`${p}__inline-edit--date-${S}`]:S}),onChange:a=>{const I=a[0];e?.onChange?.(I,o);const h=L("Enter");g(I),k(I),setTimeout(()=>{C(!1),O(),$({type:"EXIT_EDIT_MODE",payload:h})},1)},value:o.value},s.createElement(Ee,{...t,placeholder:t?.placeholder||"mm/dd/yyyy",labelText:t?.labelText||N||"Set date",id:`${p}__inline-edit--date-picker--${o.row.index}`,hideLabel:!0}))},G=e=>e.toString().padStart(2,"0"),se=e=>{const t=u?.inputProps?.dateFormat;if(e instanceof Date){const a=e.getFullYear(),I=G(e.getMonth()+1),h=G(e.getDate());if(t==="m/d/Y"||e==="m/d/y")return[I,h,a].join("/");if(t==="d/m/Y"||t==="d/m/y"||t===void 0)return[h,I,a].join("/")}else return e;return null},de=()=>{const{validator:e}=u||{};return s.createElement(xe,{placeholder:_,label:N,...x,id:r,hideLabel:!0,defaultValue:c,invalid:e?.(c),invalidText:x?.invalidText||"Provide missing invalidText",onChange:(t,{value:a})=>{k(a),x.onChange&&x.onChange(a)},ref:Y})},ce=()=>s.createElement(be,{labelText:N||"Checkbox",...x,className:D(`${p}__inline-edit--outer-cell-checkbox`,{[`${p}__inline-edit--outer-cell-checkbox-focus`]:T===r}),id:r,hideLabel:!0,checked:c,onChange:(e,{checked:t})=>{k(t),x.onChange&&x.onChange(t)},ref:Z}),ue=()=>{const{validator:e}=u||{},t=e?.(c);return s.createElement(he,{labelText:N,placeholder:_,...x,id:r,hideLabel:!0,defaultValue:c,invalid:t,invalidText:x?.invalidText||"Provide missing invalidText",onChange:a=>{k(a.target.value),x.onChange&&x.onChange(a.target.value)},ref:W})},me=()=>{const e=t=>{if(typeof t=="object"&&t?.isStaticCell)return t?.value};switch(i){case"selection":return e(l),l?.text??l;case"date":return e(l),se(l);default:return e(l)??l}};return s.createElement("div",{ref:z,"data-cell-id":r,"data-column-index":w,"data-row-index":o.row.index,"data-disabled":f||b,"data-inline-type":i,onClick:b?ie:te,onKeyDown:b?null:ne,className:D(`${p}__inline-edit--outer-cell-button`,{[`${p}__inline-edit--outer-cell-button--${S}`]:S,[`${p}__inline-edit--outer-cell-button--lg`]:!S,[`${p}__inline-edit--outer-cell-button--invalid`]:v&&u?.validator?.(c),[`${p}__static--outer-cell`]:!f})},(!v||f)&&i!=="checkbox"&&s.createElement(B,{isActiveCell:r===T,renderIcon:le(),label:me(),disabledCell:f,labelIcon:l?.icon||null,placeholder:_,tabIndex:y,nonEditCell:b,columnConfig:o.column,type:i}),i==="checkbox"&&ce(),!b&&v&&r===T&&s.createElement(s.Fragment,null,i==="text"&&ue(),i==="number"&&de(),i==="selection"&&oe(),i==="date"&&re()))};M.propTypes={cell:n.object,config:n.object,disabledCell:n.bool,instance:n.shape({columns:n.arrayOf(n.object),onDataUpdate:n.func,rows:n.arrayOf(n.object),rowSize:n.string,tableId:n.string,cellEditing:n.object}),nonEditCell:n.bool,placeholder:n.string,tabIndex:n.number,type:n.oneOf(["text","number","selection","date","checkbox"]),value:n.oneOfType([n.string,n.node,n.object])};M.__docgenInfo={description:"",methods:[],displayName:"InlineEditCell",props:{disabledCell:{defaultValue:{value:"false",computed:!1},description:"",type:{name:"bool"},required:!1},placeholder:{defaultValue:{value:"''",computed:!1},description:"",type:{name:"string"},required:!1},nonEditCell:{defaultValue:{value:"false",computed:!1},description:"",type:{name:"bool"},required:!1},cell:{description:"",type:{name:"object"},required:!1},config:{description:"",type:{name:"object"},required:!1},instance:{description:"",type:{name:"shape",value:{columns:{name:"arrayOf",value:{name:"object"},required:!1},onDataUpdate:{name:"func",required:!1},rows:{name:"arrayOf",value:{name:"object"},required:!1},rowSize:{name:"string",required:!1},tableId:{name:"string",required:!1},cellEditing:{name:"object",required:!1}}},required:!1},tabIndex:{description:"",type:{name:"number"},required:!1},type:{description:"",type:{name:"enum",value:[{value:"'text'",computed:!1},{value:"'number'",computed:!1},{value:"'selection'",computed:!1},{value:"'date'",computed:!1},{value:"'checkbox'",computed:!1}]},required:!1},value:{description:"",type:{name:"union",value:[{name:"string"},{name:"node"},{name:"object"}]},required:!1}}};const F=`${X.prefix}--datagrid`,De=o=>{const u=(f,{cell:d,instance:_})=>{const y=d.column.inlineEdit,l=d.column?.inlineEdit?.type,b=d.column?.isDisabled,i=typeof d.value=="object"&&d.column.id===d.value?.columnId&&d.value?.isStaticCell,q=w=>s.createElement(M,{config:y,tabIndex:-1,value:d.value,cell:d,disabledCell:b,instance:_,type:w});return d.column.id==="spacer"?[f,{className:D(`${F}__cell`,`${F}__cell--spacer`)}]:[f,{className:D(`${F}__cell`,`${F}__cell-inline-edit`),role:"gridcell",children:s.createElement(s.Fragment,null,!i&&l==="text"&&q(l),!i&&l==="number"&&q(l),!i&&l==="selection"&&q(l),l==="checkbox"&&q(l),!i&&l==="date"&&q(l),i&&s.createElement(M,{config:y,tabIndex:-1,value:d.value?.value,cell:d,instance:_,nonEditCell:!0,type:"text"}),!l&&s.createElement(M,{config:y,tabIndex:-1,value:d.value,cell:d,instance:_,disabledCell:b,nonEditCell:!0,type:"text"}))}]};o.getCellProps.push(u),o.useInstance.push(f=>{Object.assign(f,{withInlineEdit:!0})})},Fe=o=>{De(o)};export{De as a,Fe as u};
