import{b as fe,i as de,d as he,_ as me,K as pe,m as O,k as xe,O as ye,J as be,H as we,P as n,g as Ie}from"./index-C360Eztx.js";import{r,e as _}from"./index-DtHxqM--.js";import{r as ze}from"./index-DgLvjnYm.js";const Ce={isRoot:!0,hasIcons:!1,hasSelectableItems:!1,size:null,items:[],requestCloseRoot:()=>{}};function Ee(u,f){switch(f.type){case"enableIcons":return{...u,hasIcons:!0};case"enableSelectableItems":return{...u,hasSelectableItems:!0};case"registerItem":return{...u,items:[...u.items,f.payload].filter(x=>x.ref.current!==null)}}}const Y=r.createContext({state:Ce,dispatch:u=>{}}),Se=_.createContext({direction:"ltr"});function Me(){return r.useContext(Se)}const g=8,Re=r.forwardRef(function({children:f,className:x,containerRef:d,label:P,menuAlignment:a,mode:B,onClose:y,onOpen:E,open:s,size:S="sm",legacyAutoalign:z="true",target:M=pe&&document.body,x:T=0,y:Z=0,...R},ee){const l=fe(),F=r.useRef(null),$=r.useContext(Y),h=$.state.isRoot,te=h?S:$.state.size,[A,H]=r.useReducer(Ee,{...$.state,isRoot:!1,size:S,requestCloseRoot:h?L:$.state.requestCloseRoot}),v=r.useMemo(()=>({state:A,dispatch:H}),[A,H]),i=r.useRef(null),ne=de([ee,i]),[U,W]=r.useState([-1,-1]),b=v.state.items.filter(e=>!e.disabled&&e.ref.current);let w;if(d!=null&&d.current){const{width:e}=d.current.getBoundingClientRect();w=e}const{direction:se}=Me();function oe(){F.current&&F.current.focus()}function re(){var e;if(i.current){if(F.current=document.activeElement,z){const t=ae();((document==null?void 0:document.dir)==="rtl"||se==="rtl")&&!((e=R==null?void 0:R.id)!=null&&e.includes("MenuButton"))?(i.current.style.insetInlineStart="initial",i.current.style.insetInlineEnd=`${t[0]}px`):(i.current.style.insetInlineStart=`${t[0]}px`,i.current.style.insetInlineEnd="initial"),i.current.style.insetBlockStart=`${t[1]}px`,W(t)}i.current.focus(),E&&E()}}function L(){oe(),y&&y()}function ie(e){e.stopPropagation(),(O(e,xe)||!h&&O(e,ye))&&y?L():j(e)}function j(e){var D,m;const t=b.findIndex(c=>{var C,p;return(p=(C=c.ref)==null?void 0:C.current)==null?void 0:p.contains(document.activeElement)});let o=t;t===-1?o=0:e&&(O(e,be)&&(o=o-1),O(e,we)&&(o=o+1)),o<0&&(o=b.length-1),o>=b.length&&(o=0),o!==t&&((m=(D=b[o].ref)==null?void 0:D.current)==null||m.focus(),e==null||e.preventDefault())}function ce(e){var t;s&&y&&h&&!((t=i.current)!=null&&t.contains(e.relatedTarget))&&L()}function J(e,t){if(!i.current)return;const{width:o,height:D}=i.current.getBoundingClientRect(),m=h?"vertical":"horizontal",c={x:{max:window.innerWidth,size:o,anchor:m==="horizontal"?e[1]:e[0],reversedAnchor:m==="horizontal"?e[0]:e[1],offset:0},y:{max:window.innerHeight,size:D,anchor:m==="horizontal"?e[0]:e[1],reversedAnchor:m==="horizontal"?e[1]:e[0],offset:h?0:4}};if(w&&w<c.x.size&&(a==="bottom"||a==="top")&&(c.x.size=w),w&&(a==="bottom-end"||a==="top-end")&&c.x.anchor>=87&&w<c.x.size){const N=c.x.anchor+c.x.reversedAnchor;c.x.anchor=c.x.anchor+N}const{max:C,size:p,anchor:q,reversedAnchor:G,offset:K}=c[t],I=[C-g-p-q>=0?q-K:!1,G-p>=0?G-p+K:!1,C-g-p],Q=a==="top"||a==="top-end"||a==="top-start";typeof I[0]=="number"&&Q&&I[0]>=0&&!I[1]&&t==="y"?i.current.style.transform="translate(0)":Q&&!I[0]&&t==="y"&&(I[0]=q-K);const X=I.find(N=>N!==!1);return X>=g?X:g}function ue(e){return e!=null}function V(e){if(Array.isArray(e)){const t=e.filter(ue);return t.length===2?t:void 0}else return[e,e]}function ae(){const e={x:V(T),y:V(Z)};return!e.x||!e.y?[-1,-1]:[J(e.x,"x")??-1,J(e.y,"y")??-1]}r.useEffect(()=>{s&&b.length>0&&j()},[s,b]),r.useEffect(()=>{s?re():W([-1,-1])},[s]);const le=he(x,`${l}--menu`,`${l}--menu--${te}`,{[`${l}--menu--box-shadow-top`]:a&&a.slice(0,3)==="top",[`${l}--menu--open`]:s,[`${l}--menu--shown`]:s&&!z||U[0]>=0&&U[1]>=0,[`${l}--menu--with-icons`]:v.state.hasIcons,[`${l}--menu--with-selectable-items`]:v.state.hasSelectableItems,[`${l}--autoalign`]:!z}),k=_.createElement(Y.Provider,{value:v},_.createElement("ul",me({},R,{className:le,role:"menu",ref:ne,"aria-label":P,tabIndex:-1,onKeyDown:ie,onBlur:ce}),f));return M&&h?s&&ze.createPortal(k,M)||null:k});Re.propTypes={children:n.node,className:n.string,label:n.string,menuAlignment:n.string,mode:Ie(n.oneOf(["full","basic"])),onClose:n.func,onOpen:n.func,open:n.bool,size:n.oneOf(["xs","sm","md","lg"]),target:n.object,x:n.oneOfType([n.number,n.arrayOf(n.number)]),y:n.oneOfType([n.number,n.arrayOf(n.number)])};function Oe(u){const[f,x]=r.useState(!1),[d,P]=r.useState([[-1,-1],[-1,-1]]);function a(){const s=(u==null?void 0:u.current)||u;if(s){const{left:S,top:z,right:M,bottom:T}=s.getBoundingClientRect();P([[S,M],[z,T]])}x(!0)}function B(){x(!1)}function y(){f?B():a()}function E(s){s.preventDefault()}return{open:f,x:d[0],y:d[1],handleClick:y,handleMousedown:E,handleClose:B}}export{Se as L,Y as M,Re as a,Oe as b,Me as u};
