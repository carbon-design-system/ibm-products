{"version":3,"file":"ExportModal-mR_z06yo.js","sources":["../../src/components/ExportModal/ExportModal.tsx"],"sourcesContent":["//\n// Copyright IBM Corp. 2020, 2025\n//\n// This source code is licensed under the Apache-2.0 license found in the\n// LICENSE file in the root directory of this source tree.\n//\n\nimport {\n  Button,\n  ComposedModal,\n  FormGroup,\n  Loading,\n  ModalBody,\n  ModalFooter,\n  ModalHeader,\n  PasswordInput,\n  RadioButton,\n  RadioButtonGroup,\n  TextInput,\n  unstable_FeatureFlags as FeatureFlags,\n  usePrefix,\n} from '@carbon/react';\nimport { CheckmarkFilled, ErrorFilled } from '@carbon/react/icons';\nimport React, {\n  ReactNode,\n  forwardRef,\n  useEffect,\n  useRef,\n  RefObject,\n  useState,\n} from 'react';\n\nimport PropTypes from 'prop-types';\nimport cx from 'classnames';\nimport { getDevtoolsProps } from '../../global/js/utils/devtools';\nimport { pkg } from '../../settings';\nimport { usePortalTarget } from '../../global/js/hooks/usePortalTarget';\nimport uuidv4 from '../../global/js/utils/uuidv4';\n\nconst componentName = 'ExportModal';\n\n// Default values for props\nconst defaults = {\n  inputType: 'text',\n  preformattedExtensions: Object.freeze([]),\n  validExtensions: Object.freeze([]),\n};\n\ntype InputType = 'text' | 'password';\n\ntype PreformattedExtensions = {\n  extension?: string;\n  description?: string;\n};\nexport interface ExportModalProps\n  extends React.ComponentProps<typeof ComposedModal> {\n  /**\n   * Body content for the modal\n   */\n  body?: string;\n  /**\n   * Optional class name\n   */\n  className?: string;\n  /**\n   * specify if an error occurred\n   */\n  error?: boolean;\n  /**\n   * messaging to display in the event of an error\n   */\n  errorMessage?: string;\n  /**\n   * name of the file being exported\n   */\n  filename: string;\n  /**\n   * label text that's displayed when hovering over visibility toggler to hide key\n   */\n  hidePasswordLabel?: string;\n  /**\n   * label for the text input\n   */\n  inputLabel?: string;\n  /**\n   * specify the type of text input\n   */\n  inputType: InputType;\n  /**\n   * text for an invalid input\n   */\n  invalidInputText?: string;\n  /**\n   * specify if the modal is in a loading state\n   */\n  loading?: boolean;\n  /**\n   * message to display during the loading state\n   */\n  loadingMessage?: string;\n  /**\n   * Specify a handler for closing modal\n   */\n  onClose?: () => void;\n  /**\n   * Specify a handler for \"submitting\" modal. Returns the file name\n   */\n  onRequestSubmit?: (value?: string) => void;\n  /**\n   * Specify whether the Modal is currently open\n   */\n  open?: boolean;\n  /**\n   * The DOM node the tearsheet should be rendered within. Defaults to document.body.\n   */\n  portalTarget?: ReactNode;\n  /**\n   * Array of extensions to display as radio buttons\n   */\n  preformattedExtensions: readonly PreformattedExtensions[];\n  /**\n   * Label for the preformatted label form group\n   */\n  preformattedExtensionsLabel?: string;\n  /**\n   * Specify the text for the primary button\n   */\n  primaryButtonText: string;\n  /**\n   * Specify the text for the secondary button\n   */\n  secondaryButtonText: string;\n  /**\n   * label text that's displayed when hovering over visibility toggler to show key\n   */\n  showPasswordLabel?: string;\n  /**\n   * messaging to display if the export was successful\n   */\n  successMessage?: string;\n  /**\n   * specify if the export was successful\n   */\n  successful?: boolean;\n  /**\n   * The text displayed at the top of the modal\n   */\n  title: string;\n  /**\n   * Reference to trigger button\n   */\n  triggerButtonRef?: RefObject<any>;\n  /**\n   * array of valid extensions the file can have\n   */\n  validExtensions: readonly any[];\n}\n\n/**\n * Modal dialog version of the export pattern\n */\nexport const ExportModal = forwardRef(\n  (\n    {\n      // The component props, in alphabetical order (for consistency).\n\n      body,\n      className,\n      error,\n      errorMessage,\n      filename,\n      hidePasswordLabel,\n      inputLabel,\n      inputType = 'text',\n      invalidInputText,\n      loading,\n      loadingMessage,\n      onClose,\n      onRequestSubmit,\n      open,\n      portalTarget: portalTargetIn,\n      preformattedExtensions = defaults.preformattedExtensions,\n      preformattedExtensionsLabel,\n      primaryButtonText,\n      secondaryButtonText,\n      showPasswordLabel,\n      successMessage,\n      successful,\n      title,\n      triggerButtonRef,\n      validExtensions = defaults.validExtensions,\n\n      // Collect any other property values passed in.\n      ...rest\n    }: React.PropsWithChildren<ExportModalProps>,\n    ref\n  ) => {\n    const blockClass = `${pkg.prefix}--export-modal`;\n    const [name, setName] = useState('');\n    const [dirtyInput, setDirtyInput] = useState(false);\n    // by default (if it exists) use the first extension in the extension array\n    const [extension, setExtension] = useState('');\n    const renderPortalUse = usePortalTarget(portalTargetIn);\n    const carbonPrefix = usePrefix();\n\n    useEffect(() => {\n      setName(filename);\n      if (\n        preformattedExtensions &&\n        preformattedExtensions.length > 0 &&\n        preformattedExtensions[0]?.extension\n      ) {\n        setExtension(preformattedExtensions?.[0]?.extension);\n      }\n    }, [filename, preformattedExtensions, open]);\n\n    useEffect(() => {\n      if (successful) {\n        const button: HTMLButtonElement | null = document.querySelector(\n          `.${blockClass} .${carbonPrefix}--modal-close-button button`\n        );\n        button?.focus();\n      }\n    }, [successful, blockClass, carbonPrefix]);\n\n    const onNameChangeHandler = (evt) => {\n      setName(evt.target.value);\n    };\n\n    const onExtensionChangeHandler = (value) => {\n      setExtension(value);\n    };\n\n    const onBlurHandler = () => {\n      setDirtyInput(true);\n    };\n\n    const onSubmitHandler = () => {\n      const returnName = extension\n        ? `${filename}.${extension.toLocaleLowerCase()}`\n        : name;\n      onRequestSubmit?.(returnName);\n    };\n\n    const hasInvalidExtension = () => {\n      if (!dirtyInput || !validExtensions || !validExtensions.length) {\n        return false;\n      }\n      if (!name.includes('.')) {\n        return true;\n      }\n      const ext = name.split('.').pop();\n      if (!validExtensions.includes(ext)) {\n        return true;\n      }\n      return false;\n    };\n\n    const internalId = useRef(uuidv4());\n    const primaryButtonDisabled = loading || !name || hasInvalidExtension();\n    const submitted = loading || error || successful;\n\n    const commonInputProps = {\n      id: `text-input--${internalId.current}`,\n      value: name,\n      onChange: onNameChangeHandler,\n      labelText: inputLabel,\n      invalid: hasInvalidExtension(),\n      invalidText: invalidInputText,\n      onBlur: onBlurHandler,\n      ['data-modal-primary-focus']: true,\n    };\n    return renderPortalUse(\n      <FeatureFlags enableExperimentalFocusWrapWithoutSentinels>\n        <ComposedModal\n          {...rest}\n          className={cx(blockClass, className)}\n          aria-label={title}\n          size=\"sm\"\n          preventCloseOnClickOutside\n          launcherButtonRef={triggerButtonRef}\n          {...{ open, ref, onClose, ...getDevtoolsProps(componentName) }}\n        >\n          <ModalHeader\n            className={`${blockClass}__header`}\n            closeModal={onClose}\n            title={title}\n          />\n          <ModalBody className={`${blockClass}__body-container`}>\n            {!submitted && (\n              <>\n                {body && <p className={`${blockClass}__body`}>{body}</p>}\n                {preformattedExtensions.length ? (\n                  <FormGroup legendText={preformattedExtensionsLabel}>\n                    <RadioButtonGroup\n                      orientation=\"vertical\"\n                      onChange={onExtensionChangeHandler}\n                      valueSelected={extension}\n                      name=\"extensions\"\n                      aria-label=\"extensions\"\n                    >\n                      {preformattedExtensions.map((o) => (\n                        <RadioButton\n                          key={o.extension}\n                          id={o.extension}\n                          value={o.extension}\n                          labelText={`${o.extension} (${o.description})`}\n                          data-modal-primary-focus\n                        />\n                      ))}\n                    </RadioButtonGroup>\n                  </FormGroup>\n                ) : (\n                  <div className={`${blockClass}__input-container`}>\n                    {inputType === 'text' ? (\n                      <TextInput {...commonInputProps} />\n                    ) : (\n                      <PasswordInput\n                        {...commonInputProps}\n                        showPasswordLabel={showPasswordLabel}\n                        hidePasswordLabel={hidePasswordLabel}\n                        tooltipPosition=\"left\"\n                      />\n                    )}\n                  </div>\n                )}\n              </>\n            )}\n            <div aria-live=\"polite\" className={`${blockClass}__messaging`}>\n              {loading && (\n                <>\n                  <Loading\n                    aria-live=\"off\"\n                    description=\"\"\n                    small\n                    withOverlay={false}\n                  />\n                  <p>{loadingMessage}</p>\n                </>\n              )}\n              {successful && (\n                <>\n                  <CheckmarkFilled\n                    size={16}\n                    className={`${blockClass}__checkmark-icon`}\n                  />\n                  <p>{successMessage}</p>\n                </>\n              )}\n              {error && (\n                <>\n                  <ErrorFilled\n                    size={16}\n                    className={`${blockClass}__error-icon`}\n                  />\n                  <p>{errorMessage}</p>\n                </>\n              )}\n            </div>\n          </ModalBody>\n          {!submitted && (\n            <ModalFooter className={`${blockClass}__footer`}>\n              <Button type=\"button\" kind=\"secondary\" onClick={onClose}>\n                {secondaryButtonText}\n              </Button>\n              <Button\n                type=\"submit\"\n                kind=\"primary\"\n                onClick={onSubmitHandler}\n                disabled={primaryButtonDisabled}\n              >\n                {primaryButtonText}\n              </Button>\n            </ModalFooter>\n          )}\n        </ComposedModal>\n      </FeatureFlags>\n    );\n  }\n);\n\n// Return a placeholder if not released and not enabled by feature flag\n\nExportModal.propTypes = {\n  /**\n   * Body content for the modal\n   */\n  /**@ts-ignore*/\n  body: PropTypes.string,\n  /**\n   * Optional class name\n   */\n  className: PropTypes.string,\n  /**\n   * specify if an error occurred\n   */\n  error: PropTypes.bool,\n  /**\n   * messaging to display in the event of an error\n   */\n  errorMessage: PropTypes.string,\n  /**\n   * name of the file being exported\n   */\n  filename: PropTypes.string.isRequired,\n  /**\n   * label text that's displayed when hovering over visibility toggler to hide key\n   */\n  hidePasswordLabel: PropTypes.string,\n  /**\n   * label for the text input\n   */\n  inputLabel: PropTypes.string,\n  /**\n   * specify the type of text input\n   */\n  /**@ts-ignore */\n  inputType: PropTypes.oneOf(['text', 'password']),\n  /**\n   * text for an invalid input\n   */\n  invalidInputText: PropTypes.string,\n  /**\n   * specify if the modal is in a loading state\n   */\n  loading: PropTypes.bool,\n  /**\n   * message to display during the loading state\n   */\n  loadingMessage: PropTypes.string,\n  /**\n   * Specify a handler for closing modal\n   */\n  onClose: PropTypes.func,\n  /**\n   * Specify a handler for \"submitting\" modal. Returns the file name\n   */\n  onRequestSubmit: PropTypes.func,\n  /**\n   * Specify whether the Modal is currently open\n   */\n  open: PropTypes.bool,\n  /**\n   * The DOM node the tearsheet should be rendered within. Defaults to document.body.\n   */\n  portalTarget: PropTypes.node,\n  /**\n   * Array of extensions to display as radio buttons\n   */\n  /**@ts-ignore */\n  preformattedExtensions: PropTypes.arrayOf(\n    PropTypes.shape({\n      extension: PropTypes.string,\n      description: PropTypes.string,\n    })\n  ),\n  /**\n   * Label for the preformatted label form group\n   */\n  preformattedExtensionsLabel: PropTypes.string,\n  /**\n   * Specify the text for the primary button\n   */\n  primaryButtonText: PropTypes.string.isRequired,\n  /**\n   * Specify the text for the secondary button\n   */\n  secondaryButtonText: PropTypes.string.isRequired,\n  /**\n   * label text that's displayed when hovering over visibility toggler to show key\n   */\n  showPasswordLabel: PropTypes.string,\n  /**\n   * messaging to display if the export was successful\n   */\n  successMessage: PropTypes.string,\n  /**\n   * specify if the export was successful\n   */\n  successful: PropTypes.bool,\n  /**\n   * The text displayed at the top of the modal\n   */\n  title: PropTypes.string.isRequired,\n  /**\n   * Sets the trigger button ref\n   */\n  triggerButtonRef: PropTypes.any,\n  /**\n   * array of valid extensions the file can have\n   */\n  /**@ts-ignore */\n  validExtensions: PropTypes.array,\n};\n\nExportModal.displayName = componentName;\n"],"names":["componentName","defaults","ExportModal","forwardRef","body","className","error","errorMessage","filename","hidePasswordLabel","inputLabel","inputType","invalidInputText","loading","loadingMessage","onClose","onRequestSubmit","open","portalTargetIn","preformattedExtensions","preformattedExtensionsLabel","primaryButtonText","secondaryButtonText","showPasswordLabel","successMessage","successful","title","triggerButtonRef","validExtensions","rest","ref","blockClass","pkg","name","setName","useState","dirtyInput","setDirtyInput","extension","setExtension","renderPortalUse","usePortalTarget","carbonPrefix","usePrefix","useEffect","onNameChangeHandler","evt","onExtensionChangeHandler","value","onBlurHandler","onSubmitHandler","returnName","hasInvalidExtension","ext","internalId","useRef","uuidv4","primaryButtonDisabled","submitted","commonInputProps","React","FeatureFlags","ComposedModal","cx","getDevtoolsProps","ModalHeader","ModalBody","FormGroup","RadioButtonGroup","o","RadioButton","TextInput","PasswordInput","Loading","CheckmarkFilled","ErrorFilled","ModalFooter","Button","PropTypes"],"mappings":"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"}