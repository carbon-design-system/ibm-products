import{P as s,b as ut,d as dt,u as ft,a as pt,j as $,c as R,_ as V,f as gt,g as mt,s as ht,h as It,a1 as we,E as Se,S as xt,B as _e,x as Ce,i as Ee}from"./index-BPCFiO9b.js";import{u as Ae,L,b as yt}from"./index-B0LLDM2X.js";import{g as bt}from"./_commonjsHelpers-BosuxZz1.js";import{r as f,e as c}from"./index-CPiZ6Cnx.js";import{m as vt}from"./mergeRefs-CTUecegF.js";import{F as wt}from"./FormContext-CgeSXHS1.js";import{C as St}from"./Checkbox-C003KrfO.js";import{n as _t}from"./settings-41bnSjHp.js";import{W as Ct,a as Et}from"./bucket-18-CAzey7tD.js";var ne,$e;function $t(){if($e)return ne;$e=1;var i=typeof Element<"u",p=typeof Map=="function",u=typeof Set=="function",I=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function g(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var a,l,m;if(Array.isArray(t)){if(a=t.length,a!=n.length)return!1;for(l=a;l--!==0;)if(!g(t[l],n[l]))return!1;return!0}var v;if(p&&t instanceof Map&&n instanceof Map){if(t.size!==n.size)return!1;for(v=t.entries();!(l=v.next()).done;)if(!n.has(l.value[0]))return!1;for(v=t.entries();!(l=v.next()).done;)if(!g(l.value[1],n.get(l.value[0])))return!1;return!0}if(u&&t instanceof Set&&n instanceof Set){if(t.size!==n.size)return!1;for(v=t.entries();!(l=v.next()).done;)if(!n.has(l.value[0]))return!1;return!0}if(I&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(n)){if(a=t.length,a!=n.length)return!1;for(l=a;l--!==0;)if(t[l]!==n[l])return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof n.valueOf=="function")return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof n.toString=="function")return t.toString()===n.toString();if(m=Object.keys(t),a=m.length,a!==Object.keys(n).length)return!1;for(l=a;l--!==0;)if(!Object.prototype.hasOwnProperty.call(n,m[l]))return!1;if(i&&t instanceof Element)return!1;for(l=a;l--!==0;)if(!((m[l]==="_owner"||m[l]==="__v"||m[l]==="__o")&&t.$$typeof)&&!g(t[m[l]],n[m[l]]))return!1;return!0}return t!==t&&n!==n}return ne=function(n,a){try{return g(n,a)}catch(l){if((l.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw l}},ne}var Tt=$t();const Oe=bt(Tt),At={compareItems:s.func,sortItems:s.func},Ot=(i,p,u)=>{let{locale:I}=u;return i.localeCompare(p,I,{numeric:!0})},Ft=(i,p)=>{let{selectedItems:u=[],itemToString:I,compareItems:g,locale:t="en"}=p;return i.sort((n,a)=>{if(n.isSelectAll)return-1;if(a.isSelectAll)return 1;const l=u.includes(n),m=u.includes(a);return l&&!m?-1:m&&!l?1:g(I(n),I(a),{locale:t})})},Te=i=>{let{isControlled:p,isMounted:u,onChangeHandlerControlled:I,onChangeHandlerUncontrolled:g,selectedItems:t}=i;p?u&&I&&I({selectedItems:t}):g(t)},Mt=i=>{let{disabled:p,onChange:u,initialSelectedItems:I=[],selectedItems:g,selectAll:t=!1,filteredItems:n=[]}=i;const a=f.useRef(!1),l=f.useRef(u),[m,v]=f.useState(I),y=!!g,w=y?g:m,z=f.useCallback(d=>{if(p)return;const H=n.filter(b=>!(b!=null&&b.disabled)),J=n.filter(b=>b==null?void 0:b.disabled).length;let S;if(d!=null&&d.isSelectAll&&w.length>0)S=[];else if(d!=null&&d.isSelectAll&&w.length===0)S=H;else{const b=w.findLastIndex(T=>Oe(T,d));b===-1?(S=w.concat(d),t&&n.length-1===S.length+J&&(S=H)):(S=Bt(w,b),S=S.filter(T=>!(T!=null&&T.isSelectAll)))}Te({isControlled:y,isMounted:a.current,onChangeHandlerControlled:l.current,onChangeHandlerUncontrolled:v,selectedItems:S})},[p,w,n,t,y]),G=f.useCallback(()=>{p||Te({isControlled:y,isMounted:a.current,onChangeHandlerControlled:l.current,onChangeHandlerUncontrolled:v,selectedItems:[]})},[p,y]);return f.useEffect(()=>{l.current=u},[u]),f.useEffect(()=>{a.current&&l.current&&!y&&l.current({selectedItems:w})},[y,w]),f.useEffect(()=>(a.current=!0,()=>{a.current=!1}),[]),{clearSelection:G,onItemChange:z,selectedItems:w}},Bt=(i,p)=>{const u=i.slice();return u.splice(p,1),u},{ItemClick:Dt,ToggleButtonBlur:Pt,ToggleButtonKeyDownArrowDown:kt,ToggleButtonKeyDownArrowUp:Nt,ToggleButtonKeyDownEnter:jt,ToggleButtonKeyDownEscape:Rt,ToggleButtonKeyDownSpaceButton:Lt,ItemMouseMove:zt,MenuMouseLeave:Ht,ToggleButtonClick:Kt,ToggleButtonKeyDownPageDown:qt,ToggleButtonKeyDownPageUp:Wt,FunctionSetHighlightedIndex:Ut}=Ae.stateChangeTypes,Vt=i=>typeof i=="string"?i:typeof i=="number"?`${i}`:i!==null&&typeof i=="object"&&"label"in i&&typeof i.label=="string"?i.label:"",Fe=c.forwardRef((i,p)=>{var ve;let{autoAlign:u=!1,className:I,decorator:g,id:t,items:n,itemToElement:a,itemToString:l=Vt,titleText:m=!1,hideLabel:v,helperText:y,label:w,type:z="default",size:G,disabled:d=!1,initialSelectedItems:H=[],sortItems:J=Ft,compareItems:S=Ot,clearSelectionText:b="To clear selection, press Delete or Backspace",clearAnnouncement:T="all items have been cleared",clearSelectionDescription:Me="Total items selected: ",light:Be,invalid:C,invalidText:De,warn:K,warnText:Pe,useTitleInItem:ke,translateWithId:le,downshiftProps:Ne,open:M=!1,selectionFeedback:se="top-after-reopen",onChange:je,onMenuChange:re,direction:oe="bottom",selectedItems:ae,readOnly:P,locale:Re="en",slug:q}=i;const k=f.useMemo(()=>n.filter(e=>{if(typeof e=="object"&&e!==null){for(const h in e)if(Object.hasOwn(e,h)&&e[h]===void 0)return!1}return!0}),[n]);let N=k.some(e=>e.isSelectAll);(ae??[]).length>0&&N&&(console.warn("Warning: `selectAll` should not be used when `selectedItems` is provided. Please pass either `selectAll` or `selectedItems`, not both."),N=!1);const r=ut(),{isFluid:Q}=f.useContext(wt),ie=dt(),[Gt,X]=f.useState(!1),[ce,j]=f.useState(!1),[_,Le]=f.useState(M||!1),[ze,He]=f.useState(M),[Ke,qe]=f.useState([]),[We,ue]=f.useState(!1),A=ft("enable-v12-dynamic-floating-styles")||u,{refs:B,floatingStyles:de,middlewareData:fe}=pt(A?{placement:oe,strategy:"fixed",middleware:[u&&mt({crossAxis:!1}),ht({apply(e){let{rects:h,elements:o}=e;Object.assign(o.floating.style,{width:`${h.reference.width}px`})}}),u&&It()],whileElementsMounted:gt}:{});f.useLayoutEffect(()=>{var e;if(A){const h={...de,visibility:(e=fe.hide)!=null&&e.referenceHidden?"hidden":"visible"};Object.keys(h).forEach(o=>{B.floating.current&&(B.floating.current.style[o]=h[o])})}},[A,de,B.floating,fe,M]);const{selectedItems:W,onItemChange:pe,clearSelection:ge}=Mt({disabled:d,initialSelectedItems:H,onChange:je,selectedItems:ae,selectAll:N,filteredItems:k}),Y={selectedItems:W,itemToString:l,compareItems:S,locale:Re},Ue={stateReducer:st,isOpen:_,itemToString:e=>Array.isArray(e)&&e.map(function(h){return l(h)}).join(", ")||"",selectedItem:W,items:k,isItemDisabled(e,h){return e==null?void 0:e.disabled},...Ne},{getToggleButtonProps:Ve,getLabelProps:Ge,getMenuProps:me,getItemProps:Je,selectedItem:Qe,highlightedIndex:Xe,setHighlightedIndex:he}=Ae(Ue),Ie=Ve({onFocus:()=>{j(!0)},onBlur:()=>{j(!1)},onKeyDown:e=>{d||(($(e,we)||$(e,Se))&&!_&&(ge(),e.stopPropagation()),!_&&$(e,we)&&x.length>0&&ue(!0),($(e,xt)||$(e,_e)||$(e,Ce))&&!_&&(he(0),ue(!1),U(!0)),$(e,_e)&&x.length===0&&(j(!1),X(!1)),$(e,Se)&&_&&j(!0),$(e,Ce)&&_&&j(!0))}}),Z=vt(Ie.ref,p),x=Qe,U=e=>{Le(e),re&&re(e)};ze!==M&&(U(M),He(M));const O=z==="inline",xe=!C&&K,Ye=R(`${r}--multi-select__wrapper`,`${r}--list-box__wrapper`,I,{[`${r}--multi-select__wrapper--inline`]:O,[`${r}--list-box__wrapper--inline`]:O,[`${r}--multi-select__wrapper--inline--invalid`]:O&&C,[`${r}--list-box__wrapper--inline--invalid`]:O&&C,[`${r}--list-box__wrapper--fluid--invalid`]:Q&&C,[`${r}--list-box__wrapper--slug`]:q,[`${r}--list-box__wrapper--decorator`]:g}),Ze=R(`${r}--label`,{[`${r}--label--disabled`]:d,[`${r}--visually-hidden`]:v}),ye=y?`multiselect-helper-text-${ie}`:void 0,et=`multiselect-field-label-${ie}`,tt=R(`${r}--form__helper-text`,{[`${r}--form__helper-text--disabled`]:d}),nt=R(`${r}--multi-select`,{[`${r}--multi-select--invalid`]:C,[`${r}--multi-select--invalid--focused`]:C&&ce,[`${r}--multi-select--warning`]:xe,[`${r}--multi-select--inline`]:O,[`${r}--multi-select--selected`]:x&&x.length>0,[`${r}--list-box--up`]:oe==="top",[`${r}--multi-select--readonly`]:P,[`${r}--autoalign`]:A,[`${r}--multi-select--selectall`]:N}),lt=a;se==="fixed"?Y.selectedItems=[]:se==="top-after-reopen"&&(Y.selectedItems=Ke);function st(e,h){const{changes:o,props:ee,type:F}=h,{highlightedIndex:E}=o;switch(o.isOpen&&!_&&qe(W),F){case Lt:case jt:if(o.selectedItem===void 0||Array.isArray(o.selectedItem))break;return pe(o.selectedItem),{...o,highlightedIndex:e.highlightedIndex};case Pt:case Rt:U(!1);break;case Kt:return U(o.isOpen||!1),{...o,highlightedIndex:W.length>0?0:void 0};case Dt:return he(o.selectedItem),pe(o.selectedItem),{...o,highlightedIndex:e.highlightedIndex};case Ht:return{...o,highlightedIndex:e.highlightedIndex};case Ut:return _?{...o,highlightedIndex:k.indexOf(E)}:{...o,highlightedIndex:0};case kt:case Nt:case qt:case Wt:if(E>-1){const te=document.querySelectorAll(`li.${r}--list-box__menu-item[role="option"]`);ee.scrollIntoView(te[E])}return E===-1?{...o,highlightedIndex:0}:o;case zt:return{...o,highlightedIndex:e.highlightedIndex}}return o}const rt=R(`${r}--list-box__field--wrapper`,{[`${r}--list-box__field--wrapper--input-focused`]:ce}),be=e=>{e.target.classList.contains(`${r}--tag__close-icon`)?X(!1):X(e.type==="focus")},ot=P?{onClick:e=>{e.preventDefault(),Z.current!==void 0&&Z.current.focus()},onKeyDown:e=>{["ArrowDown","ArrowUp"," ","Enter"].includes(e.key)&&e.preventDefault()}}:{};let D=c.isValidElement(q??g)?q??g:null;D&&((ve=D.type)==null?void 0:ve.displayName)==="AILabel"&&(D=c.cloneElement(D,{size:"mini"}));const at=x.length>0&&x.map(e=>e==null?void 0:e.text),it=N?x.filter(e=>!e.isSelectAll).length:x.length,ct=f.useMemo(()=>me({ref:A?B.setFloating:null}),[A,me,B.setFloating]);return c.createElement("div",{className:Ye},c.createElement("label",V({className:Ze},Ge()),m&&m,x.length>0&&c.createElement("span",{className:`${r}--visually-hidden`},Me," ",x.length," ",at,",",b)),c.createElement(L,{onFocus:Q?be:void 0,onBlur:Q?be:void 0,type:z,size:G,className:nt,disabled:d,light:Be,invalid:C,invalidText:De,warn:K,warnText:Pe,isOpen:_,id:t},C&&c.createElement(Ct,{className:`${r}--list-box__invalid-icon`}),xe&&c.createElement(Et,{className:`${r}--list-box__invalid-icon ${r}--list-box__invalid-icon--warning`}),c.createElement("div",{className:rt,ref:A?B.setReference:null},x.length>0&&c.createElement(L.Selection,{readOnly:P,clearSelection:!d&&!P?ge:_t,selectionCount:it,translateWithId:le,disabled:d}),c.createElement("button",V({type:"button",className:`${r}--list-box__field`,disabled:d,"aria-disabled":d||P,"aria-describedby":!O&&!C&&!K&&y?ye:void 0},Ie,{ref:Z},ot),c.createElement("span",{id:et,className:`${r}--list-box__label`},w),c.createElement(L.MenuIcon,{isOpen:_,translateWithId:le})),q?D:g?c.createElement("div",{className:`${r}--list-box__inner-wrapper--decorator`},D):""),c.createElement(L.Menu,ct,_&&J(k,Y).map((e,h)=>{const o=x.filter(te=>Oe(te,e)).length>0,ee=x.length!==0&&e.isSelectAll&&!o,F=Je({item:e,"aria-selected":o}),E=l(e);return c.createElement(L.MenuItem,V({key:F.id,isActive:o&&!e.isSelectAll,"aria-label":E,isHighlighted:Xe===h,title:E,disabled:F["aria-disabled"]},F),c.createElement("div",{className:`${r}--checkbox-wrapper`},c.createElement(St,{id:`${F.id}__checkbox`,labelText:a?c.createElement(lt,V({key:F.id},e)):E,checked:o,title:ke?E:void 0,indeterminate:ee,disabled:d})))})),We&&c.createElement("span",{"aria-live":"assertive","aria-label":T})),!O&&!C&&!K&&y&&c.createElement("div",{id:ye,className:tt},y))});Fe.displayName="MultiSelect";Fe.propTypes={...At,autoAlign:s.bool,className:s.string,clearSelectionDescription:s.string,clearSelectionText:s.string,compareItems:s.func,decorator:s.node,direction:s.oneOf(["top","bottom"]),disabled:s.bool,downshiftProps:s.object,helperText:s.node,hideLabel:s.bool,id:s.string.isRequired,initialSelectedItems:s.array,invalid:s.bool,invalidText:s.node,itemToElement:s.func,itemToString:s.func,items:s.array.isRequired,label:s.node.isRequired,light:Ee(s.bool),locale:s.string,onChange:s.func,onMenuChange:s.func,open:s.bool,readOnly:s.bool,selectedItems:s.array,selectionFeedback:s.oneOf(["top","fixed","top-after-reopen"]),size:yt,slug:Ee(s.node),sortItems:s.func,titleText:s.node,translateWithId:s.func,type:s.oneOf(["default","inline"]),useTitleInItem:s.bool,warn:s.bool,warnText:s.node};export{Fe as M,Oe as i};
