import{r as h}from"./index-BwDkhjyp.js";import{p as _,j as i,c as C}from"./settings-B0yoEqB-.js";import{c as b,p as R}from"./useMergedRefs-CY5AfkP4.js";import{u as $}from"./useFocusRowExpander-9BajiKyr.js";import{d as f}from"./events-D6dlm1BF.js";const u=`${_.prefix}--datagrid`,j=d=>s=>{var e;const{row:t}=s,{expandedContentHeight:c}=t,p=(n,g="")=>{var x,a;if((x=n==null?void 0:n.target)!=null&&x.closest("tr").previousElementSibling){const o=(a=n==null?void 0:n.target)==null?void 0:a.closest("tr").previousElementSibling;g==="enter"?o.classList.add(`${u}__expandable-row--hover`):o.classList.remove(`${u}__expandable-row--hover`)}},{key:r,...l}=s;return i.jsx("tr",{className:b(`${u}__expanded-row`,{[`${u}__slug--row`]:h.isValidElement((e=t==null?void 0:t.original)==null?void 0:e.slug)}),onMouseEnter:n=>p(n,"enter"),onMouseLeave:n=>p(n),children:i.jsx("td",{className:`${u}__expanded-row-cell-wrapper`,children:i.jsx("div",{className:`${u}__expanded-row-content`,style:{height:c&&c},children:i.jsx(d,{...l},r)})})})},E=`${_.prefix}--datagrid`,w=d=>{const s=h.useRef(),t=h.useRef(),c=r=>{s.current=r};$({instance:s==null?void 0:s.current,lastExpandedRowIndex:t==null?void 0:t.current,blockClass:E,activeElement:document.activeElement});const p=r=>[{id:"expander",Cell:({row:e})=>{const n={...e.getToggleRowExpandedProps(),onClick:o=>{var m;o.stopPropagation(),e.toggleRowExpanded(),(m=e==null?void 0:e.onClick)==null||m.call(e,e,o),t.current=e.id}},{expanderButtonTitleExpanded:g="Collapse row",expanderButtonTitleCollapsed:x="Expand row"}=(s==null?void 0:s.current)||{},a=e.isExpanded?g:x;return e.canExpand&&i.jsx("button",{type:"button","aria-label":a,className:b(`${E}__row-expander`,`${C.prefix}--btn`,`${C.prefix}--btn--ghost`),...n,children:e.isExpanded?i.jsx(R,{className:`${E}__row-expander--icon`}):i.jsx(f,{className:`${E}__row-expander--icon`})})},width:48,disableResizing:!0,disableSortBy:!0,Header:""},...r];d.visibleColumns.push(p),d.useInstance.push(c)},B=d=>{w(d);const s=t=>{const{rows:c,expandedContentHeight:p,ExpandedRowContentComponent:r,onRowExpand:l}=t,[e,n]=h.useState({}),g=(a,o)=>n({...e,[a]:o}),x=c.map(a=>({...a,canExpand:a.original&&!a.original.notExpandable,expandedContentHeight:e[a.index]||p,RowExpansionRenderer:r&&j(r),onClick:(o,m)=>l==null?void 0:l(o,m)}));Object.assign(t,{rows:x,setExpandedRowHeight:g,withExpandedRows:!0})};d.useInstance.push(s)};export{B as u};
