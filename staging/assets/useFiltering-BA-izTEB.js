import{r as d,e as c}from"./index-DtHxqM--.js";import{b as se,c as le,F as ie,e as ne,C as oe,f as ue,B as E,g as ce,I as de,R as pe,M as fe,i as me,N as ye,j as he}from"./useDatagrid-DRFhvKQ0.js";import{b as be,d as R,P as a}from"./index-C360Eztx.js";import{p as ge,I as Fe}from"./settings-CFkY3W_8.js";import{p as q,b as ve}from"./index-CrSLweFd.js";import{u as Ce}from"./useWindowResize-CR2_9WVc.js";import{u as qe}from"./useClickOutside-DnYoV4Om.js";import{A as Ae}from"./ActionSet-Du6AS19V.js";import{F as we}from"./bucket-6-BjeV6rPm.js";const Se=`${ge.prefix}--datagrid`,i=`${Se}-filter-flyout`,v={flyoutIconDescription:"Open filters",title:"Filter",primaryActionLabel:"Apply",secondaryActionLabel:"Cancel",align:"bottom"},T=[],V=({updateMethod:o,flyoutIconDescription:p=v.flyoutIconDescription,align:t=v.align,filters:r=T,title:e=v.title,primaryActionLabel:s=v.primaryActionLabel,onFlyoutOpen:f=()=>{},onFlyoutClose:u=()=>{},onApply:b=()=>{},onCancel:y=()=>{},secondaryActionLabel:h=v.secondaryActionLabel,setAllFilters:_,data:$=T,reactTableFiltersState:j=T})=>{const[C,A]=d.useState(!1),[M,L]=d.useState(!1),B=()=>{A(!1),y()},{filtersState:w,prevFiltersObjectArrayRef:W,prevFiltersRef:x,cancel:I,reset:z,renderFilter:J,filtersObjectArray:g,lastAppliedFilters:D}=se({updateMethod:o,filters:r,setAllFilters:_,variation:ue,reactTableFiltersState:j,onCancel:B}),{width:U}=ve.md,H=parseInt(U)*16,N=d.useRef(null),l=d.useRef(null),K=d.useRef(null),[X,Y]=le({initialValue:!0,filtersState:w,prevFiltersRef:x}),G=n=>{const m=l==null?void 0:l.current.getBoundingClientRect(),F=parseInt(window.getComputedStyle(l==null?void 0:l.current).getPropertyValue("width"));if(Math.sign(m.left)===-1){const k=F-Math.abs(m.left);l.current.style.width=q(k)}if(F<642&&Math.sign(m.left)===1||Math.sign(m.left).toString()==="0"){const k=F+Math.abs(m.left);l.current.style.width=q(k)}(n==null?void 0:n.innerWidth)<=H+254?L(!0):L(!1)};Ce(({current:n})=>{G(n)});const{dispatch:Q}=d.useContext(ie),S=o===E,Z=be(),ee=()=>{A(!0),f()},O=()=>{A(!1),u(),l.current.style.width=q(642)};d.useEffect(()=>{l.current.style.width=q(642)},[]);const te=()=>{_(g),O(),b({filtersState:w,filtersObjectArray:g,lastAppliedFilters:D}),Y(!0),x.current=JSON.stringify(w),W.current=JSON.stringify(g),D.current=JSON.stringify(g),Q({type:ce,payload:{savedFilters:g}})},ae=()=>r.map(J),re=()=>S&&c.createElement(Ae,{actions:[{key:1,kind:"primary",label:s,onClick:te,isExpressive:!1,disabled:X},{key:3,kind:"secondary",label:h,onClick:I,isExpressive:!1}],size:"md",buttonSize:"md"});return qe(N,n=>{const m=n.closest(".flatpickr-calendar"),F=n.className===`${Z}--list-box__menu-item__option`;!C||m||F||(O(),I())}),ne(oe,n=>{z(n)}),c.createElement("div",{className:`${i}__container`,ref:N},c.createElement(Fe,{label:p,kind:"ghost",align:t,onClick:C?O:ee,className:R(`${i}__trigger`,{[`${i}__trigger--open`]:C}),disabled:$.length===0},c.createElement(we,null)),c.createElement("div",{className:R(i,{[`${i}--open`]:C,[`${i}--batch`]:S,[`${i}--instant`]:!S}),ref:l},c.createElement("div",{className:`${i}__inner-container`},c.createElement("span",{className:`${i}__title`},e),c.createElement("div",{className:R(`${i}__filters`,{[`${i}__stacked`]:M}),ref:K},ae())),re()))};V.propTypes={align:a.string,data:a.array.isRequired,filters:a.arrayOf(a.shape({type:a.string.isRequired,column:a.string.isRequired,props:a.object.isRequired})).isRequired,flyoutIconDescription:a.string,onApply:a.func,onCancel:a.func,onFlyoutClose:a.func,onFlyoutOpen:a.func,primaryActionLabel:a.string,reactTableFiltersState:a.arrayOf(a.shape({id:a.string.isRequired,type:a.string.isRequired,value:a.any.isRequired})),secondaryActionLabel:a.string,setAllFilters:a.func.isRequired,title:a.string,updateMethod:a.oneOf([E,de]).isRequired};V.__docgenInfo={description:"",methods:[],displayName:"FilterFlyout",props:{flyoutIconDescription:{defaultValue:{value:"'Open filters'",computed:!1},description:"Icon description for the filter flyout button",type:{name:"string"},required:!1},align:{defaultValue:{value:"'bottom'",computed:!1},description:"Tooltip alignment for the filter button",type:{name:"string"},required:!1},filters:{defaultValue:{value:"[]",computed:!1},description:"Array of filters to render",type:{name:"arrayOf",value:{name:"shape",value:{type:{name:"string",required:!0},column:{name:"string",required:!0},props:{name:"object",required:!0}}}},required:!1},title:{defaultValue:{value:"'Filter'",computed:!1},description:"Title of the filter flyout",type:{name:"string"},required:!1},primaryActionLabel:{defaultValue:{value:"'Apply'",computed:!1},description:"Label text of the primary action in the flyout",type:{name:"string"},required:!1},onFlyoutOpen:{defaultValue:{value:"() => {}",computed:!1},description:"Callback when the flyout opens",type:{name:"func"},required:!1},onFlyoutClose:{defaultValue:{value:"() => {}",computed:!1},description:"Callback when the flyout closes",type:{name:"func"},required:!1},onApply:{defaultValue:{value:"() => {}",computed:!1},description:"Callback when the apply button is clicked",type:{name:"func"},required:!1},onCancel:{defaultValue:{value:"() => {}",computed:!1},description:"Callback when the cancel button is clicked",type:{name:"func"},required:!1},secondaryActionLabel:{defaultValue:{value:"'Cancel'",computed:!1},description:"Label text of the secondary action in the flyout",type:{name:"string"},required:!1},data:{defaultValue:{value:"[]",computed:!1},description:"All data rows in the table",type:{name:"array"},required:!1},reactTableFiltersState:{defaultValue:{value:"[]",computed:!1},description:"Filters from react table's state",type:{name:"arrayOf",value:{name:"shape",value:{id:{name:"string",required:!0},type:{name:"string",required:!0},value:{name:"any",required:!0}}}},required:!1},setAllFilters:{description:"Function that sets all the filters, this comes from the datagridState",type:{name:"func"},required:!0},updateMethod:{description:"The update method used to apply the filters",type:{name:"enum",value:[{value:"'batch'",computed:!1},{value:"'instant'",computed:!1}]},required:!0}}};const Oe=(o,p,t)=>o.filter(r=>p.some(e=>{const s=r.values[e];return s!==void 0?String(s).toLowerCase()===String(t).toLowerCase():!0})),P=(o,p,t)=>{const r=t.filter(e=>e.selected).map(e=>e.value);return r.length===0?o:o.filter(e=>{const s=e.values[p];return r.includes(s)})},De=o=>{const p=d.useMemo(()=>({[he]:(t,r,[e,s])=>t.filter(f=>{const u=f.values[r],b=typeof e=="object"?e:new Date(e),y=typeof s=="object"?s:new Date(s),h=typeof u=="object"?u:new Date(u);return h.getTime()<=y.getTime()&&h.getTime()>=b.getTime()}),[ye]:(t,r,e)=>{if(e==="")return t;const s=parseInt(e);return t.filter(f=>f.values[r]===s)},[me]:(t,r,e)=>P(t,r,e),[fe]:(t,r,e)=>P(t,r,e),[pe]:(t,r,e)=>Oe(t,r,e)}),[]);o.useInstance.push(t=>{const{filterProps:r,setAllFilters:e,setFilter:s,headers:f,data:u,state:b}=t,y={variation:"flyout",updateMethod:E,panelIconDescription:"Open filter panel",reactTableFiltersState:b.filters},h=()=>({...y,...r,setAllFilters:e,setFilter:s,headers:f,data:u});Object.assign(t,{filterProps:{...y,...t==null?void 0:t.filterProps},filterTypes:p,getFilterFlyoutProps:h,FilterFlyout:V})})};export{De as u};
