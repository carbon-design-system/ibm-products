import{e as d,r as m}from"./index-DzvNrmz8.js";import{p as H}from"./settings-CP9zVSjJ.js";import{d as j,P as n,k as _e}from"./index-5As4T26e.js";import{C as Ee}from"./Checkbox-BedUlDBz.js";import{D as xe,a as he}from"./DatePicker-D5zAEtWz.js";import{D as Ce}from"./Dropdown-DocP4HuW.js";import{N as ye}from"./NumberInput-B9uXi7jS.js";import{T as $e}from"./TextInput-BPIVFFXG.js";import{p as we}from"./props-helper-DCsMHcG1.js";import{l as Te}from"./useDatagrid-D8g-gYQ1.js";import{u as De}from"./usePreviousValue-DGkdsrtI.js";import{u as ge}from"./useIsomorphicEffect-l5L8NYko.js";import{t as ke}from"./bucket-2-CdrYWKja.js";import{aX as ve}from"./bucket-1-BbY-lWHx.js";import{b as qe}from"./bucket-6-BVxmYIXv.js";const $=`${H.prefix}--datagrid`,K=({label:o,renderIcon:s,labelIcon:_,placeholder:c,disabledCell:w,nonEditCell:v,isActiveCell:i,columnConfig:I,type:a})=>d.createElement("div",{className:j(`${$}__inline-edit-button`,{[`${$}__inline-edit-button--disabled`]:w,[`${$}__inline-edit-button--with-label-icon`]:_,[`${$}__inline-edit-button--non-edit`]:v,[`${$}__inline-edit-button--active`]:i,[`${$}__inline-edit-button--${a}`]:a==="date"||a==="selection"}),tabIndex:i?0:-1,"data-disabled":w,"aria-disabled":w,role:"button"},_&&d.createElement("div",{className:`${$}__label-icon`},d.createElement(_,null)),o!==""?d.createElement("span",{className:j(`${$}__inline-edit-button-label`,{[`${$}__inline-edit-button-label-with-icon`]:!v,[`${$}__defaultStringRenderer--multiline`]:I==null?void 0:I.multiLineWrap})},o):d.createElement("span",{className:`${$}__placeholder`},c),!v&&s&&d.createElement("div",{className:`${$}__inline-edit-button-icon`},d.createElement(s,null)));K.propTypes={columnConfig:n.object,disabledCell:n.bool,isActiveCell:n.bool,label:n.oneOfType([n.string,n.number]),labelIcon:n.oneOfType([n.func,n.object]),nonEditCell:n.bool,placeholder:n.string,renderIcon:n.oneOfType([n.func,n.object]),type:n.oneOf(["text","number","selection","date","checkbox"]),value:n.oneOfType([n.string,n.node])};K.__docgenInfo={description:"",methods:[],displayName:"InlineEditButton",props:{columnConfig:{description:"",type:{name:"object"},required:!1},disabledCell:{description:"",type:{name:"bool"},required:!1},isActiveCell:{description:"",type:{name:"bool"},required:!1},label:{description:"",type:{name:"union",value:[{name:"string"},{name:"number"}]},required:!1},labelIcon:{description:"",type:{name:"union",value:[{name:"func"},{name:"object"}]},required:!1},nonEditCell:{description:"",type:{name:"bool"},required:!1},placeholder:{description:"",type:{name:"string"},required:!1},renderIcon:{description:"",type:{name:"union",value:[{name:"func"},{name:"object"}]},required:!1},type:{description:"",type:{name:"enum",value:[{value:"'text'",computed:!1},{value:"'number'",computed:!1},{value:"'selection'",computed:!1},{value:"'date'",computed:!1},{value:"'checkbox'",computed:!1}]},required:!1},value:{description:"",type:{name:"union",value:[{name:"string"},{name:"node"}]},required:!1}}};const f=`${H.prefix}--datagrid`,X=({cell:o,config:s,disabledCell:_=!1,instance:c,placeholder:w="",tabIndex:v,value:i,nonEditCell:I=!1,type:a})=>{var ee;const N=o.column.id,D=c.columns.findIndex(e=>e.id===N),V=o.row.index,r=`column-${D}-row-${V}`,{state:U,dispatch:h}=m.useContext(Te),[E,C]=m.useState(!1),[u,O]=m.useState(i),[R,W]=m.useState(),[M,ne]=m.useState(),{activeCellId:q,editId:S}=U,b=De({editId:S,activeCellId:q}),{inputProps:p}=s||{},G=m.useRef(void 0),ae=m.useRef(void 0),J=m.useRef(void 0),T=m.useRef(void 0),Y=m.useRef(void 0),{rowSize:A,onDataUpdate:Q}=c;let g;E&&(c.cellEditing={cellId:r,columnIndex:D,rowIndex:V,curCellValue:u}),m.useEffect(()=>{W(i);const e=o.column.id,t=c.columns.find(l=>l.id===e);ne(typeof t.Header=="string"?t.Header:"Inline edit cell label")},[]),m.useEffect(()=>{if((b==null?void 0:b.editId)===r&&!S||(b==null?void 0:b.editId)===r&&r!==S){const{validator:e}=s||{};if(e==null?void 0:e(u)){O(R),g(R);return}}},[b==null?void 0:b.editId,S,r,u,s,R,g]),m.useEffect(()=>{(q!==r||!S)&&C(!1),q===r&&S===r&&!I&&(C(!0),g(u))},[q,r,I,S,u,g]);const le=e=>{const t=document.querySelector(`#${f}__inline-edit--date-picker--${o.row.index}`),l=e==="selection"?T==null?void 0:T.current:t;l.click(),e==="date"&&(l==null||l.focus())};m.useEffect(()=>{if((b==null?void 0:b.editId)===r&&(b==null?void 0:b.activeCellId)===r&&q!==r){const{validator:e}=s||{};(e==null?void 0:e(u))||W(u)}},[b,r,u,q,s]);const ie=()=>{E||(h({type:"ENTER_EDIT_MODE",payload:{activeCellId:r,editId:r}}),C(!0),setTimeout(()=>{(a==="selection"||a==="date")&&le(a)},1))};m.useEffect(()=>{var e;E&&(a==="text"&&G.current.focus(),a==="number"&&J.current.focus(),a==="selection"&&((e=T==null?void 0:T.current)==null||e.focus()))},[E,a]),g=m.useCallback(e=>{const t=o.column.id,l=o.row.index;Q(y=>y.map((x,k)=>k===l?{...y[l],[t]:e}:x))},[o,Q]),m.useEffect(()=>{O(i)},[i]);const L=()=>{document.querySelector(`#${c.tableId} .${f}__table-with-inline-edit`).focus()},F=e=>{const t=c.rows.length;return e==="Enter"?`column-${D}-row-${o.row.index<t-1&&a==="checkbox"?o.row.index+1:o.row.index}`:`column-${D<c.columns.length-1?D+1:D}-row-${o.row.index}`},oe=e=>{const{key:t}=e;switch(t){case"ArrowRight":case"ArrowLeft":case"ArrowUp":case"ArrowDown":if(E&&e.target.type==="checkbox"){const l=F(t);g(u),W(u),h({type:"EXIT_EDIT_MODE",payload:l}),C(!1),L()}break;case"Tab":case"Enter":{if(a==="checkbox"){const l=F(t);h({type:"EXIT_EDIT_MODE",payload:l}),C(!1),L()}if(E){if(a==="selection"||a==="date")return;const{validator:l}=s||{};if(l==null?void 0:l(u))return;const x=F(t);g(u),W(u),h({type:"EXIT_EDIT_MODE",payload:x}),C(!1),L()}break}case"Escape":{E&&(h({type:"EXIT_EDIT_MODE",payload:r}),O(R),g(R),C(!1),L());break}default:return}},re=()=>{h({type:"UPDATE_ACTIVE_CELL_ID",payload:r})},se=e=>!!(e!=null&&e.icon)?d.createElement(d.Fragment,null,d.createElement(e.icon),d.createElement("span",{className:j(`${f}__inline-edit--select-item`)},e==null?void 0:e.text)):e==null?void 0:e.text,Z=e=>e!=null&&e.length&&typeof e[0]=="object"?t=>se(t):null;ge(()=>{if(T.current&&T.current.style){const e=T.current.closest(`.${f}__inline-edit--select`);e.style.width=`${o.column.totalWidth}px`}},[T.current,o.column.totalWidth]);const de=()=>{const{inputProps:e}=s||{};return d.createElement(Ce,{id:r,label:M||"Dropdown menu options",ariaLabel:M||"Dropdown menu options",...e,hideLabel:!0,className:j(`${f}__inline-edit--select`,{[`${f}__inline-edit--select-${A}`]:A}),items:(e==null?void 0:e.items)||[],initialSelectedItem:o.value,itemToElement:Z(e==null?void 0:e.items),renderSelectedItem:Z(e==null?void 0:e.items),onChange:t=>{var y;const l=F("Enter");g(t.selectedItem),O(t.selectedItem),h({type:"EXIT_EDIT_MODE",payload:l}),C(!1),L(),(y=e==null?void 0:e.onChange)==null||y.call(e,t.selectedItem)},downshiftProps:{onStateChange:t=>{const{isOpen:l}=t||{};l===!1&&(h({type:"EXIT_EDIT_MODE",payload:r}),C(!1),L())}},ref:T,autoAlign:!0})},ce=()=>{if(a==="text")return qe;if(a==="number")return ke;if(a==="selection")return _e;if(a==="date")return ve},ue=()=>{var l,y;const e=we(s.inputProps,["datePickerInputProps"]),t=(l=s==null?void 0:s.inputProps)==null?void 0:l.datePickerInputProps;return d.createElement(xe,{...e,appendTo:(y=Y==null?void 0:Y.current)==null?void 0:y.parentElement,ref:x=>{if(x&&x.style){x.style.width=`${o.column.totalWidth}px`;const k=`${f}__inline-edit--date-picker--${o.row.index}`,z=x.querySelector(`input#${k}`);z&&(z.style.position="static")}},datePickerType:"single",className:j(`${f}__inline-edit--date`,{[`${f}__inline-edit--date-${A}`]:A}),onChange:x=>{var te;const k=x[0];(te=e==null?void 0:e.onChange)==null||te.call(e,k,o);const z=F("Enter");g(k),O(k),setTimeout(()=>{C(!1),L(),h({type:"EXIT_EDIT_MODE",payload:z})},1)},value:o.value},d.createElement(he,{...t,placeholder:(t==null?void 0:t.placeholder)||"mm/dd/yyyy",labelText:(t==null?void 0:t.labelText)||M||"Set date",id:`${f}__inline-edit--date-picker--${o.row.index}`,hideLabel:!0}))},P=e=>e.toString().padStart(2,"0"),me=e=>{var l;const t=(l=s==null?void 0:s.inputProps)==null?void 0:l.dateFormat;if(e instanceof Date){const y=e.getFullYear(),x=P(e.getMonth()+1),k=P(e.getDate());if(t==="m/d/Y"||e==="m/d/y")return[x,k,y].join("/");if(t==="d/m/Y"||t==="d/m/y"||t===void 0)return[k,x,y].join("/")}else return e;return null},fe=()=>{const{validator:e}=s||{};return d.createElement(ye,{placeholder:w,label:M,...p,id:r,hideLabel:!0,defaultValue:u,invalid:e==null?void 0:e(u),invalidText:(p==null?void 0:p.invalidText)||"Provide missing invalidText",onChange:(t,{value:l})=>{O(l),p.onChange&&p.onChange(l)},ref:J})},be=()=>d.createElement(Ee,{labelText:M||"Checkbox",...p,className:j(`${f}__inline-edit--outer-cell-checkbox`,{[`${f}__inline-edit--outer-cell-checkbox-focus`]:q===r}),id:r,hideLabel:!0,checked:u,onChange:(e,{checked:t})=>{O(t),p.onChange&&p.onChange(t)},ref:ae}),pe=()=>{const{validator:e}=s||{},t=e==null?void 0:e(u);return d.createElement($e,{labelText:M,placeholder:w,...p,id:r,hideLabel:!0,defaultValue:u,invalid:t,invalidText:(p==null?void 0:p.invalidText)||"Provide missing invalidText",onChange:l=>{O(l.target.value),p.onChange&&p.onChange(l.target.value)},ref:G})},Ie=()=>{const e=t=>{if(typeof t=="object"&&(t!=null&&t.isStaticCell))return t==null?void 0:t.value};switch(a){case"selection":return e(i),(i==null?void 0:i.text)??i;case"date":return e(i),me(i);default:return e(i)??i}};return d.createElement("div",{ref:Y,"data-cell-id":r,"data-column-index":D,"data-row-index":o.row.index,"data-disabled":_||I,"data-inline-type":a,onClick:I?re:ie,onKeyDown:I?null:oe,className:j(`${f}__inline-edit--outer-cell-button`,{[`${f}__inline-edit--outer-cell-button--${A}`]:A,[`${f}__inline-edit--outer-cell-button--lg`]:!A,[`${f}__inline-edit--outer-cell-button--invalid`]:E&&((ee=s==null?void 0:s.validator)==null?void 0:ee.call(s,u)),[`${f}__static--outer-cell`]:!_})},(!E||_)&&a!=="checkbox"&&d.createElement(K,{isActiveCell:r===q,renderIcon:ce(),label:Ie(),disabledCell:_,labelIcon:(i==null?void 0:i.icon)||null,placeholder:w,tabIndex:v,nonEditCell:I,columnConfig:o.column,type:a}),a==="checkbox"&&be(),!I&&E&&r===q&&d.createElement(d.Fragment,null,a==="text"&&pe(),a==="number"&&fe(),a==="selection"&&de(),a==="date"&&ue()))};X.propTypes={cell:n.object,config:n.object,disabledCell:n.bool,instance:n.shape({columns:n.arrayOf(n.object),onDataUpdate:n.func,rows:n.arrayOf(n.object),rowSize:n.string,tableId:n.string,cellEditing:n.object}),nonEditCell:n.bool,placeholder:n.string,tabIndex:n.number,type:n.oneOf(["text","number","selection","date","checkbox"]),value:n.oneOfType([n.string,n.node,n.object])};X.__docgenInfo={description:"",methods:[],displayName:"InlineEditCell",props:{disabledCell:{defaultValue:{value:"false",computed:!1},description:"",type:{name:"bool"},required:!1},placeholder:{defaultValue:{value:"''",computed:!1},description:"",type:{name:"string"},required:!1},nonEditCell:{defaultValue:{value:"false",computed:!1},description:"",type:{name:"bool"},required:!1},cell:{description:"",type:{name:"object"},required:!1},config:{description:"",type:{name:"object"},required:!1},instance:{description:"",type:{name:"shape",value:{columns:{name:"arrayOf",value:{name:"object"},required:!1},onDataUpdate:{name:"func",required:!1},rows:{name:"arrayOf",value:{name:"object"},required:!1},rowSize:{name:"string",required:!1},tableId:{name:"string",required:!1},cellEditing:{name:"object",required:!1}}},required:!1},tabIndex:{description:"",type:{name:"number"},required:!1},type:{description:"",type:{name:"enum",value:[{value:"'text'",computed:!1},{value:"'number'",computed:!1},{value:"'selection'",computed:!1},{value:"'date'",computed:!1},{value:"'checkbox'",computed:!1}]},required:!1},value:{description:"",type:{name:"union",value:[{name:"string"},{name:"node"},{name:"object"}]},required:!1}}};const B=`${H.prefix}--datagrid`,je=o=>{const s=(_,{cell:c,instance:w})=>{var D,V,r,U,h,E;const v=c.column.inlineEdit,i=(V=(D=c.column)==null?void 0:D.inlineEdit)==null?void 0:V.type,I=(r=c.column)==null?void 0:r.isDisabled,a=typeof c.value=="object"&&c.column.id===((U=c.value)==null?void 0:U.columnId)&&((h=c.value)==null?void 0:h.isStaticCell),N=C=>d.createElement(X,{config:v,tabIndex:-1,value:c.value,cell:c,disabledCell:I,instance:w,type:C});return c.column.id==="spacer"?[_,{className:j(`${B}__cell`,`${B}__cell--spacer`)}]:[_,{className:j(`${B}__cell`,`${B}__cell-inline-edit`),role:"gridcell",children:d.createElement(d.Fragment,null,!a&&i==="text"&&N(i),!a&&i==="number"&&N(i),!a&&i==="selection"&&N(i),i==="checkbox"&&N(i),!a&&i==="date"&&N(i),a&&d.createElement(X,{config:v,tabIndex:-1,value:(E=c.value)==null?void 0:E.value,cell:c,instance:w,nonEditCell:!0,type:"text"}),!i&&d.createElement(X,{config:v,tabIndex:-1,value:c.value,cell:c,instance:w,disabledCell:I,nonEditCell:!0,type:"text"}))}]};o.getCellProps.push(s),o.useInstance.push(_=>{Object.assign(_,{withInlineEdit:!0})})},He=o=>{je(o)};export{je as a,He as u};
