import{u as be,a as He,e as Ve,f as We,c as je,b as ze,d as W,_ as Q,P as t,bL as we,r as Ke,m as Xe,T as Ye,bO as Ge,q as ue,J as Ue,D as Je,H as Qe,O as Ze,k as et,g as de}from"./index-C360Eztx.js";import{e as g,r as o}from"./index-DtHxqM--.js";import{I as ve}from"./settings-CFkY3W_8.js";import{b as tt,a as ot}from"./useAttachedMenu-DmwntCh_.js";import{m as ne}from"./mergeRefs-91-mP8KM.js";import{d as Ee,m as ye}from"./index-BopFi8TB.js";import{aM as Re}from"./bucket-12-BdSjg9jc.js";import{g as Oe,c as U}from"./_commonjsHelpers-Cpj98o6Y.js";import{h as nt}from"./index-DgLvjnYm.js";import{s as rt,b as st,w as it,a as at}from"./wrapFocus-BeRLXXyC.js";import{n as te}from"./events-CdfZZS3f.js";import{u as ct}from"./useOutsideClick-BpB8dfan.js";const pe="md",Ce=g.forwardRef(function({autoAlign:r=!1,children:w,className:d,label:p="Options",renderIcon:l=Re,size:s=pe,menuAlignment:v="bottom-start",tooltipAlignment:N,menuTarget:c,...T},h){const E=be("enable-v12-dynamic-floating-styles")||r,{refs:i,floatingStyles:x,placement:m,middlewareData:y}=He(E?{placement:v,strategy:"fixed",middleware:[r&&We({fallbackPlacements:v.includes("bottom")?["bottom-start","bottom-end","top-start","top-end"]:["top-start","top-end","bottom-start","bottom-end"]})],whileElementsMounted:Ve}:{}),R=je("overflowmenu"),f=ze(),C=o.useRef(null),{open:I,x:F,y:B,handleClick:j,handleMousedown:D,handleClose:u}=tt(C);o.useEffect(()=>{E&&Object.keys(x).forEach(S=>{i.floating.current&&(i.floating.current.style[S]=x[S])})},[x,E,i.floating,I,m,y]);function e(){C.current&&j()}const b=W(d,`${f}--overflow-menu__container`,{[`${f}--autoalign`]:E}),O=W(`${f}--overflow-menu__${v}`),M=W(`${f}--overflow-menu`,{[`${f}--overflow-menu--open`]:I},s!==pe&&`${f}--overflow-menu--${s}`),L=ne(C,i.setReference);return g.createElement("div",Q({},T,{className:b,"aria-owns":I?R:void 0,ref:h}),g.createElement(ve,{"aria-controls":I?R:void 0,"aria-haspopup":!0,"aria-expanded":I,className:M,onClick:e,onMouseDown:D,ref:L,label:p,align:N,kind:"ghost"},g.createElement(l,{className:`${f}--overflow-menu__icon`})),g.createElement(ot,{containerRef:C,ref:i.setFloating,menuAlignment:v,className:O,id:R,size:s,legacyAutoalign:!E,open:I,onClose:u,x:F,y:B,label:p,target:c},w))});Ce.propTypes={autoAlign:t.bool,children:t.node,className:t.string,label:t.string,menuAlignment:t.oneOf(["top-start","top-end","bottom-start","bottom-end"]),renderIcon:t.oneOfType([t.func,t.object]),size:t.oneOf(["sm","md","lg"]),tooltipAlignment:Ee(t.oneOf(["top","top-left","top-right","bottom","bottom-left","bottom-right","left","left-bottom","left-top","right","right-bottom","right-top","top-start","top-end","bottom-start","bottom-end","left-end","left-start","right-end","right-start"]),["top","top-start","top-end","bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end"],ye),menuTarget:t.instanceOf(typeof Element<"u"?Element:Object)};var oe,me;function lt(){if(me)return oe;me=1;var a=function(r,w,d,p,l,s,v,N){if(!r){var c;if(w===void 0)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var T=[d,p,l,s,v,N],h=0;c=new Error(w.replace(/%s/g,function(){return T[h++]})),c.name="Invariant Violation"}throw c.framesToPop=1,c}};return oe=a,oe}var ft=lt();const St=Oe(ft);var J,ge;function ut(){return ge||(ge=1,J=typeof self=="object"&&self.self===self&&self||typeof U=="object"&&U.global===U&&U||J),J}var dt=ut();const V=Oe(dt),pt=(()=>{const a=[];let r=!1;const w=()=>{a.forEach(l=>{l()}),r=!1},d=()=>{r||(r=!0,V.requestAnimationFrame(w))},p=l=>{a.indexOf(l)<0&&a.push(l)};return{add:l=>(a.length||V.addEventListener("resize",d),p(l),{remove:()=>{const s=a.indexOf(l);s>=0&&a.splice(s,1)}})}})(),mt="left",re="top",gt="right",X="bottom",ht=({menuSize:a,refPosition:r,offset:w,direction:d,scrollX:p,scrollY:l,container:s})=>{const{left:v=0,top:N=0,right:c=0,bottom:T=0}=r,h=s.position!=="static"?0:p,E=s.position!=="static"?0:l,i={top:s.position!=="static"?s.rect.top:0,left:s.position!=="static"?s.rect.left:0},{width:x,height:m}=a,{top:y=0,left:R=0}=w,f=(v+c)/2,C=(N+T)/2;return{[mt]:()=>({left:v-x+h-R-i.left,top:C-m/2+E+y-9-i.top}),[re]:()=>({left:f-x/2+h+R-i.left,top:N-m+E-y-i.top}),[gt]:()=>({left:c+h+R-i.left,top:C-m/2+E+y+3-i.top}),[X]:()=>({left:f-x/2+h+R-i.left,top:T+E+y-i.top})}[d]()},bt=({children:a,flipped:r,focusTrap:w,menuDirection:d=X,menuOffset:p={top:0,left:0},menuRef:l,onPlace:s,selectorPrimaryFocus:v,styles:N,target:c=()=>document.body,triggerRef:T,updateOrientation:h})=>{const E=o.useContext(we),[i,x]=o.useState(void 0),m=o.useRef(null),y=o.useRef(null),R=o.useRef(null),f=o.useRef(!1),C=o.useCallback(e=>{const b=m.current;if(!b)return;const O=T.current,M=b.getBoundingClientRect(),L=O?O.getBoundingClientRect():void 0,S=typeof p=="function"?p(b,d,O,r):p;if(h&&h({menuSize:M,refPosition:L,direction:d,offset:S,scrollX:V.pageXOffset,scrollY:V.pageYOffset,container:{rect:c().getBoundingClientRect(),position:getComputedStyle(c()).position}}),M.width>0&&M.height>0||!S){const P=ht({menuSize:M,refPosition:L??{left:0,top:0,right:0,bottom:0},offset:S,direction:d,scrollX:V.pageXOffset,scrollY:V.pageYOffset,container:{rect:c().getBoundingClientRect(),position:getComputedStyle(c()).position}});if((!i||i.left!==P.left||i.top!==P.top)&&x(P),!e){const Y=b.getBoundingClientRect();(Y.width!==M.width||Y.height!==M.height)&&C(!0)}}},[T,p,d,r,c,h,i]),I=e=>{const b=v?e.querySelector(v):null,O=e.querySelector(rt),M=e.querySelector(st);(b||O||M||e).focus()},F=e=>{m.current=e,f.current=!!e,l&&l(e),e&&C()};o.useEffect(()=>{f.current&&i&&m.current&&(m.current.contains(document.activeElement)||I(m.current),typeof s=="function"&&s(m.current),f.current=!1)},[i,s]),o.useEffect(()=>{const e=pt.add(()=>{C()});return()=>{e.remove()}},[T,p,d,r,c,h]),o.useEffect(()=>{C()},[p,d,r,T,c,h]);const B=()=>{const e=i,b=e?{left:`${e.left}px`,top:`${e.top}px`,right:"auto"}:{visibility:"hidden",top:"0px"},O=a;return o.cloneElement(O,{ref:F,style:{...N,...b,position:"absolute",opacity:1}})},j=e=>{const{target:b,relatedTarget:O}=e;m.current&&y.current&&R.current&&b instanceof HTMLElement&&O instanceof HTMLElement&&at({bodyNode:m.current,startTrapNode:y.current,endTrapNode:R.current,currentActiveNode:O,oldActiveNode:b})},D=e=>{Xe(e,Ye)&&m.current&&e.target instanceof HTMLElement&&it({containerNode:m.current,currentActiveNode:e.target,event:e})},u=Ke("enable-experimental-focus-wrap-without-sentinels");if(typeof document<"u"){const e=c?c():document.body;return nt.createPortal(g.createElement("div",{onBlur:w&&!u?j:void 0,onKeyDown:u?D:void 0},!u&&g.createElement("span",{ref:y,tabIndex:0,role:"link",className:`${E}--visually-hidden`},"Focus sentinel"),B(),!u&&g.createElement("span",{ref:R,tabIndex:0,role:"link",className:`${E}--visually-hidden`},"Focus sentinel")),e)}return null},wt=Ge(),vt=(a,...r)=>(a.addEventListener(...r),{release(){return a.removeEventListener(...r),null}}),Et={[re]:"bottom",[X]:"top"},he=(a,r,w,d)=>{const p=Et[r],{offsetWidth:l,offsetHeight:s}=a;switch(p){case"top":case"bottom":{const v=w?w.offsetWidth:0;return{left:(d?-1:1)*(l/2-v/2),top:0}}default:return{left:0,top:0}}},se=o.forwardRef(({align:a,["aria-label"]:r=null,ariaLabel:w,children:d,className:p,direction:l=X,flipped:s=!1,focusTrap:v=!0,iconClass:N,iconDescription:c="Options",id:T,light:h,menuOffset:E=he,menuOffsetFlip:i=he,menuOptionsClass:x,onClick:m=te,onClose:y=te,onOpen:R=te,open:f,renderIcon:C=Re,selectorPrimaryFocus:I="[data-floating-menu-primary-focus]",size:F="md",innerRef:B,...j},D)=>{const u=o.useContext(we),[e,b]=o.useState(f??!1),[O,M]=o.useState(!1),[L,S]=o.useState(!1),P=o.useRef(null),Y=o.useRef(wt()),H=o.useRef(null),ie=o.useRef({}),ae=o.useRef(f),Z=o.useRef(e),_=o.useRef(null),ce=o.useRef(null);o.useEffect(()=>{ae.current!==f&&(b(!!f),ae.current=f)},[f]),o.useEffect(()=>{_.current&&S(!0)},[]),o.useEffect(()=>{e&&!Z.current?R():!e&&Z.current&&y(),Z.current=e},[e,y,R]),ct(ce,({target:n})=>{e&&(!H.current||n instanceof Node&&!H.current.contains(n))&&z()});const G=o.useCallback(()=>{_.current&&_.current.focus()},[]),z=o.useCallback(n=>{b(!1),n&&n(),y()},[y]),le=o.useCallback(()=>{const n=O,$=e;z(()=>{$&&!n&&G()})},[O,e,z,G]),Me=o.useCallback(()=>{const n=e;z(()=>{n&&G()})},[e,z,G]),xe=n=>{M(!0),(!H.current||!H.current.contains(n.target))&&(b($=>!$),m(n))},Ie=n=>{e&&ue(n,[Ue,Je,Qe,Ze])&&n.preventDefault(),ue(n,[et])&&(Me(),n.stopPropagation())},$e=({currentIndex:n=0,direction:$})=>{const k=o.Children.toArray(d).reduce((A,fe,De)=>(g.isValidElement(fe)&&!fe.props.disabled&&A.push(De),A),[]),K=(()=>{const A=k.indexOf(n)+$;switch(A){case-1:return k.length-1;case k.length:return 0;default:return A}})(),q=ie.current[k[K]];q==null||q.focus()},Ne=n=>{n||(H.current=n),!n&&P.current&&(P.current=P.current.release())},Fe=n=>{if(!n)return;H.current=n;const $="onfocusin"in window,k=$?"focusin":"focus";P.current=vt(n.ownerDocument,k,K=>{const q=K.target,A=_.current;typeof q.matches=="function"&&!n.contains(q)&&A&&!q.matches(`.${u}--overflow-menu:first-child, .${u}--overflow-menu-options:first-child`)&&le()},!$)},ke=()=>{const n=_.current;return n instanceof Element&&n.closest("[data-floating-menu-container]")||document.body},ee=`overflow-menu-${Y.current}__menu-body`,Se=W(p,`${u}--overflow-menu`,{[`${u}--overflow-menu--open`]:e,[`${u}--overflow-menu--light`]:h,[`${u}--overflow-menu--${F}`]:F}),Pe=W(x,`${u}--overflow-menu-options`,{[`${u}--overflow-menu--flip`]:s,[`${u}--overflow-menu-options--open`]:e,[`${u}--overflow-menu-options--light`]:h,[`${u}--overflow-menu-options--${F}`]:F}),_e=W(`${u}--overflow-menu__icon`,N),Le=o.Children.toArray(d).map((n,$)=>{if(o.isValidElement(n)){const k=n;return o.cloneElement(k,{closeMenu:k.props.closeMenu||le,handleOverflowMenuItemFocus:$e,ref:K=>{ie.current[$]=K},index:$})}return null}),qe=g.createElement("ul",{className:Pe,tabIndex:-1,role:"menu","aria-label":r||w,onKeyDown:Ie,id:ee},Le),Ae=g.createElement(bt,{focusTrap:v,triggerRef:_,menuDirection:l,menuOffset:s?i:E,menuRef:Ne,flipped:s,target:ke,onPlace:Fe,selectorPrimaryFocus:I},o.cloneElement(qe,{"data-floating-menu-direction":l})),Be=B?ne(_,B,D):ne(_,D);return g.createElement(g.Fragment,null,g.createElement("span",{className:`${u}--overflow-menu__wrapper`,"aria-owns":e?ee:void 0,ref:ce},g.createElement(ve,Q({},j,{align:a,type:"button","aria-haspopup":!0,"aria-expanded":e,"aria-controls":e?ee:void 0,className:Se,onClick:xe,id:T,ref:Be,size:F,label:c,kind:"ghost"}),g.createElement(C,{className:_e,"aria-label":c})),e&&L&&Ae))});se.propTypes={align:Ee(t.oneOf(["top","top-left","top-right","bottom","bottom-left","bottom-right","left","left-bottom","left-top","right","right-bottom","right-top","top-start","top-end","bottom-start","bottom-end","left-end","left-start","right-end","right-start"]),["top","top-start","top-end","bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end"],ye),"aria-label":t.string,ariaLabel:de(t.string),children:t.node,className:t.string,direction:t.oneOf([re,X]),flipped:t.bool,focusTrap:t.bool,iconClass:t.string,iconDescription:t.string,id:t.string,light:de(t.bool),menuOffset:t.oneOfType([t.shape({top:t.number.isRequired,left:t.number.isRequired}),t.func]),menuOffsetFlip:t.oneOfType([t.shape({top:t.number.isRequired,left:t.number.isRequired}),t.func]),menuOptionsClass:t.string,onClick:t.func,onClose:t.func,onFocus:t.func,onKeyDown:t.func,onOpen:t.func,open:t.bool,renderIcon:t.oneOfType([t.func,t.object]),selectorPrimaryFocus:t.string,size:t.oneOf(["sm","md","lg"])};const Te=o.forwardRef((a,r)=>be("enable-v12-overflowmenu")?g.createElement(Ce,Q({},a,{ref:r})):g.createElement(se,Q({},a,{ref:r})));Te.displayName="OverflowMenu";Te.propTypes=se.propTypes;export{Te as O,St as i};
