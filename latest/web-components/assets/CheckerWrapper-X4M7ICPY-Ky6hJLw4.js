const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ace-window-D0JDShqD.js","./iframe-CRtCEvHj.js","./preload-helper-D9Z9MdNV.js","./story-styles-tn0RQdqM.css"])))=>i.map(i=>d[i]);
import{_ as g}from"./preload-helper-D9Z9MdNV.js";import{d}from"./iframe-CRtCEvHj.js";var u=class h{constructor(e){this.config=e,this.ruleTKLevel={}}static async getWrapper(e){const c=new h;return await c.initialize(),c}async initialize(){await g(()=>import("./ace-window-D0JDShqD.js").then(i=>i.a),__vite__mapDeps([0,1,2,3]),import.meta.url);const e=window.ace_ibma,{Checker:c}=e;this.checker=new c,this.guidelines=this.checker.getGuidelines().filter(i=>(!this.config?.guidelines||this.config.guidelines.length===0)&&i.id==="IBM_Accessibility"||this.config?.guidelines&&this.config.guidelines.length>0&&this.config?.guidelines?.includes(i.id)),this.guidelines.forEach(i=>{i.checkpoints.forEach(l=>{l.rules?.forEach(t=>{this.ruleTKLevel[t.id]=t.toolkitLevel})})})}configureEngine(){this.guidelines.forEach(e=>{e.checkpoints.forEach(c=>{(c.rules||[]).forEach(i=>{const l=i,t=this.config?.rules?.find(r=>r.id===l.id);t?l.enabled=t.enabled!==!1:this.config?.disableOtherRules===!0&&(l.enabled=!1)})}),this.checker.addGuideline(e)})}async run(e){this.configureEngine();const c=await this.checker.check(e,this.guidelines.map(t=>t.id));if(this.config?.rules){const t=this.config.rules.filter(r=>r.selector);t.length>0&&(c.results=c.results.filter(r=>{const s=t.find(n=>n.id===r.ruleId);return!s||!s.selector||r.node.nodeType!==1||r.node.matches(s.selector)}))}let i=1,l=e;for(;l.nodeName!=="html"&&l.parentElement;)l=l.parentElement,i+=1;return this.convertResult(e,c,i)}convertResult(e,c,i){try{const{results:l}=c;return{testEngine:{name:"accessibility-checker-engine",version:"3.1.62"},testRunner:{name:"accessibility-checker"},timestamp:new Date().toISOString(),url:document.location.href,toolOptions:{},inapplicable:[],passes:this.convertCollection(e,c,l.filter(t=>t.value[1]==="PASS"),i),incomplete:this.convertCollection(e,c,l.filter(t=>t.value[0]==="VIOLATION"&&(t.value[1]==="POTENTIAL"||t.value[1]==="MANUAL")),i),violations:this.convertCollection(e,c,l.filter(t=>t.value[0]==="VIOLATION"&&t.value[1]==="FAIL"),i)}}catch(l){return console.error(l),{}}}xpathToCSS(e){return e.substring(1).replace(/\//g," > ").replace(/\[(\d+)\]/g,":nth-of-type($1)")}convertCollection(e,c,i,l){const t={};i.forEach(s=>{t[s.ruleId]=t[s.ruleId]||[],t[s.ruleId].push(s)});const r=[];return Object.keys(t).forEach(s=>{const n=t[s][0],a={id:s,impact:"",tags:[],description:"",help:c.nls?c.nls[s][0]:"",helpUrl:this.getHelpUrl(n),nodes:t[s].map(o=>this.convertIssue(e,o,l)).filter(o=>!!o)};a.nodes.length>0&&r.push(a)}),r}convertIssue(e,c,i){const l=c.path.dom.substring(1).split("/");if(i>=l.length)return;let t=this.xpathToCSS(`/${l.slice(i).join("/")}`);t=this.simplifySelector(e,t);let r="serious";if(c.ruleId in this.ruleTKLevel){const s=this.ruleTKLevel[c.ruleId];s==="1"&&(r="critical"),s==="2"&&(r="serious"),s==="3"&&(r="minor")}return{any:[{impact:r,message:c.message}],all:[],none:[],target:[t]}}simplifySelector(e,c){let i=c.split(" > ");for(let l=0;l<i.length;l+=1){let t="";l>0&&(t=`${i.slice(0,l).join(" > ")} > `);const r=e.querySelector(t+i[l]);r&&(r?.hasAttribute("id")&&e.querySelector(`${t}#${CSS.escape(r.getAttribute("id"))}`)===r&&e.querySelectorAll(`${t}#${CSS.escape(r.getAttribute("id"))}`).length===1?i[l]=`#${CSS.escape(r.getAttribute("id"))}`:r?.hasAttribute("class")&&e.querySelector(`${t}.${CSS.escape(r.getAttribute("class"))}`)===r&&e.querySelectorAll(`${t}.${CSS.escape(r.getAttribute("class"))}`).length===1?i[l]=`.${CSS.escape(r.getAttribute("class"))}`:e.querySelector(t+r.nodeName)===r&&e.querySelectorAll(t+r.nodeName).length===1&&(i[l]=r.nodeName.toLowerCase()))}for(;i.length>1&&e.querySelector(i.slice(1).join(" > "))===e.querySelector(i.join(" > "))&&e.querySelectorAll(i.slice(1).join(" > ")).length===1;)i=i.slice(1);return e.querySelector(i.join(" "))!==e.querySelector(i.join(" > "))||e.querySelectorAll(i.join(" ")).length>1?i.join(" > "):i.join(" ")}getHelpUrl(e){return e.help?e.help:`${this.checker.engine.getHelp(e.ruleId,e.reasonId)}`}};d(u,"CheckerWrapper");var S=u;export{S as CheckerWrapper};
