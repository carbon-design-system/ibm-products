//
// Copyright IBM Corp. 2023, 2023
//
// This source code is licensed under the Apache-2.0 license found in the
// LICENSE file in the root directory of this source tree.
//

/**
 * The CoachmarkBeacon specifically is theme-agnostic, and so we have to
 * use color tokens to keep the colors static instead of theme tokens
 * that will change depending on the selected theme.
 *
 * Because of this, we are triggering a *large* amount of linting errors.
 * So, we're adding 4 "disable" rules for the file instead of 50
 * individual rules.
 */

/* stylelint-disable carbon/layout-token-use */
/* stylelint-disable carbon/motion-duration-use */
/* stylelint-disable carbon/theme-token-use */

// Standard imports.
@import '../../global/styles/project-settings';
@import '../../global/styles/mixins';

@mixin coachmark-beacon {
  // The block part of our conventional BEM class names (blockClass__E--M).
  $block-class: #{$pkg-prefix}--coachmark-beacon;
  $beaconAnimationTime: 2s;
  .#{$block-class} {
    position: relative;

    &-default {
      .#{$block-class}__target {
        // the blue dot
        &::after {
          position: absolute;
          top: calc($spacing-01 + $spacing-03);
          left: calc($spacing-01 + $spacing-03);
          width: $spacing-04;
          height: $spacing-04;
          border-radius: 50%;
          background-color: $blue-50;
          content: '';
        }
      }
    }

    &-ring {
      .#{$block-class}__center {
        -webkit-mask-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='80px' height='80px' viewBox='008080'><pathfill='white' stroke='none' d='M0,0m37-2a404001010Zm128a1212011-10Z'/></svg>");
        mask-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='80px' height='80px' viewBox='008080'><pathfill='white' stroke='none' d='M0,0m37-2a404001010Zm128a1212011-10Z'/></svg>");

        circle {
          /* stylelint-disable-next-line carbon/motion-easing-use */
          animation: ring-ripple $beaconAnimationTime infinite;
          @media (prefers-reduced-motion) {
            animation: none;
          }
        }
      }
    }

    .#{$block-class}__target {
      // the hit area
      position: absolute;
      top: calc(-1 * $spacing-05);
      left: calc(-1 * $spacing-05);
      width: $spacing-07;
      height: $spacing-07;
      padding: 0;
      border: none;
      border-radius: 50%;
      background-color: transparent;
      cursor: pointer;

      &[aria-expanded='true'] {
        circle {
          animation: none;
        }
      }
    }

    &__center {
      position: absolute;
      z-index: 6900;
      top: calc(($spacing-06 - $spacing-01) * -1);
      left: calc(($spacing-06 - $spacing-01) * -1);
      width: $spacing-11;
      height: $spacing-11;
      pointer-events: none;

      circle {
        /* stylelint-disable-next-line carbon/motion-easing-use */
        animation: ripple $beaconAnimationTime infinite;
        fill: $support-04;
        fill-opacity: 0;
        -webkit-mask-image: none;
        mask-image: none;
        stroke: $support-04;
        stroke-opacity: 0;
        stroke-width: 1px;
        transition-timing-function: carbon--motion(exit, productive);
        @media (prefers-reduced-motion) {
          animation: none;
        }
      }
    }
  }

  @keyframes ripple {
    0% {
      fill-opacity: 0;
      r: 1px;
      stroke-opacity: 0;
      transition-timing-function: carbon--motion(entrance, productive);
    }

    31% {
      fill-opacity: 0.2;
      stroke-opacity: 1;
    }

    62% {
      fill-opacity: 0;
      r: 32px;
      stroke-opacity: 0;
    }

    100% {
      fill-opacity: 0;
      r: 32px;
      stroke-opacity: 0;
    }
  }

  @keyframes ring-ripple {
    0% {
      fill-opacity: 0;
      r: 12px;
      stroke-opacity: 0;
      transition-timing-function: carbon--motion(entrance, productive);
    }

    31% {
      fill-opacity: 0.2;
      stroke-opacity: 1;
    }

    62% {
      fill-opacity: 0;
      r: 32px;
      stroke-opacity: 0;
    }

    100% {
      fill-opacity: 0;
      r: 32px;
      stroke-opacity: 0;
    }
  }
}

@include exports('coachmark-beacon') {
  @include coachmark-beacon;
}
