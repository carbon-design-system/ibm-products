import{e as a,r as Y}from"./index-DzvNrmz8.js";import{u as te,a as fe,e as pe,f as de,c as he,b as me,d as P,_ as K,P as n,bQ as i,p as ge,T as be,o as we,bP as ne,bS as ve,n as H,J as ye,D as Oe,H as _e,U as Ce,q as Me,g as G}from"./index-5As4T26e.js";import{I as oe,n as T}from"./settings-CP9zVSjJ.js";import{b as Ee,a as Re}from"./useAttachedMenu-ByErO-AK.js";import{m as se}from"./mergeRefs-CTUecegF.js";import{d as Te}from"./index-P6UCShJt.js";import{am as ie}from"./bucket-12-BMUr2nnk.js";import{h as Ie}from"./index-Cg1swjps.js";import{c as S,g as re}from"./_commonjsHelpers-D6-XlEtG.js";import{s as Pe,b as xe,a as Fe,w as $e}from"./wrapFocus-DPmHpWJH.js";import{c as De}from"./createClassWrapper-0jMU_xgu.js";const J="md",Se=c=>({"top-left":"top-start","top-right":"top-end","bottom-left":"bottom-start","bottom-right":"bottom-end","left-bottom":"left-end","left-top":"left-start","right-bottom":"right-end","right-top":"right-start"})[c],ae=a.forwardRef(function(e,t){let{autoAlign:o=!1,children:s,className:u,label:l="Options",renderIcon:r=ie,size:p=J,menuAlignment:f="bottom-start",tooltipAlignment:y,menuTarget:v,...b}=e;const h=te("enable-v12-dynamic-floating-styles")||o,{refs:d,floatingStyles:w,placement:_,middlewareData:C}=fe(h?{placement:f,strategy:"fixed",middleware:[o&&de({fallbackPlacements:f.includes("bottom")?["bottom-start","bottom-end","top-start","top-end"]:["top-start","top-end","bottom-start","bottom-end"]})],whileElementsMounted:pe}:{}),O=he("overflowmenu"),m=me(),g=Y.useRef(null),{open:M,x:E,y:z,handleClick:A,handleMousedown:L,handleClose:W}=Ee(g);Y.useEffect(()=>{h&&Object.keys(w).forEach($=>{d.floating.current&&(d.floating.current.style[$]=w[$])})},[w,h,d.floating,M,_,C]);function x(){g.current&&A()}const j=P(u,`${m}--overflow-menu__container`,{[`${m}--autoalign`]:h}),q=P(`${m}--overflow-menu__${f}`),V=P(`${m}--overflow-menu`,{[`${m}--overflow-menu--open`]:M},p!==J&&`${m}--overflow-menu--${p}`),F=se(g,d.setReference);return a.createElement("div",K({},b,{className:j,"aria-owns":M?O:void 0,ref:t}),a.createElement(oe,{"aria-controls":M?O:void 0,"aria-haspopup":!0,"aria-expanded":M,className:V,onClick:x,onMouseDown:L,ref:F,label:l,align:y,kind:"ghost"},a.createElement(r,{className:`${m}--overflow-menu__icon`})),a.createElement(Re,{containerRef:g,ref:d.setFloating,menuAlignment:f,className:q,id:O,size:p,legacyAutoalign:!h,open:M,onClose:W,x:E,y:z,label:l,target:v},s))});ae.propTypes={autoAlign:n.bool,children:n.node,className:n.string,label:n.string,menuAlignment:n.oneOf(["top-start","top-end","bottom-start","bottom-end"]),renderIcon:n.oneOfType([n.func,n.object]),size:n.oneOf(["sm","md","lg"]),tooltipAlignment:Te(n.oneOf(["top","top-left","top-right","bottom","bottom-left","bottom-right","left","left-bottom","left-top","right","right-bottom","right-top","top-start","top-end","bottom-start","bottom-end","left-end","left-start","right-end","right-start"]),["top","top-start","top-end","bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end"],Se),menuTarget:n.instanceOf(typeof Element<"u"?Element:Object)};var B,Q;function Be(){return Q||(Q=1,B=typeof self=="object"&&self.self===self&&self||typeof S=="object"&&S.global===S&&S||B),B}var Ne=Be();const I=re(Ne),ke=function(){const e=[];let t=!1;function o(){e.forEach(l=>{l()}),t=!1}function s(){t||(t=!0,I.requestAnimationFrame(o))}function u(l){l&&e.indexOf(l)<0&&e.push(l)}return{add:l=>(e.length||I.addEventListener("resize",s),u(l),{release(){const r=e.indexOf(l);r>=0&&e.splice(r,1)}})}}();var ze=ke;const le="left",N="top",ce="right",R="bottom",Ae=function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return typeof c!=typeof e?!0:Object(e)===e&&typeof e!="function"?c.top!==e.top||c.left!==e.left:c!==e},Le=c=>{let{menuSize:e,refPosition:t={},offset:o={},direction:s=R,scrollX:u=0,scrollY:l=0,container:r}=c;const{left:p=0,top:f=0,right:y=0,bottom:v=0}=t,b=r.position!=="static"?0:u,h=r.position!=="static"?0:l,d={top:r.position!=="static"?r.rect.top:0,left:r.position!=="static"?r.rect.left:0},{width:w,height:_}=e,{top:C=0,left:O=0}=o,m=(p+y)/2,g=(f+v)/2;return{[le]:()=>({left:p-w+b-O-d.left,top:g-_/2+h+C-9-d.top}),[N]:()=>({left:m-w/2+b+O-d.left,top:f-_+h-C-d.top}),[ce]:()=>({left:y+b+O-d.left,top:g-_/2+h+C+3-d.top}),[R]:()=>({left:m-w/2+b+O-d.left,top:v+h+C-d.top})}[s]()};class X extends a.Component{constructor(){var e;super(...arguments),e=this,i(this,"_placeInProgress",!1),i(this,"state",{floatingPosition:void 0}),i(this,"_menuContainer",null),i(this,"_menuBody",null),i(this,"startSentinel",a.createRef()),i(this,"endSentinel",a.createRef()),i(this,"_updateMenuSize",function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const s=e._menuBody;if(!s)return;const{menuOffset:u={},menuDirection:l}=t,{menuOffset:r={},menuDirection:p=R}=e.props;if(Ae(u,r)||l!==p||o){const{flipped:f,triggerRef:y,updateOrientation:v=null}=e.props,{current:b}=y,h=s.getBoundingClientRect(),d=b&&b.getBoundingClientRect(),w=typeof r!="function"?r:r(s,p,b,f);v&&v({menuSize:h,refPosition:d,direction:p,offset:w,scrollX:I.pageXOffset,scrollY:I.pageYOffset,container:{rect:e.props.target().getBoundingClientRect(),position:getComputedStyle(e.props.target()).position}}),(h.width>0&&h.height>0||!w)&&e.setState({floatingPosition:Le({menuSize:h,refPosition:d,direction:p,offset:w,scrollX:I.pageXOffset,scrollY:I.pageYOffset,container:{rect:e.props.target().getBoundingClientRect(),position:getComputedStyle(e.props.target()).position}})},()=>{o||s.getBoundingClientRect()!==h&&e._updateMenuSize(e.props,!0)})}}),i(this,"_focusMenuContent",t=>{const o=t.querySelector(this.props.selectorPrimaryFocus||null),s=t.querySelector(Pe),u=t.querySelector(xe);(o||s||u||t).focus()}),i(this,"_menuRef",t=>{const{menuRef:o}=this.props;this._placeInProgress=!!t,o&&o(this._menuBody=t),t&&this._updateMenuSize()}),i(this,"_getChildrenWithProps",()=>{const{styles:t,children:o}=this.props,{floatingPosition:s}=this.state,u=s?{left:`${s.left}px`,top:`${s.top}px`,right:"auto"}:{visibility:"hidden",top:"0px"};return a.cloneElement(o,{ref:this._menuRef,style:{...t,...u,position:"absolute",opacity:1}})}),i(this,"handleBlur",t=>{let{target:o,relatedTarget:s}=t;if(s&&o){const{current:u}=this.startSentinel,{current:l}=this.endSentinel;Fe({bodyNode:this._menuBody,currentActiveNode:s,oldActiveNode:o})}}),i(this,"handleKeyDown",t=>{ge(t,be)&&this._menuBody&&$e({containerNode:this._menuBody,currentActiveNode:t.target,event:t})})}componentWillUnmount(){this.hResize.release()}componentDidMount(){this.hResize=ze.add(()=>{this._updateMenuSize()})}componentDidUpdate(e){this._updateMenuSize(e);const{onPlace:t}=this.props;this._placeInProgress&&this.state.floatingPosition&&(this._menuBody&&!this._menuBody.contains(document.activeElement)&&this._focusMenuContent(this._menuBody),typeof t=="function"&&(t(this._menuBody),this._placeInProgress=!1))}render(){const{context:e}=this,t=we("enable-experimental-focus-wrap-without-sentinels");if(typeof document<"u"){const{focusTrap:o,target:s}=this.props;return Ie.createPortal(a.createElement("div",{onBlur:o&&!t?this.handleBlur:()=>{},onKeyDown:t?this.handleKeyDown:()=>{}},!t&&a.createElement("span",{ref:this.startSentinel,tabIndex:"0",role:"link",className:`${e}--visually-hidden`},"Focus sentinel"),this._getChildrenWithProps(),!t&&a.createElement("span",{ref:this.endSentinel,tabIndex:"0",role:"link",className:`${e}--visually-hidden`},"Focus sentinel")),s?s():document.body)}return null}}i(X,"contextType",ne);i(X,"propTypes",{children:n.object,flipped:n.bool,focusTrap:n.bool,menuDirection:n.oneOf([le,N,ce,R]),menuOffset:n.oneOfType([n.shape({top:n.number,left:n.number}),n.func]),menuRef:n.func,onPlace:n.func,selectorPrimaryFocus:n.string,styles:n.object,target:n.func,triggerRef:n.oneOfType([n.func,n.shape({current:n.any})]),updateOrientation:n.func});var We=X;class D extends a.Component{static getEventTarget(e){return e.composed&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target}constructor(e){super(e),this.handleRef=this.handleRef.bind(this),this.handleDocumentClick=this.handleDocumentClick.bind(this)}componentDidMount(){document.addEventListener("click",this.handleDocumentClick)}componentWillUnmount(){document.removeEventListener("click",this.handleDocumentClick)}handleDocumentClick(e){this.element&&this.element.contains&&!this.element.contains(D.getEventTarget(e))&&this.props.onClickOutside(e)}handleRef(e){const{children:t}=this.props;this.element=e,t.ref&&typeof t.ref=="function"&&t.ref(e)}render(){return a.cloneElement(this.props.children,{ref:this.handleRef})}}i(D,"propTypes",{children:n.element.isRequired,onClickOutside:n.func.isRequired});var U,Z;function je(){if(Z)return U;Z=1;var c=function(e,t,o,s,u,l,r,p){if(!e){var f;if(t===void 0)f=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var y=[o,s,u,l,r,p],v=0;f=new Error(t.replace(/%s/g,function(){return y[v++]})),f.name="Invariant Violation"}throw f.framesToPop=1,f}};return U=c,U}var qe=je();const rt=re(qe),Ve=ve(),Ue=function(c){for(var e=arguments.length,t=new Array(e>1?e-1:0),o=1;o<e;o++)t[o-1]=arguments[o];return c.addEventListener(...t),{release(){return c.removeEventListener(...t),null}}},Ke={[N]:"bottom",[R]:"top"},ee=(c,e,t,o)=>{const s=Ke[e],{offsetWidth:u,offsetHeight:l}=c;switch(s){case"top":case"bottom":{const r=t?t.offsetWidth:0;return{left:(o?-1:1)*(u/2-r/2),top:0}}}};let k=class extends a.Component{constructor(){super(...arguments),i(this,"state",{open:!1,hasMountedTrigger:!1,click:!1}),i(this,"instanceId",Ve()),i(this,"_hFocusIn",null),i(this,"_hBlurTimeout",void 0),i(this,"_triggerRef",a.createRef()),i(this,"handleClick",e=>{const{onClick:t=T}=this.props;this.setState({click:!0}),(!this._menuBody||!this._menuBody.contains(e.target))&&(this.setState({open:!this.state.open}),t(e))}),i(this,"closeMenuAndFocus",()=>{const e=this.state.click,t=this.state.open;this.closeMenu(()=>{t&&!e&&this.focusMenuEl()})}),i(this,"closeMenuOnEscape",()=>{const e=this.state.open;this.closeMenu(()=>{e&&this.focusMenuEl()})}),i(this,"handleKeyPress",e=>{this.state.open&&H(e,[ye,Oe,_e,Ce])&&e.preventDefault(),H(e,[Me])&&(this.closeMenuOnEscape(),e.stopPropagation())}),i(this,"handleClickOutside",e=>{this.state.open&&(!this._menuBody||!this._menuBody.contains(e.target))&&this.closeMenu()}),i(this,"closeMenu",e=>{const{onClose:t=T}=this.props;this.setState({open:!1},()=>{e&&e(),t()})}),i(this,"focusMenuEl",()=>{const{current:e}=this._triggerRef;e&&e.focus()}),i(this,"handleOverflowMenuItemFocus",e=>{let{currentIndex:t,direction:o}=e;const s=a.Children.toArray(this.props.children).reduce((r,p,f)=>(a.isValidElement(p)&&!p.props.disabled&&r.push(f),r),[]),u=(()=>{const r=s.indexOf(t)+o;switch(r){case-1:return s.length-1;case s.length:return 0;default:return r}})(),l=this[`overflowMenuItem${s[u]}`];l==null||l.focus()}),i(this,"_menuBody",null),i(this,"_bindMenuBody",e=>{e||(this._menuBody=e),!e&&this._hFocusIn&&(this._hFocusIn=this._hFocusIn.release())}),i(this,"_handlePlace",e=>{const{onOpen:t=T}=this.props;if(e){this._menuBody=e;const o="onfocusin"in window,s=o?"focusin":"focus";this._hFocusIn=Ue(e.ownerDocument,s,u=>{const l=D.getEventTarget(u),{current:r}=this._triggerRef;typeof l.matches=="function"&&!e.contains(l)&&r&&!l.matches(`.${this.context}--overflow-menu:first-child,.${this.context}--overflow-menu-options:first-child`)&&this.closeMenuAndFocus()},!o),t()}}),i(this,"_getTarget",()=>{const{current:e}=this._triggerRef;return e instanceof Element&&e.closest("[data-floating-menu-container]")||document.body})}componentDidUpdate(e,t){const{onClose:o=T}=this.props;!this.state.open&&t.open&&o()}componentDidMount(){this._triggerRef.current&&this.setState({hasMountedTrigger:!0})}static getDerivedStateFromProps(e,t){let{open:o}=e;const{prevOpen:s}=t;return s===o?null:{open:o,prevOpen:o}}componentWillUnmount(){typeof this._hBlurTimeout=="number"&&(clearTimeout(this._hBlurTimeout),this._hBlurTimeout=void 0)}render(){const e=this.context,{id:t,["aria-label"]:o=null,ariaLabel:s,children:u,iconDescription:l="Options",direction:r=R,flipped:p=!1,focusTrap:f=!0,menuOffset:y=ee,menuOffsetFlip:v=ee,iconClass:b,onClick:h=T,onOpen:d=T,selectorPrimaryFocus:w="[data-floating-menu-primary-focus]",renderIcon:_=ie,innerRef:C,menuOptionsClass:O,light:m,size:g="md",...M}=this.props,{open:E=!1}=this.state,z=P(this.props.className,`${e}--overflow-menu`,{[`${e}--overflow-menu--open`]:E,[`${e}--overflow-menu--light`]:m,[`${e}--overflow-menu--${g}`]:g}),A=P(O,`${e}--overflow-menu-options`,{[`${e}--overflow-menu--flip`]:this.props.flipped,[`${e}--overflow-menu-options--open`]:E,[`${e}--overflow-menu-options--light`]:m,[`${e}--overflow-menu-options--${g}`]:g}),L=P(`${e}--overflow-menu__icon`,b),W=a.Children.toArray(u).map((F,$)=>a.isValidElement(F)?a.cloneElement(F,{closeMenu:F.props.closeMenu||this.closeMenuAndFocus,handleOverflowMenuItemFocus:this.handleOverflowMenuItemFocus,ref:ue=>{this[`overflowMenuItem${$}`]=ue},index:$}):null),x=`overflow-menu-${this.instanceId}__menu-body`,j=a.createElement("ul",{className:A,tabIndex:-1,role:"menu","aria-label":o||s,onKeyDown:this.handleKeyPress,id:x},W),q=a.createElement(We,{focusTrap:f,triggerRef:this._triggerRef,menuDirection:r,menuOffset:p?v:y,menuRef:this._bindMenuBody,flipped:this.props.flipped,target:this._getTarget,onPlace:this._handlePlace,selectorPrimaryFocus:this.props.selectorPrimaryFocus},a.cloneElement(j,{"data-floating-menu-direction":r})),V={className:L,"aria-label":l};return a.createElement(D,{onClickOutside:this.handleClickOutside},a.createElement("span",{className:`${e}--overflow-menu__wrapper`,"aria-owns":E?x:void 0},a.createElement(oe,K({},M,{type:"button","aria-haspopup":!0,"aria-expanded":E,"aria-controls":E?x:void 0,className:z,onClick:this.handleClick,id:t,ref:se(this._triggerRef,C),size:g,label:l,kind:"ghost"}),a.createElement(_,V)),E&&this.state.hasMountedTrigger&&q))}};i(k,"propTypes",{"aria-label":n.string,ariaLabel:G(n.string),children:n.node,className:n.string,direction:n.oneOf([N,R]),flipped:n.bool,focusTrap:n.bool,iconClass:n.string,iconDescription:n.string,id:n.string,light:G(n.bool),menuOffset:n.oneOfType([n.shape({top:n.number,left:n.number}),n.func]),menuOffsetFlip:n.oneOfType([n.shape({top:n.number,left:n.number}),n.func]),menuOptionsClass:n.string,onClick:n.func,onClose:n.func,onFocus:n.func,onKeyDown:n.func,onOpen:n.func,open:n.bool,renderIcon:n.oneOfType([n.func,n.object]),selectorPrimaryFocus:n.string,size:n.oneOf(["sm","md","lg"])});i(k,"contextType",ne);(()=>{const c=(e,t)=>a.createElement(k,K({},e,{innerRef:t}));return c.displayName="OverflowMenu",a.forwardRef(c)})();const Xe=De(k);function Ye(c){return te("enable-v12-overflowmenu")?a.createElement(ae,c):a.createElement(Xe,c)}Ye.displayName="OverflowMenu";export{Ye as O,rt as i};
