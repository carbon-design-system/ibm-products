import{b as E,d as f,a7 as N}from"./index-C360Eztx.js";import{p as P}from"./settings-CFkY3W_8.js";import{r as x,e as y}from"./index-DtHxqM--.js";import{u as B}from"./useFocusRowExpander-BIwFvcb9.js";import{k as I}from"./useDatagrid-DRFhvKQ0.js";const d=`${P.prefix}--datagrid`,T=c=>{const g=E(),r=x.useRef(void 0),o=x.useRef(void 0),b=p=>{r.current=p};B({instance:r==null?void 0:r.current,lastExpandedRowIndex:o==null?void 0:o.current,blockClass:d,activeElement:typeof document<"u"&&document.activeElement});const C=(p,$)=>{const{getAsyncSubRows:n,dispatch:t,state:e}=$.instance||{},i=!!e.dynamicRowSkeleton;return[{id:"expander",Cell:({row:s})=>{const l={...s.getToggleRowExpandedProps(),disabled:n&&i,onClick:async S=>{if(S.stopPropagation(),s.toggleRowExpanded(),o.current=s.id,!s.isExpanded)try{I({dispatch:t,status:"start",rowId:s.id,depth:s.depth,index:s.index}),n&&await(n==null?void 0:n(s)),I({dispatch:t,status:"finish",rowId:s.id})}catch(v){console.log({error:v})}}},{expanderButtonTitleExpanded:h="Collapse row",expanderButtonTitleCollapsed:u="Expand row"}=(r==null?void 0:r.current)||{},m=s.isExpanded?h:u;return s.canExpand||n?y.createElement("button",{type:"button","aria-label":m,className:f(`${d}__row-expander`,`${g}--btn`,`${g}--btn--ghost`),...l},y.createElement(N,{className:f(`${d}__expander-icon`,{[`${d}__expander-icon--not-open`]:!s.isExpanded,[`${d}__expander-icon--open`]:s.isExpanded})})):null},width:48,disableResizing:!0,disableSortBy:!0,Header:""},...p]};c.visibleColumns.push(C),c.useInstance.push(b)},_=`${P.prefix}--datagrid`,k=c=>{T(c);const g=r=>{x.useEffect(()=>{const{rows:n}=r,t=n.filter(e=>{var i;return(i=e==null?void 0:e.original)==null?void 0:i.defaultExpanded});t!=null&&t.length&&t.map(e=>{var i;if(!(e!=null&&e.isExpanded)&&!(e!=null&&e.hasExpanded)){(i=e==null?void 0:e.toggleRowExpanded)==null||i.call(e),e.hasExpanded=!0;return}})},[r,r.rows]),x.useEffect(()=>{const{rows:n,initialState:t}=r,{expandedRowIds:e}=t;e&&Object.keys(e).forEach(i=>{var s,l;const a=n.filter(h=>{var u,m;return h.id.toString()===i.toString()||((m=(u=h.original)==null?void 0:u.id)==null?void 0:m.toString())===i.toString()});(a.length&&i.toString()===a[0].id.toString()||a.length&&i.toString()===((l=(s=a[0].original)==null?void 0:s.id)==null?void 0:l.toString()))&&a[0].toggleRowExpanded()})},[r]);const o=24,b=(n,{row:t})=>[n,{className:f({[`${_}__carbon-nested-row`]:t.depth>0,[`${_}__carbon-row-expanded`]:t.isExpanded})}],C=(n,{row:t})=>[n,{style:{paddingLeft:`${t.depth>1?o*2+(t.depth-1)*(o+o/3):t.depth===1?o*2:0}px`}}],p=n=>32*n+16,$=(n,{cell:t,instance:e})=>{const i=e.columns.findIndex(a=>a.id===t.column.id)===0;return[n,{style:{marginRight:i&&t.row.depth>0&&parseInt(n.style.width,10)<=p(t.row.depth)+50?`${parseInt(n.style.width,10)-(p(t.row.depth)+50)}px`:"",width:i&&t.row.depth>0?parseInt(n.style.width,10)-p(t.row.depth):n.style.width}}]};Object.assign(r,{withNestedRows:!0}),c.getRowProps.push(b),c.getRowProps.push(C),c.getCellProps.push($)};c.useInstance.push(g)};export{k as u};
