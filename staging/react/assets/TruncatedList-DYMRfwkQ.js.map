{"version":3,"file":"TruncatedList-DYMRfwkQ.js","sources":["../../src/components/TruncatedList/TruncatedList.tsx"],"sourcesContent":["/**\n * Copyright IBM Corp. 2024, 2025\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n// Import portions of React that are needed.\nimport React, {\n  Children,\n  PropsWithChildren,\n  ReactNode,\n  useEffect,\n  useRef,\n  useState,\n} from 'react';\nimport { pkg } from '../../settings';\n\n// Carbon and package components we use.\nimport { Button, usePrefix } from '@carbon/react';\n// Other standard imports.\nimport PropTypes from 'prop-types';\nimport cx from 'classnames';\nimport { getDevtoolsProps } from '../../global/js/utils/devtools';\nimport { useIsomorphicEffect } from '../../global/js/hooks';\n\n// The block part of our conventional BEM class names (blockClass__E--M).\nconst blockClass = `${pkg.prefix}--truncated-list`;\nconst componentName = 'TruncatedList';\n\nconst defaults = {\n  as: 'ul',\n  collapsedItemsLimit: 5,\n  expandedItemsLimit: 10,\n  onClick: () => {},\n  viewLessLabel: 'View less',\n  viewMoreLabel: (value: number) => `View more (${value})`,\n};\n\nexport interface TruncatedListProps extends PropsWithChildren {\n  as?: React.ElementType | string;\n  /**\n   * Optional class name for expand/collapse button.\n   */\n  buttonClassName?: string;\n  /**\n   * The contents of the TruncatedList.\n   */\n  children: ReactNode;\n  /**\n   * Provide an optional class to be applied to the containing node.\n   */\n  className?: string;\n  /**\n   * Number of items to render and display when the list is truncated and collapsed.\n   * Scrolling is not enabled when collapsed. The smallest number is 1.\n   */\n  collapsedItemsLimit?: number;\n  /**\n   * Maximum number of items to show when the list is expanded. All\n   * items are rendered when the list is expanded. Scrolling is enabled\n   * if there are more items to display than this number.\n   */\n  expandedItemsLimit?: number;\n  /**\n   * Optional callback reports the collapsed state of the list.\n   */\n  onClick?: (value: any) => void;\n  /**\n   * Text label for when the list is expanded.\n   */\n  viewLessLabel?: string;\n  /**\n   * Callback function for building the label when the list is collapsed.\n   */\n  viewMoreLabel?: (value: number) => ReactNode;\n}\n/**\n * The `TruncatedList` allows consumers to control how many items are\n * revealed to the user while giving the user the ability to expand\n * and see the entire list.\n */\nexport const TruncatedList = React.forwardRef<\n  HTMLDivElement,\n  TruncatedListProps\n>(\n  (\n    {\n      children,\n      className,\n      as: List = defaults.as,\n      buttonClassName,\n      collapsedItemsLimit = defaults.collapsedItemsLimit,\n      expandedItemsLimit = defaults.expandedItemsLimit,\n      onClick = defaults.onClick,\n      viewLessLabel = defaults.viewLessLabel,\n      viewMoreLabel = defaults.viewMoreLabel,\n      // Collect any other property values passed in.\n      ...rest\n    }: TruncatedListProps,\n    ref\n  ) => {\n    const childrenArray = Children.toArray(children);\n    // Exception handling: minimum number of items is 1.\n    const minItems = Math.max(collapsedItemsLimit, 1);\n    // Exception handling: maximum number of items is the number of items passed as children.\n    const maxItems = Math.min(expandedItemsLimit, childrenArray.length);\n    const [isCollapsed, setIsCollapsed] = useState(true);\n    // To minimize *initial* animation,\n    //   (difference of zero height to component's rendered height)\n    // guesstimate the initial height to reduce animation distance.\n    //   (difference of the guessed height to rendered height - a few pixels)\n    const [listHeight, setListHeight] = useState(minItems * 16);\n    const listRef = useRef<HTMLElement | undefined>(undefined);\n    const carbonPrefix = usePrefix();\n\n    const handleToggle = () => {\n      setIsCollapsed((prev) => !prev);\n    };\n\n    useEffect(() => {\n      onClick(isCollapsed);\n    }, [isCollapsed, onClick]);\n\n    // Calculate height of the list by measuring the height of each item.\n    // (E.g. the height of plain text is not the same height as a link.)\n    // CSS animation requires an explicitly declared height for when the\n    // list is both collapsed and expanded.\n    useEffect(() => {\n      if (listRef && childrenArray.length > 0) {\n        const numItemsToShow = isCollapsed ? minItems : maxItems;\n        const items = listRef.current?.childNodes;\n        let listHeight = 0;\n\n        for (let index = 0; index < numItemsToShow; index++) {\n          if (items && items[index]) {\n            const itemElement = items[index] as HTMLElement;\n            const height =\n              window?.getComputedStyle(itemElement)?.height || '16';\n            listHeight += parseInt(height);\n          }\n        }\n\n        setListHeight(listHeight);\n      }\n    }, [childrenArray, minItems, maxItems, isCollapsed, listRef]);\n\n    useIsomorphicEffect(() => {\n      if (listRef.current) {\n        listRef.current.style.height = `${listHeight}px`;\n      }\n    }, [listHeight]);\n\n    return (\n      <div\n        {...rest}\n        className={cx(\n          blockClass,\n          className,\n          isCollapsed ? `${blockClass}--collapsed` : `${blockClass}--expanded`,\n          // If the list is expanded && showing all the items,\n          // then disable scrolling using CSS, instead of adding an arbitrary #px to the height of the list.\n          !isCollapsed &&\n            childrenArray.length <= maxItems &&\n            `${blockClass}--expanded-all`\n        )}\n        ref={ref}\n        {...getDevtoolsProps(componentName)}\n      >\n        <List className={`${blockClass}__list`} ref={listRef}>\n          {isCollapsed ? childrenArray.slice(0, minItems) : children}\n        </List>\n\n        {childrenArray.length > minItems && (\n          <Button\n            className={cx(\n              `${blockClass}__button`,\n              `${carbonPrefix}--link`,\n              buttonClassName\n            )}\n            kind=\"ghost\"\n            size=\"sm\"\n            onClick={handleToggle}\n          >\n            {isCollapsed\n              ? viewMoreLabel(childrenArray.length - minItems)\n              : viewLessLabel}\n          </Button>\n        )}\n      </div>\n    );\n  }\n);\n\n// Return a placeholder if not released and not enabled by feature flag\n\n// The display name of the component, used by React. Note that displayName\n// is used in preference to relying on function.name.\nTruncatedList.displayName = componentName;\n\n// The types and DocGen commentary for the component props,\n// in alphabetical order (for consistency).\n// See https://www.npmjs.com/package/prop-types#usage.\nTruncatedList.propTypes = {\n  /**\n   * The type of list element to render.\n   * This could be a `ul`, `ol`, or a custom React component.\n   */\n  as: PropTypes.oneOfType([PropTypes.elementType, PropTypes.string]),\n  /**\n   * Optional class name for expand/collapse button.\n   */\n  buttonClassName: PropTypes.string,\n  /**\n   * The contents of the TruncatedList.\n   */\n  children: PropTypes.node.isRequired,\n  /**\n   * Provide an optional class to be applied to the containing node.\n   */\n  className: PropTypes.string,\n  /**\n   * Number of items to render and display when the list is truncated and collapsed.\n   * Scrolling is not enabled when collapsed. The smallest number is 1.\n   */\n  collapsedItemsLimit: PropTypes.number,\n  /**\n   * Maximum number of items to show when the list is expanded. All\n   * items are rendered when the list is expanded. Scrolling is enabled\n   * if there are more items to display than this number.\n   */\n  expandedItemsLimit: PropTypes.number,\n  /**\n   * Optional callback reports the collapsed state of the list.\n   */\n  onClick: PropTypes.func,\n  /**\n   * Text label for when the list is expanded.\n   */\n  viewLessLabel: PropTypes.string,\n  /**\n   * Callback function for building the label when the list is collapsed.\n   */\n  viewMoreLabel: PropTypes.func,\n};\n"],"names":["blockClass","pkg","componentName","defaults","value","TruncatedList","React","children","className","List","buttonClassName","collapsedItemsLimit","expandedItemsLimit","onClick","viewLessLabel","viewMoreLabel","rest","ref","childrenArray","Children","minItems","maxItems","isCollapsed","setIsCollapsed","useState","listHeight","setListHeight","listRef","useRef","carbonPrefix","usePrefix","handleToggle","prev","useEffect","numItemsToShow","items","index","itemElement","height","useIsomorphicEffect","cx","getDevtoolsProps","Button","PropTypes"],"mappings":"oLA2BA,MAAMA,EAAa,GAAGC,EAAI,MAAM,mBAC1BC,EAAgB,gBAEhBC,EAAW,CACf,GAAI,KACJ,oBAAqB,EACrB,mBAAoB,GACpB,QAAS,IAAM,CAAC,EAChB,cAAe,YACf,cAAgBC,GAAkB,cAAcA,CAAK,GACvD,EA6CaC,EAAgBC,EAAM,WAIjC,CACE,CACE,SAAAC,EACA,UAAAC,EACA,GAAIC,EAAON,EAAS,GACpB,gBAAAO,EACA,oBAAAC,EAAsBR,EAAS,oBAC/B,mBAAAS,EAAqBT,EAAS,mBAC9B,QAAAU,EAAUV,EAAS,QACnB,cAAAW,EAAgBX,EAAS,cACzB,cAAAY,EAAgBZ,EAAS,cAEzB,GAAGa,CAAA,EAELC,IACG,CACH,MAAMC,EAAgBC,EAAAA,SAAS,QAAQZ,CAAQ,EAEzCa,EAAW,KAAK,IAAIT,EAAqB,CAAC,EAE1CU,EAAW,KAAK,IAAIT,EAAoBM,EAAc,MAAM,EAC5D,CAACI,EAAaC,CAAc,EAAIC,EAAAA,SAAS,EAAI,EAK7C,CAACC,EAAYC,CAAa,EAAIF,EAAAA,SAASJ,EAAW,EAAE,EACpDO,EAAUC,EAAAA,OAAgC,MAAS,EACnDC,EAAeC,EAAA,EAEfC,EAAe,IAAM,CACzBR,EAAgBS,GAAS,CAACA,CAAI,CAChC,EAEAC,OAAAA,EAAAA,UAAU,IAAM,CACdpB,EAAQS,CAAW,CACrB,EAAG,CAACA,EAAaT,CAAO,CAAC,EAMzBoB,EAAAA,UAAU,IAAM,CACd,GAAIN,GAAWT,EAAc,OAAS,EAAG,CACvC,MAAMgB,EAAiBZ,EAAcF,EAAWC,EAC1Cc,EAAQR,EAAQ,SAAS,WAC/B,IAAIF,EAAa,EAEjB,QAASW,EAAQ,EAAGA,EAAQF,EAAgBE,IAC1C,GAAID,GAASA,EAAMC,CAAK,EAAG,CACzB,MAAMC,EAAcF,EAAMC,CAAK,EACzBE,EACJ,QAAQ,iBAAiBD,CAAW,GAAG,QAAU,KACnDZ,GAAc,SAASa,CAAM,CAC/B,CAGFZ,EAAcD,CAAU,CAC1B,CACF,EAAG,CAACP,EAAeE,EAAUC,EAAUC,EAAaK,CAAO,CAAC,EAE5DY,EAAoB,IAAM,CACpBZ,EAAQ,UACVA,EAAQ,QAAQ,MAAM,OAAS,GAAGF,CAAU,KAEhD,EAAG,CAACA,CAAU,CAAC,EAGbnB,EAAA,cAAC,MAAA,CACE,GAAGU,EACJ,UAAWwB,EACTxC,EACAQ,EACAc,EAAc,GAAGtB,CAAU,cAAgB,GAAGA,CAAU,aAGxD,CAACsB,GACCJ,EAAc,QAAUG,GACxB,GAAGrB,CAAU,gBAAA,EAEjB,IAAAiB,EACC,GAAGwB,EAAiBvC,CAAa,CAAA,EAElCI,EAAA,cAACG,EAAA,CAAK,UAAW,GAAGT,CAAU,SAAU,IAAK2B,CAAA,EAC1CL,EAAcJ,EAAc,MAAM,EAAGE,CAAQ,EAAIb,CACpD,EAECW,EAAc,OAASE,GACtBd,EAAA,cAACoC,EAAA,CACC,UAAWF,EACT,GAAGxC,CAAU,WACb,GAAG6B,CAAY,SACfnB,CAAA,EAEF,KAAK,QACL,KAAK,KACL,QAASqB,CAAA,EAERT,EACGP,EAAcG,EAAc,OAASE,CAAQ,EAC7CN,CAAA,CACN,CAIR,CACF,EAMAT,EAAc,YAAcH,EAK5BG,EAAc,UAAY,CAKxB,GAAIsC,EAAU,UAAU,CAACA,EAAU,YAAaA,EAAU,MAAM,CAAC,EAIjE,gBAAiBA,EAAU,OAI3B,SAAUA,EAAU,KAAK,WAIzB,UAAWA,EAAU,OAKrB,oBAAqBA,EAAU,OAM/B,mBAAoBA,EAAU,OAI9B,QAASA,EAAU,KAInB,cAAeA,EAAU,OAIzB,cAAeA,EAAU,IAC3B;;;"}