{"version":3,"file":"useExpandedRow-CXnXgCg1.js","sources":["../../src/components/Datagrid/Datagrid/DatagridExpandedRow.tsx","../../src/components/Datagrid/useRowExpander.js","../../src/components/Datagrid/useExpandedRow.ts"],"sourcesContent":["/**\n * Copyright IBM Corp. 2020, 2024\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React, { JSXElementConstructor, isValidElement } from 'react';\nimport { pkg } from '../../../settings';\nimport cx from 'classnames';\nimport { DataGridState } from '../types';\n\nconst blockClass = `${pkg.prefix}--datagrid`;\n\nconst DatagridExpandedRow =\n  (ExpandedRowContentComponent: JSXElementConstructor<any>) =>\n  (datagridState: DataGridState) => {\n    const { row } = datagridState;\n    const { expandedContentHeight } = row;\n\n    const toggleParentHoverClass = (event, eventType = '') => {\n      /* istanbul ignore else */\n      if (event?.target?.closest('tr').previousElementSibling) {\n        const parentNode = event?.target?.closest('tr').previousElementSibling;\n        if (eventType === 'enter') {\n          parentNode.classList.add(`${blockClass}__expandable-row--hover`);\n        } else {\n          parentNode.classList.remove(`${blockClass}__expandable-row--hover`);\n        }\n      }\n    };\n\n    const { key, ..._state } = datagridState;\n\n    return (\n      <tr\n        className={cx(`${blockClass}__expanded-row`, {\n          [`${blockClass}__slug--row`]: isValidElement(row?.original?.slug),\n          [`${blockClass}__ai-label--row`]: isValidElement(\n            row?.original?.aiLabel\n          ),\n        })}\n        onMouseEnter={(event) => toggleParentHoverClass(event, 'enter')}\n        onMouseLeave={(event) => toggleParentHoverClass(event)}\n      >\n        <td className={`${blockClass}__expanded-row-cell-wrapper`}>\n          <div\n            className={`${blockClass}__expanded-row-content`}\n            ref={(el) => {\n              if (el && el.style && expandedContentHeight) {\n                el.style.height = `${expandedContentHeight}px`;\n              }\n            }}\n          >\n            <ExpandedRowContentComponent key={key} {..._state} />\n          </div>\n        </td>\n      </tr>\n    );\n  };\n\nexport default DatagridExpandedRow;\n","/* eslint-disable react/prop-types */\n/**\n * Copyright IBM Corp. 2020, 2025\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React, { useRef } from 'react';\nimport { ChevronDown, ChevronUp } from '@carbon/react/icons';\nimport { pkg } from '../../settings';\nimport cx from 'classnames';\nimport { useFocusRowExpander } from './useFocusRowExpander';\nimport { usePrefix } from '@carbon/react';\n\nconst blockClass = `${pkg.prefix}--datagrid`;\n\nconst useRowExpander = (hooks) => {\n  const tempState = useRef(undefined);\n  const lastExpandedRowIndex = useRef(undefined);\n  const useInstance = (instance) => {\n    tempState.current = instance;\n  };\n  const carbonPrefix = usePrefix();\n\n  useFocusRowExpander({\n    instance: tempState?.current,\n    lastExpandedRowIndex: lastExpandedRowIndex?.current,\n    blockClass,\n    activeElement: document.activeElement,\n  });\n\n  const visibleColumns = (columns) => {\n    const expanderColumn = {\n      id: 'expander',\n      Cell: ({ row }) => {\n        const expanderButtonProps = {\n          ...row.getToggleRowExpandedProps(),\n          onClick: (event) => {\n            // Prevents `onRowClick` from being called if `useOnRowClick` is included\n            event.stopPropagation();\n            row.toggleRowExpanded();\n            row?.onClick?.(row, event);\n            lastExpandedRowIndex.current = row.id;\n          },\n          title: null,\n        };\n        const { expanderButtonTitleExpanded, expanderButtonTitleCollapsed } =\n          tempState?.current || {};\n        const expanderTitle = row.isExpanded\n          ? expanderButtonTitleExpanded\n          : expanderButtonTitleCollapsed;\n        return (\n          row.canExpand && (\n            <button\n              type=\"button\"\n              aria-label={expanderTitle}\n              className={cx(\n                `${blockClass}__row-expander`,\n                `${carbonPrefix}--btn`,\n                `${carbonPrefix}--btn--ghost`\n              )}\n              {...expanderButtonProps}\n            >\n              {row.isExpanded ? (\n                <ChevronUp className={`${blockClass}__row-expander--icon`} />\n              ) : (\n                <ChevronDown className={`${blockClass}__row-expander--icon`} />\n              )}\n            </button>\n          )\n        );\n      },\n      width: 48,\n      disableResizing: true,\n      disableSortBy: true,\n      Header: '',\n    };\n    return [expanderColumn, ...columns];\n  };\n  hooks.visibleColumns.push(visibleColumns);\n  hooks.useInstance.push(useInstance);\n};\n\nexport default useRowExpander;\n","/**\n * Copyright IBM Corp. 2020, 2024\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { useState } from 'react';\nimport DatagridExpandedRow from './Datagrid/DatagridExpandedRow';\nimport useRowExpander from './useRowExpander';\nimport { Hooks, TableInstance } from 'react-table';\nimport { DataGridState, DatagridRow } from './types';\n\nconst useExpandedRow = (hooks: Hooks) => {\n  useRowExpander(hooks);\n  const useInstance = (instance: TableInstance) => {\n    const {\n      rows,\n      expandedContentHeight,\n      ExpandedRowContentComponent,\n      onRowExpand,\n    } = instance as DataGridState;\n    const [expandedRowsHeight, setExpandedRowsHeight] = useState({});\n    const setExpandedRowHeight = (rowIndex, height) =>\n      setExpandedRowsHeight({ ...expandedRowsHeight, [rowIndex]: height });\n    const rowsWithExpand = rows.map((row) => ({\n      ...row,\n      canExpand: row.original && !row.original.notExpandable,\n      expandedContentHeight:\n        expandedRowsHeight[row.index] || expandedContentHeight,\n      RowExpansionRenderer:\n        ExpandedRowContentComponent &&\n        DatagridExpandedRow(ExpandedRowContentComponent),\n      onClick: (row: DatagridRow, event: React.MouseEvent<HTMLElement>) =>\n        onRowExpand?.(row, event),\n    }));\n    Object.assign(instance, {\n      rows: rowsWithExpand,\n      setExpandedRowHeight,\n      withExpandedRows: true,\n    });\n  };\n  hooks.useInstance.push(useInstance);\n};\n\nexport default useExpandedRow;\n"],"names":["blockClass","pkg","DatagridExpandedRow","ExpandedRowContentComponent","datagridState","row","expandedContentHeight","toggleParentHoverClass","event","eventType","parentNode","key","_state","React","cx","isValidElement","el","useRowExpander","hooks","tempState","useRef","lastExpandedRowIndex","useInstance","instance","carbonPrefix","usePrefix","useFocusRowExpander","visibleColumns","columns","expanderButtonProps","expanderButtonTitleExpanded","expanderButtonTitleCollapsed","expanderTitle","ChevronUp","ChevronDown","useExpandedRow","rows","onRowExpand","expandedRowsHeight","setExpandedRowsHeight","useState","setExpandedRowHeight","rowIndex","height","rowsWithExpand"],"mappings":"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"}